(()=>{"use strict";class e extends Error{constructor(e){super(e),this.name="LoginError"}}class t extends Error{constructor(e){super(e),this.name="ServerOutageError"}}class s extends Error{constructor(e,t){super(t),this.code=e}}class a extends Error{constructor(e,t){super(e),this.featureName=t}}const r={LoginError:e,ServerOutageError:t,HTTPError:s,FeatureDependencyError:a};class i{static escape(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>t[e]))}static fragment(e){const t=document.createElement("template");return t.innerHTML=DOMPurify.sanitize(e),t.content}static element(e){return i.fragment(e).firstElementChild}static _getNode(e){let t=e;return null==t?(console.warn(t+" is not an Element."),null):("string"==typeof t&&(t=document.querySelector(t)),t instanceof Element?t:(console.warn(t+" is not an Element."),null))}static inner(e,t){const s=i._getNode(e);return s&&(s.innerHTML=DOMPurify.sanitize(t)),s}static replace(e,t){const s=i._getNode(e);return s&&(s.outerHTML=DOMPurify.sanitize(t)),s}static wrap(e,t){const s=i._getNode(e);if(s){const e=i.element(t);return s.replaceWith(e),e.append(s),e}return s}static adjacent(e,t,s){const a=i._getNode(e);return a&&a.insertAdjacentHTML(t,DOMPurify.sanitize(s)),a}static beforeBegin(e,t){i.adjacent(e,"beforebegin",t)}static afterBegin(e,t){i.adjacent(e,"afterbegin",t)}static beforeEnd(e,t){i.adjacent(e,"beforeend",t)}static afterEnd(e,t){i.adjacent(e,"afterend",t)}}class n{static clearSpecialSymbols(e){return e.replace(/[\u00AE\u00A9\u2122]/g,"")}static htmlToDOM(e){return i.fragment(e)}static htmlToElement(e){return i.element(e)}static getVariableFromText(e,t,s){let a;if("object"===s)a=new RegExp(t+"\\s*=\\s*(\\{.+?\\});");else if("array"===s)a=new RegExp(t+"\\s*=\\s*(\\[.+?\\]);");else if("int"===s)a=new RegExp(t+"\\s*=\\s*(.+?);");else{if("string"!==s)return null;a=new RegExp(t+'\\s*=\\s*(\\".+?\\");')}const r=e.match(a);return r?"int"===s?parseInt(r[1]):JSON.parse(r[1]):null}static getVariableFromDom(e,t,s=document){for(const a of s.querySelectorAll("script")){const s=n.getVariableFromText(a.textContent,e,t);if(null!==s)return s}return null}}class o{static get(e,t){const s=e.trim();return o.cache.has(s)?o.cache.get(s):t}static set(e,t,s=31536e3){let a=e.trim(),r=t.trim();o.cache.set(a,r),a=encodeURIComponent(a),r=encodeURIComponent(r),document.cookie=`${a}=${r}; max-age=${s}`}static remove(e){let t=e.trim();o.cache.delete(t),t=encodeURIComponent(t),document.cookie=t+"; expires=Thu, 01 Jan 1970 00:00:00 GMT"}static init(){o.cache=new Map;for(let[e,t]of document.cookie.split(";").map((e=>e.split("="))))e=e.trim(),o.cache.set(e,decodeURIComponent(t))}}o.init();const c=Object.freeze({BACKGROUND:1,CONTENT_SCRIPT:2,OPTIONS:3});let l;if(browser.extension.getBackgroundPage){const e=browser.extension.getBackgroundPage();l=e===window?c.BACKGROUND:c.OPTIONS}else l=c.CONTENT_SCRIPT;class d{static getCurrentSteamLanguage(){if(null!==this._currentSteamLanguage)return this._currentSteamLanguage;for(const e of document.querySelectorAll("script[src]")){const t=new URL(e.src).searchParams.get("l");if(t)return d._currentSteamLanguage=t,this._currentSteamLanguage}return class{static isBackgroundScript(){return l===c.BACKGROUND}static isContentScript(){return l===c.CONTENT_SCRIPT}static isOptions(){return l===c.OPTIONS}}.isContentScript()&&(d._currentSteamLanguage=o.get("Steam_Language")||null),this._currentSteamLanguage}static getLanguageCode(e){return d.languages[e]||"en"}static isCurrentLanguageOneOf(e){return e.includes(d.getCurrentSteamLanguage())}}d._currentSteamLanguage=null,d.languages={english:"en",bulgarian:"bg",czech:"cs",danish:"da",dutch:"nl",finnish:"fi",french:"fr",greek:"el",german:"de",hungarian:"hu",italian:"it",japanese:"ja",koreana:"ko",norwegian:"no",polish:"pl",portuguese:"pt-PT",brazilian:"pt-BR",russian:"ru",romanian:"ro",schinese:"zh-CN",spanish:"es-ES",latam:"es-419",swedish:"sv-SE",tchinese:"zh-TW",thai:"th",turkish:"tr",ukrainian:"ua",vietnamese:"vi"};class u{static message(e){return browser.runtime.sendMessage(e)}static action(e,...t){return t.length?this.message({action:e,params:t}):this.message({action:e})}}class h{static getURL(e){return browser.runtime.getURL(e)}static get(e){return fetch(h.getURL(e))}static getJSON(e){return h.get(e).then((e=>e.json()))}static getText(e){return h.get(e).then((e=>e.text()))}}const _={version:browser.runtime.getManifest().version,db_version:3};class g{static has(e){return Object.prototype.hasOwnProperty.call(this._cache,e)}static get(e){return void 0===this._cache[e]?(void 0===this.defaults[e]&&console.warn(`Unrecognized SyncedStorage key "${e}"`),this.defaults[e]):this._cache[e]}static set(e,t){return this._cache[e]=t,this._adapter.set({[e]:t})}static import(e){for(const[t,s]of Object.entries(e))this._cache[t]=s;return this._adapter.set(e)}static remove(e){return void 0!==this._cache[e]&&delete this._cache[e],this._adapter.remove(e)}static keys(e=""){return Object.keys(this._cache).filter((t=>t.startsWith(e)))}static entries(){return Object.entries(this._cache)}static async clear(e=!1){let t;e?this._cache={}:t=this.persistent.reduce(((e,t)=>(e[t]=this._cache[t],e)),{}),await this._adapter.clear(),e||await this.import(t)}static async init(){browser.storage.onChanged.addListener((e=>{for(const[t,{newValue:s}]of Object.entries(e))this._cache[t]=s}));const e=await this._adapter.get(null);return Object.assign(this._cache,e),this._cache}static then(e,t){return this.init().then(e,t)}static toJson(){return JSON.stringify(this._cache)}}g.QUOTA_BYTES_PER_ITEM=8192,g._adapter=browser.storage.sync||browser.storage.local,g._cache={},g.defaults=Object.freeze({language:"english",version:_.version,version_show:!0,highlight_owned_color:"#00ce67",highlight_wishlist_color:"#0491bf",highlight_coupon_color:"#a26426",highlight_inv_gift_color:"#800040",highlight_inv_guestpass_color:"#513c73",highlight_notinterested_color:"#4f4f4f",highlight_collection_color:"#856d0e",highlight_waitlist_color:"#4c7521",tag_owned_color:"#00b75b",tag_wishlist_color:"#0383b4",tag_coupon_color:"#c27120",tag_inv_gift_color:"#b10059",tag_inv_guestpass_color:"#65449a",tag_notinterested_color:"#4f4f4f",tag_collection_color:"#856d0e",tag_waitlist_color:"#4c7521",highlight_owned:!0,highlight_wishlist:!0,highlight_coupon:!1,highlight_inv_gift:!1,highlight_inv_guestpass:!1,highlight_notinterested:!1,highlight_excludef2p:!1,highlight_collection:!0,highlight_waitlist:!0,tag_owned:!1,tag_wishlist:!1,tag_coupon:!1,tag_inv_gift:!1,tag_inv_guestpass:!1,tag_notinterested:!0,tag_collection:!1,tag_waitlist:!1,tag_short:!1,hidetmsymbols:!1,showlowestprice:!0,showlowestprice_onwishlist:!0,showlowestpricecoupon:!0,showallstores:!0,stores:[],override_price:"auto",showregionalprice:"mouse",regional_countries:["us","gb","ru","br","au","jp"],show_es_homepagetabs:!0,showmarkettotal:!1,showsteamrepapi:!0,showmcus:!0,showoc:!0,showhltb:!0,showyoutube:!0,showtwitch:!0,showpcgw:!0,showcompletionistme:!1,showprotondb:!1,showviewinlibrary:!1,showsteamcardexchange:!1,showitadlinks:!0,showsteamdb:!0,showbartervg:!1,showastatslink:!0,showyoutubegameplay:!0,showyoutubereviews:!0,showwsgf:!0,exfgls:!0,app_custom_link:[{enabled:!1,name:"Google",url:"google.com/search?q=[ID]+[NAME]",icon:"www.google.com/images/branding/product/ico/googleg_lodp.ico"}],customize_apppage:{recentupdates:!0,reviews:!0,about:!0,contentwarning:!0,steamchart:!0,steamspy:!0,surveys:!0,sysreq:!0,legal:!0,morelikethis:!0,recommendedbycurators:!0,customerreviews:!0},customize_frontpage:{featuredrecommended:!0,specialoffers:!0,trendingamongfriends:!0,discoveryqueue:!0,browsesteam:!0,curators:!0,morecuratorrecommendations:!0,recentlyupdated:!0,fromdevelopersandpublishersthatyouknow:!0,popularvrgames:!0,homepagetabs:!0,gamesstreamingnow:!0,under:!0,updatesandoffers:!0,homepagesidebar:!0},show_package_info:!1,show_steamchart_info:!0,show_steamspy_info:!0,show_early_access:!0,show_alternative_linux_icon:!1,show_itad_button:!1,skip_got_steam:!1,installsteam:"show",openinnewtab:!1,keepssachecked:!1,showemptywishlist:!0,user_notes_app:!0,user_notes_wishlist:!0,showwishliststats:!0,user_notes:{},user_notes_adapter:"synced_storage",replaceaccountname:!0,showlanguagewarning:!0,showlanguagewarninglanguage:"english",homepage_tab_selection:"remember",homepage_tab_last:null,send_age_info:!0,removebroadcasts:!1,mp4video:!1,horizontalscrolling:!0,showsupportinfo:!0,showdrm:!0,regional_hideworld:!1,showinvnav:!0,quickinv:!0,quickinv_diff:-.01,community_default_tab:"",showallachievements:!1,showallstats:!0,showachinstore:!0,showcomparelinks:!1,hideactivelistings:!1,showlowestmarketprice:!0,hidespamcomments:!1,spamcommentregex:"[\\u2500-\\u25FF]",wlbuttoncommunityapp:!0,removeguideslanguagefilter:!1,disablelinkfilter:!1,sortfriendsby:"default_ASC",sortreviewsby:"default_ASC",sortgroupsby:"default_ASC",show1clickgoo:!0,show_profile_link_images:"gray",show_custom_themes:!0,profile_steamrepcn:!0,profile_steamgifts:!0,profile_steamtrades:!0,profile_bartervg:!0,profile_steamrep:!0,profile_steamdbcalc:!0,profile_astats:!0,profile_backpacktf:!0,profile_astatsnl:!0,profile_steamid:!0,profile_custom_link:[{enabled:!0,name:"Google",url:"google.com/search?q=[ID]",icon:"www.google.com/images/branding/product/ico/googleg_lodp.ico"}],fav_emoticons:[],group_steamgifts:!0,steamcardexchange:!0,purchase_dates:!0,show_badge_progress:!0,show_coupon:!0,show_wishlist_link:!0,show_wishlist_count:!0,show_progressbar:!0,show_backtotop:!1,profile_showcase_twitch:!0,profile_showcase_own_twitch:!1,profile_showcase_twitch_profileonly:!1,itad_import_library:!1,itad_import_wishlist:!1,add_to_waitlist:!1,context_steam_store:!1,context_steam_market:!1,context_itad:!1,context_bartervg:!1,context_steamdb:!1,context_steamdb_instant:!1,context_steam_keys:!1}),g.persistent=["user_notes","user_notes_adapter"];class m{static loadLocalization(e){return h.getJSON(`/localization/${e}.json`)}static init(){if(m._promise)return m._promise;let e=d.getCurrentSteamLanguage();const t=g.get("language");function s(e,t){for(const[a,r]of Object.entries(t))void 0!==e[a]?"object"==typeof r?s(e[a],r):""!==r&&(e[a]=r):console.warn("The key %s doesn't exist in the English localization file",a);return e}null===e?e=t:e!==t&&(g.set("language",e),u.action("clearpurchases"));const a=d.getLanguageCode(e),r=["en"];return null!==a&&"en"!==a&&r.push(a),m._promise=Promise.all(r.map((e=>m.loadLocalization(e)))).then((([e,t])=>(m.str=e,t&&s(m.str,t),m.str))),m._promise}static then(e,t){return m.init().then(e,t)}static getString(e){const t=e.split(".").reverse();let s=m.str;for(;t.length;){if("object"!=typeof s)return null;s=s[t.pop()]}return s}}m._promise=null;class p{constructor(e){this._promise=new Promise((t=>{this._id=setTimeout((()=>{t()}),e)}))}then(e,t){if(this._promise)return this._promise.then(e,t);throw new Error("Timer has been cleared before")}clear(){clearTimeout(this._id),this._promise=null}}class f{constructor(e,t){this.onDone=e,this.duration=t,this.reset()}get running(){return this._running}reset(){void 0!==this._id&&clearTimeout(this._id),this._id=setTimeout((async()=>{await this.onDone(),this._running=!1}),this.duration),this._running=!0}}class w{static parseId(e){if(!e)return null;return parseInt(e)||null}static getAppid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsAppid;if(e)return w.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/(?:app|market\/listings)\/(\d+)\/?/);return s&&w.parseId(s[1])}static getSubid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsPackageid;if(e)return w.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/sub\/(\d+)\/?/);return s&&w.parseId(s[1])}static getBundleid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsBundleid;if(e)return w.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/bundle\/(\d+)\/?/);return s&&w.parseId(s[1])}static trimStoreId(e){return Number(e.slice(e.indexOf("/")+1))}static getAppidImgSrc(e){if(!e)return null;const t=e.match(/(?:cdn\.akamai\.steamstatic\.com\/steam|steamcdn-a\.akamaihd\.net\/steam|steamcommunity\/public\/images)\/apps\/(\d+)\//);return t&&w.parseId(t[1])}static getAppidUriQuery(e){if(!e)return null;const t=e.match(/appid=(\d+)/);return t&&w.parseId(t[1])}static getAppids(e){const t=/(?:store\.steampowered|steamcommunity)\.com\/app\/(\d+)\/?/g,s=[];let a;for(;null!==(a=t.exec(e));){const e=w.parseId(a[1]);e&&s.push(e)}return s}static getAppidFromId(e){if(!e)return null;const t=e.match(/game_(\d+)/);return t&&w.parseId(t[1])}static getAppidFromGameCard(e){if(!e)return null;const t=e.match(/\/gamecards\/(\d+)/);return t&&w.parseId(t[1])}}Object.freeze({context_steam_store:{persistent:!0,permissions:["contextMenus"]},context_steam_market:{persistent:!0,permissions:["contextMenus"]},context_itad:{persistent:!0,permissions:["contextMenus"]},context_bartervg:{persistent:!0,permissions:["contextMenus"]},context_steamdb:{persistent:!0,permissions:["contextMenus"]},context_steamdb_instant:{persistent:!0,permissions:["contextMenus"]},context_steam_keys:{persistent:!0,permissions:["contextMenus"]}});class y{constructor(e,t=0,s=0){console.assert(3===[e,t,s].filter(Number.isInteger).length,`${e}.${t}.${s} must be integers`),this.major=e,this.minor=t,this.patch=s}static from(e){if(e instanceof y)return new y(e.major,e.minor,e.patch);if("string"==typeof e)return y.fromString(e);if(Array.isArray(e))return y.fromArray(e);throw new Error("Could not construct a Version from "+e)}static fromArray(e){return new y(...e.map((e=>parseInt(e))))}static fromString(e){return y.fromArray(e.split("."))}static coerce(e){return e instanceof y?e:y.from(e)}toString(){return`${this.major}.${this.minor}.${this.patch}`}toArray(){return[this.major,this.minor,this.patch]}toJSON(){return this.toString()}isCurrent(){return this.isSameOrAfter(_.version)}isSame(e){const t=y.coerce(e);return this.major===t.major&&this.minor===t.minor&&this.patch===t.patch}isBefore(e){const t=y.coerce(e);return this.major<t.major||!(this.major>t.major)&&(this.minor<t.minor||!(this.minor>t.minor)&&this.patch<t.patch)}isSameOrBefore(e){return this.isSame(e)||this.isBefore(e)}isAfter(e){return y.coerce(e).isBefore(this)}isSameOrAfter(e){return y.coerce(e).isSameOrBefore(this)}}class v{static create(){g.get("show_progressbar")&&(i.afterEnd("#global_actions",`<div class="es_progress__wrap">\n                <div class="es_progress es_progress--complete" title="${m.str.ready.ready}">\n                    <div class="es_progress__bar">\n                        <div class="es_progress__value"></div>\n                    </div>\n                </div>\n            </div>`),v._progress=document.querySelector(".es_progress"))}static loading(){v._progress&&(v._progress.setAttribute("title",m.str.ready.loading),v.requests={initiated:0,completed:0},v._progress.classList.remove("es_progress--complete"),v._progress.querySelector(".es_progress__value").style.width="18px")}static startRequest(){v.requests&&(v.requests.initiated++,v.progress())}static finishRequest(){v.requests&&(v.requests.completed++,v.progress())}static progress(e){if(!v._progress)return;let t=e;if(!t){if(!v.requests)return;v.requests.initiated>0&&(t=100*v.requests.completed/v.requests.initiated)}t>100&&(t=100),v._progress.querySelector(".es_progress__value").style.width=t+"px",t>=100&&(v._progress.classList.add("es_progress--complete"),v._progress.setAttribute("title",m.str.ready.ready),v.requests=null)}static serverOutage(){v._progress&&(v._progress.classList.add("es_progress--warning"),v.requests=null,v._progress.parentElement.querySelector(".es_progress__warning, .es_progress__error")||i.afterEnd(v._progress,`<div class="es_progress__warning">${m.str.ready.server_outage}</div>`))}static failed(){if(!v._progress)return;const e=v._progress.parentElement.querySelector(".es_progress__warning");e&&(v._progress.classList.remove("es_progress--warning"),e.remove()),v._progress.classList.add("es_progress--error"),v.requests=null;const t=v._progress.parentElement.querySelector(".es_progress__error");t?t.textContent=m.str.ready.failed.replace("__amount__",++v._failedRequests):i.afterEnd(v._progress,`<div class="es_progress__error">${m.str.ready.failed.replace("__amount__",++v._failedRequests)}</div>`)}}v._progress=null,v._failedRequests=0;class S extends u{static async message(e){let t;v.startRequest();try{return t=await super.message(e),v.finishRequest(),t}catch(e){const t=class{static parse(e){const t=e.match(/(.*):\s(.+)/);return{name:t[1]||"",msg:t[2]||""}}}.parse(e.message);switch(t.name){case"ServerOutageError":v.serverOutage();break;default:S._errorHandlers.some((e=>e(t)))||v.failed()}throw e}}static registerErrorHandler(e){S._errorHandlers.push(e)}}S._errorHandlers=[];class b{static async getHttp(e,t={},s="text"){let a=e;const i={method:"GET",credentials:"include",headers:{origin:window.location.origin},referrer:window.location.origin+window.location.pathname,...t};let n;v.startRequest(),a.startsWith("//")&&(a=window.location.protocol+e,console.warn("Requesting URL without protocol, please update"));try{if(n=await b._fetchFn(a,i),!n.ok)throw new r.HTTPError(n.status,`HTTP ${n.status} ${n.statusText} for ${n.url}`)}catch(e){throw v.failed(),e}return v.finishRequest(),n[s]()}static post(e,t,s,a){return b.getHttp(e,Object.assign(s||{},{method:"POST",body:t}),a?"json":"text")}static getJson(e,t){return b.getHttp(e,t,"json")}static getBlob(e,t){return b.getHttp(e,t,"blob")}}b._fetchFn="undefined"!=typeof content&&content&&content.fetch||fetch.bind(window);class E{static get storeCountry(){const e=new URL(window.location.href);let t;return e.searchParams&&e.searchParams.has("cc")?t=e.searchParams.get("cc"):(t=E._storeCountry,t||(t=o.get("steamCountry"))),t||(console.warn("Failed to detect store country, falling back to US"),t="US"),t.substr(0,2)}static promise(){if(E._promise)return E._promise;const e=document.querySelector("#global_actions > a.user_avatar");let t;return e?(E.profileUrl=e.href,E.profilePath=e.pathname,t=S.action("login",E.profilePath).then((e=>{e&&(E.isSignedIn=!0,E.steamId=e.steamId)}))):t=S.action("logout"),E._promise=t.then((()=>S.action("storecountry"))).catch((({message:e})=>{console.error(e)})).then((e=>{if(e)return E._storeCountry=e,null;let t;if(window.location.hostname.endsWith("steampowered.com"))for(const e of document.getElementsByTagName("script")){const s=e.textContent.match(/GDynamicStore\.Init\(.+?, '([A-Z]{2})/);if(s){t=s[1];break}}else if("steamcommunity.com"===window.location.hostname){const e=document.querySelector("#webui_config,#application_config");e&&(t=JSON.parse(e.dataset.config).COUNTRY)}if(t)return E._storeCountry=t,S.action("storecountry",t).catch((({message:e})=>{console.error(e)}));throw new Error("Script with user store country not found")})).catch((e=>{console.group("Store country detection"),console.warn("Failed to detect store country from page"),console.error(e),console.groupEnd()})),E._promise}static then(e,t){return E.promise().then(e,t)}static get sessionId(){return E._sessionId||(E._sessionId=n.getVariableFromDom("g_sessionID","string")),E._sessionId}static getPurchaseDate(e,t){const s=n.clearSpecialSymbols(t);return S.action("purchases",s,e)}static async getUserToken(){const e=await b.getJson("/pointssummary/ajaxgetasyncconfig").catch((()=>!1));if(!e||!e.success)throw new Error("Failed to get webapi token");return e.data.webapi_token}}Promise.allSettled||(Promise.allSettled=e=>Promise.all(e.map((e=>e.then((e=>({status:"fulfilled",value:e}))).catch((e=>({status:"rejected",reason:e})))))));const k=Object.freeze({ACCOUNT:1,APP:2,BUNDLE:3,STORE_DEFAULT:4,FUNDS:5,REGISTER_KEY:6,SALE:7,SEARCH:8,STATS:9,STORE_FRONT:10,SUB:11,WISHLIST:12,AGECHECK:13,COMMUNITY_DEFAULT:14,WORKSHOP:15,PROFILE_ACTIVITY:16,GAMES:17,PROFILE_EDIT:18,BADGES:19,GAME_CARD:20,FRIENDS_THAT_PLAY:21,FRIENDS:22,GROUPS:23,INVENTORY:24,MARKET_LISTING:25,MARKET:26,PROFILE_HOME:27,GROUP_HOME:28,GUIDES:29,COMMUNITY_APP:30,COMMUNITY_STATS:31,MY_WORKSHOP:32,SHARED_FILES:33,WORKSHOP_BROWSE:34,EDIT_GUIDE:35,RECOMMENDED:36,BOOSTER_CREATOR:37,TRADE_OFFER:38});class C{static clear(){return S.action("dynamicstore.clear")}static async getAppStatus(e){const t=Array.isArray(e);let s,a,r;t?(a=e.map((e=>w.trimStoreId(e))),s=S.action("dynamicstorestatus",a)):s=S.action("dynamicstorestatus",w.trimStoreId(e));const i=await s;if(t){r={};for(let t=0;t<e.length;++t){const s=a[t],n=e[t];r[n]={ignored:i[s].includes("ignored"),wishlisted:i[s].includes("wishlisted")},n.startsWith("app/")?r[n].owned=i[s].includes("ownedApps"):n.startsWith("sub/")&&(r[n].owned=i[s].includes("ownedPackages"))}}else r={ignored:i.includes("ignored"),wishlisted:i.includes("wishlisted")},e.startsWith("app/")?r.owned=i.includes("ownedApps"):e.startsWith("sub/")&&(r.owned=i.includes("ownedPackages"));return r}static async getRandomApp(){return await C._fetch(),S.action("dynamicStore.randomApp")}static _fetch(){return E.isSignedIn?Promise.resolve(null):C.clear()}static then(e,t){return C._promise||(C._promise=C._fetch()),C._promise.then(e,t)}}class L{static getCoupon(e){return S.action("coupon",e)}static async getAppStatus(e,t){function s(e,t){return{gift:e.includes("gifts"),guestPass:e.includes("passes"),coupon:Boolean(t)}}const a={giftsAndPasses:!0,coupons:!0,...t};if(!a.giftsAndPasses&&!a.coupons)return null;const r=Array.isArray(e);try{const[t,i]=await Promise.all([a.giftsAndPasses?S.action("hasgiftsandpasses",e):Promise.resolve(),a.coupons?S.action("hascoupon",e):Promise.resolve()]);if(r){const a={};for(const r of e)a[r]=s(t?t[r]:[],!!i&&i[r]);return a}return s(t||[],void 0!==i&&i)}catch(t){if(r){const t={};for(const a of e)t[a]=s([],!1);return t}return s([],!1)}}static hasInMarketInventory(e){return S.action("hasitem",e)}}class A{constructor(e){this.context=e}checkPrerequisites(){return!0}apply(){throw new Error("Stub")}logError(e,t,...s){console.group(this.constructor.name),console.error(t,...s),console.error(e),console.groupEnd()}}class x{static get(e,t){const s=localStorage.getItem(e);if(!s)return t;try{return JSON.parse(s)}catch(e){return t}}static set(e,t){localStorage.setItem(e,JSON.stringify(t))}static has(e){return null!==localStorage.getItem(e)}static remove(e){localStorage.removeItem(e)}static keys(){const e=[];for(let t=localStorage.length-1;t>=0;--t)e.push(localStorage.key(t));return e}static clear(){localStorage.clear()}}class q{static wrap(e,t){const s=t.parentNode;s.insertBefore(e,t),s.removeChild(t),e.append(t)}static remove(e){const t=document.querySelector(e);t&&t.remove()}static selectLastNode(e,t){const s=e.querySelectorAll(t);return 0===s.length?null:s[s.length-1]}static insertStylesheet(e){const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t)}static insertScript({src:e,content:t},s,a,r=!0){const i=document.createElement("script");a&&(i.onload=a),s&&(i.id=s),e&&(i.src=e),t&&(i.textContent=t),i.async=r,document.head.appendChild(i)}}class T{static create(e,t,s){let a=0;e.addEventListener("wheel",(e=>{e.preventDefault(),e.stopPropagation(),Date.now()-a<200||(a=Date.now(),e.deltaY>0?s.click():t.click())}))}}const I="https://augmentedsteam.com";class P{static _addMenu(){i.afterBegin("#global_action_menu",`<div id="es_menu">\n                <span id="es_pulldown" class="pulldown global_action_link">Augmented Steam</span>\n                <div id="es_popup" class="popup_block_new">\n                    <div class="popup_body popup_menu">\n                        <a class="popup_menu_item" target="_blank" href="${h.getURL("html/options.html")}">${m.str.thewordoptions}</a>\n                        <a class="popup_menu_item" id="es_clear_cache" href="#clear_cache">${m.str.clear_cache}</a>\n                        <div class="hr"></div>\n                        <a class="popup_menu_item" target="_blank" href="https://github.com/tfedor/AugmentedSteam">${m.str.contribute}</a>\n                        <a class="popup_menu_item" target="_blank" href="https://github.com/tfedor/AugmentedSteam/issues">${m.str.bug_feature}</a>\n                        <div class="hr"></div>\n                        <a class="popup_menu_item" target="_blank" href="${I}">${m.str.website}</a>\n                        <a class="popup_menu_item" target="_blank" href="https://isthereanydeal.com/">IsThereAnyDeal</a>\n                        <a class="popup_menu_item" target="_blank" href="https://discord.gg/yn57q7f">Discord</a>\n                    </div>\n                </div>\n            </div>`),document.querySelector("#es_pulldown").addEventListener("click",(()=>{F.runInPageContext((()=>{window.SteamFacade.showMenu("es_pulldown","es_popup","right","bottom",!0)}))})),document.querySelector("#es_menu").addEventListener("click",(e=>{e.stopPropagation()})),document.querySelector("#es_popup").addEventListener("click",(()=>{F.runInPageContext((()=>{window.SteamFacade.hideMenu("es_pulldown","es_popup")}))})),document.querySelector("#es_clear_cache").addEventListener("click",(e=>{e.preventDefault(),P.clearCache(),window.location.reload()}))}static _addBackToTop(){if(!g.get("show_backtotop"))return;q.remove("#BackToTop");const e=document.createElement("div");e.classList.add("es_btt"),e.textContent="▲",document.body.append(e),e.addEventListener("click",(()=>{window.scroll({top:0,left:0,behavior:"smooth"})})),window.addEventListener("scroll",(()=>{e.classList.toggle("is-visible",window.scrollY>=400)}))}static _bindLogout(){document.querySelector("a[href$='javascript:Logout();']").addEventListener("click",(()=>{P.clearCache()}))}static _addWarning(e,t){const s=i.element(`<div class="es_warn js-warn">\n                <div class="es_warn__cnt">\n                    <div>${e}</div>\n                    <div class="es_warn__control">\n                        <a class="es_warn__btn js-warn-close">${m.str.update.dont_show}</a>\n                        <a class="es_warn__btn js-warn-hide">${m.str.hide}</a>\n                    </div>\n                </div>\n            </div>`);s.querySelector(".js-warn-close").addEventListener("click",(()=>{t&&t(),s.closest(".js-warn").remove()})),s.querySelector(".js-warn-hide").addEventListener("click",(()=>{s.closest(".js-warn").remove()})),document.getElementById("global_header").insertAdjacentElement("afterend",s)}static _addLanguageWarning(){if(!g.get("showlanguagewarning"))return;const e=d.getCurrentSteamLanguage();if(!e)return;g.has("showlanguagewarninglanguage")||g.set("showlanguagewarninglanguage",e);const t=g.get("showlanguagewarninglanguage");e!==t&&m.loadLocalization(d.getLanguageCode(t)).then((s=>{P._addWarning(`${s.using_language.replace("__current__",s.options.lang[e]||e)}\n                <a href="#" id="es_reset_language_code">\n                ${s.using_language_return.replace("__base__",s.options.lang[t]||t)}\n                </a>`,(()=>{g.set("showlanguagewarning",!1)})),document.querySelector("#es_reset_language_code").addEventListener("click",(e=>{e.preventDefault(),F.runInPageContext((e=>{ChangeLanguage(e)}),[t])}))}))}static _handleInstallSteamButton(){const e=g.get("installsteam");if("hide"===e)q.remove("div.header_installsteam_btn");else if("replace"===e){const e=document.querySelector("div.header_installsteam_btn > a");e.textContent=m.str.viewinclient,e.href="steam://openurl/"+window.location.href,e.classList.add("es_steamclient_btn")}}static _addUsernameSubmenuLinks(){const e=document.querySelector(".supernav_container .submenu_username");i.afterEnd(e.querySelector("a"),`<a class="submenuitem" href="//steamcommunity.com/my/games/">${m.str.games}</a>`),i.afterEnd(e.querySelector("a:nth-child(2)"),`<a class="submenuitem" href="//store.steampowered.com/wishlist/">${m.str.wishlist}</a>`),i.beforeEnd(e,`<a class="submenuitem" href="//steamcommunity.com/my/recommended/">${m.str.reviews}</a>`)}static _disableLinkFilter(){function e(e=document){for(const t of e.querySelectorAll("a[href*='/linkfilter/']"))t.href=t.href.replace(/^.+?\/linkfilter\/\?url=/,"")}g.get("disablelinkfilter")&&(e(),new MutationObserver((t=>{for(const s of t)for(const t of s.addedNodes)t.nodeType===Node.ELEMENT_NODE&&e(t)})).observe(document,{childList:!0,subtree:!0}))}static _addRedeemLink(){i.beforeBegin("#account_language_pulldown",`<a class="popup_menu_item" href="https://store.steampowered.com/account/registerkey">${m.str.activate}</a>`)}static _replaceAccountName(){if(!g.get("replaceaccountname"))return;const e=document.querySelector("#account_dropdown .persona.online"),t=e.textContent.trim(),s=document.querySelector("#account_pulldown").textContent.trim();if(e.textContent=s,location.href.startsWith("https://store.steampowered.com/account")){const e=document.querySelector("h2.pageheader");e&&(e.textContent=e.textContent.replace(new RegExp(t,"i"),s))}/.*(id|profiles)\/.+/g.test(location.pathname)&&!location.pathname.includes(E.profilePath)||(document.title=document.title.replace(t,s))}static _launchRandomButton(){i.beforeEnd("#es_popup .popup_menu",`<div class="hr"></div>\n             <a id="es_random_game" class="popup_menu_item" style="cursor: pointer;">${m.str.launch_random}</a>`),document.querySelector("#es_random_game").addEventListener("click",(async()=>{const e=await C.getRandomApp();e&&S.action("appdetails",e).then((t=>{if(!t||!t.success)return;const s=t.data;let a,r=e;s.fullgame?(r=s.fullgame.appid,a=s.fullgame.name):a=s.name,F.runInPageContext(((e,t,s)=>{window.SteamFacade.showConfirmDialog(e,`<img src="//steamcdn-a.akamaihd.net/steam/apps/${t}/header.jpg">`,null,null,s).done((e=>{"OK"===e&&window.location.assign("steam://run/"+t),"SECONDARY"===e&&window.location.assign("//store.steampowered.com/app/"+t)}))}),[m.str.play_game.replace("__gamename__",a.replace("'","").trim()),r,m.str.visit_store])}))}))}static _skipGotSteam(){if(g.get("skip_got_steam"))for(const e of document.querySelectorAll("a[href^='javascript:ShowGotSteamModal']"))e.href=e.href.split("'")[1]}static _keepSteamSubscriberAgreementState(){const e=document.querySelectorAll("#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa");for(const t of e)t.checked=g.get("keepssachecked"),t.addEventListener("click",(()=>{g.set("keepssachecked",!g.get("keepssachecked"))}))}static _defaultCommunityTab(){const e=g.get("community_default_tab");if(!e)return;const t=document.querySelectorAll("a[href^='https://steamcommunity.com/app/']");for(const s of t)s.classList.contains("apphub_sectionTab")||/^\/app\/[0-9]+\/?$/.test(s.pathname)&&(s.pathname.endsWith("/")||(s.pathname+="/"),s.pathname+=e+"/")}static _horizontalScrolling(){if(g.get("horizontalscrolling"))for(const e of document.querySelectorAll(".slider_ctn:not(.spotlight)"))T.create(e.parentNode.querySelector("#highlight_strip, .store_horizontal_autoslider_ctn"),e.querySelector(".slider_left"),e.querySelector(".slider_right"))}static addLoginWarning(e){if(P._loginWarningAdded||x.get("hide_login_warn_"+e))return;let t;if("store"===e)t="store.steampowered.com";else{if("community"!==e)return void console.warn("Unknown login warning type %s",e);t="steamcommunity.com"}P._addWarning(""+m.str.login_warning.replace("__link__",`<a href="https://${t}/login/">${t}</a>`),(()=>{x.set("hide_login_warn_"+e,!0)})),P._loginWarningAdded=!0,console.warn("Are you logged into %s?",t)}static clearCache(){localStorage.clear(),g.remove("user_currency"),g.remove("store_sessionid"),S.action("cache.clear")}static init(){P._addBackToTop(),P._addMenu(),P._addLanguageWarning(),P._handleInstallSteamButton(),P._disableLinkFilter(),P._skipGotSteam(),P._keepSteamSubscriberAgreementState(),P._defaultCommunityTab(),P._horizontalScrolling(),E.isSignedIn&&(P._addUsernameSubmenuLinks(),P._addRedeemLink(),P._replaceAccountName(),P._launchRandomButton(),P._bindLogout())}}class ${static escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class N{constructor({id:e,abbr:t="USD",symbol:s="$",hint:a="Default Currency",multiplier:r=100,unit:i=1,format:{places:n=2,hidePlacesWhenZero:o=!1,symbolFormat:c="$",thousand:l=",",group:d=3,decimal:u=".",right:h=!1}}){Object.assign(this,{id:e,abbr:t,symbol:s,hint:a,multiplier:r,unit:i,format:{decimalPlaces:n,hidePlacesWhenZero:o,symbol:c,groupSeparator:l,groupSize:d,decimalSeparator:u,postfix:h}}),Object.freeze(this.format),Object.freeze(this)}valueOf(e){let t=e.trim().replace(this.format.groupSeparator,"");"."!==this.format.decimalSeparator&&(t=t.replace(this.format.decimalSeparator,".")),t=t.replace(/[^\d.]/g,"");const s=parseFloat(t);return Number.isNaN(s)?null:s}stringify(e,t=!0){const s=e<0?"-":"";let a,r=Math.abs(e).toFixed(this.format.decimalPlaces);[r,a]=r.split(".");const i=[];let n=r.length;for(;n>this.format.groupSize;n-=this.format.groupSize)i.unshift(r.substring(n-this.format.groupSize,n));return i.unshift(r.substring(0,n)),r=[s,i.join(this.format.groupSeparator)],this.format.decimalPlaces>0&&(!this.format.hidePlacesWhenZero||parseInt(a)>0)&&(r.push(this.format.decimalSeparator),r.push(a)),t&&(this.format.postfix?r.push(this.format.symbol):r.unshift(this.format.symbol)),r.join("")}placeholder(){let e="1"+this.format.groupSeparator,t=2;for(let s=0;s<this.format.groupSize;++s,++t)e+=t;if(0===this.format.decimalPlaces)return e;e+=this.format.decimalSeparator;for(let s=0;s<this.format.decimalPlaces;++s,++t)e+=t;return e}regExp(){let e=`^(?:\\d{1,${this.format.groupSize}}(?:${$.escapeRegExp(this.format.groupSeparator)}\\d{${this.format.groupSize}})+|\\d*)`;return this.format.decimalPlaces>0&&(e+=`(?:${$.escapeRegExp(this.format.decimalSeparator)}\\d{0,${this.format.decimalPlaces}})?`),e+="$",new RegExp(e)}}class O{static _getCurrencyFromDom(){const e=document.querySelector('meta[itemprop="priceCurrency"]');return e&&e.hasAttribute("content")?e.getAttribute("content"):null}static async _getCurrencyFromWallet(){const e=await F.runInPageContext((()=>"undefined"!=typeof g_rgWalletInfo&&g_rgWalletInfo?g_rgWalletInfo.wallet_currency:null),null,"walletCurrency");return e?O.currencyNumberToType(e):null}static async _getStoreCurrency(e){let t=O._getCurrencyFromDom();if(t||(t=await O._getCurrencyFromWallet(e)),!t)try{t=await S.action("currency")}catch(e){console.error("Couldn't load currency"+e)}return t||(t="USD"),t}static getRate(e,t){return e===t?1:O._rates[e]&&O._rates[e][t]?O._rates[e][t]:null}static getCurrencySymbolFromString(e){const t=e.match(/(?:R\$|S\$|\$|RM|kr|Rp|€|¥|£|฿|pуб|P|₫|₩|TL|₴|Mex\$|CDN\$|A\$|HK\$|NT\$|₹|SR|R |DH|CHF|CLP\$|S\/\.|COL\$|NZ\$|ARS\$|₡|₪|₸|KD|zł|QR|\$U)/);return t?t[0]:""}static currencyTypeToNumber(e){return O.fromType(e).id}static currencyNumberToType(e){return O.fromNumber(e).abbr}static fromType(e){return O._indices.abbr[e]||O._defaultCurrency}static fromNumber(e){return O._indices.id[e]||O._defaultCurrency}static async _loadCurrency(e){O.storeCurrency=await O._getStoreCurrency(e);const t=g.get("override_price");O.customCurrency="auto"===t?O.storeCurrency:t}static async _loadRates(){const e=[O.storeCurrency];O.customCurrency!==O.storeCurrency&&e.push(O.customCurrency),O._rates=await S.action("rates",e)}static async init(e){if(O._isInitialized)return;const t=await S.action("steam.currencies");for(let e of t)e=new N(e),O._indices.abbr[e.abbr]=e,O._indices.id[e.id]=e,e.symbol&&(O._indices.symbols[e.symbol]=e);O._defaultCurrency=O._indices.id[1];try{await O._loadCurrency(e),await O._loadRates()}catch(e){console.error("Failed to initialize Currency"),console.error(e)}O._isInitialized=!0}static then(e,t){return O.init().then(e,t)}}O._isInitialized=!1,O._indices={id:{},abbr:{},symbols:{}};class R{static async getEaNodes(e,t){const s=new Map;for(const a of e){a.classList.add("es_ea_checked");const e=a.querySelector("a"),r=e&&e.hasAttribute("href")?e.getAttribute("href"):a.getAttribute("href"),i=a.querySelector("img"+t),n=w.getAppid(r)||w.getAppidImgSrc(i?i.getAttribute("src"):null);n&&s.set(String(n),a)}const a=await S.action("isea",Array.from(s.keys()));for(const e of s.keys())a[e]||s.delete(e);return Array.from(s.values())}static async _checkNodes(e,t){const s="string"==typeof t?t:"",a=e.map((e=>e+":not(.es_ea_checked)")).join(",");for(const e of await R.getEaNodes(document.querySelectorAll(a),s)){e.classList.add("es_early_access");const t=e.querySelector("img"+s),a=document.createElement("span");a.classList.add("es_overlay_container"),q.wrap(a,t),i.afterBegin(a,`<span class="es_overlay"><img title="${m.str.early_access}" src="${R._imageUrl}"></span>`)}}static _handleStore(){switch(!0){case/^\/app\/.*/.test(window.location.pathname):R._checkNodes([".game_header_image_ctn",".small_cap"]);break;case/^\/(?:genre|browse|tag)\/.*/.test(window.location.pathname):R._checkNodes([".tab_item",".special_tiny_cap",".cluster_capsule",".game_capsule",".browse_tag_game",".dq_item:not(:first-child)",".discovery_queue:not(:first-child)"]);break;case/^\/search\/.*/.test(window.location.pathname):R._checkNodes([".search_result_row"]);break;case/^\/recommended/.test(window.location.pathname):R._checkNodes([".friendplaytime_appheader",".header_image",".appheader",".recommendation_carousel_item .carousel_cap",".game_capsule",".game_capsule_area",".similar_grid_capsule"]);break;case/^\/tag\/.*/.test(window.location.pathname):R._checkNodes([".cluster_capsule",".tab_row",".browse_tag_game_cap"]);break;case/^\/(?:curator|developer|dlc|publisher)\/.*/.test(window.location.pathname):R._checkNodes(["#curator_avatar_image",".capsule"]);break;case/^\/$/.test(window.location.pathname):R._checkNodes([".cap",".special",".game_capsule",".cluster_capsule",".recommended_spotlight_ctn",".curated_app_link",".dailydeal_ctn a",".tab_item:last-of-type",".large_sale_caps a",".small_sale_caps a",".spotlight_img"])}}static _handleCommunity(){switch(!0){case/^\/(?:id|profiles)\/.+\/(wishlist|games|followedgames)/.test(window.location.pathname):R._checkNodes([".gameListRowLogo"]);break;case/^\/(?:id|profiles)\/.+\/\b(home|myactivity)\b/.test(window.location.pathname):R._checkNodes([".blotter_gamepurchase_content a"]);break;case/^\/(?:id|profiles)\/.+\/\b(reviews|recommended)\b/.test(window.location.pathname):R._checkNodes([".leftcol"]);break;case/^\/(?:id|profiles)\/.+/.test(window.location.pathname):R._checkNodes([".game_info_cap",".showcase_gamecollector_game",".favoritegame_showcase_game"])}}static showEarlyAccess(){if(!g.get("show_early_access"))return;let e="img/overlay/early_access_banner_english.png";switch(d.isCurrentLanguageOneOf(["brazilian","french","italian","japanese","koreana","polish","portuguese","russian","schinese","spanish","latam","tchinese","thai"])&&(e=`img/overlay/early_access_banner_${d.getCurrentSteamLanguage()}.png`),R._imageUrl=h.getURL(e),window.location.host){case"store.steampowered.com":R._handleStore();break;case"steamcommunity.com":R._handleCommunity()}}}class M{static async create(){await S.action("itad.isconnected")&&(i.afterBegin("#global_action_menu",`<div id="es_itad">\n                <img id="es_itad_logo" src="${h.getURL("img/itad.png")}">\n                <span id="es_itad_status">✓</span>\n            </div>`),document.querySelector("#es_itad").addEventListener("mouseenter",M.onHover),E.isSignedIn&&(g.get("itad_import_library")||g.get("itad_import_wishlist"))&&S.action("itad.import"))}static async onHover(){async function e(){const{from:e,to:t}=await S.action("itad.lastimport");let s=`<div>${m.str.itad.from}</div>\n                   <div>${e?new Date(1e3*e).toLocaleString():m.str.never}</div>`;(g.get("itad_import_library")||g.get("itad_import_wishlist"))&&(s+=`<div>${m.str.itad.to}</div>\n                        <div>${t?new Date(1e3*t).toLocaleString():m.str.never}</div>`),i.inner(".es-itad-hover__last-import",s)}if(!document.querySelector(".es-itad-hover")){i.afterEnd("#es_itad_status",`<div class="es-itad-hover">\n                    <div class="es-itad-hover__content">\n                        <h4>${m.str.itad.last_import}</h4>\n                        <div class="es-itad-hover__last-import"></div>\n                        <div class="es-itad-hover__sync-now">\n                            <span class="es-itad-hover__sync-now-text">${m.str.itad.sync_now}</span>\n                            <div class="loader"></div>\n                            <span class="es-itad-hover__sync-failed">&#10060;</span>\n                            <span class="es-itad-hover__sync-success">&#10003;</span>\n                        </div>\n                    </div>\n                    <div class="es-itad-hover__arrow"></div>\n                </div>`);const t=document.querySelector(".es-itad-hover"),s=document.querySelector(".es-itad-hover__sync-now");document.querySelector(".es-itad-hover__sync-now-text").addEventListener("click",(async()=>{let a;s.classList.remove("es-itad-hover__sync-now--failed","es-itad-hover__sync-now--success"),s.classList.add("es-itad-hover__sync-now--loading"),t.style.display="block";try{await S.action("itad.sync"),s.classList.add("es-itad-hover__sync-now--success"),await e(),a=1e3}catch(e){s.classList.add("es-itad-hover__sync-now--failed"),console.group("ITAD sync"),console.error("Failed to sync with ITAD"),console.error(e),console.groupEnd(),a=3e3}finally{(class{static timer(e){return new p(e)}static resettableTimer(e,t){return new f(e,t)}static now(){return Math.trunc(Date.now()/1e3)}}).timer(a).then((()=>{t.style.display=""})),s.classList.remove("es-itad-hover__sync-now--loading")}}))}await e()}static async getAppStatus(e,t){const s={waitlist:!0,collection:!0,...t};if(!s.collection&&!s.waitlist)return null;const a=Array.isArray(e),r=[],i=Promise.resolve(!!a&&{});await S.action("itad.isconnected")?(s.collection?r.push(S.action("itad.incollection",e)):r.push(i),s.waitlist?r.push(S.action("itad.inwaitlist",e)):r.push(i)):r.push(i,i);const[n,o]=await Promise.all(r);if(a){const t={};for(const s of e)t[s]={collected:n[s],waitlisted:o[s]};return t}return{collected:n,waitlisted:o}}}class j{static postMessage(e,t){window.postMessage({type:"es_"+e,information:t},window.location.origin)}static onMessage(e){return new Promise((t=>{window.addEventListener("message",(function s(a){a.source===window&&a.data&&a.data.type&&a.data.type==="es_"+e&&(t(a.data.information),window.removeEventListener("message",s))}))}))}static addMessageListener(e,t){window.addEventListener("message",(s=>{s.source===window&&s.data&&s.data.type&&s.data.type==="es_"+e&&t(s.data.information)}))}}void 0===Promise.prototype.finally&&Object.defineProperty(Promise.prototype,"finally",{value:function(e){const t=this.constructor;return this.then((s=>t.resolve(e()).then((()=>s))),(s=>t.resolve(e()).then((()=>{throw console.error(s),s}))))}});let D=!1;window.addEventListener("unhandledrejection",(function(e){const t=e.reason;t&&t.error&&(e.preventDefault(),e.stopPropagation(),console.group("An error occurred in the background context."),console.error(t.localStack),console.error(t.stack),console.groupEnd())})),q.insertScript({content:"window.Messenger = "+j.toString()}),q.insertScript({content:"window.SteamFacade = "+class{static global(e){return window[e]}static globalSet(e,t){window[e]=t}static showDialog(e,t,s){ShowDialog(e,t,s)}static showConfirmDialog(e,t,s,a,r){return ShowConfirmDialog(e,t,s,a,r)}static showAlertDialog(e,t,s){return ShowAlertDialog(e,t,s)}static showBlockingWaitDialog(e,t){return ShowBlockingWaitDialog(e,t)}static showNicknameModal(){return ShowNicknameModal()}static dismissActiveModal(){CModal.DismissActiveModal()}static showMenu(e,t,s,a,r){return ShowMenu(e,t,s,a,r)}static hideMenu(e,t){return HideMenu(e,t)}static collapseLongStrings(e){return CollapseLongStrings(e)}static bindAutoFlyoutEvents(){return BindAutoFlyoutEvents()}static dynamicStoreInvalidateCache(){return GDynamicStore.InvalidateCache()}static dynamicStoreDecorateItems(e,t){return GDynamicStore.DecorateDynamicItems($J(e),t)}static onDynamicStoreReady(e){return GDynamicStore.OnReady(e)}static storeItemDataBindHover(e,t,s,a,r){GStoreItemData.BindHoverEvents($J(e),t,s,a,r)}static vTooltip(e,t=!1){const s="store.steampowered.com"===window.location.host;$J(e).v_tooltip({tooltipClass:s?"store_tooltip":"community_tooltip",dataName:t?"tooltipHtml":"tooltipText",defaultType:t?"html":"text",replaceExisting:!1})}static calculateFeeAmount(e,t){return CalculateFeeAmount(e,t)}static vCurrencyFormat(e,t){return v_currencyformat(e,t)}static toggleManageFriends(){return ToggleManageFriends()}static openFriendChatInWebChat(e){return OpenFriendChatInWebChat(e)}static submitGuide(){return SubmitGuide()}static initMiniprofileHovers(){return InitMiniprofileHovers()}static inviteUserToGroup(e,t,s){return InviteUserToGroup(e,t,s)}static getCheckedAccounts(e){return GetCheckedAccounts(e)}static execFriendAction(e,t){return ExecFriendAction(e,t)}static scrollOffsetForceRecalc(){CScrollOffsetWatcher.ForceRecalc()}static firstPage(){return InventoryFirstPage()}static lastPage(){return InventoryLastPage()}static goToPage(){return InventoryGoToPage()}static reloadCommunityInventory(){return ReloadCommunityInventory()}static getMarketHashName(e){return GetMarketHashName(e)}static zoomYear(){pricehistory_zoomDays(g_plotPriceHistory,g_timePriceHistoryEarliest,g_timePriceHistoryLatest,365)}static zoomYearForSellDialog(){pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory,SellItemDialog.m_timePriceHistoryEarliest,SellItemDialog.m_timePriceHistoryLatest,365)}static updateSelection(){return UpdateSelection()}static selectAll(){return selectAll()}static selectNone(){return selectNone()}static selectInverse(){return selectInverse()}static jq(e){return $J(e)}static jqOnClick(e,t){$J(e).on("click",t)}static jqAjax(e){return $J.ajax(e)}static jqGet(e,t){return $J.get(e,t)}static jqPost(e,t){return $J.post(e,t)}}.toString()}),S.registerErrorHandler((({name:e,msg:t})=>"LoginError"===e&&(P.addLoginWarning(t),v.finishRequest(),!0)));class F{static runInPageContext(e,t,s){const a=document.createElement("script");let r;const i=Array.isArray(t)?JSON.stringify(t):"[]";if(s){const t="msg_"+ ++F._msgCounter;r=j.onMessage(t),a.textContent=`(async () => { Messenger.postMessage("${t}", await (${e})(...${i})); })();`}else a.textContent=`(${e})(...${i});`;return document.documentElement.appendChild(a),a.parentNode.removeChild(a),r}async run(e){if(document.getElementById("global_header")){try{try{await g,function(){if(D)return;D=!0;const e={ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\-:]|$))/i};g.get("openinnewtab")&&(e.ADD_ATTR=["target"],DOMPurify.addHook("uponSanitizeAttribute",((e,t)=>{"target"===t.attrName&&("_blank"===t.attrValue?e.setAttribute("rel","noreferrer noopener"):t.keepAttr=!1)}))),DOMPurify.setConfig(e)}()}catch(e){console.error(e)}await Promise.all([m,E,O])}catch(e){return console.group("Augmented Steam initialization"),console.error("Failed to initiliaze Augmented Steam"),console.error(e),void console.groupEnd()}console.log(`%c Augmented %cSteam v${_.version} %c ${I}`,"background: #000000; color: #046eb2","background: #000000; color: #ffffff",""),v.create(),v.loading(),P.init(),class{static checkVersion(e){const t=y.fromString(g.get("version"));y.fromString(_.version).isAfter(t)&&(g.get("version_show")&&this._showChangelog(),this._migrateSettings(t),e()),g.set("version",_.version)}static async _showChangelog(){const e=(await h.getJSON("changelog.json"))[_.version];if(!e)return;const t=`<div class="es_changelog"><img src="${h.getURL("img/logo/as128.png")}"><div>${e}</div></div>`,s=document.querySelector("#itad_connect");function a(){s.replaceWith("✓")}F.runInPageContext(((e,t)=>{window.SteamFacade.showAlertDialog(e,t)}),[m.str.update.updated.replace("__version__",_.version),t]),y.fromString(_.version).isSame(new y(1,4))&&(await u.action("itad.isconnected")?a():s.addEventListener("click",(async()=>{await u.action("itad.authorize"),M.create(),a()})))}static _migrateSettings(e){if(e.isSameOrBefore("1.3.1")&&(u.action("cache.clear"),g.set("horizontalscrolling",g.get("horizontalmediascrolling")),g.remove("horizontalmediascrolling")),e.isSameOrBefore("1.4")&&g.remove("show_sysreqcheck"),e.isSame("1.4")&&S.action("migrate.notesToSyncedStorage"),e.isSameOrBefore("1.4.1")&&(g.set("profile_steamid",g.get("profile_permalink")),g.remove("profile_permalink")),e.isSameOrBefore("1.4.3")&&(g.remove("contscroll"),S.action("logout")),e.isSameOrBefore("1.4.7")){const e=x.get("fav_emoticons");Array.isArray(e)&&g.set("fav_emoticons",e)}if(e.isSameOrBefore("2.0.0")&&(g.remove("showfakeccwarning"),g.remove("hideaboutlinks")),e.isSameOrBefore("2.0.1")&&(g.remove("hide_dlcunownedgames"),g.remove("hide_wishlist"),g.remove("hide_cart"),g.remove("hide_notdiscounted"),g.remove("hide_mixed"),g.remove("hide_negative"),g.remove("hide_priceabove"),g.remove("priceabove_value"),g.remove("hide_owned"),g.remove("hide_ignored"),g.remove("highlight_notdiscounted"),g.remove("showallfriendsthatown"),g.has("showusernotes"))){const e=g.get("showusernotes");g.set("user_notes_app",e),g.set("user_notes_wishlist",e),g.remove("showusernotes")}}}.checkVersion(P.clearCache),R.showEarlyAccess(),M.create(),class{static init(){this._activeDropLists={},this._lastSelectHideTime=0,document.addEventListener("mousedown",(e=>this._handleMouseClick(e)))}static _handleMouseClick(e){for(const t of Object.keys(this._activeDropLists)){if(!this._activeDropLists[t])continue;const s=e.target.closest("ul");s&&s.id===t+"_droplist"||this._hide(t)}}static _highlightItem(e,t,s){const a=document.querySelector(`#${e}_droplist`),r=document.querySelector(`#${e}_trigger`),n=a.getElementsByTagName("a");if(t>=0&&t<n.length){const o=n[t];void 0!==r.highlightedItem&&r.highlightedItem!==t&&(n[r.highlightedItem].className="inactive_selection"),r.highlightedItem=t,n[t].className="highlighted_selection";let c=n[t].offsetTop+n[t].clientHeight,l=a.scrollTop+a.clientHeight,d=!1;const u=n.length;let h=0;for(;l<c&&h++<u;)a.scrollTop+=n[t].clientHeight,l=a.scrollTop+a.clientHeight,d=!0;if(!d)for(h=0,c=n[t].offsetTop,l=a.scrollTop;l>c&&h++<u;)a.scrollTop-=n[t].clientHeight,l=a.scrollTop;if(s){i.inner(r,o.innerHTML);const t=document.querySelector("#"+e);t.value=o.id,t.dispatchEvent(new Event("change")),this._hide(e)}}}static _onFocus(e){this._activeDropLists[e]=!0}static _onBlur(e){this._classCheck(document.querySelector(`#${e}_trigger`),"activetrigger")||(this._activeDropLists[e]=!1)}static _hide(e){const t=document.querySelector(`#${e}_droplist`),s=document.querySelector(`#${e}_trigger`),a=new Date;this._lastSelectHideTime=a.valueOf(),s.className="trigger",t.className="dropdownhidden",this._activeDropLists[e]=!1,s.focus()}static _show(e){if(new Date-this._lastSelectHideTime<50)return;const t=document.querySelector(`#${e}_droplist`),s=document.querySelector(`#${e}_trigger`);s.className="activetrigger",t.className="dropdownvisible",this._activeDropLists[e]=!0,s.focus()}static _onTriggerClick(e){this._classCheck(document.querySelector(`#${e}_trigger`),"activetrigger")||this._show(e)}static _classCheck(e,t){return new RegExp(`\\b${t}\\b`).test(e.className)}static get(e,t,s,a,r){const n="sort_by_"+e;let o=s.endsWith("_DESC");const c=i.element(`<div class="es-sortbox es-sortbox--${e}">\n                <div class="es-sortbox__label">${m.str.sort_by}</div>\n                <div class="es-sortbox__container">\n                    <input id="${n}" type="hidden" name="${e}" value="${s}">\n                    <a class="trigger" id="${n}_trigger"></a>\n                    <div class="es-dropdown">\n                        <ul id="${n}_droplist" class="es-dropdown__list dropdownhidden"></ul>\n                    </div>\n                </div>\n                <span class="es-sortbox__reverse">↓</span>\n            </div>`),l=c.querySelector("#"+n);function d(e){return e.replace(/(_ASC|_DESC)$/,"")}function u(e,t){const s=d(e);a(s,t),r&&g.set(r,`${s}_${t?"DESC":"ASC"}`)}l.addEventListener("change",(()=>{u(l.value.replace(n+"_",""),o)})),"default_ASC"!==s&&l.dispatchEvent(new Event("change"));const h=c.querySelector(".es-sortbox__reverse");h.addEventListener("click",(()=>{o=!o,h.textContent=o?"↑":"↓",u(l.value.replace(n+"_",""),o)})),o&&(h.textContent="↑");const _=c.querySelector(`#${n}_trigger`);_.addEventListener("focus",(()=>this._onFocus(n))),_.addEventListener("blur",(()=>this._onBlur(n))),_.addEventListener("click",(()=>this._onTriggerClick(n)));const p=c.querySelector("ul"),f=d(s);for(let e=0;e<t.length;++e){const[s,a]=t[e];let r="inactive";s===f&&(c.querySelector("#"+n).value=s,c.querySelector(".trigger").textContent=a,r="highlighted"),i.beforeEnd(p,`<li>\n                    <a class="${r}_selection" tabindex="99999" id="${n}_${s}">${a}</a>\n                </li>`);const o=p.querySelector("li:last-child > a");o.addEventListener("mouseover",(()=>this._highlightItem(n,e,!1))),o.addEventListener("click",(()=>this._highlightItem(n,e,!0)))}return c}}.init(),this._pageSpecificFeatures(),(new e).applyFeatures()}}_pageSpecificFeatures(){}}F._msgCounter=0;class H extends A{async apply(){await F.runInPageContext((()=>new Promise((e=>{window.SteamFacade.onDynamicStoreReady((()=>{e()}))}))),null,!0);const e=document.getElementById("search_suggestion_contents");return e&&new MutationObserver((e=>{H.highlightAndTag(e[0].addedNodes)})).observe(e,{childList:!0}),Promise.all([H.highlightTitle(this.context.appid),H.highlightAndTag()])}static highlightTitle(e){const t=document.querySelector(".apphub_AppName");return t?(t.dataset.dsAppid=e,H.highlightAndTag([t],!1)):null}static async highlightAndTag(e=document.querySelectorAll(this._selector),t=!0,s={}){const a={owned:!0,wishlisted:!0,ignored:!0,collected:!0,waitlisted:!0,gift:!0,guestPass:!0,coupon:!0,...s},r=new Map;for(const s of e){let e=s;s.classList.contains("item")?e=s.querySelector(".info"):s.classList.contains("home_area_spotlight")?e=s.querySelector(".spotlight_content"):s.parentNode.classList.contains("steam_curator_recommendation")&&s.parentNode.classList.contains("big")?e=s.nextElementSibling:s.parentNode.parentNode.classList.contains("curations")?e=s.parentNode:(s.classList.contains("special_img_ctn")&&s.parentElement.classList.contains("special")||s.classList.contains("blotter_userstats_game"))&&(e=s.parentElement);const i=s.querySelector("a"),n=w.getAppid(s)||w.getAppid(i)||w.getAppidFromId(s.id),o=w.getSubid(s)||w.getSubid(i),c=w.getBundleid(s)||w.getBundleid(i);let l;if(n?l="app/"+n:c?l="bundle/"+c:o&&(l="sub/"+o),l)if(r.has(l)){const t=r.get(l);t.push(e),r.set(l,t)}else r.set(l,[e]);t&&(s.querySelector(".ds_owned_flag")&&a.owned&&this.highlightOwned(e),s.querySelector(".ds_wishlist_flag")&&a.wishlisted&&this.highlightWishlist(e),s.querySelector(".ds_ignored_flag")&&a.ignored&&this.highlightIgnored(e))}const i=Array.from(r.keys()),n=i.map((e=>w.trimStoreId(e))),o=!t&&(a.owned&&(g.get("highlight_owned")||g.get("tag_owned"))||a.wishlisted&&(g.get("highlight_wishlist")||g.get("tag_wishlist"))||a.ignored&&(g.get("highlight_notinterested")||g.get("tag_notinterested"))),[c,l,d]=await Promise.all([o?C.getAppStatus(i):Promise.resolve(),M.getAppStatus(i,{waitlist:a.waitlisted&&(g.get("highlight_waitlist")||g.get("tag_waitlist")),collection:a.collected&&(g.get("highlight_collection")||g.get("tag_collection"))}),L.getAppStatus(n,{giftsAndPasses:a.gift&&(g.get("highlight_inv_gift")||g.get("tag_inv_gift"))||a.guestPass&&(g.get("highlight_inv_guestpass")||g.get("tag_inv_guestpass")),coupons:a.coupon&&(g.get("highlight_coupon")||g.get("tag_coupon"))})]),u=n.values();for(const[e,t]of r)if(c&&(a.owned&&c[e].owned&&t.forEach((e=>{this.highlightOwned(e)})),a.wishlisted&&c[e].wishlisted&&t.forEach((e=>{this.highlightWishlist(e)})),a.ignored&&c[e].ignored&&t.forEach((e=>{this.highlightIgnored(e)}))),l&&(l[e].collected&&t.forEach((e=>{this.highlightCollection(e)})),l[e].waitlisted&&t.forEach((e=>{this.highlightWaitlist(e)}))),d){const e=u.next().value;a.gift&&d[e].gift&&t.forEach((e=>{this.highlightInvGift(e)})),a.guestPass&&d[e].guestPass&&t.forEach((e=>{this.highlightInvGuestpass(e)})),d[e].coupon&&t.forEach((e=>{this.highlightInvCoupon(e)}))}}static _addTag(e,t){const s=g.get("tag_short");if(!this._tagCssLoaded){this._tagCssLoaded=!0;const e=[];for(const t of this._types){const s=g.get(`tag_${t}_color`);e.push(`.es_tag_${t} { background-color: ${s}; }`)}let t=document.createElement("style");t.id="es_tag_styles",t.textContent=e.join("\n"),document.head.appendChild(t),t=null}let a=e.querySelectorAll(".es_tags");if(0===a.length){let t;a=n.htmlToElement(`<div class="es_tags ${s?"es_tags_short":""}"></div>`),e.classList.contains("tab_row")?(t=e.querySelector(".tab_desc").classList.remove("with_discount"),e.querySelector(".tab_discount").style.top="15px",t.querySelector("h4").insertAdjacentElement("afterend",a)):e.classList.contains("home_smallcap")?e.querySelector(".home_smallcap_title").insertAdjacentElement("afterbegin",a):e.classList.contains("curated_app_item")?e.querySelector(".home_headerv5_title").insertAdjacentElement("afterbegin",a):e.classList.contains("tab_item")?e.querySelector(".tab_item_name").insertAdjacentElement("afterend",a):e.classList.contains("newonsteam_headercap")||e.classList.contains("comingsoon_headercap")?e.querySelector(".discount_block").insertAdjacentElement("beforebegin",a):e.classList.contains("search_result_row")?e.querySelector("p").insertAdjacentElement("afterbegin",a):e.classList.contains("dailydeal")?(t=e.parentNode,t.querySelector(".game_purchase_action").insertAdjacentElement("beforebegin",a),i.beforeBegin(t.querySelector(".game_purchase_action"),'<div style="clear: right;"></div>')):e.classList.contains("browse_tag_game")?e.querySelector(".browse_tag_game_price").insertAdjacentElement("afterend",a):e.classList.contains("game_area_dlc_row")?e.querySelector(".game_area_dlc_price").insertAdjacentElement("afterbegin",a):e.classList.contains("wishlist_row")?e.querySelector(".addedon").insertAdjacentElement("afterbegin",a):e.classList.contains("match")?e.querySelector(".match_price").insertAdjacentElement("afterbegin",a):e.classList.contains("cluster_capsule")?e.querySelector(".main_cap_platform_area").append(a):e.classList.contains("recommendation_highlight")?e.querySelector(".highlight_description").insertAdjacentElement("afterbegin",a):e.classList.contains("similar_grid_item")?e.querySelector(".regular_price, .discount_block").append(a):e.classList.contains("recommendation_carousel_item")?e.querySelector(".buttons").insertAdjacentElement("beforebegin",a):e.classList.contains("friendplaytime_game")&&e.querySelector(".friendplaytime_buttons").insertAdjacentElement("beforebegin",a),a=[a]}for(const e of a)e.querySelector(".es_tag_"+t)||i.beforeEnd(e,`<span class="es_tag_${t}">${m.str.tag[t]}</span>`)}static _highlightNode(e){if(g.get("highlight_excludef2p")){if(e.innerHTML.match(/<div class="(tab_price|large_cap_price|col search_price|main_cap_price|price)">\n?(.+)?(Free to Play|Play for Free!)(.+)?<\/div>/i))return;if(e.innerHTML.match(/<h5>(Free to Play|Play for Free!)<\/h5>/i))return;if(e.innerHTML.match(/genre_release/)&&e.querySelector(".genre_release").innerHTML.match(/Free to Play/i))return;if(e.classList.contains("search_result_row")&&e.innerHTML.match(/Free to Play/i))return}if(!this._highlightCssLoaded){this._highlightCssLoaded=!0;const e=[];for(const t of this._types){const s=g.get(`highlight_${t}_color`);e.push(`.es_highlighted_${t} {\n                        background: ${s} linear-gradient(135deg, rgba(0, 0, 0, 0.70) 10%, rgba(0, 0, 0, 0) 100%) !important;\n                    }\n                    .carousel_items .es_highlighted_${t}.price_inline, .curator_giant_capsule.es_highlighted_${t},\n                    .hero_capsule.es_highlighted_${t}, .blotter_userstatus_game.es_highlighted_${t} {\n                        outline: solid ${s};\n                    }\n                    #search_suggestion_contents .focus.es_highlighted_${t} {\n                        box-shadow: -5px 0 0 ${s};\n                    }\n                    .apphub_AppName.es_highlighted_${t} {\n                        background: none !important; color: ${s};\n                    }`)}let t=document.createElement("style");t.id="es_highlight_styles",t.textContent=e.join("\n"),document.head.appendChild(t),t=null}let t=e;if(t.classList.contains("cluster_capsule")?t=t.querySelector(".main_cap_content").parentNode:t.classList.contains("large_cap")?t=t.querySelector(".large_cap_content"):t.parentNode.classList.contains("steam_curator_recommendation")&&t.parentNode.classList.contains("big")&&(t=t.previousElementSibling),t.classList.contains("single")&&(t=t.querySelector(".gamelink")),t.parentNode.parentNode.classList.contains("apps_recommended_by_curators_v2")){let e=t.querySelectorAll(".ds_flag");e.forEach((e=>e.remove())),e=t.querySelectorAll(".ds_flagged"),e.forEach((e=>e.classList.remove("ds_flagged")))}else{(t.classList.contains("info")||t.classList.contains("spotlight_content"))&&(t=t.parentElement);let e=t.querySelector(".ds_flag");e&&e.remove(),e=t.querySelector(".ds_flagged"),e&&e.classList.remove("ds_flagged")}t.classList.remove("ds_flagged")}static _highlightItem(e,t){e.classList.add("es_highlight_checked"),g.get("highlight_"+t)&&(e.classList.add("es_highlighted","es_highlighted_"+t),this._highlightNode(e)),g.get("tag_"+t)&&this._addTag(e,t)}static highlightOwned(e){this._highlightItem(e,"owned")}static highlightWishlist(e){this._highlightItem(e,"wishlist")}static highlightInvCoupon(e){this._highlightItem(e,"coupon")}static highlightInvGift(e){this._highlightItem(e,"inv_gift")}static highlightInvGuestpass(e){this._highlightItem(e,"inv_guestpass")}static highlightIgnored(e){this._highlightItem(e,"notinterested")}static highlightCollection(e){this._highlightItem(e,"collection")}static highlightWaitlist(e){this._highlightItem(e,"waitlist")}}H._highlightCssLoaded=!1,H._tagCssLoaded=!1,H._types=["notinterested","waitlist","wishlist","collection","owned","coupon","inv_guestpass","inv_gift"],H._selector=["div.tab_row","div.dailydeal_ctn",".store_main_capsule","div.wishlistRow","a.game_area_dlc_row","a.small_cap","a.home_smallcap",".home_content_item",".home_content.single",".home_area_spotlight","a.search_result_row","a.match",".highlighted_app","a.cluster_capsule","div.recommendation_highlight","div.recommendation_carousel_item","div.friendplaytime_game",".recommendation_row",".friendactivity_tab_row",".friend_game_block",".recommendation",".curator_giant_capsule","div.carousel_items.curator_featured > div","div.item_ctn",".store_capsule",".newonsteam_headercap",".comingsoon_headercap",".home_marketing_message","div.dlc_page_purchase_dlc","div.sale_page_purchase_item","div.item","div.home_area_spotlight","div.browse_tag_game","div.similar_grid_item",".tab_item",".special > .special_img_ctn",".special.special_img_ctn","div.curated_app_item",".hero_capsule",".sale_capsule"].map((e=>e+":not(.es_highlighted)")).join(",");class B extends A{checkPrerequisites(){return g.get("hidetmsymbols")}apply(){let e="title, .apphub_AppName, .breadcrumbs, h1, h4";function t(e){e&&e.innerHTML&&i.inner(e,e.innerHTML.replace(/[\u00AE\u00A9\u2122]/g,""))}this.context.type===k.STORE_DEFAULT?e+=".game_area_already_owned, .details_block, .game_description_snippet, .game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, .game_area_dlc_name, .tab_desc, .tab_item_name":e+=".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, .apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName";for(const s of document.querySelectorAll(e))t(s);const s=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{t(e)}))}))})),a=document.querySelectorAll("#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn");for(const e of a)s.observe(e,{childList:!0,subtree:!0})}}class U extends A{checkPrerequisites(){return g.get("show_alternative_linux_icon")}apply(){const e=h.getURL("img/alternative_linux_icon.png"),t=document.createElement("style");let s=`span.platform_img.linux { background-image: url(${e}) !important; }`;this.context.type===k.STORE_FRONT&&(s+=".tab_item.focus .tab_item_details span.platform_img.linux { filter: brightness(20%); }"),t.textContent=s,document.head.appendChild(t)}}class z{constructor(e,t){this._feature=t,this.urlParam=e,this._value=null}get active(){return!1}get value(){return this._value}set value(e){e!==this._value&&(this._value=e,this._feature.updateURLs())}setup(e){const t=document.querySelectorAll(".search_result_row");this._addRowMetadata(t),this._setState(e),this._apply(t)}_addRowMetadata(e){}_setState(e){}_apply(e){}}class W extends z{constructor(e,t,s,a){super(e,t),this._localization=s,this._id=a}getHTML(){return`<div class="tab_filter_control_row" data-param="augmented_steam" data-value="${this._id}" data-loc="${this._localization}" data-clientside="1">\n                    <span class="tab_filter_control tab_filter_control_include" data-param="augmented_steam" data-value="${this._id}" data-loc="${this._localization}" data-clientside="1">\n                        <span>\n                            <span class="tab_filter_control_checkbox"></span>\n                            <span class="tab_filter_control_label">${this._localization}</span>\n                            <span class="tab_filter_control_count" style="display: none;"></span>\n                        </span>\n                    </span>\n                </div>`}setup(e){this._elem=document.querySelector(`span[data-param="augmented_steam"][data-value="${this._id}"]`),this._elem.addEventListener("click",(()=>{this._onClick()})),super.setup(e)}_setState(e){this.active=e.has(this.urlParam)&&e.get(this.urlParam).split(",").includes(this._id)}_onClick(){const e=this._elem,t=e.getBoundingClientRect().top;this.active=e.classList.toggle("checked"),document.scrollTop=document.scrollTop-t+e.getBoundingClientRect().top}get active(){return this._active}set active(e){const t=this._elem;this._active=e,this._feature.results.classList.toggle(this._id,e),t.classList.toggle("checked",e),t.parentElement.classList.toggle("checked",e),this.value=this._active?this._id:null}}class G extends W{constructor(e){super("as-hide",e,m.str.search_filters.hide_cart,"cart")}}class V extends W{constructor(e){super("as-hide",e,m.str.search_filters.hide_ea,"ea")}_setState(e){super._setState(e),this.active&&this._addRowMetadata(document.querySelectorAll(".search_result_row:not(.es_ea_checked)"))}_onClick(){super._onClick(),this.active&&this._addRowMetadata(document.querySelectorAll(".search_result_row:not(.es_ea_checked)"))}async _addRowMetadata(e){if(this.active&&!g.get("show_early_access"))for(const t of await R.getEaNodes(e))t.classList.add("es_early_access")}}class J extends W{constructor(e){super("as-hide",e,m.str.search_filters.hide_mixed,"mixed")}_addRowMetadata(e){for(const t of e)t.querySelector(".search_reviewscore span.search_review_summary.mixed")&&t.classList.add("as-hide-mixed")}}class Y extends W{constructor(e){super("as-hide",e,m.str.search_filters.hide_negative,"negative")}_addRowMetadata(e){for(const t of e)t.querySelector(".search_reviewscore span.search_review_summary.negative")&&t.classList.add("as-hide-negative")}}class K extends z{constructor(e){super("as-reviews-count",e),this._val=null}get active(){return this._minCount.value||this._maxCount.value}getHTML(){return`<div class="as-reviews-count-filter">\n                    <div class="as-reviews-count-filter__header">${m.str.search_filters.reviews_count.count}</div>\n                    <div class="as-reviews-count-filter__content js-reviews-count-filter">\n                        <input class="as-reviews-count-filter__input js-reviews-count-input js-reviews-count-lower" type="number" min="0" step="100" placeholder="${m.str.search_filters.reviews_count.min_count}">\n                        -\n                        <input class="as-reviews-count-filter__input js-reviews-count-input js-reviews-count-upper" type="number" min="0" step="100" placeholder="${m.str.search_filters.reviews_count.max_count}">\n                        <input type="hidden" name="as-reviews-count">\n                    </div>\n                </div>`}setup(e){this._minCount=document.querySelector(".js-reviews-count-lower"),this._maxCount=document.querySelector(".js-reviews-count-upper");for(const e of document.querySelectorAll(".js-reviews-count-input"))e.addEventListener("change",(()=>{this._apply();const e=this._minCount.value,t=this._maxCount.value;let s=null;(e&&0!==Number(e)||t)&&(s=`${e}-${t}`),this.value=s})),e.addEventListener("keydown",(t=>{"Enter"===t.key&&(t.preventDefault(),e.dispatchEvent(new Event("change")))}));super.setup(e)}_setState(e){let t="",s="";if(e.has("as-reviews-count")){const a=e.get("as-reviews-count"),r=a.match(/(^\d*)-(\d*)/);if(this._value=a,r){let[,e,a]=r;e=parseInt(e),a=parseInt(a),isNaN(e)||(t=e),isNaN(a)||(s=a)}}t!==this._minCount.value&&(this._minCount.value=t),s!==this._maxCount.value&&(this._maxCount.value=s)}_addRowMetadata(e=document.querySelectorAll(".search_result_row:not([data-as-review-count])")){for(const t of e){let e=0;const s=t.querySelector(".search_review_summary");if(s){const t=s.dataset.tooltipHtml.match(/\d{1,3}%.*?((?:\d{1,3},?)+)/);t&&(e=Number(t[1].replace(/,/g,"")))}t.dataset.asReviewCount=e}}_apply(e=document.querySelectorAll(".search_result_row")){const t=Number(this._minCount.value),s=""===this._maxCount.value?1/0:Number(this._maxCount.value);for(const a of e){const e=Number(a.dataset.asReviewCount);a.classList.toggle("as-reviews-count",e<t||e>s)}}}class Q extends z{constructor(e){super("as-reviews-score",e),this._stepSize=5,this._scoreValues=[];for(let e=0;e<100;e+=this._stepSize)this._scoreValues.push(e);this._maxStep=this._scoreValues.length}get active(){return"0"!==this._minScore.value||this._maxScore.value!==this._maxStep.toString()}getHTML(){return`<div><input type="hidden" name="as-hide"></div>\n                <div class="block_rule"></div>\n                <div class="range_container" style="margin-top: 8px;">\n                    <div class="as-double-slider js-reviews-score-filter range_container_inner">\n                        <input class="as-double-slider__input as-double-slider__input--upper js-reviews-score-input js-reviews-score-upper range_input" type="range" min="0" max="${this._maxStep}" step="1" value="${this._maxStep}">\n                        <input class="as-double-slider__input as-double-slider__input--lower js-reviews-score-input js-reviews-score-lower range_input" type="range" min="0" max="${this._maxStep}" step="1" value="0">\n                        <input type="hidden" name="as-reviews-score">\n                    </div>\n                    <div class="as-range-display range_display">${m.str.search_filters.reviews_score.any}</div>\n                </div>`}setup(e){this._scoreFilter=document.querySelector(".js-reviews-score-filter"),this._minScore=this._scoreFilter.querySelector(".js-reviews-score-lower"),this._maxScore=this._scoreFilter.querySelector(".js-reviews-score-upper"),this._rangeDisplay=this._scoreFilter.nextElementSibling;for(const e of document.querySelectorAll(".js-reviews-score-input")){let t=parseInt(this._minScore.value),s=parseInt(this._maxScore.value);e.addEventListener("input",(()=>{const a=this._maxStep;let r;t=parseInt(this._minScore.value),s=parseInt(this._maxScore.value),e===this._maxScore?t>=s&&(t<=0?(this._maxScore.value=1,s=1):(this._minScore.value=s-1,t=s-1)):s<=t&&(t===a?(this._minScore.value=a-1,t=a-1,this._maxScore.value=a,s=a):s<a?(this._maxScore.value=t+1,s=t+1):(this._minScore.value=s-1,t=s-1)),r=0===t?s===a?m.str.search_filters.reviews_score.any:m.str.search_filters.reviews_score.up_to.replace("__score__",this._scoreValues[s]):s===a?m.str.search_filters.reviews_score.from.replace("__score__",this._scoreValues[t]):m.str.search_filters.reviews_score.between.replace("__lower__",this._scoreValues[t]).replace("__upper__",this._scoreValues[s]),this._rangeDisplay.textContent=r})),e.addEventListener("change",(()=>{this._apply();let e=null;0===t&&s===this._maxStep||(e=`${0===t?"":this._scoreValues[t]}-${s===this._maxStep?"":this._scoreValues[s]}`),this.value=e}))}super.setup(e)}_setState(e){let t="0",s=this._maxStep.toString();if(e.has("as-reviews-score")){const a=e.get("as-reviews-score"),r=a.match(/(^\d*)-(\d*)/);if(this._value=a,r){let[,e,a]=r;e=parseInt(e),a=parseInt(a),!isNaN(e)&&this._scoreValues.includes(e)&&(t=this._scoreValues.indexOf(e).toString()),!isNaN(a)&&this._scoreValues.includes(a)&&(s=this._scoreValues.indexOf(a).toString())}}this._minScore.value=t,this._maxScore.value=s}_addRowMetadata(e=document.querySelectorAll(".search_result_row:not([data-as-review-percentage])")){for(const t of e){let e=100;const s=t.querySelector(".search_review_summary");if(s){const t=s.dataset.tooltipHtml.match(/(\d{1,3})%/);t&&(e=Number(t[1]))}t.dataset.asReviewPercentage=e}}_apply(e=document.querySelectorAll(".search_result_row")){const t=this._scoreValues[Number(this._minScore.value)],s=Number(this._maxScore.value),a=s===this._maxStep?1/0:this._scoreValues[s];for(const s of e){const e=Number(s.dataset.asReviewPercentage);s.classList.toggle("as-reviews-score",e<t||e>a)}}}class Z extends A{apply(){this._filters=[G,V,J,Y,Q,K].map((e=>new e(this))),this._urlParams={};for(const e of this._filters){const t=e.urlParam;this._urlParams[t]?this._urlParams[t].push(e):this._urlParams[t]=[e]}this.results=document.getElementById("search_results");i.afterBegin("#advsearchform .rightcol",`<div class="block search_collapse_block" data-collapse-name="augmented_steam">\n                <div class="block_header"><div>${m.str.filters}</div></div>\n                <div class="block_content block_content_inner">\n                    ${this._filters.reduce(((e,t)=>e+t.getHTML()),"")}\n                </div>\n            </div>`);const e=new URLSearchParams(window.location.search);for(const t of this._filters)t.setup(e);this._updateFilterValues(),this._modifyPageLinks(),window.addEventListener("popstate",(()=>{const e=new URLSearchParams(window.location.search);for(const t of this._filters)t._setState(e);this._updateFilterValues()})),F.runInPageContext(((e,t)=>{const s=GetCollapsePrefs(),a=window.SteamFacade.jq(`.search_collapse_block[data-collapse-name="${e}"]`);let r;void 0===s[e]?(s[e]=!1,r=!1):r=s[e],r=r&&t,a.children(".block_content").css("height",""),r&&(a.addClass("collapsed"),a.children(".block_content").hide()),a.children(".block_header").on("click",(()=>{a.hasClass("collapsed")?(s[e]=!1,a.children(".block_content").slideDown("fast")):(s[e]=!0,a.children(".block_content").slideUp("fast")),a.toggleClass("collapsed"),SaveCollapsePrefs(s)}))}),["augmented_steam",this._filters.every((e=>!e.active))]),this._observeChanges()}_observeChanges(){j.addMessageListener("searchCompleted",(e=>{const t=document.querySelectorAll(".search_result_row:not([data-as-review-count])");R.showEarlyAccess(),H.highlightAndTag(t);const s=new URLSearchParams(window.location.search);for(const a of this._filters)a._addRowMetadata(t),e?(a._setState(s),a._apply(document.querySelectorAll(".search_result_row"))):a._apply(t);this._updateFilterValues(),this._modifyPageLinks()})),F.runInPageContext((()=>{function e(){const e=InitInfiniteScroll.oController;if(e){const t=e.m_fnPageChangedHandler;e.SetPageChangedHandler(((...e)=>{t(...e),window.Messenger.postMessage("searchCompleted",!1)}))}}const t=window.ExecuteSearch;window.ExecuteSearch=function(e){const s={};Object.assign(s,e);const a={},r={};for(const e in g_rgCurrentParameters)e.startsWith("as-")&&(a[e]=g_rgCurrentParameters[e],delete g_rgCurrentParameters[e]);for(const t in e)t.startsWith("as-")&&(r[t]=e[t],delete e[t]);Object.toQueryString(a)!==Object.toQueryString(r)&&window.Messenger.postMessage("searchCompleted",!0),t(e),g_rgCurrentParameters=s};const s=window.SearchCompleted;window.SearchCompleted=function(...t){s(...t),e(),window.Messenger.postMessage("searchCompleted",!1)},e()}))}_updateFilterValues(){this._filterValues=Object.entries(this._urlParams).map((([e,t])=>[e,t.map((e=>e.value)).filter((e=>null!==e)).join(",")]))}updateURLs(){this._updateFilterValues();const e=new URLSearchParams(window.location.search);for(const[e,t]of this._filterValues)document.getElementsByName(e)[0].value=t;this._modifyParams(e,this._filterValues),F.runInPageContext((e=>{UpdateUrl(e)}),[this._paramsToObject(e)]),this._modifyPageLinks()}_modifyPageLinks(){if(!this.context.infiniScrollEnabled)for(const e of document.querySelectorAll(".search_pagination_right a")){const t=new URL(e.href),s=t.searchParams;this._modifyParams(s,this._filterValues),F.runInPageContext((e=>Object.toQueryString(e)),[this._paramsToObject(s)],!0).then((s=>{t.search="?"+s,e.href=t.href}))}}_modifyParams(e,t){for(const[s,a]of t)""!==a&&null!==a?e.set(s,a):e.delete(s)}_paramsToObject(e){const t={};for(const[s,a]of e)t[s]=a;return t}}(new class extends F{}).run(class extends class extends class{constructor(e,t){this._callbacks=[],this.type=e,this.features=t.map((e=>new e(this)))}applyFeatures(){return class{static async apply(e){for(this._promisesMap=new Map,this._stats={completed:0,failed:0,dependency:0};e.length>0;){const t=e.pop(),s=this._generateFeatureChain(t);null===s?e.unshift(t):this._promisesMap.set(t.constructor,s)}await Promise.allSettled(Array.from(this._promisesMap.values())),console.log("Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors",this._stats.completed,this._stats.failed,this._stats.dependency)}static _generateFeatureChain(e){let t=!0,s=Promise.resolve(!0);if(Array.isArray(e.constructor.dependencies)){for(const s of e.constructor.dependencies)if(!this._promisesMap.has(s)){t=!1;break}t&&(s=Promise.all(Array.from(this._promisesMap.entries()).filter((([t])=>e.constructor.dependencies.includes(t))).map((([,e])=>e))))}return t?s.then((t=>{let s=!0;return e.constructor.weakDependency||(s=Array.isArray(t)?t.every((e=>e)):t),s&&e.checkPrerequisites()})).then((async t=>(t&&(await e.apply(),++this._stats.completed),t))).catch((t=>{const s=e.constructor.name;if(t instanceof r.FeatureDependencyError)throw console.warn("Not applying feature %s due to an error in the dependency chain (namely %s)",s,t.featureName),++this._stats.dependency,t;throw console.group(s),console.error("Error while applying feature %s",s),console.error(t),console.groupEnd(),++this._stats.failed,new r.FeatureDependencyError("Failed to apply",s)})):null}}.apply(this.features)}registerCallback(e){this._callbacks.push(e)}triggerCallbacks(...e){for(const t of this._callbacks)t(...e)}}{constructor(e=k.STORE_DEFAULT,t=[]){t.push(H,U,B),super(e,t),this._observeChanges()}_observeChanges(){const e=document.querySelectorAll(".tag_browse_ctn, .tabarea, .browse_ctn_background");if(!e)return;const t=new MutationObserver((()=>{H.highlightAndTag(),R.showEarlyAccess()}));e.forEach((e=>t.observe(e,{childList:!0,subtree:!0})))}}{constructor(){super(k.SEARCH,[Z]),this.infiniScrollEnabled="none"===document.querySelector(".search_pagination").style.display}})})();
//# sourceMappingURL=search.js.map