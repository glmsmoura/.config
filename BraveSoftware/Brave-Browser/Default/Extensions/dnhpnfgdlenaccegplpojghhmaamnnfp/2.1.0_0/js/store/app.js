(()=>{"use strict";class e extends Error{constructor(e){super(e),this.name="LoginError"}}class t extends Error{constructor(e){super(e),this.name="ServerOutageError"}}class s extends Error{constructor(e,t){super(t),this.code=e}}class a extends Error{constructor(e,t){super(e),this.featureName=t}}const n={LoginError:e,ServerOutageError:t,HTTPError:s,FeatureDependencyError:a};class r{static escape(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>t[e]))}static fragment(e){const t=document.createElement("template");return t.innerHTML=DOMPurify.sanitize(e),t.content}static element(e){return r.fragment(e).firstElementChild}static _getNode(e){let t=e;return null==t?(console.warn(t+" is not an Element."),null):("string"==typeof t&&(t=document.querySelector(t)),t instanceof Element?t:(console.warn(t+" is not an Element."),null))}static inner(e,t){const s=r._getNode(e);return s&&(s.innerHTML=DOMPurify.sanitize(t)),s}static replace(e,t){const s=r._getNode(e);return s&&(s.outerHTML=DOMPurify.sanitize(t)),s}static wrap(e,t){const s=r._getNode(e);if(s){const e=r.element(t);return s.replaceWith(e),e.append(s),e}return s}static adjacent(e,t,s){const a=r._getNode(e);return a&&a.insertAdjacentHTML(t,DOMPurify.sanitize(s)),a}static beforeBegin(e,t){r.adjacent(e,"beforebegin",t)}static afterBegin(e,t){r.adjacent(e,"afterbegin",t)}static beforeEnd(e,t){r.adjacent(e,"beforeend",t)}static afterEnd(e,t){r.adjacent(e,"afterend",t)}}class i{static clearSpecialSymbols(e){return e.replace(/[\u00AE\u00A9\u2122]/g,"")}static htmlToDOM(e){return r.fragment(e)}static htmlToElement(e){return r.element(e)}static getVariableFromText(e,t,s){let a;if("object"===s)a=new RegExp(t+"\\s*=\\s*(\\{.+?\\});");else if("array"===s)a=new RegExp(t+"\\s*=\\s*(\\[.+?\\]);");else if("int"===s)a=new RegExp(t+"\\s*=\\s*(.+?);");else{if("string"!==s)return null;a=new RegExp(t+'\\s*=\\s*(\\".+?\\");')}const n=e.match(a);return n?"int"===s?parseInt(n[1]):JSON.parse(n[1]):null}static getVariableFromDom(e,t,s=document){for(const a of s.querySelectorAll("script")){const s=i.getVariableFromText(a.textContent,e,t);if(null!==s)return s}return null}}class o{static get(e,t){const s=e.trim();return o.cache.has(s)?o.cache.get(s):t}static set(e,t,s=31536e3){let a=e.trim(),n=t.trim();o.cache.set(a,n),a=encodeURIComponent(a),n=encodeURIComponent(n),document.cookie=`${a}=${n}; max-age=${s}`}static remove(e){let t=e.trim();o.cache.delete(t),t=encodeURIComponent(t),document.cookie=t+"; expires=Thu, 01 Jan 1970 00:00:00 GMT"}static init(){o.cache=new Map;for(let[e,t]of document.cookie.split(";").map((e=>e.split("="))))e=e.trim(),o.cache.set(e,decodeURIComponent(t))}}o.init();const c=Object.freeze({BACKGROUND:1,CONTENT_SCRIPT:2,OPTIONS:3});let l;if(browser.extension.getBackgroundPage){const e=browser.extension.getBackgroundPage();l=e===window?c.BACKGROUND:c.OPTIONS}else l=c.CONTENT_SCRIPT;class d{static getCurrentSteamLanguage(){if(null!==this._currentSteamLanguage)return this._currentSteamLanguage;for(const e of document.querySelectorAll("script[src]")){const t=new URL(e.src).searchParams.get("l");if(t)return d._currentSteamLanguage=t,this._currentSteamLanguage}return class{static isBackgroundScript(){return l===c.BACKGROUND}static isContentScript(){return l===c.CONTENT_SCRIPT}static isOptions(){return l===c.OPTIONS}}.isContentScript()&&(d._currentSteamLanguage=o.get("Steam_Language")||null),this._currentSteamLanguage}static getLanguageCode(e){return d.languages[e]||"en"}static isCurrentLanguageOneOf(e){return e.includes(d.getCurrentSteamLanguage())}}d._currentSteamLanguage=null,d.languages={english:"en",bulgarian:"bg",czech:"cs",danish:"da",dutch:"nl",finnish:"fi",french:"fr",greek:"el",german:"de",hungarian:"hu",italian:"it",japanese:"ja",koreana:"ko",norwegian:"no",polish:"pl",portuguese:"pt-PT",brazilian:"pt-BR",russian:"ru",romanian:"ro",schinese:"zh-CN",spanish:"es-ES",latam:"es-419",swedish:"sv-SE",tchinese:"zh-TW",thai:"th",turkish:"tr",ukrainian:"ua",vietnamese:"vi"};class _{static message(e){return browser.runtime.sendMessage(e)}static action(e,...t){return t.length?this.message({action:e,params:t}):this.message({action:e})}}class u{static getURL(e){return browser.runtime.getURL(e)}static get(e){return fetch(u.getURL(e))}static getJSON(e){return u.get(e).then((e=>e.json()))}static getText(e){return u.get(e).then((e=>e.text()))}}const p={version:browser.runtime.getManifest().version,db_version:3};class h{static has(e){return Object.prototype.hasOwnProperty.call(this._cache,e)}static get(e){return void 0===this._cache[e]?(void 0===this.defaults[e]&&console.warn(`Unrecognized SyncedStorage key "${e}"`),this.defaults[e]):this._cache[e]}static set(e,t){return this._cache[e]=t,this._adapter.set({[e]:t})}static import(e){for(const[t,s]of Object.entries(e))this._cache[t]=s;return this._adapter.set(e)}static remove(e){return void 0!==this._cache[e]&&delete this._cache[e],this._adapter.remove(e)}static keys(e=""){return Object.keys(this._cache).filter((t=>t.startsWith(e)))}static entries(){return Object.entries(this._cache)}static async clear(e=!1){let t;e?this._cache={}:t=this.persistent.reduce(((e,t)=>(e[t]=this._cache[t],e)),{}),await this._adapter.clear(),e||await this.import(t)}static async init(){browser.storage.onChanged.addListener((e=>{for(const[t,{newValue:s}]of Object.entries(e))this._cache[t]=s}));const e=await this._adapter.get(null);return Object.assign(this._cache,e),this._cache}static then(e,t){return this.init().then(e,t)}static toJson(){return JSON.stringify(this._cache)}}h.QUOTA_BYTES_PER_ITEM=8192,h._adapter=browser.storage.sync||browser.storage.local,h._cache={},h.defaults=Object.freeze({language:"english",version:p.version,version_show:!0,highlight_owned_color:"#00ce67",highlight_wishlist_color:"#0491bf",highlight_coupon_color:"#a26426",highlight_inv_gift_color:"#800040",highlight_inv_guestpass_color:"#513c73",highlight_notinterested_color:"#4f4f4f",highlight_collection_color:"#856d0e",highlight_waitlist_color:"#4c7521",tag_owned_color:"#00b75b",tag_wishlist_color:"#0383b4",tag_coupon_color:"#c27120",tag_inv_gift_color:"#b10059",tag_inv_guestpass_color:"#65449a",tag_notinterested_color:"#4f4f4f",tag_collection_color:"#856d0e",tag_waitlist_color:"#4c7521",highlight_owned:!0,highlight_wishlist:!0,highlight_coupon:!1,highlight_inv_gift:!1,highlight_inv_guestpass:!1,highlight_notinterested:!1,highlight_excludef2p:!1,highlight_collection:!0,highlight_waitlist:!0,tag_owned:!1,tag_wishlist:!1,tag_coupon:!1,tag_inv_gift:!1,tag_inv_guestpass:!1,tag_notinterested:!0,tag_collection:!1,tag_waitlist:!1,tag_short:!1,hidetmsymbols:!1,showlowestprice:!0,showlowestprice_onwishlist:!0,showlowestpricecoupon:!0,showallstores:!0,stores:[],override_price:"auto",showregionalprice:"mouse",regional_countries:["us","gb","ru","br","au","jp"],show_es_homepagetabs:!0,showmarkettotal:!1,showsteamrepapi:!0,showmcus:!0,showoc:!0,showhltb:!0,showyoutube:!0,showtwitch:!0,showpcgw:!0,showcompletionistme:!1,showprotondb:!1,showviewinlibrary:!1,showsteamcardexchange:!1,showitadlinks:!0,showsteamdb:!0,showbartervg:!1,showastatslink:!0,showyoutubegameplay:!0,showyoutubereviews:!0,showwsgf:!0,exfgls:!0,app_custom_link:[{enabled:!1,name:"Google",url:"google.com/search?q=[ID]+[NAME]",icon:"www.google.com/images/branding/product/ico/googleg_lodp.ico"}],customize_apppage:{recentupdates:!0,reviews:!0,about:!0,contentwarning:!0,steamchart:!0,steamspy:!0,surveys:!0,sysreq:!0,legal:!0,morelikethis:!0,recommendedbycurators:!0,customerreviews:!0},customize_frontpage:{featuredrecommended:!0,specialoffers:!0,trendingamongfriends:!0,discoveryqueue:!0,browsesteam:!0,curators:!0,morecuratorrecommendations:!0,recentlyupdated:!0,fromdevelopersandpublishersthatyouknow:!0,popularvrgames:!0,homepagetabs:!0,gamesstreamingnow:!0,under:!0,updatesandoffers:!0,homepagesidebar:!0},show_package_info:!1,show_steamchart_info:!0,show_steamspy_info:!0,show_early_access:!0,show_alternative_linux_icon:!1,show_itad_button:!1,skip_got_steam:!1,installsteam:"show",openinnewtab:!1,keepssachecked:!1,showemptywishlist:!0,user_notes_app:!0,user_notes_wishlist:!0,showwishliststats:!0,user_notes:{},user_notes_adapter:"synced_storage",replaceaccountname:!0,showlanguagewarning:!0,showlanguagewarninglanguage:"english",homepage_tab_selection:"remember",homepage_tab_last:null,send_age_info:!0,removebroadcasts:!1,mp4video:!1,horizontalscrolling:!0,showsupportinfo:!0,showdrm:!0,regional_hideworld:!1,showinvnav:!0,quickinv:!0,quickinv_diff:-.01,community_default_tab:"",showallachievements:!1,showallstats:!0,showachinstore:!0,showcomparelinks:!1,hideactivelistings:!1,showlowestmarketprice:!0,hidespamcomments:!1,spamcommentregex:"[\\u2500-\\u25FF]",wlbuttoncommunityapp:!0,removeguideslanguagefilter:!1,disablelinkfilter:!1,sortfriendsby:"default_ASC",sortreviewsby:"default_ASC",sortgroupsby:"default_ASC",show1clickgoo:!0,show_profile_link_images:"gray",show_custom_themes:!0,profile_steamrepcn:!0,profile_steamgifts:!0,profile_steamtrades:!0,profile_bartervg:!0,profile_steamrep:!0,profile_steamdbcalc:!0,profile_astats:!0,profile_backpacktf:!0,profile_astatsnl:!0,profile_steamid:!0,profile_custom_link:[{enabled:!0,name:"Google",url:"google.com/search?q=[ID]",icon:"www.google.com/images/branding/product/ico/googleg_lodp.ico"}],fav_emoticons:[],group_steamgifts:!0,steamcardexchange:!0,purchase_dates:!0,show_badge_progress:!0,show_coupon:!0,show_wishlist_link:!0,show_wishlist_count:!0,show_progressbar:!0,show_backtotop:!1,profile_showcase_twitch:!0,profile_showcase_own_twitch:!1,profile_showcase_twitch_profileonly:!1,itad_import_library:!1,itad_import_wishlist:!1,add_to_waitlist:!1,context_steam_store:!1,context_steam_market:!1,context_itad:!1,context_bartervg:!1,context_steamdb:!1,context_steamdb_instant:!1,context_steam_keys:!1}),h.persistent=["user_notes","user_notes_adapter"];class g{static loadLocalization(e){return u.getJSON(`/localization/${e}.json`)}static init(){if(g._promise)return g._promise;let e=d.getCurrentSteamLanguage();const t=h.get("language");function s(e,t){for(const[a,n]of Object.entries(t))void 0!==e[a]?"object"==typeof n?s(e[a],n):""!==n&&(e[a]=n):console.warn("The key %s doesn't exist in the English localization file",a);return e}null===e?e=t:e!==t&&(h.set("language",e),_.action("clearpurchases"));const a=d.getLanguageCode(e),n=["en"];return null!==a&&"en"!==a&&n.push(a),g._promise=Promise.all(n.map((e=>g.loadLocalization(e)))).then((([e,t])=>(g.str=e,t&&s(g.str,t),g.str))),g._promise}static then(e,t){return g.init().then(e,t)}static getString(e){const t=e.split(".").reverse();let s=g.str;for(;t.length;){if("object"!=typeof s)return null;s=s[t.pop()]}return s}}g._promise=null;class m{static get(e,t){const s=localStorage.getItem(e);if(!s)return t;try{return JSON.parse(s)}catch(e){return t}}static set(e,t){localStorage.setItem(e,JSON.stringify(t))}static has(e){return null!==localStorage.getItem(e)}static remove(e){localStorage.removeItem(e)}static keys(){const e=[];for(let t=localStorage.length-1;t>=0;--t)e.push(localStorage.key(t));return e}static clear(){localStorage.clear()}}class f{constructor(e){this._promise=new Promise((t=>{this._id=setTimeout((()=>{t()}),e)}))}then(e,t){if(this._promise)return this._promise.then(e,t);throw new Error("Timer has been cleared before")}clear(){clearTimeout(this._id),this._promise=null}}class y{constructor(e,t){this.onDone=e,this.duration=t,this.reset()}get running(){return this._running}reset(){void 0!==this._id&&clearTimeout(this._id),this._id=setTimeout((async()=>{await this.onDone(),this._running=!1}),this.duration),this._running=!0}}class v{static timer(e){return new f(e)}static resettableTimer(e,t){return new y(e,t)}static now(){return Math.trunc(Date.now()/1e3)}}class w{static parseId(e){if(!e)return null;return parseInt(e)||null}static getAppid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsAppid;if(e)return w.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/(?:app|market\/listings)\/(\d+)\/?/);return s&&w.parseId(s[1])}static getSubid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsPackageid;if(e)return w.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/sub\/(\d+)\/?/);return s&&w.parseId(s[1])}static getBundleid(e){let t=e;if(!t)return null;if(t instanceof HTMLElement){const e=t.dataset.dsBundleid;if(e)return w.parseId(e);if(t=t.href,!t)return null}const s=t.match(/(?:store\.steampowered|steamcommunity)\.com\/bundle\/(\d+)\/?/);return s&&w.parseId(s[1])}static trimStoreId(e){return Number(e.slice(e.indexOf("/")+1))}static getAppidImgSrc(e){if(!e)return null;const t=e.match(/(?:cdn\.akamai\.steamstatic\.com\/steam|steamcdn-a\.akamaihd\.net\/steam|steamcommunity\/public\/images)\/apps\/(\d+)\//);return t&&w.parseId(t[1])}static getAppidUriQuery(e){if(!e)return null;const t=e.match(/appid=(\d+)/);return t&&w.parseId(t[1])}static getAppids(e){const t=/(?:store\.steampowered|steamcommunity)\.com\/app\/(\d+)\/?/g,s=[];let a;for(;null!==(a=t.exec(e));){const e=w.parseId(a[1]);e&&s.push(e)}return s}static getAppidFromId(e){if(!e)return null;const t=e.match(/game_(\d+)/);return t&&w.parseId(t[1])}static getAppidFromGameCard(e){if(!e)return null;const t=e.match(/\/gamecards\/(\d+)/);return t&&w.parseId(t[1])}}Object.freeze({context_steam_store:{persistent:!0,permissions:["contextMenus"]},context_steam_market:{persistent:!0,permissions:["contextMenus"]},context_itad:{persistent:!0,permissions:["contextMenus"]},context_bartervg:{persistent:!0,permissions:["contextMenus"]},context_steamdb:{persistent:!0,permissions:["contextMenus"]},context_steamdb_instant:{persistent:!0,permissions:["contextMenus"]},context_steam_keys:{persistent:!0,permissions:["contextMenus"]}});class b{constructor(e,t=0,s=0){console.assert(3===[e,t,s].filter(Number.isInteger).length,`${e}.${t}.${s} must be integers`),this.major=e,this.minor=t,this.patch=s}static from(e){if(e instanceof b)return new b(e.major,e.minor,e.patch);if("string"==typeof e)return b.fromString(e);if(Array.isArray(e))return b.fromArray(e);throw new Error("Could not construct a Version from "+e)}static fromArray(e){return new b(...e.map((e=>parseInt(e))))}static fromString(e){return b.fromArray(e.split("."))}static coerce(e){return e instanceof b?e:b.from(e)}toString(){return`${this.major}.${this.minor}.${this.patch}`}toArray(){return[this.major,this.minor,this.patch]}toJSON(){return this.toString()}isCurrent(){return this.isSameOrAfter(p.version)}isSame(e){const t=b.coerce(e);return this.major===t.major&&this.minor===t.minor&&this.patch===t.patch}isBefore(e){const t=b.coerce(e);return this.major<t.major||!(this.major>t.major)&&(this.minor<t.minor||!(this.minor>t.minor)&&this.patch<t.patch)}isSameOrBefore(e){return this.isSame(e)||this.isBefore(e)}isAfter(e){return b.coerce(e).isBefore(this)}isSameOrAfter(e){return b.coerce(e).isSameOrBefore(this)}}class S{static create(){h.get("show_progressbar")&&(r.afterEnd("#global_actions",`<div class="es_progress__wrap">\n                <div class="es_progress es_progress--complete" title="${g.str.ready.ready}">\n                    <div class="es_progress__bar">\n                        <div class="es_progress__value"></div>\n                    </div>\n                </div>\n            </div>`),S._progress=document.querySelector(".es_progress"))}static loading(){S._progress&&(S._progress.setAttribute("title",g.str.ready.loading),S.requests={initiated:0,completed:0},S._progress.classList.remove("es_progress--complete"),S._progress.querySelector(".es_progress__value").style.width="18px")}static startRequest(){S.requests&&(S.requests.initiated++,S.progress())}static finishRequest(){S.requests&&(S.requests.completed++,S.progress())}static progress(e){if(!S._progress)return;let t=e;if(!t){if(!S.requests)return;S.requests.initiated>0&&(t=100*S.requests.completed/S.requests.initiated)}t>100&&(t=100),S._progress.querySelector(".es_progress__value").style.width=t+"px",t>=100&&(S._progress.classList.add("es_progress--complete"),S._progress.setAttribute("title",g.str.ready.ready),S.requests=null)}static serverOutage(){S._progress&&(S._progress.classList.add("es_progress--warning"),S.requests=null,S._progress.parentElement.querySelector(".es_progress__warning, .es_progress__error")||r.afterEnd(S._progress,`<div class="es_progress__warning">${g.str.ready.server_outage}</div>`))}static failed(){if(!S._progress)return;const e=S._progress.parentElement.querySelector(".es_progress__warning");e&&(S._progress.classList.remove("es_progress--warning"),e.remove()),S._progress.classList.add("es_progress--error"),S.requests=null;const t=S._progress.parentElement.querySelector(".es_progress__error");t?t.textContent=g.str.ready.failed.replace("__amount__",++S._failedRequests):r.afterEnd(S._progress,`<div class="es_progress__error">${g.str.ready.failed.replace("__amount__",++S._failedRequests)}</div>`)}}S._progress=null,S._failedRequests=0;class k extends _{static async message(e){let t;S.startRequest();try{return t=await super.message(e),S.finishRequest(),t}catch(e){const t=class{static parse(e){const t=e.match(/(.*):\s(.+)/);return{name:t[1]||"",msg:t[2]||""}}}.parse(e.message);switch(t.name){case"ServerOutageError":S.serverOutage();break;default:k._errorHandlers.some((e=>e(t)))||S.failed()}throw e}}static registerErrorHandler(e){k._errorHandlers.push(e)}}k._errorHandlers=[];class q{static async getHttp(e,t={},s="text"){let a=e;const r={method:"GET",credentials:"include",headers:{origin:window.location.origin},referrer:window.location.origin+window.location.pathname,...t};let i;S.startRequest(),a.startsWith("//")&&(a=window.location.protocol+e,console.warn("Requesting URL without protocol, please update"));try{if(i=await q._fetchFn(a,r),!i.ok)throw new n.HTTPError(i.status,`HTTP ${i.status} ${i.statusText} for ${i.url}`)}catch(e){throw S.failed(),e}return S.finishRequest(),i[s]()}static post(e,t,s,a){return q.getHttp(e,Object.assign(s||{},{method:"POST",body:t}),a?"json":"text")}static getJson(e,t){return q.getHttp(e,t,"json")}static getBlob(e,t){return q.getHttp(e,t,"blob")}}q._fetchFn="undefined"!=typeof content&&content&&content.fetch||fetch.bind(window);class ${static get storeCountry(){const e=new URL(window.location.href);let t;return e.searchParams&&e.searchParams.has("cc")?t=e.searchParams.get("cc"):(t=$._storeCountry,t||(t=o.get("steamCountry"))),t||(console.warn("Failed to detect store country, falling back to US"),t="US"),t.substr(0,2)}static promise(){if($._promise)return $._promise;const e=document.querySelector("#global_actions > a.user_avatar");let t;return e?($.profileUrl=e.href,$.profilePath=e.pathname,t=k.action("login",$.profilePath).then((e=>{e&&($.isSignedIn=!0,$.steamId=e.steamId)}))):t=k.action("logout"),$._promise=t.then((()=>k.action("storecountry"))).catch((({message:e})=>{console.error(e)})).then((e=>{if(e)return $._storeCountry=e,null;let t;if(window.location.hostname.endsWith("steampowered.com"))for(const e of document.getElementsByTagName("script")){const s=e.textContent.match(/GDynamicStore\.Init\(.+?, '([A-Z]{2})/);if(s){t=s[1];break}}else if("steamcommunity.com"===window.location.hostname){const e=document.querySelector("#webui_config,#application_config");e&&(t=JSON.parse(e.dataset.config).COUNTRY)}if(t)return $._storeCountry=t,k.action("storecountry",t).catch((({message:e})=>{console.error(e)}));throw new Error("Script with user store country not found")})).catch((e=>{console.group("Store country detection"),console.warn("Failed to detect store country from page"),console.error(e),console.groupEnd()})),$._promise}static then(e,t){return $.promise().then(e,t)}static get sessionId(){return $._sessionId||($._sessionId=i.getVariableFromDom("g_sessionID","string")),$._sessionId}static getPurchaseDate(e,t){const s=i.clearSpecialSymbols(t);return k.action("purchases",s,e)}static async getUserToken(){const e=await q.getJson("/pointssummary/ajaxgetasyncconfig").catch((()=>!1));if(!e||!e.success)throw new Error("Failed to get webapi token");return e.data.webapi_token}}Promise.allSettled||(Promise.allSettled=e=>Promise.all(e.map((e=>e.then((e=>({status:"fulfilled",value:e}))).catch((e=>({status:"rejected",reason:e})))))));const x=Object.freeze({ACCOUNT:1,APP:2,BUNDLE:3,STORE_DEFAULT:4,FUNDS:5,REGISTER_KEY:6,SALE:7,SEARCH:8,STATS:9,STORE_FRONT:10,SUB:11,WISHLIST:12,AGECHECK:13,COMMUNITY_DEFAULT:14,WORKSHOP:15,PROFILE_ACTIVITY:16,GAMES:17,PROFILE_EDIT:18,BADGES:19,GAME_CARD:20,FRIENDS_THAT_PLAY:21,FRIENDS:22,GROUPS:23,INVENTORY:24,MARKET_LISTING:25,MARKET:26,PROFILE_HOME:27,GROUP_HOME:28,GUIDES:29,COMMUNITY_APP:30,COMMUNITY_STATS:31,MY_WORKSHOP:32,SHARED_FILES:33,WORKSHOP_BROWSE:34,EDIT_GUIDE:35,RECOMMENDED:36,BOOSTER_CREATOR:37,TRADE_OFFER:38});class E{static clear(){return k.action("dynamicstore.clear")}static async getAppStatus(e){const t=Array.isArray(e);let s,a,n;t?(a=e.map((e=>w.trimStoreId(e))),s=k.action("dynamicstorestatus",a)):s=k.action("dynamicstorestatus",w.trimStoreId(e));const r=await s;if(t){n={};for(let t=0;t<e.length;++t){const s=a[t],i=e[t];n[i]={ignored:r[s].includes("ignored"),wishlisted:r[s].includes("wishlisted")},i.startsWith("app/")?n[i].owned=r[s].includes("ownedApps"):i.startsWith("sub/")&&(n[i].owned=r[s].includes("ownedPackages"))}}else n={ignored:r.includes("ignored"),wishlisted:r.includes("wishlisted")},e.startsWith("app/")?n.owned=r.includes("ownedApps"):e.startsWith("sub/")&&(n.owned=r.includes("ownedPackages"));return n}static async getRandomApp(){return await E._fetch(),k.action("dynamicStore.randomApp")}static _fetch(){return $.isSignedIn?Promise.resolve(null):E.clear()}static then(e,t){return E._promise||(E._promise=E._fetch()),E._promise.then(e,t)}}class L{static getCoupon(e){return k.action("coupon",e)}static async getAppStatus(e,t){function s(e,t){return{gift:e.includes("gifts"),guestPass:e.includes("passes"),coupon:Boolean(t)}}const a={giftsAndPasses:!0,coupons:!0,...t};if(!a.giftsAndPasses&&!a.coupons)return null;const n=Array.isArray(e);try{const[t,r]=await Promise.all([a.giftsAndPasses?k.action("hasgiftsandpasses",e):Promise.resolve(),a.coupons?k.action("hascoupon",e):Promise.resolve()]);if(n){const a={};for(const n of e)a[n]=s(t?t[n]:[],!!r&&r[n]);return a}return s(t||[],void 0!==r&&r)}catch(t){if(n){const t={};for(const a of e)t[a]=s([],!1);return t}return s([],!1)}}static hasInMarketInventory(e){return k.action("hasitem",e)}}class C{constructor(e){this.context=e}checkPrerequisites(){return!0}apply(){throw new Error("Stub")}logError(e,t,...s){console.group(this.constructor.name),console.error(t,...s),console.error(e),console.groupEnd()}}class A{static wrap(e,t){const s=t.parentNode;s.insertBefore(e,t),s.removeChild(t),e.append(t)}static remove(e){const t=document.querySelector(e);t&&t.remove()}static selectLastNode(e,t){const s=e.querySelectorAll(t);return 0===s.length?null:s[s.length-1]}static insertStylesheet(e){const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.head.appendChild(t)}static insertScript({src:e,content:t},s,a,n=!0){const r=document.createElement("script");a&&(r.onload=a),s&&(r.id=s),e&&(r.src=e),t&&(r.textContent=t),r.async=n,document.head.appendChild(r)}}class P{static create(e,t,s){let a=0;e.addEventListener("wheel",(e=>{e.preventDefault(),e.stopPropagation(),Date.now()-a<200||(a=Date.now(),e.deltaY>0?s.click():t.click())}))}}const I="https://augmentedsteam.com";class T{static _addMenu(){r.afterBegin("#global_action_menu",`<div id="es_menu">\n                <span id="es_pulldown" class="pulldown global_action_link">Augmented Steam</span>\n                <div id="es_popup" class="popup_block_new">\n                    <div class="popup_body popup_menu">\n                        <a class="popup_menu_item" target="_blank" href="${u.getURL("html/options.html")}">${g.str.thewordoptions}</a>\n                        <a class="popup_menu_item" id="es_clear_cache" href="#clear_cache">${g.str.clear_cache}</a>\n                        <div class="hr"></div>\n                        <a class="popup_menu_item" target="_blank" href="https://github.com/tfedor/AugmentedSteam">${g.str.contribute}</a>\n                        <a class="popup_menu_item" target="_blank" href="https://github.com/tfedor/AugmentedSteam/issues">${g.str.bug_feature}</a>\n                        <div class="hr"></div>\n                        <a class="popup_menu_item" target="_blank" href="${I}">${g.str.website}</a>\n                        <a class="popup_menu_item" target="_blank" href="https://isthereanydeal.com/">IsThereAnyDeal</a>\n                        <a class="popup_menu_item" target="_blank" href="https://discord.gg/yn57q7f">Discord</a>\n                    </div>\n                </div>\n            </div>`),document.querySelector("#es_pulldown").addEventListener("click",(()=>{z.runInPageContext((()=>{window.SteamFacade.showMenu("es_pulldown","es_popup","right","bottom",!0)}))})),document.querySelector("#es_menu").addEventListener("click",(e=>{e.stopPropagation()})),document.querySelector("#es_popup").addEventListener("click",(()=>{z.runInPageContext((()=>{window.SteamFacade.hideMenu("es_pulldown","es_popup")}))})),document.querySelector("#es_clear_cache").addEventListener("click",(e=>{e.preventDefault(),T.clearCache(),window.location.reload()}))}static _addBackToTop(){if(!h.get("show_backtotop"))return;A.remove("#BackToTop");const e=document.createElement("div");e.classList.add("es_btt"),e.textContent="▲",document.body.append(e),e.addEventListener("click",(()=>{window.scroll({top:0,left:0,behavior:"smooth"})})),window.addEventListener("scroll",(()=>{e.classList.toggle("is-visible",window.scrollY>=400)}))}static _bindLogout(){document.querySelector("a[href$='javascript:Logout();']").addEventListener("click",(()=>{T.clearCache()}))}static _addWarning(e,t){const s=r.element(`<div class="es_warn js-warn">\n                <div class="es_warn__cnt">\n                    <div>${e}</div>\n                    <div class="es_warn__control">\n                        <a class="es_warn__btn js-warn-close">${g.str.update.dont_show}</a>\n                        <a class="es_warn__btn js-warn-hide">${g.str.hide}</a>\n                    </div>\n                </div>\n            </div>`);s.querySelector(".js-warn-close").addEventListener("click",(()=>{t&&t(),s.closest(".js-warn").remove()})),s.querySelector(".js-warn-hide").addEventListener("click",(()=>{s.closest(".js-warn").remove()})),document.getElementById("global_header").insertAdjacentElement("afterend",s)}static _addLanguageWarning(){if(!h.get("showlanguagewarning"))return;const e=d.getCurrentSteamLanguage();if(!e)return;h.has("showlanguagewarninglanguage")||h.set("showlanguagewarninglanguage",e);const t=h.get("showlanguagewarninglanguage");e!==t&&g.loadLocalization(d.getLanguageCode(t)).then((s=>{T._addWarning(`${s.using_language.replace("__current__",s.options.lang[e]||e)}\n                <a href="#" id="es_reset_language_code">\n                ${s.using_language_return.replace("__base__",s.options.lang[t]||t)}\n                </a>`,(()=>{h.set("showlanguagewarning",!1)})),document.querySelector("#es_reset_language_code").addEventListener("click",(e=>{e.preventDefault(),z.runInPageContext((e=>{ChangeLanguage(e)}),[t])}))}))}static _handleInstallSteamButton(){const e=h.get("installsteam");if("hide"===e)A.remove("div.header_installsteam_btn");else if("replace"===e){const e=document.querySelector("div.header_installsteam_btn > a");e.textContent=g.str.viewinclient,e.href="steam://openurl/"+window.location.href,e.classList.add("es_steamclient_btn")}}static _addUsernameSubmenuLinks(){const e=document.querySelector(".supernav_container .submenu_username");r.afterEnd(e.querySelector("a"),`<a class="submenuitem" href="//steamcommunity.com/my/games/">${g.str.games}</a>`),r.afterEnd(e.querySelector("a:nth-child(2)"),`<a class="submenuitem" href="//store.steampowered.com/wishlist/">${g.str.wishlist}</a>`),r.beforeEnd(e,`<a class="submenuitem" href="//steamcommunity.com/my/recommended/">${g.str.reviews}</a>`)}static _disableLinkFilter(){function e(e=document){for(const t of e.querySelectorAll("a[href*='/linkfilter/']"))t.href=t.href.replace(/^.+?\/linkfilter\/\?url=/,"")}h.get("disablelinkfilter")&&(e(),new MutationObserver((t=>{for(const s of t)for(const t of s.addedNodes)t.nodeType===Node.ELEMENT_NODE&&e(t)})).observe(document,{childList:!0,subtree:!0}))}static _addRedeemLink(){r.beforeBegin("#account_language_pulldown",`<a class="popup_menu_item" href="https://store.steampowered.com/account/registerkey">${g.str.activate}</a>`)}static _replaceAccountName(){if(!h.get("replaceaccountname"))return;const e=document.querySelector("#account_dropdown .persona.online"),t=e.textContent.trim(),s=document.querySelector("#account_pulldown").textContent.trim();if(e.textContent=s,location.href.startsWith("https://store.steampowered.com/account")){const e=document.querySelector("h2.pageheader");e&&(e.textContent=e.textContent.replace(new RegExp(t,"i"),s))}/.*(id|profiles)\/.+/g.test(location.pathname)&&!location.pathname.includes($.profilePath)||(document.title=document.title.replace(t,s))}static _launchRandomButton(){r.beforeEnd("#es_popup .popup_menu",`<div class="hr"></div>\n             <a id="es_random_game" class="popup_menu_item" style="cursor: pointer;">${g.str.launch_random}</a>`),document.querySelector("#es_random_game").addEventListener("click",(async()=>{const e=await E.getRandomApp();e&&k.action("appdetails",e).then((t=>{if(!t||!t.success)return;const s=t.data;let a,n=e;s.fullgame?(n=s.fullgame.appid,a=s.fullgame.name):a=s.name,z.runInPageContext(((e,t,s)=>{window.SteamFacade.showConfirmDialog(e,`<img src="//steamcdn-a.akamaihd.net/steam/apps/${t}/header.jpg">`,null,null,s).done((e=>{"OK"===e&&window.location.assign("steam://run/"+t),"SECONDARY"===e&&window.location.assign("//store.steampowered.com/app/"+t)}))}),[g.str.play_game.replace("__gamename__",a.replace("'","").trim()),n,g.str.visit_store])}))}))}static _skipGotSteam(){if(h.get("skip_got_steam"))for(const e of document.querySelectorAll("a[href^='javascript:ShowGotSteamModal']"))e.href=e.href.split("'")[1]}static _keepSteamSubscriberAgreementState(){const e=document.querySelectorAll("#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa");for(const t of e)t.checked=h.get("keepssachecked"),t.addEventListener("click",(()=>{h.set("keepssachecked",!h.get("keepssachecked"))}))}static _defaultCommunityTab(){const e=h.get("community_default_tab");if(!e)return;const t=document.querySelectorAll("a[href^='https://steamcommunity.com/app/']");for(const s of t)s.classList.contains("apphub_sectionTab")||/^\/app\/[0-9]+\/?$/.test(s.pathname)&&(s.pathname.endsWith("/")||(s.pathname+="/"),s.pathname+=e+"/")}static _horizontalScrolling(){if(h.get("horizontalscrolling"))for(const e of document.querySelectorAll(".slider_ctn:not(.spotlight)"))P.create(e.parentNode.querySelector("#highlight_strip, .store_horizontal_autoslider_ctn"),e.querySelector(".slider_left"),e.querySelector(".slider_right"))}static addLoginWarning(e){if(T._loginWarningAdded||m.get("hide_login_warn_"+e))return;let t;if("store"===e)t="store.steampowered.com";else{if("community"!==e)return void console.warn("Unknown login warning type %s",e);t="steamcommunity.com"}T._addWarning(""+g.str.login_warning.replace("__link__",`<a href="https://${t}/login/">${t}</a>`),(()=>{m.set("hide_login_warn_"+e,!0)})),T._loginWarningAdded=!0,console.warn("Are you logged into %s?",t)}static clearCache(){localStorage.clear(),h.remove("user_currency"),h.remove("store_sessionid"),k.action("cache.clear")}static init(){T._addBackToTop(),T._addMenu(),T._addLanguageWarning(),T._handleInstallSteamButton(),T._disableLinkFilter(),T._skipGotSteam(),T._keepSteamSubscriberAgreementState(),T._defaultCommunityTab(),T._horizontalScrolling(),$.isSignedIn&&(T._addUsernameSubmenuLinks(),T._addRedeemLink(),T._replaceAccountName(),T._launchRandomButton(),T._bindLogout())}}class D{static escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}class N{constructor({id:e,abbr:t="USD",symbol:s="$",hint:a="Default Currency",multiplier:n=100,unit:r=1,format:{places:i=2,hidePlacesWhenZero:o=!1,symbolFormat:c="$",thousand:l=",",group:d=3,decimal:_=".",right:u=!1}}){Object.assign(this,{id:e,abbr:t,symbol:s,hint:a,multiplier:n,unit:r,format:{decimalPlaces:i,hidePlacesWhenZero:o,symbol:c,groupSeparator:l,groupSize:d,decimalSeparator:_,postfix:u}}),Object.freeze(this.format),Object.freeze(this)}valueOf(e){let t=e.trim().replace(this.format.groupSeparator,"");"."!==this.format.decimalSeparator&&(t=t.replace(this.format.decimalSeparator,".")),t=t.replace(/[^\d.]/g,"");const s=parseFloat(t);return Number.isNaN(s)?null:s}stringify(e,t=!0){const s=e<0?"-":"";let a,n=Math.abs(e).toFixed(this.format.decimalPlaces);[n,a]=n.split(".");const r=[];let i=n.length;for(;i>this.format.groupSize;i-=this.format.groupSize)r.unshift(n.substring(i-this.format.groupSize,i));return r.unshift(n.substring(0,i)),n=[s,r.join(this.format.groupSeparator)],this.format.decimalPlaces>0&&(!this.format.hidePlacesWhenZero||parseInt(a)>0)&&(n.push(this.format.decimalSeparator),n.push(a)),t&&(this.format.postfix?n.push(this.format.symbol):n.unshift(this.format.symbol)),n.join("")}placeholder(){let e="1"+this.format.groupSeparator,t=2;for(let s=0;s<this.format.groupSize;++s,++t)e+=t;if(0===this.format.decimalPlaces)return e;e+=this.format.decimalSeparator;for(let s=0;s<this.format.decimalPlaces;++s,++t)e+=t;return e}regExp(){let e=`^(?:\\d{1,${this.format.groupSize}}(?:${D.escapeRegExp(this.format.groupSeparator)}\\d{${this.format.groupSize}})+|\\d*)`;return this.format.decimalPlaces>0&&(e+=`(?:${D.escapeRegExp(this.format.decimalSeparator)}\\d{0,${this.format.decimalPlaces}})?`),e+="$",new RegExp(e)}}class R{static _getCurrencyFromDom(){const e=document.querySelector('meta[itemprop="priceCurrency"]');return e&&e.hasAttribute("content")?e.getAttribute("content"):null}static async _getCurrencyFromWallet(){const e=await z.runInPageContext((()=>"undefined"!=typeof g_rgWalletInfo&&g_rgWalletInfo?g_rgWalletInfo.wallet_currency:null),null,"walletCurrency");return e?R.currencyNumberToType(e):null}static async _getStoreCurrency(e){let t=R._getCurrencyFromDom();if(t||(t=await R._getCurrencyFromWallet(e)),!t)try{t=await k.action("currency")}catch(e){console.error("Couldn't load currency"+e)}return t||(t="USD"),t}static getRate(e,t){return e===t?1:R._rates[e]&&R._rates[e][t]?R._rates[e][t]:null}static getCurrencySymbolFromString(e){const t=e.match(/(?:R\$|S\$|\$|RM|kr|Rp|€|¥|£|฿|pуб|P|₫|₩|TL|₴|Mex\$|CDN\$|A\$|HK\$|NT\$|₹|SR|R |DH|CHF|CLP\$|S\/\.|COL\$|NZ\$|ARS\$|₡|₪|₸|KD|zł|QR|\$U)/);return t?t[0]:""}static currencyTypeToNumber(e){return R.fromType(e).id}static currencyNumberToType(e){return R.fromNumber(e).abbr}static fromType(e){return R._indices.abbr[e]||R._defaultCurrency}static fromNumber(e){return R._indices.id[e]||R._defaultCurrency}static async _loadCurrency(e){R.storeCurrency=await R._getStoreCurrency(e);const t=h.get("override_price");R.customCurrency="auto"===t?R.storeCurrency:t}static async _loadRates(){const e=[R.storeCurrency];R.customCurrency!==R.storeCurrency&&e.push(R.customCurrency),R._rates=await k.action("rates",e)}static async init(e){if(R._isInitialized)return;const t=await k.action("steam.currencies");for(let e of t)e=new N(e),R._indices.abbr[e.abbr]=e,R._indices.id[e.id]=e,e.symbol&&(R._indices.symbols[e.symbol]=e);R._defaultCurrency=R._indices.id[1];try{await R._loadCurrency(e),await R._loadRates()}catch(e){console.error("Failed to initialize Currency"),console.error(e)}R._isInitialized=!0}static then(e,t){return R.init().then(e,t)}}R._isInitialized=!1,R._indices={id:{},abbr:{},symbols:{}};class B{static async getEaNodes(e,t){const s=new Map;for(const a of e){a.classList.add("es_ea_checked");const e=a.querySelector("a"),n=e&&e.hasAttribute("href")?e.getAttribute("href"):a.getAttribute("href"),r=a.querySelector("img"+t),i=w.getAppid(n)||w.getAppidImgSrc(r?r.getAttribute("src"):null);i&&s.set(String(i),a)}const a=await k.action("isea",Array.from(s.keys()));for(const e of s.keys())a[e]||s.delete(e);return Array.from(s.values())}static async _checkNodes(e,t){const s="string"==typeof t?t:"",a=e.map((e=>e+":not(.es_ea_checked)")).join(",");for(const e of await B.getEaNodes(document.querySelectorAll(a),s)){e.classList.add("es_early_access");const t=e.querySelector("img"+s),a=document.createElement("span");a.classList.add("es_overlay_container"),A.wrap(a,t),r.afterBegin(a,`<span class="es_overlay"><img title="${g.str.early_access}" src="${B._imageUrl}"></span>`)}}static _handleStore(){switch(!0){case/^\/app\/.*/.test(window.location.pathname):B._checkNodes([".game_header_image_ctn",".small_cap"]);break;case/^\/(?:genre|browse|tag)\/.*/.test(window.location.pathname):B._checkNodes([".tab_item",".special_tiny_cap",".cluster_capsule",".game_capsule",".browse_tag_game",".dq_item:not(:first-child)",".discovery_queue:not(:first-child)"]);break;case/^\/search\/.*/.test(window.location.pathname):B._checkNodes([".search_result_row"]);break;case/^\/recommended/.test(window.location.pathname):B._checkNodes([".friendplaytime_appheader",".header_image",".appheader",".recommendation_carousel_item .carousel_cap",".game_capsule",".game_capsule_area",".similar_grid_capsule"]);break;case/^\/tag\/.*/.test(window.location.pathname):B._checkNodes([".cluster_capsule",".tab_row",".browse_tag_game_cap"]);break;case/^\/(?:curator|developer|dlc|publisher)\/.*/.test(window.location.pathname):B._checkNodes(["#curator_avatar_image",".capsule"]);break;case/^\/$/.test(window.location.pathname):B._checkNodes([".cap",".special",".game_capsule",".cluster_capsule",".recommended_spotlight_ctn",".curated_app_link",".dailydeal_ctn a",".tab_item:last-of-type",".large_sale_caps a",".small_sale_caps a",".spotlight_img"])}}static _handleCommunity(){switch(!0){case/^\/(?:id|profiles)\/.+\/(wishlist|games|followedgames)/.test(window.location.pathname):B._checkNodes([".gameListRowLogo"]);break;case/^\/(?:id|profiles)\/.+\/\b(home|myactivity)\b/.test(window.location.pathname):B._checkNodes([".blotter_gamepurchase_content a"]);break;case/^\/(?:id|profiles)\/.+\/\b(reviews|recommended)\b/.test(window.location.pathname):B._checkNodes([".leftcol"]);break;case/^\/(?:id|profiles)\/.+/.test(window.location.pathname):B._checkNodes([".game_info_cap",".showcase_gamecollector_game",".favoritegame_showcase_game"])}}static showEarlyAccess(){if(!h.get("show_early_access"))return;let e="img/overlay/early_access_banner_english.png";switch(d.isCurrentLanguageOneOf(["brazilian","french","italian","japanese","koreana","polish","portuguese","russian","schinese","spanish","latam","tchinese","thai"])&&(e=`img/overlay/early_access_banner_${d.getCurrentSteamLanguage()}.png`),B._imageUrl=u.getURL(e),window.location.host){case"store.steampowered.com":B._handleStore();break;case"steamcommunity.com":B._handleCommunity()}}}class O{static async create(){await k.action("itad.isconnected")&&(r.afterBegin("#global_action_menu",`<div id="es_itad">\n                <img id="es_itad_logo" src="${u.getURL("img/itad.png")}">\n                <span id="es_itad_status">✓</span>\n            </div>`),document.querySelector("#es_itad").addEventListener("mouseenter",O.onHover),$.isSignedIn&&(h.get("itad_import_library")||h.get("itad_import_wishlist"))&&k.action("itad.import"))}static async onHover(){async function e(){const{from:e,to:t}=await k.action("itad.lastimport");let s=`<div>${g.str.itad.from}</div>\n                   <div>${e?new Date(1e3*e).toLocaleString():g.str.never}</div>`;(h.get("itad_import_library")||h.get("itad_import_wishlist"))&&(s+=`<div>${g.str.itad.to}</div>\n                        <div>${t?new Date(1e3*t).toLocaleString():g.str.never}</div>`),r.inner(".es-itad-hover__last-import",s)}if(!document.querySelector(".es-itad-hover")){r.afterEnd("#es_itad_status",`<div class="es-itad-hover">\n                    <div class="es-itad-hover__content">\n                        <h4>${g.str.itad.last_import}</h4>\n                        <div class="es-itad-hover__last-import"></div>\n                        <div class="es-itad-hover__sync-now">\n                            <span class="es-itad-hover__sync-now-text">${g.str.itad.sync_now}</span>\n                            <div class="loader"></div>\n                            <span class="es-itad-hover__sync-failed">&#10060;</span>\n                            <span class="es-itad-hover__sync-success">&#10003;</span>\n                        </div>\n                    </div>\n                    <div class="es-itad-hover__arrow"></div>\n                </div>`);const t=document.querySelector(".es-itad-hover"),s=document.querySelector(".es-itad-hover__sync-now");document.querySelector(".es-itad-hover__sync-now-text").addEventListener("click",(async()=>{let a;s.classList.remove("es-itad-hover__sync-now--failed","es-itad-hover__sync-now--success"),s.classList.add("es-itad-hover__sync-now--loading"),t.style.display="block";try{await k.action("itad.sync"),s.classList.add("es-itad-hover__sync-now--success"),await e(),a=1e3}catch(e){s.classList.add("es-itad-hover__sync-now--failed"),console.group("ITAD sync"),console.error("Failed to sync with ITAD"),console.error(e),console.groupEnd(),a=3e3}finally{v.timer(a).then((()=>{t.style.display=""})),s.classList.remove("es-itad-hover__sync-now--loading")}}))}await e()}static async getAppStatus(e,t){const s={waitlist:!0,collection:!0,...t};if(!s.collection&&!s.waitlist)return null;const a=Array.isArray(e),n=[],r=Promise.resolve(!!a&&{});await k.action("itad.isconnected")?(s.collection?n.push(k.action("itad.incollection",e)):n.push(r),s.waitlist?n.push(k.action("itad.inwaitlist",e)):n.push(r)):n.push(r,r);const[i,o]=await Promise.all(n);if(a){const t={};for(const s of e)t[s]={collected:i[s],waitlisted:o[s]};return t}return{collected:i,waitlisted:o}}}class M{static postMessage(e,t){window.postMessage({type:"es_"+e,information:t},window.location.origin)}static onMessage(e){return new Promise((t=>{window.addEventListener("message",(function s(a){a.source===window&&a.data&&a.data.type&&a.data.type==="es_"+e&&(t(a.data.information),window.removeEventListener("message",s))}))}))}static addMessageListener(e,t){window.addEventListener("message",(s=>{s.source===window&&s.data&&s.data.type&&s.data.type==="es_"+e&&t(s.data.information)}))}}class F{constructor(e=0,t=R.storeCurrency){this.value=e,this.currency=t,Object.freeze(this)}formattedValue(){return R.fromType(this.currency).stringify(this.value,!1)}toString(){return R.fromType(this.currency).stringify(this.value)}add(e){let t=e;return e.currency!==this.currency&&(t=e.inCurrency(this.currency)),new F(this.value+t.value,this.currency)}inCurrency(e){if(this.currency===e)return new F(this.value,this.currency);const t=R.getRate(this.currency,e);if(!t)throw new Error(`Could not establish conversion rate between ${this.currency} and ${e}`);return new F(this.value*t,e)}static parseFromString(e,t=R.storeCurrency){let s=R.fromType(t).valueOf(e);return null!==s&&(s=new F(s,t)),s}}class j{constructor(){this.appids=[],this.subids=[],this.bundleids=[],this.priceCallback=null,this.bundleCallback=null,this._bundles=[]}_getApiParams(){const e={};!h.get("showallstores")&&h.get("stores").length>0&&(e.stores=h.get("stores").join(","));const t=$.storeCountry;return t&&(e.cc=t),e.appids=this.appids.join(","),e.subids=this.subids.join(","),e.bundleids=this.bundleids.join(","),h.get("showlowestpricecoupon")&&(e.coupon=!0),e.appids||e.subids||e.bundleids?e:null}_getPricingStrings(e,t,s){let a=t.toString();R.customCurrency!==R.storeCurrency&&(a+=` (${t.inCurrency(R.storeCurrency).toString()})`);const n=`<span class="itad-pricing__price">${a}</span>`;let r="";return e.cut>0&&(r=`<span class="itad-pricing__cut">-${e.cut}%</span> `),[n,r,s.store.replace("__store__",e.store)]}_processPrices(e,t,s){if(!this.priceCallback)return;const[a,n]=e.split("/"),i=document.createElement("div");i.classList.add("itad-pricing"),i.id="es_price_"+n;const o=g.str.pricing;let c=!1;const l=s.price,d=s.lowest,_=s.bundles.count,u=s.urls;if(l){let e;c=!0;let s="";if(h.get("showlowestpricecoupon")&&l.price_voucher){e=new F(l.price_voucher,t.currency);const a=r.escape(l.voucher);s=o.with_voucher.replace("__voucher__",`<span class="itad-pricing__voucher">${a}</span>`)+" "}else e=new F(l.price,t.currency);e=e.inCurrency(R.customCurrency);const[a,n,d]=this._getPricingStrings(l,e,o);let _="";l.drm.length>0&&"Steam"!==l.store&&(_=`<span class="itad-pricing__drm">(${l.drm[0]})</span>`);const p=r.escape(u.info),g=r.escape(l.url.toString());r.beforeEnd(i,`<a href="${p}" target="_blank">${o.lowest_price}</a>`),r.beforeEnd(i,a),r.beforeEnd(i,`<a href="${g}" class="itad-pricing__main" target="_blank">${n}${s}${d} ${_}</a>`)}if(d){c=!0;const e=new F(d.price,t.currency).inCurrency(R.customCurrency),[s,a,n]=this._getPricingStrings(d,e,o),l=new Date(1e3*d.recorded).toLocaleDateString(),_=r.escape(u.history);r.beforeEnd(i,`<a href="${_}" target="_blank">${o.historical_low}</a>`),r.beforeEnd(i,s),r.beforeEnd(i,`<div class="itad-pricing__main">${a}${n} ${l}</div>`)}if(_>0){c=!0;const e=r.escape(u.bundles||u.bundle_history),t=o.bundle_count.replace("__count__",_);r.beforeEnd(i,`<a href="${e}" target="_blank">${o.bundled}</a>`),r.beforeEnd(i,`<div class="itad-pricing__bundled">${t}</div>`)}c&&this.priceCallback(a,n,i)}_processBundles(e,t){if(!this.bundleCallback)return;let s="";for(const a of t.bundles.live){const t=a.tiers;let n;a.expiry&&(n=new Date(1e3*a.expiry));const r=(new Date).getTime();if(n&&r>n)continue;const i=JSON.stringify({page:a.page||"",title:a.title||"",url:a.url||"",tiers:(()=>{const e=[];for(const s of Object.keys(t))e.push((t[s].games||[]).sort());return e})()});if(this._bundles.indexOf(i)>=0)continue;let o;this._bundles.push(i),a.page?s+=`<div class="game_area_purchase_game">\n                            <div class="game_area_purchase_platform"></div>\n                            <h1>${g.str.buy_package.replace("__package__",`${a.page} ${a.title}`)}</h1>`:s+=`<div class="game_area_purchase_game_wrapper">\n                            <div class="game_area_purchase_game"></div>\n                            <div class="game_area_purchase_platform"></div>\n                            <h1>${g.str.buy_package.replace("__package__",a.title)}</h1>`,n&&(s+=`<p class="game_purchase_discount_countdown">${g.str.bundle.offer_ends} ${n}</p>`),s+='<p class="package_contents">';const c=document.querySelector(".apphub_AppName").textContent;for(let a=0;a<t.length;++a){const n=a+1,r=t[a];if(s+="<b>",t.length>1){const t=r.note||g.str.bundle.tier.replace("__num__",n),a=new F(r.price,e.currency).inCurrency(R.customCurrency).toString();s+=g.str.bundle.tier_includes.replace("__tier__",t).replace("__price__",a).replace("__num__",r.games.length)}else s+=g.str.bundle.includes.replace("__num__",r.games.length);s+=":</b> ";const i=r.games.join(", ");i.includes(c)?(s+=i.replace(c,`<u>${c}</u>`),o=r.price):s+=i,s+="<br>"}s+="</p>",s+=`<div class="game_purchase_action">\n                            <div class="game_purchase_action_bg">\n                                <div class="btn_addtocart btn_packageinfo">\n                                    <a class="btn_blue_steamui btn_medium" href="${a.details}" target="_blank">\n                                        <span>${g.str.bundle.info}</span>\n                                    </a>\n                                </div>\n                            </div>\n                            <div class="game_purchase_action_bg">`,o&&o>0&&(o=new F(o,e.currency).inCurrency(R.customCurrency).toString(),s+=`<div class="game_purchase_price price" itemprop="price">${o}</div>`),s+=`<div class="btn_addtocart">\n                            <a class="btn_green_steamui btn_medium" href="${a.url}" target="_blank">\n                                <span>${g.str.buy}</span>\n                            </a>\n                        </div></div></div></div>`}s&&this.bundleCallback(s)}load(){const e=this._getApiParams();e&&k.action("prices",e).then((e=>{const t=e[".meta"];for(const[s,a]of Object.entries(e.data))this._processPrices(s,t,a),this._processBundles(t,a)}))}}void 0===Promise.prototype.finally&&Object.defineProperty(Promise.prototype,"finally",{value:function(e){const t=this.constructor;return this.then((s=>t.resolve(e()).then((()=>s))),(s=>t.resolve(e()).then((()=>{throw console.error(s),s}))))}});let H=!1;window.addEventListener("unhandledrejection",(function(e){const t=e.reason;t&&t.error&&(e.preventDefault(),e.stopPropagation(),console.group("An error occurred in the background context."),console.error(t.localStack),console.error(t.stack),console.groupEnd())})),A.insertScript({content:"window.Messenger = "+M.toString()}),A.insertScript({content:"window.SteamFacade = "+class{static global(e){return window[e]}static globalSet(e,t){window[e]=t}static showDialog(e,t,s){ShowDialog(e,t,s)}static showConfirmDialog(e,t,s,a,n){return ShowConfirmDialog(e,t,s,a,n)}static showAlertDialog(e,t,s){return ShowAlertDialog(e,t,s)}static showBlockingWaitDialog(e,t){return ShowBlockingWaitDialog(e,t)}static showNicknameModal(){return ShowNicknameModal()}static dismissActiveModal(){CModal.DismissActiveModal()}static showMenu(e,t,s,a,n){return ShowMenu(e,t,s,a,n)}static hideMenu(e,t){return HideMenu(e,t)}static collapseLongStrings(e){return CollapseLongStrings(e)}static bindAutoFlyoutEvents(){return BindAutoFlyoutEvents()}static dynamicStoreInvalidateCache(){return GDynamicStore.InvalidateCache()}static dynamicStoreDecorateItems(e,t){return GDynamicStore.DecorateDynamicItems($J(e),t)}static onDynamicStoreReady(e){return GDynamicStore.OnReady(e)}static storeItemDataBindHover(e,t,s,a,n){GStoreItemData.BindHoverEvents($J(e),t,s,a,n)}static vTooltip(e,t=!1){const s="store.steampowered.com"===window.location.host;$J(e).v_tooltip({tooltipClass:s?"store_tooltip":"community_tooltip",dataName:t?"tooltipHtml":"tooltipText",defaultType:t?"html":"text",replaceExisting:!1})}static calculateFeeAmount(e,t){return CalculateFeeAmount(e,t)}static vCurrencyFormat(e,t){return v_currencyformat(e,t)}static toggleManageFriends(){return ToggleManageFriends()}static openFriendChatInWebChat(e){return OpenFriendChatInWebChat(e)}static submitGuide(){return SubmitGuide()}static initMiniprofileHovers(){return InitMiniprofileHovers()}static inviteUserToGroup(e,t,s){return InviteUserToGroup(e,t,s)}static getCheckedAccounts(e){return GetCheckedAccounts(e)}static execFriendAction(e,t){return ExecFriendAction(e,t)}static scrollOffsetForceRecalc(){CScrollOffsetWatcher.ForceRecalc()}static firstPage(){return InventoryFirstPage()}static lastPage(){return InventoryLastPage()}static goToPage(){return InventoryGoToPage()}static reloadCommunityInventory(){return ReloadCommunityInventory()}static getMarketHashName(e){return GetMarketHashName(e)}static zoomYear(){pricehistory_zoomDays(g_plotPriceHistory,g_timePriceHistoryEarliest,g_timePriceHistoryLatest,365)}static zoomYearForSellDialog(){pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory,SellItemDialog.m_timePriceHistoryEarliest,SellItemDialog.m_timePriceHistoryLatest,365)}static updateSelection(){return UpdateSelection()}static selectAll(){return selectAll()}static selectNone(){return selectNone()}static selectInverse(){return selectInverse()}static jq(e){return $J(e)}static jqOnClick(e,t){$J(e).on("click",t)}static jqAjax(e){return $J.ajax(e)}static jqGet(e,t){return $J.get(e,t)}static jqPost(e,t){return $J.post(e,t)}}.toString()}),k.registerErrorHandler((({name:e,msg:t})=>"LoginError"===e&&(T.addLoginWarning(t),S.finishRequest(),!0)));class z{static runInPageContext(e,t,s){const a=document.createElement("script");let n;const r=Array.isArray(t)?JSON.stringify(t):"[]";if(s){const t="msg_"+ ++z._msgCounter;n=M.onMessage(t),a.textContent=`(async () => { Messenger.postMessage("${t}", await (${e})(...${r})); })();`}else a.textContent=`(${e})(...${r});`;return document.documentElement.appendChild(a),a.parentNode.removeChild(a),n}async run(e){if(document.getElementById("global_header")){try{try{await h,function(){if(H)return;H=!0;const e={ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\-:]|$))/i};h.get("openinnewtab")&&(e.ADD_ATTR=["target"],DOMPurify.addHook("uponSanitizeAttribute",((e,t)=>{"target"===t.attrName&&("_blank"===t.attrValue?e.setAttribute("rel","noreferrer noopener"):t.keepAttr=!1)}))),DOMPurify.setConfig(e)}()}catch(e){console.error(e)}await Promise.all([g,$,R])}catch(e){return console.group("Augmented Steam initialization"),console.error("Failed to initiliaze Augmented Steam"),console.error(e),void console.groupEnd()}console.log(`%c Augmented %cSteam v${p.version} %c ${I}`,"background: #000000; color: #046eb2","background: #000000; color: #ffffff",""),S.create(),S.loading(),T.init(),class{static checkVersion(e){const t=b.fromString(h.get("version"));b.fromString(p.version).isAfter(t)&&(h.get("version_show")&&this._showChangelog(),this._migrateSettings(t),e()),h.set("version",p.version)}static async _showChangelog(){const e=(await u.getJSON("changelog.json"))[p.version];if(!e)return;const t=`<div class="es_changelog"><img src="${u.getURL("img/logo/as128.png")}"><div>${e}</div></div>`,s=document.querySelector("#itad_connect");function a(){s.replaceWith("✓")}z.runInPageContext(((e,t)=>{window.SteamFacade.showAlertDialog(e,t)}),[g.str.update.updated.replace("__version__",p.version),t]),b.fromString(p.version).isSame(new b(1,4))&&(await _.action("itad.isconnected")?a():s.addEventListener("click",(async()=>{await _.action("itad.authorize"),O.create(),a()})))}static _migrateSettings(e){if(e.isSameOrBefore("1.3.1")&&(_.action("cache.clear"),h.set("horizontalscrolling",h.get("horizontalmediascrolling")),h.remove("horizontalmediascrolling")),e.isSameOrBefore("1.4")&&h.remove("show_sysreqcheck"),e.isSame("1.4")&&k.action("migrate.notesToSyncedStorage"),e.isSameOrBefore("1.4.1")&&(h.set("profile_steamid",h.get("profile_permalink")),h.remove("profile_permalink")),e.isSameOrBefore("1.4.3")&&(h.remove("contscroll"),k.action("logout")),e.isSameOrBefore("1.4.7")){const e=m.get("fav_emoticons");Array.isArray(e)&&h.set("fav_emoticons",e)}if(e.isSameOrBefore("2.0.0")&&(h.remove("showfakeccwarning"),h.remove("hideaboutlinks")),e.isSameOrBefore("2.0.1")&&(h.remove("hide_dlcunownedgames"),h.remove("hide_wishlist"),h.remove("hide_cart"),h.remove("hide_notdiscounted"),h.remove("hide_mixed"),h.remove("hide_negative"),h.remove("hide_priceabove"),h.remove("priceabove_value"),h.remove("hide_owned"),h.remove("hide_ignored"),h.remove("highlight_notdiscounted"),h.remove("showallfriendsthatown"),h.has("showusernotes"))){const e=h.get("showusernotes");h.set("user_notes_app",e),h.set("user_notes_wishlist",e),h.remove("showusernotes")}}}.checkVersion(T.clearCache),B.showEarlyAccess(),O.create(),class{static init(){this._activeDropLists={},this._lastSelectHideTime=0,document.addEventListener("mousedown",(e=>this._handleMouseClick(e)))}static _handleMouseClick(e){for(const t of Object.keys(this._activeDropLists)){if(!this._activeDropLists[t])continue;const s=e.target.closest("ul");s&&s.id===t+"_droplist"||this._hide(t)}}static _highlightItem(e,t,s){const a=document.querySelector(`#${e}_droplist`),n=document.querySelector(`#${e}_trigger`),i=a.getElementsByTagName("a");if(t>=0&&t<i.length){const o=i[t];void 0!==n.highlightedItem&&n.highlightedItem!==t&&(i[n.highlightedItem].className="inactive_selection"),n.highlightedItem=t,i[t].className="highlighted_selection";let c=i[t].offsetTop+i[t].clientHeight,l=a.scrollTop+a.clientHeight,d=!1;const _=i.length;let u=0;for(;l<c&&u++<_;)a.scrollTop+=i[t].clientHeight,l=a.scrollTop+a.clientHeight,d=!0;if(!d)for(u=0,c=i[t].offsetTop,l=a.scrollTop;l>c&&u++<_;)a.scrollTop-=i[t].clientHeight,l=a.scrollTop;if(s){r.inner(n,o.innerHTML);const t=document.querySelector("#"+e);t.value=o.id,t.dispatchEvent(new Event("change")),this._hide(e)}}}static _onFocus(e){this._activeDropLists[e]=!0}static _onBlur(e){this._classCheck(document.querySelector(`#${e}_trigger`),"activetrigger")||(this._activeDropLists[e]=!1)}static _hide(e){const t=document.querySelector(`#${e}_droplist`),s=document.querySelector(`#${e}_trigger`),a=new Date;this._lastSelectHideTime=a.valueOf(),s.className="trigger",t.className="dropdownhidden",this._activeDropLists[e]=!1,s.focus()}static _show(e){if(new Date-this._lastSelectHideTime<50)return;const t=document.querySelector(`#${e}_droplist`),s=document.querySelector(`#${e}_trigger`);s.className="activetrigger",t.className="dropdownvisible",this._activeDropLists[e]=!0,s.focus()}static _onTriggerClick(e){this._classCheck(document.querySelector(`#${e}_trigger`),"activetrigger")||this._show(e)}static _classCheck(e,t){return new RegExp(`\\b${t}\\b`).test(e.className)}static get(e,t,s,a,n){const i="sort_by_"+e;let o=s.endsWith("_DESC");const c=r.element(`<div class="es-sortbox es-sortbox--${e}">\n                <div class="es-sortbox__label">${g.str.sort_by}</div>\n                <div class="es-sortbox__container">\n                    <input id="${i}" type="hidden" name="${e}" value="${s}">\n                    <a class="trigger" id="${i}_trigger"></a>\n                    <div class="es-dropdown">\n                        <ul id="${i}_droplist" class="es-dropdown__list dropdownhidden"></ul>\n                    </div>\n                </div>\n                <span class="es-sortbox__reverse">↓</span>\n            </div>`),l=c.querySelector("#"+i);function d(e){return e.replace(/(_ASC|_DESC)$/,"")}function _(e,t){const s=d(e);a(s,t),n&&h.set(n,`${s}_${t?"DESC":"ASC"}`)}l.addEventListener("change",(()=>{_(l.value.replace(i+"_",""),o)})),"default_ASC"!==s&&l.dispatchEvent(new Event("change"));const u=c.querySelector(".es-sortbox__reverse");u.addEventListener("click",(()=>{o=!o,u.textContent=o?"↑":"↓",_(l.value.replace(i+"_",""),o)})),o&&(u.textContent="↑");const p=c.querySelector(`#${i}_trigger`);p.addEventListener("focus",(()=>this._onFocus(i))),p.addEventListener("blur",(()=>this._onBlur(i))),p.addEventListener("click",(()=>this._onTriggerClick(i)));const m=c.querySelector("ul"),f=d(s);for(let e=0;e<t.length;++e){const[s,a]=t[e];let n="inactive";s===f&&(c.querySelector("#"+i).value=s,c.querySelector(".trigger").textContent=a,n="highlighted"),r.beforeEnd(m,`<li>\n                    <a class="${n}_selection" tabindex="99999" id="${i}_${s}">${a}</a>\n                </li>`);const o=m.querySelector("li:last-child > a");o.addEventListener("mouseover",(()=>this._highlightItem(i,e,!1))),o.addEventListener("click",(()=>this._highlightItem(i,e,!0)))}return c}}.init(),this._pageSpecificFeatures(),(new e).applyFeatures()}}_pageSpecificFeatures(){}}z._msgCounter=0;class U extends C{checkPrerequisites(){return this._details=document.querySelector("#game_highlights .rightcol, .workshop_item_header .col_right"),null!==this._details}apply(){if(r.beforeEnd("#highlight_player_area",`<div class="es_slider_toggle btnv6_blue_hoverfade btn_medium">\n                <div data-tooltip-text="${g.str.expand_slider}" class="es_slider_expand"><i class="es_slider_toggle_icon"></i></div>\n                <div data-tooltip-text="${g.str.contract_slider}" class="es_slider_contract"><i class="es_slider_toggle_icon"></i></div>\n            </div>`),m.get("expand_slider",!1)){this._buildSideDetails();for(const e of document.querySelectorAll(".es_slider_toggle, #game_highlights, .workshop_item_header, .es_side_details, .es_side_details_wrap"))e.classList.add("es_expanded");for(const e of document.querySelectorAll(".es_side_details_wrap, .es_side_details"))e.style.display=null,e.style.opacity=1;v.timer(250).then((()=>{window.dispatchEvent(new Event("resize"))}))}const e=document.querySelector(".es_slider_toggle");e.addEventListener("click",(e=>{this._clickSliderToggle(e)}));const t=document.querySelector(".highlight_sketchfab_model");if(t){const s=document.getElementById("highlight_player_area");s.addEventListener("mouseenter",(()=>{"none"!==t.style.display&&(e.style.top="32px")})),s.addEventListener("mouseleave",(()=>{e.style.top=null}))}}_buildSideDetails(){if(this._detailsBuilt)return;this._detailsBuilt=!0;const e=this._details;if(e.matches(".rightcol")){let t=e.querySelector(".glance_ctn");if(!t)return;t=t.cloneNode(!0),t.classList.add("es_side_details","block","responsive_apppage_details_left");for(const e of t.querySelectorAll(".app_tag.add_button, .glance_tags_ctn.your_tags_ctn"))e.remove();const s=r.wrap(t,'<div class="es_side_details_wrap"></div>'),a=document.querySelector("div.rightcol.game_meta_data");a&&a.insertAdjacentElement("afterbegin",s)}else{const t=e.cloneNode(!0);t.classList.add("panel","es_side_details"),r.afterBegin(t,`<div class="title">${g.str.details}</div><div class="hr padded"></div>`);let s=document.querySelector(".sidebar");s&&s.insertAdjacentElement("afterbegin",t),s=document.querySelector(".highlight_ctn"),s&&r.wrap(s,'<div class="leftcol"></div>')}}_clickSliderToggle(e){e.preventDefault(),e.stopPropagation();const t=e.target.closest(".es_slider_toggle");this._buildSideDetails();const s=document.querySelector(".es_side_details_wrap, .es_side_details");s&&(t.classList.contains("es_expanded")?(s.style.opacity=0,v.timer(250).then((()=>{t.classList.contains("es_expanded")||(s.style.display="none")}))):(s.style.display=null,s.style.opacity=1)),document.querySelector(".highlight_ctn").addEventListener("transitionend",(()=>{m.set("expand_slider",t.classList.contains("es_expanded"));const e=this._details;t.classList.contains("es_expanded")||(e.style.transition="",e.style.opacity="0",e.style.transition="opacity 250ms",e.style.display=null,e.style.opacity="1"),v.timer(250).then((()=>{window.dispatchEvent(new Event("resize"))}))}));for(const e of document.querySelectorAll(".es_slider_toggle, #game_highlights, .workshop_item_header, .es_side_details, .es_side_details_wrap"))e.classList.toggle("es_expanded")}}class W extends C{checkPrerequisites(){return h.get("showlowestprice")}apply(){const e=new j;e.subids=this.context.getAllSubids(),e.bundleids=[];for(const t of document.querySelectorAll("[data-ds-bundleid]"))e.bundleids.push(t.dataset.dsBundleid);e.priceCallback=function(e,t,s){let a,n="afterbegin";if("sub"===e)a=document.querySelector(`input[name=subid][value="${t}"]`).parentNode.parentNode.parentNode;else if("bundle"===e)if(a=document.querySelector(`.game_area_purchase_game_wrapper[data-ds-bundleid="${t}"]`),a){const e=a.querySelector(".ds_completetheset"),t=a.querySelector(".game_area_purchase_game");e&&t&&t.appendChild(e)}else a=document.querySelector(`.game_area_purchase_game[data-ds-bundleid="${t}"]`),n="beforebegin";a.insertAdjacentElement(n,s)},e.bundleCallback=function(e){r.afterEnd("#game_area_purchase",`<h2 class="gradientbg es_bundle_info">${g.str.bundle.header} <img src="//store.steampowered.com/public/images/v5/ico_external_link.gif"></h2>\n                ${e}`)},e.load()}}class G extends C{checkPrerequisites(){return!!h.get("showdrm")&&(!this.context.type===x.APP||21690!==this.context.appid&&1157970!==this.context.appid)}apply(){let e="";for(const t of document.querySelectorAll(".game_area_sys_req, #game_area_legal, .game_details, .DRM_notice"))e+=t.textContent.toLowerCase();const t=[[e.includes("games for windows live")||e.includes("games for windows - live")||e.includes("online play requires log-in to games for windows")||e.includes("installation of the games for windows live software")||e.includes("multiplayer play and other live features included at no charge")||e.includes("www.gamesforwindows.com/live"),"Games for Windows Live"],[e.includes("uplay")||e.includes("ubisoft account"),"Ubisoft Uplay"],[e.includes("securom"),"SecuROM"],[e.match(/\b(tages|solidshield)\b/)&&!e.match(/angebote des tages/),"Tages"],[e.includes("stardock account"),"Stardock Account Required"],[e.includes("rockstar social club")||e.includes("rockstar games social club"),"Rockstar Social Club"],[e.includes("requires a kalypso account"),"Kalypso Launcher"],[e.includes("denuvo"),"Denuvo Anti-tamper"],[e.includes("origin client"),"EA Origin"],[e.includes("xbox live"),"Microsoft Xbox Live"]].filter((([e])=>e)).map((([,e])=>e));let s;if(t.length>0)s=this.context.type===x.APP?g.str.drm_third_party:g.str.drm_third_party_sub,s=s.replace("__drmlist__",`(${t.join(", ")})`);else{const e=/\b(drm|account|steam)\b/i;if(this.context.type===x.APP)for(const t of document.querySelectorAll("#category_block > .DRM_notice")){const a=t.textContent;if(e.test(a)){s=a;break}}else{const t=document.querySelector(".game_details .details_block > p > b:last-of-type"),a=t.textContent+t.nextSibling.textContent;e.test(a)&&(s=a)}}if(s){const e=document.querySelector("#game_area_purchase .game_area_description_bodylabel");e?r.afterEnd(e,`<div class="game_area_already_owned es_drm_warning"><span>${s}</span></div>`):r.afterBegin("#game_area_purchase",`<div class="es_drm_warning"><span>${s}</span></div>`)}}}class V extends C{checkPrerequisites(){const e=this.context;return e.type===x.APP?(this._type="app",this._gameid=e.appid,this._node=document.querySelector("#shareEmbedRow")):e.type===x.SUB?(this._type="sub",this._gameid=e.subid,this._node=document.querySelector(".share").parentNode):e.type===x.BUNDLE&&(this._type="bundle",this._gameid=e.bundleid,this._node=document.querySelector(".share, .rightcol .game_details")),this._node||console.warn("Couldn't find element to insert extra links"),null!==this._node&&("app"===this._type||h.get("showbartervg")||h.get("showsteamdb")||h.get("showitadlinks"))}apply(){if("app"===this._type){this._moveExtraLinks();const e=i.clearSpecialSymbols(this.context.appName);for(const t of h.get("app_custom_link")){if(!t||!t.enabled)continue;const s=t.url,a=r.escape(t.name),n="//"+r.escape(s.replace("[NAME]",encodeURIComponent(e)).replace("[ID]",this.context.appid));let i;t.icon&&(i="//"+r.escape(t.icon)),r.afterBegin(this._node,this._getRightColLinkHtml(null,n,g.str.view_on_website.replace("__website__",a),i))}h.get("showyoutubereviews")&&r.afterBegin(this._node,this._getRightColLinkHtml("youtube_btn","https://www.youtube.com/results?search_query="+encodeURIComponent(e+' "PC" intitle:Review'),g.str.youtube_reviews)),h.get("showyoutubegameplay")&&r.afterBegin(this._node,this._getRightColLinkHtml("youtube_btn","https://www.youtube.com/results?search_query="+encodeURIComponent(e+' "PC Gameplay"'),g.str.youtube_gameplay)),h.get("showyoutube")&&r.afterBegin(this._node,this._getRightColLinkHtml("youtube_btn","https://www.youtube.com/results?search_query="+encodeURIComponent(e),g.str.view_on_website.replace("__website__","YouTube"))),h.get("showtwitch")&&r.afterBegin(this._node,this._getRightColLinkHtml("twitch_btn","https://www.twitch.tv/directory/game/"+encodeURIComponent(e),g.str.view_on_website.replace("__website__","Twitch"))),h.get("showpcgw")&&r.afterBegin(this._node,this._getRightColLinkHtml("pcgw_btn","https://pcgamingwiki.com/api/appid.php?appid="+this.context.appid,g.str.wiki_article.replace("__pcgw__","PCGamingWiki"))),h.get("showcompletionistme")&&r.afterBegin(this._node,this._getRightColLinkHtml("completionistme_btn",`https://completionist.me/steam/app/${this.context.appid}/`,g.str.view_on_website.replace("__website__","Completionist.me"))),h.get("showprotondb")&&r.afterBegin(this._node,this._getRightColLinkHtml("protondb_btn",`https://www.protondb.com/app/${this.context.appid}/`,g.str.view_on_website.replace("__website__","ProtonDB"))),this.context.hasCards&&h.get("showsteamcardexchange")&&r.afterBegin(this._node,this._getRightColLinkHtml("cardexchange_btn",`https://www.steamcardexchange.net/index.php?gamepage-appid-${this.context.communityAppid}/`,g.str.view_on_website.replace("__website__","Steam Card Exchange")))}h.get("showbartervg")&&r.afterBegin(this._node,this._getRightColLinkHtml("bartervg_ico",`https://barter.vg/steam/${this._type}/${this._gameid}/`,g.str.view_on_website.replace("__website__","Barter.vg"))),h.get("showsteamdb")&&r.afterBegin(this._node,this._getRightColLinkHtml("steamdb_ico",`https://steamdb.info/${this._type}/${this._gameid}/`,g.str.view_on_website.replace("__website__","Steam Database"))),h.get("showitadlinks")&&r.afterBegin(this._node,this._getRightColLinkHtml("itad_ico",`https://isthereanydeal.com/steam/${this._type}/${this._gameid}/`,g.str.view_on_website.replace("__website__","IsThereAnyDeal")))}_getRightColLinkHtml(e,t,s,a){return`<a class="btnv6_blue_hoverfade btn_medium es_app_btn ${e||""}" target="_blank" href="${t}">\n                    <span><i class="ico16" ${e?"":`style="background: ${a?`url('${a}')`:"none"}; background-size: contain;"`}></i>&nbsp;&nbsp; ${s}</span>\n                </a>`}_moveExtraLinks(){const e=this._node;e.classList.add("es_useful_link");const t=document.querySelector(".es_side_details_wrap");t?t.insertAdjacentElement("afterend",e):document.querySelector("div.rightcol.game_meta_data").insertAdjacentElement("afterbegin",e)}}class J{static getAdapter(){if(void 0===J._adapter){let e=J.adapters[h.get("user_notes_adapter")];void 0===e&&(h.remove("user_notes_adapter"),e=J.adapters[h.defaults.user_notes_adapter]),J._adapter=new e}return J._adapter}static async changeAdapter(e){const t=J.getAdapter(),s=new J.adapters[e];return await s.import(await t.export()),await t.clear(),J._adapter=s,J._adapter}}class Y extends Error{constructor(e,...t){super(...t),this.name=this.constructor.name,this.ratio=e}}class K{constructor(e=!1,t=null){this.closeToFull=e,this.utilization=t}}J.adapters=Object.freeze({synced_storage:class{constructor(){this._notes=h.get("user_notes")}get(e){return this._notes[e]||null}async set(e,t){const s=this._notes[e];this._notes[e]=t;const a=this._getNotesSize()/h.QUOTA_BYTES_PER_ITEM;if(a>1)throw this._notes[e]=s,new Y(a,"Can't set this user note, out of capacity");return await h.set("user_notes",this._notes),new K(a>.85,a)}delete(e){return delete this._notes[e],h.set("user_notes",this._notes)}export(){return this._notes}import(e){const t=this._getNotesSize(e)/h.QUOTA_BYTES_PER_ITEM;if(t>1)throw new Y(t,"Import to synced storage failed, too much data for this adapter");return this._notes=e,h.set("user_notes",this._notes)}clear(){return h.remove("user_notes")}_getNotesSize(e=this._notes){return"user_notes".length+JSON.stringify(e).length}},idb:class{get(e){return _.action("notes.get",e)}set(e,t){return _.action("notes.set",e,t)}delete(e){return _.action("notes.delete",e)}export(){return _.action("notes.getall")}import(e){return _.action("notes.setall",e)}clear(){return _.action("notes.clear")}}});class Q{constructor(){this._str=g.str.user_note,this._adapter=J.getAdapter(),this.noteModalTemplate='<div class="es_note_prompt newmodal_prompt_with_textarea gray_bevel fullwidth">\n                <textarea name="es_note_input" id="es_note_input" rows="6" cols="12">__note__</textarea>\n            </div>'}get(...e){return this._adapter.get(...e)}async set(...e){let t=null;try{t=await this._adapter.set(...e)}catch(t){if(t instanceof Y)return!!await this._showDialog(!0,t.ratio)&&this.set(...e);throw t}return t instanceof K&&t.closeToFull&&await this._showDialog(!1,t.utilization),!0}delete(...e){return this._adapter.delete(...e)}async showModalDialog(e,t,s,a){let n=await this.get(t)||"";z.runInPageContext(((e,t,s,a)=>{const n=new jQuery.Deferred;function r(){n.resolve(document.querySelector("#es_note_input").value.trim().replace(/\s\s+/g," "))}function i(){n.reject()}const o=[],c=_BuildDialogButton(s,!0);c.click(r),o.push(c);const l=_BuildDialogButton(a,!1);l.click(i),o.push(l);const d=_BuildDialog(e,t,o,i);_BindOnEnterKeyPressForDialog(d,n,r),n.always((()=>d.Dismiss()));const _=document.getElementById("es_note_input");_.focus(),_.setSelectionRange(0,_.textLength),n.promise(d),d.done((e=>{window.Messenger.postMessage("noteClosed",e)})).fail((()=>{window.Messenger.postMessage("noteClosed",null)})),d.Show()}),[this._str.add_for_game.replace("__gamename__",e),this.noteModalTemplate.replace("__appid__",t).replace("__note__",n).replace("__selector__",encodeURIComponent(s)),g.str.save,g.str.cancel],!0);const i=n;if(n=await M.onMessage("noteClosed"),null===n)return;if(n=r.escape(n),n===i)return;const o=document.querySelector(s);if(0===n.length)this.delete(t),o.textContent=this._str.add;else{if(!await this.set(t,n))return;r.inner(o,`"${n}"`)}a(o,0!==n.length)}async _showDialog(e,t){const s=this._str,a=`${(e?s.not_enough_space_desc:s.close_on_storage_desc).replace("__perc__",(100*t).toFixed(0))}\n            <br>\n            ${s.storage_warning_desc}`;let n;return z.runInPageContext(((e,t,s,a,n)=>{window.SteamFacade.showConfirmDialog(e,t,n,a).done((e=>window.Messenger.postMessage("storageOption",e))).fail((()=>window.Messenger.postMessage("storageOption",null)))}),[e?s.not_enough_space:s.close_on_storage,a,s.save_itad,s.save_synced_storage,s.save_local]),"OK"===await M.onMessage("storageOption")&&(n="idb",this._adapter=await J.changeAdapter("idb"),await h.set("user_notes_adapter","idb"),!0)}}class Z extends C{async apply(){await z.runInPageContext((()=>new Promise((e=>{window.SteamFacade.onDynamicStoreReady((()=>{e()}))}))),null,!0);const e=document.getElementById("search_suggestion_contents");return e&&new MutationObserver((e=>{Z.highlightAndTag(e[0].addedNodes)})).observe(e,{childList:!0}),Promise.all([Z.highlightTitle(this.context.appid),Z.highlightAndTag()])}static highlightTitle(e){const t=document.querySelector(".apphub_AppName");return t?(t.dataset.dsAppid=e,Z.highlightAndTag([t],!1)):null}static async highlightAndTag(e=document.querySelectorAll(this._selector),t=!0,s={}){const a={owned:!0,wishlisted:!0,ignored:!0,collected:!0,waitlisted:!0,gift:!0,guestPass:!0,coupon:!0,...s},n=new Map;for(const s of e){let e=s;s.classList.contains("item")?e=s.querySelector(".info"):s.classList.contains("home_area_spotlight")?e=s.querySelector(".spotlight_content"):s.parentNode.classList.contains("steam_curator_recommendation")&&s.parentNode.classList.contains("big")?e=s.nextElementSibling:s.parentNode.parentNode.classList.contains("curations")?e=s.parentNode:(s.classList.contains("special_img_ctn")&&s.parentElement.classList.contains("special")||s.classList.contains("blotter_userstats_game"))&&(e=s.parentElement);const r=s.querySelector("a"),i=w.getAppid(s)||w.getAppid(r)||w.getAppidFromId(s.id),o=w.getSubid(s)||w.getSubid(r),c=w.getBundleid(s)||w.getBundleid(r);let l;if(i?l="app/"+i:c?l="bundle/"+c:o&&(l="sub/"+o),l)if(n.has(l)){const t=n.get(l);t.push(e),n.set(l,t)}else n.set(l,[e]);t&&(s.querySelector(".ds_owned_flag")&&a.owned&&this.highlightOwned(e),s.querySelector(".ds_wishlist_flag")&&a.wishlisted&&this.highlightWishlist(e),s.querySelector(".ds_ignored_flag")&&a.ignored&&this.highlightIgnored(e))}const r=Array.from(n.keys()),i=r.map((e=>w.trimStoreId(e))),o=!t&&(a.owned&&(h.get("highlight_owned")||h.get("tag_owned"))||a.wishlisted&&(h.get("highlight_wishlist")||h.get("tag_wishlist"))||a.ignored&&(h.get("highlight_notinterested")||h.get("tag_notinterested"))),[c,l,d]=await Promise.all([o?E.getAppStatus(r):Promise.resolve(),O.getAppStatus(r,{waitlist:a.waitlisted&&(h.get("highlight_waitlist")||h.get("tag_waitlist")),collection:a.collected&&(h.get("highlight_collection")||h.get("tag_collection"))}),L.getAppStatus(i,{giftsAndPasses:a.gift&&(h.get("highlight_inv_gift")||h.get("tag_inv_gift"))||a.guestPass&&(h.get("highlight_inv_guestpass")||h.get("tag_inv_guestpass")),coupons:a.coupon&&(h.get("highlight_coupon")||h.get("tag_coupon"))})]),_=i.values();for(const[e,t]of n)if(c&&(a.owned&&c[e].owned&&t.forEach((e=>{this.highlightOwned(e)})),a.wishlisted&&c[e].wishlisted&&t.forEach((e=>{this.highlightWishlist(e)})),a.ignored&&c[e].ignored&&t.forEach((e=>{this.highlightIgnored(e)}))),l&&(l[e].collected&&t.forEach((e=>{this.highlightCollection(e)})),l[e].waitlisted&&t.forEach((e=>{this.highlightWaitlist(e)}))),d){const e=_.next().value;a.gift&&d[e].gift&&t.forEach((e=>{this.highlightInvGift(e)})),a.guestPass&&d[e].guestPass&&t.forEach((e=>{this.highlightInvGuestpass(e)})),d[e].coupon&&t.forEach((e=>{this.highlightInvCoupon(e)}))}}static _addTag(e,t){const s=h.get("tag_short");if(!this._tagCssLoaded){this._tagCssLoaded=!0;const e=[];for(const t of this._types){const s=h.get(`tag_${t}_color`);e.push(`.es_tag_${t} { background-color: ${s}; }`)}let t=document.createElement("style");t.id="es_tag_styles",t.textContent=e.join("\n"),document.head.appendChild(t),t=null}let a=e.querySelectorAll(".es_tags");if(0===a.length){let t;a=i.htmlToElement(`<div class="es_tags ${s?"es_tags_short":""}"></div>`),e.classList.contains("tab_row")?(t=e.querySelector(".tab_desc").classList.remove("with_discount"),e.querySelector(".tab_discount").style.top="15px",t.querySelector("h4").insertAdjacentElement("afterend",a)):e.classList.contains("home_smallcap")?e.querySelector(".home_smallcap_title").insertAdjacentElement("afterbegin",a):e.classList.contains("curated_app_item")?e.querySelector(".home_headerv5_title").insertAdjacentElement("afterbegin",a):e.classList.contains("tab_item")?e.querySelector(".tab_item_name").insertAdjacentElement("afterend",a):e.classList.contains("newonsteam_headercap")||e.classList.contains("comingsoon_headercap")?e.querySelector(".discount_block").insertAdjacentElement("beforebegin",a):e.classList.contains("search_result_row")?e.querySelector("p").insertAdjacentElement("afterbegin",a):e.classList.contains("dailydeal")?(t=e.parentNode,t.querySelector(".game_purchase_action").insertAdjacentElement("beforebegin",a),r.beforeBegin(t.querySelector(".game_purchase_action"),'<div style="clear: right;"></div>')):e.classList.contains("browse_tag_game")?e.querySelector(".browse_tag_game_price").insertAdjacentElement("afterend",a):e.classList.contains("game_area_dlc_row")?e.querySelector(".game_area_dlc_price").insertAdjacentElement("afterbegin",a):e.classList.contains("wishlist_row")?e.querySelector(".addedon").insertAdjacentElement("afterbegin",a):e.classList.contains("match")?e.querySelector(".match_price").insertAdjacentElement("afterbegin",a):e.classList.contains("cluster_capsule")?e.querySelector(".main_cap_platform_area").append(a):e.classList.contains("recommendation_highlight")?e.querySelector(".highlight_description").insertAdjacentElement("afterbegin",a):e.classList.contains("similar_grid_item")?e.querySelector(".regular_price, .discount_block").append(a):e.classList.contains("recommendation_carousel_item")?e.querySelector(".buttons").insertAdjacentElement("beforebegin",a):e.classList.contains("friendplaytime_game")&&e.querySelector(".friendplaytime_buttons").insertAdjacentElement("beforebegin",a),a=[a]}for(const e of a)e.querySelector(".es_tag_"+t)||r.beforeEnd(e,`<span class="es_tag_${t}">${g.str.tag[t]}</span>`)}static _highlightNode(e){if(h.get("highlight_excludef2p")){if(e.innerHTML.match(/<div class="(tab_price|large_cap_price|col search_price|main_cap_price|price)">\n?(.+)?(Free to Play|Play for Free!)(.+)?<\/div>/i))return;if(e.innerHTML.match(/<h5>(Free to Play|Play for Free!)<\/h5>/i))return;if(e.innerHTML.match(/genre_release/)&&e.querySelector(".genre_release").innerHTML.match(/Free to Play/i))return;if(e.classList.contains("search_result_row")&&e.innerHTML.match(/Free to Play/i))return}if(!this._highlightCssLoaded){this._highlightCssLoaded=!0;const e=[];for(const t of this._types){const s=h.get(`highlight_${t}_color`);e.push(`.es_highlighted_${t} {\n                        background: ${s} linear-gradient(135deg, rgba(0, 0, 0, 0.70) 10%, rgba(0, 0, 0, 0) 100%) !important;\n                    }\n                    .carousel_items .es_highlighted_${t}.price_inline, .curator_giant_capsule.es_highlighted_${t},\n                    .hero_capsule.es_highlighted_${t}, .blotter_userstatus_game.es_highlighted_${t} {\n                        outline: solid ${s};\n                    }\n                    #search_suggestion_contents .focus.es_highlighted_${t} {\n                        box-shadow: -5px 0 0 ${s};\n                    }\n                    .apphub_AppName.es_highlighted_${t} {\n                        background: none !important; color: ${s};\n                    }`)}let t=document.createElement("style");t.id="es_highlight_styles",t.textContent=e.join("\n"),document.head.appendChild(t),t=null}let t=e;if(t.classList.contains("cluster_capsule")?t=t.querySelector(".main_cap_content").parentNode:t.classList.contains("large_cap")?t=t.querySelector(".large_cap_content"):t.parentNode.classList.contains("steam_curator_recommendation")&&t.parentNode.classList.contains("big")&&(t=t.previousElementSibling),t.classList.contains("single")&&(t=t.querySelector(".gamelink")),t.parentNode.parentNode.classList.contains("apps_recommended_by_curators_v2")){let e=t.querySelectorAll(".ds_flag");e.forEach((e=>e.remove())),e=t.querySelectorAll(".ds_flagged"),e.forEach((e=>e.classList.remove("ds_flagged")))}else{(t.classList.contains("info")||t.classList.contains("spotlight_content"))&&(t=t.parentElement);let e=t.querySelector(".ds_flag");e&&e.remove(),e=t.querySelector(".ds_flagged"),e&&e.classList.remove("ds_flagged")}t.classList.remove("ds_flagged")}static _highlightItem(e,t){e.classList.add("es_highlight_checked"),h.get("highlight_"+t)&&(e.classList.add("es_highlighted","es_highlighted_"+t),this._highlightNode(e)),h.get("tag_"+t)&&this._addTag(e,t)}static highlightOwned(e){this._highlightItem(e,"owned")}static highlightWishlist(e){this._highlightItem(e,"wishlist")}static highlightInvCoupon(e){this._highlightItem(e,"coupon")}static highlightInvGift(e){this._highlightItem(e,"inv_gift")}static highlightInvGuestpass(e){this._highlightItem(e,"inv_guestpass")}static highlightIgnored(e){this._highlightItem(e,"notinterested")}static highlightCollection(e){this._highlightItem(e,"collection")}static highlightWaitlist(e){this._highlightItem(e,"waitlist")}}Z._highlightCssLoaded=!1,Z._tagCssLoaded=!1,Z._types=["notinterested","waitlist","wishlist","collection","owned","coupon","inv_guestpass","inv_gift"],Z._selector=["div.tab_row","div.dailydeal_ctn",".store_main_capsule","div.wishlistRow","a.game_area_dlc_row","a.small_cap","a.home_smallcap",".home_content_item",".home_content.single",".home_area_spotlight","a.search_result_row","a.match",".highlighted_app","a.cluster_capsule","div.recommendation_highlight","div.recommendation_carousel_item","div.friendplaytime_game",".recommendation_row",".friendactivity_tab_row",".friend_game_block",".recommendation",".curator_giant_capsule","div.carousel_items.curator_featured > div","div.item_ctn",".store_capsule",".newonsteam_headercap",".comingsoon_headercap",".home_marketing_message","div.dlc_page_purchase_dlc","div.sale_page_purchase_item","div.item","div.home_area_spotlight","div.browse_tag_game","div.similar_grid_item",".tab_item",".special > .special_img_ctn",".special.special_img_ctn","div.curated_app_item",".hero_capsule",".sale_capsule"].map((e=>e+":not(.es_highlighted)")).join(",");class X extends C{checkPrerequisites(){return h.get("hidetmsymbols")}apply(){let e="title, .apphub_AppName, .breadcrumbs, h1, h4";function t(e){e&&e.innerHTML&&r.inner(e,e.innerHTML.replace(/[\u00AE\u00A9\u2122]/g,""))}this.context.type===x.STORE_DEFAULT?e+=".game_area_already_owned, .details_block, .game_description_snippet, .game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, .game_area_dlc_name, .tab_desc, .tab_item_name":e+=".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, .apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName";for(const s of document.querySelectorAll(e))t(s);const s=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{t(e)}))}))})),a=document.querySelectorAll("#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn");for(const e of a)s.observe(e,{childList:!0,subtree:!0})}}class ee extends C{checkPrerequisites(){return h.get("show_alternative_linux_icon")}apply(){const e=u.getURL("img/alternative_linux_icon.png"),t=document.createElement("style");let s=`span.platform_img.linux { background-image: url(${e}) !important; }`;this.context.type===x.STORE_FRONT&&(s+=".tab_item.focus .tab_item_details span.platform_img.linux { filter: brightness(20%); }"),t.textContent=s,document.head.appendChild(t)}}class te extends C{apply(){const e=Array.from(document.querySelectorAll("#developers_list > a, .details_block > .dev_row:first-of-type > a")),t=Array.from(document.querySelectorAll(".user_reviews > .dev_row:last-of-type a, .details_block > .dev_row:nth-of-type(2) > a"));let s=document.querySelector(".details_block > .dev_row:nth-of-type(3) > a");s=s?[s]:[];for(const a of[...e,...t,...s]){const n=new URL(a.href);if(n.pathname.startsWith("/search/"))continue;let i;e.includes(a)?i="developer":t.includes(a)?i="publisher":s===a&&(i="franchise"),i&&(a.href=`https://store.steampowered.com/search/?${i}=${encodeURIComponent(a.textContent)}`,r.afterEnd(a,` (<a href="${n.href}">${g.str.options.homepage}</a>)`))}for(const e of document.querySelectorAll(".dev_row > .more_btn"))e.remove();z.runInPageContext((()=>{window.SteamFacade.collapseLongStrings(".dev_row .summary.column")}))}}class se extends C{checkPrerequisites(){return $.isSignedIn&&!this.context.isOwned()}apply(){const e=document.querySelector("#add_to_wishlist_area_success > a");e.dataset.tooltipText=g.str.remove_from_wishlist_tooltip;const t=e.querySelector("img:last-child");t.classList.add("es-in-wl"),r.beforeBegin(t,`<img class="es-remove-wl" src="${u.getURL("img/remove.png")}" style="display: none;">\n            <img class="es-loading-wl" src="//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif" style="display: none;">`),e.addEventListener("click",(async t=>{t.preventDefault();const s=e.closest(".queue_actions_ctn");if(s.classList.contains("loading"))return;s.classList.add("loading");const a=Boolean(document.querySelector(".queue_btn_wishlist + .queue_btn_ignore_menu.owned_elsewhere"));try{await Promise.all([this.context.removeFromWishlist(),a?this.context.removeFromWaitlist():Promise.resolve()]),this.context.onWishAndWaitlistRemove&&this.context.onWishAndWaitlistRemove(),document.getElementById("add_to_wishlist_area").style.display="",E.clear(),z.runInPageContext((()=>{window.SteamFacade.dynamicStoreInvalidateCache()}))}catch(e){document.getElementById("add_to_wishlist_area_fail").style.display="",this.logError(e,"Failed to remove app from wishlist")}finally{document.getElementById("add_to_wishlist_area_success").style.display="none",s.classList.remove("loading")}}));for(const e of document.querySelectorAll("#add_to_wishlist_area, #add_to_wishlist_area_success, .queue_btn_ignore"))e.addEventListener("click",E.clear)}}class ae extends C{checkPrerequisites(){return h.get("mp4video")}apply(){for(const e of document.querySelectorAll("[data-webm-source]")){const t=e.dataset.mp4Source,s=e.dataset.mp4HdSource;if(!t||!s)continue;e.dataset.webmSource=t,e.dataset.webmHdSource=s;const a=e.querySelector("video");a&&(a.dataset.sdSrc=t,a.dataset.hdSrc=s,this.context.toggleVideoDefinition(a,!1))}}}class ne extends C{checkPrerequisites(){return document.querySelector("div.highlight_movie")}apply(){const e=this,t=document.querySelector("div.highlight_movie");let s=m.get("playback_hd");function a(e){if(!document.fullscreenEnabled&&!document.mozFullScreenEnabled)return;const t=e.parentNode;if(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen();else{let e=null;t.requestFullscreen?e=t.requestFullscreen():t.mozRequestFullScreen?e=t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),Promise.resolve(e).catch((e=>console.error(e)))}}async function n(t){if(s=m.get("playback_hd"),await v.timer(150),t.dataset.hdSrc){const e=t.parentNode.querySelector(".time");e&&r.afterEnd(e,'<div class="es_hd_toggle"><span>HD</span></div>')}let n=t.parentNode.querySelector(".fullscreen_button");if(n){let e=document.createElement("div");e.classList.add("fullscreen_button"),e.addEventListener("click",(()=>a(t)),!1),n.replaceWith(e),n=null,e=null}t.addEventListener("dblclick",(()=>a(t)),!1),e.context.toggleVideoDefinition(t,s)}const i=t.querySelector("video.highlight_movie");i&&n(i);const o=new MutationObserver((e=>{for(const t of e)for(const e of t.addedNodes)e.matches("video.highlight_movie")&&n(e)}));for(const e of document.querySelectorAll("div.highlight_movie"))o.observe(e,{childList:!0});document.querySelector("#highlight_player_area").addEventListener("click",(e=>{if(!e.target.closest(".es_hd_toggle"))return;e.preventDefault(),e.stopPropagation();const t=e.target.closest("div.highlight_movie").querySelector("video"),s=this.context.toggleVideoDefinition(t);for(const e of document.querySelectorAll("video.highlight_movie"))e!==t&&this.context.toggleVideoDefinition(e,s);m.set("playback_hd",s)}),!0);for(const t of document.querySelectorAll(".es_slider_toggle"))t.addEventListener("click",(function t(s){if(s.currentTarget.removeEventListener("click",t,!1),s.target.classList.contains("es_expanded")){for(const t of document.querySelectorAll("video.highlight_movie.es_video_sd"))e.context.toggleVideoDefinition(t,!0);m.set("playback_hd",!0)}}),!1)}}class re extends C{checkPrerequisites(){return $.isSignedIn&&h.get("user_notes_app")}async apply(){const e=this.context.userNotes;let t="",s="esi-note--hidden",a="",n="display:none;";const i=await e.get(this.context.appid);function o(e,t){const s=document.querySelector(".js-user-note-button");s.querySelector("#es_add_note").style.display=t?"none":null,s.querySelector("#es_update_note").style.display=t?null:"none",e.classList.toggle("esi-note--hidden",!t)}null!==i&&(t=`"${i}"`,s="",a="display:none;",n=""),r.beforeBegin(".queue_actions_ctn > :last-child",`<div class="queue_control_button js-user-note-button">\n                <div id="es_add_note" class="btnv6_blue_hoverfade btn_medium queue_btn_inactive" style="${a}">\n                    <span>${g.str.user_note.add}</span>\n                </div>\n                <div id="es_update_note" class="btnv6_blue_hoverfade btn_medium queue_btn_inactive" style="${n}">\n                    <span>${g.str.user_note.update}</span>\n                </div>\n            </div>`),r.beforeEnd(".queue_actions_ctn",`<div id='esi-store-user-note' class='esi-note esi-note--store ${s} ellipsis'>${t}</div>`);const c=()=>{e.showModalDialog(this.context.appName,this.context.appid,"#esi-store-user-note",o)};document.querySelector(".js-user-note-button").addEventListener("click",c),document.querySelector("#esi-store-user-note").addEventListener("click",c)}}class ie extends C{async checkPrerequisites(){return h.get("add_to_waitlist")&&null!==document.querySelector("#add_to_wishlist_area")&&!0===await k.action("itad.isconnected")}async apply(){for(const e of document.querySelectorAll("#add_to_wishlist_area_success > div"))e.remove();const e=document.querySelectorAll("#add_to_wishlist_area,#add_to_wishlist_area_success"),[t,s]=e;r.afterEnd(".queue_actions_ctn :first-child",'<div style="position: relative; display: inline-block;">\n                <div class="queue_control_button as_btn_wishlist"></div>\n            </div>');const a=document.querySelector(".as_btn_wishlist");document.querySelector(".queue_actions_ctn").insertBefore(a.parentNode,t),a.append(...e),r.afterEnd(a,`<div class="queue_control_button queue_btn_menu as_btn_wishlist_menu">\n                <div class="queue_menu_arrow btn_medium">\n                    <span><img src="https://steamstore-a.akamaihd.net/public/images/v6/btn_arrow_down_padded.png"></span>\n                </div>\n                <div class="queue_menu_flyout">\n                    <div class="queue_menu_flyout_content">\n                        <div class="queue_menu_option" id="queue_menu_option_on_wishlist">\n                            <div>\n                                <img class="queue_ignore_menu_option_image selected" src="https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_selected_bright.png">\n                                <img class="queue_ignore_menu_option_image unselected" src="https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_unselected_bright.png">\n                            </div>\n                            <div class="queue_menu_option_label">\n                                <div class="option_title">${g.str.wishlist} (${g.str.theworddefault})</div>\n                                <div class="option_subtitle">${g.str.add_to_wishlist}</div>\n                            </div>\n                        </div>\n                        <div class="queue_menu_option" id="queue_menu_option_on_waitlist">\n                            <div>\n                                <img class="queue_ignore_menu_option_image selected" src="https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_selected_bright.png">\n                                <img class="queue_ignore_menu_option_image unselected" src="https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_unselected_bright.png">\n                            </div>\n                            <div class="queue_menu_option_label">\n                                <div class="option_title">Waitlist</div>\n                                <div class="option_subtitle">${g.str.add_to_waitlist}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>`);let n="none"===document.querySelector("#add_to_wishlist_area").style.display,i=await k.action("itad.inwaitlist",this.context.storeid);const o=document.querySelector(".as_btn_wishlist_menu"),c=o.querySelector(".queue_menu_arrow"),l=document.querySelector("#queue_menu_option_on_wishlist"),d=document.querySelector("#queue_menu_option_on_waitlist");function _(){const e=Boolean(n)||Boolean(i);let a;if(c.classList.toggle("queue_btn_active",e),o.classList.toggle("on_wishlist",n),o.classList.toggle("on_waitlist",i),t.style.display=e?"none":"",s.style.display=e?"":"none",n&&!i)a=g.str.on_wishlist;else if(!n&&i)a=g.str.on_waitlist;else{if(!n||!i)return void(document.querySelector("#add_to_wishlist_area span").textContent=" "+g.str.add_to_wishlist);a=`${g.str.on_wishlist} & ${g.str.on_waitlist}`}document.querySelector("#add_to_wishlist_area_success span").lastChild.textContent=" "+a}_(),t.querySelector("a").addEventListener("click",(async()=>{await z.runInPageContext((()=>new Promise((e=>{const t=window.SteamFacade.jq(document);t.ajaxComplete((function s(a,n,{url:r}){"https://store.steampowered.com/api/addtowishlist"===r&&(e(),t.unbind("ajaxComplete",s))}))}))),null,!0),n=!n,_()})),this.context.onWishAndWaitlistRemove=()=>{n=!1,i=!1,_()},l.addEventListener("click",(async()=>{n?(await this.context.removeFromWishlist(),n=!n,_()):t.querySelector("a").click()})),d.addEventListener("click",(async()=>{i?await this.context.removeFromWaitlist():await k.action("itad.addtowaitlist",this.context.appid),i=!i,_()}))}}class oe extends C{checkPrerequisites(){return null!==document.querySelector(".finish_queue_text")}apply(){r.afterEnd(".btn_next_in_queue",`<div id="es_new_queue" class="btn_next_in_queue btn_next_in_queue_trigger" data-tooltip-text="${g.str.queue.new_tooltip}">\n                <div class="next_in_queue_content">\n                    <span class="finish_queue_text">${g.str.queue.new}</span>\n                </div>\n            </div>`),z.runInPageContext((()=>{const e=window.SteamFacade;e.vTooltip("#es_new_queue"),e.jqOnClick("#es_new_queue",(()=>{const t=e.global("g_eDiscoveryQueueType");e.jqAjax({url:`https://store.steampowered.com/explore/next/${t}/`,type:"POST",data:e.jq("#next_in_queue_form").serialize(),success:()=>{window.location.href=`https://store.steampowered.com/explore/startnew/${t}/`}})}))}))}}class ce extends C{apply(){function e(e){document.fullscreenElement?document.exitFullscreen():e.target.closest(".screenshot_popup_modal_content").requestFullscreen()}function t(){const t=document.querySelector(".screenshot_popup_modal_footer"),s=t.querySelector(".next");let a=s.offsetWidth;"none"===s.style.display&&(s.style.display="",a=s.offsetWidth,s.style.display="none"),r.beforeEnd(t,`<div class="btnv6_blue_hoverfade btn_medium es_screenshot_fullscreen_toggle" style="right: calc(${a}px + 0.5em)"><i></i></div>`);const n=t.querySelector(".es_screenshot_fullscreen_toggle");n.addEventListener("click",e);const i=t.parentElement.querySelector(".screenshot_popup_modal_title > a");r.beforeEnd(t,`<div class="btnv6_blue_hoverfade btn_medium es_screenshot_open_btn" style="right: calc(${a+n.offsetWidth}px + 1em)"><i></i></div>`),t.querySelector(".es_screenshot_open_btn").addEventListener("click",(()=>{window.open(i.href,"_blank")}))}new MutationObserver((e=>{for(const s of e)for(const e of s.addedNodes)e.classList.contains("screenshot_popup_modal")&&t()})).observe(document.body,{childList:!0})}}class le extends C{checkPrerequisites(){return h.get("show_coupon")}async apply(){const e=await L.getCoupon(this.context.appid);if(!e)return;const t=e.valid&&e.valid.replace(/\[date](.+)\[\/date]/,((e,t)=>new Date(1e3*t).toLocaleString()));r.beforeBegin("#game_area_purchase",`<div class="early_access_header es_coupon_info">\n                <div class="heading">\n                    <h1 class="inset">${g.str.coupon_available}</h1>\n                    <h2 class="inset">${g.str.coupon_application_note}</h2>\n                    <p>${g.str.coupon_learn_more}</p>\n                </div>\n                <div class="devnotes">\n                    <div style="display:flex;padding-top:10px">\n                        <img src="//steamcommunity-a.akamaihd.net/economy/image/${e.image_url}" style="width:96px;height:64px;">\n                        <div style="display:flex;flex-direction:column;margin-left:10px">\n                            <h1 style="margin-top:2px">${e.title}</h1>\n                            <div>${e.discount_note||""}</div>\n                            <div style="color:#a75124">${t}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>`);const s=document.querySelector(".game_area_purchase_game_wrapper .game_purchase_action");if(!s)return;if(s.querySelector(".game_purchase_discount")&&e.discount_doesnt_stack)return;const a=s.querySelector("[data-price-final]");if(!a)return;const n=10**R.fromType(R.storeCurrency).format.decimalPlaces,i=Number(a.dataset.priceFinal)/100,o=i-Math.floor(i*(e.discount/100)*n)/n;r.replace(a,`<div class="discount_block game_purchase_discount">\n                <div class="discount_pct">-${e.discount}%</div>\n                <div class="discount_prices">\n                    <div class="discount_original_price">${new F(i)}</div>\n                    <div class="discount_final_price">${new F(o)}</div>\n                </div>\n            </div>`)}}class de extends C{checkPrerequisites(){return this.context.isDlc()}async apply(){let e;try{if(e=await k.action("dlcinfo",{appid:this.context.appid,appname:this.context.appName}),!e||!e.length)return}catch(e){return void console.error(e)}let t=`<div class="block responsive_apppage_details_right heading">${g.str.dlc_details}</div>\n                   <div class="block es_dlc_info">\n                   <div class="block_content"><div class="block_content_inner"><div class="details_block">`;for(const s of e)t+=`<div class="game_area_details_specs">\n                        <div class="icon"><img src="${I}/gamedata/icons/${encodeURIComponent(s.icon)}"></div>\n                        <a class="name" title="${r.escape(s.desc)}">${r.escape(s.name)}</a>\n                    </div>`;t+="</div>",t+="</div></div></div>",r.beforeBegin(document.querySelector("#category_block"),t)}}class _e extends C{async checkPrerequisites(){if(h.get("showmcus")&&document.querySelector("#game_area_metascore")){const e=await this.context.data;return e&&e.data&&e.data.userscore}return!1}async apply(){const e=document.querySelector("#game_area_metascore"),t=10*(await this.context.data).data.userscore;if(!isNaN(t)){let s;s=t>=75?"high":t>=50?"medium":"low",r.afterEnd(e,`<div id="game_area_userscore">\n                    <div class="score ${s}">${t}</div>\n                    <div class="logo"></div>\n                    <div class="wordmark">\n                        <div class="metacritic">${g.str.user_score}</div>\n                    </div>\n                </div>`)}}}class ue extends C{async checkPrerequisites(){if(!h.get("showoc"))return!1;const e=await this.context.data;return!!(e&&e.oc&&e.oc.url)}async apply(){const e=(await this.context.data).oc,t=u.getURL("img/opencritic.png"),s=e.award||"NA";let a=document.querySelector("#game_area_metascore");a=a?a.parentNode:document.querySelector(".game_details"),r.afterEnd(a,`<div class="block responsive_apppage_reviewblock">\n                <div id="game_area_opencritic">\n                    <div class="score ${s.toLowerCase()}">${e.score?e.score:"--"}</div>\n                    <div class="logo"><img src="${t}"></div>\n                    <div class="wordmark">\n                        <div class="metacritic">OpenCritic</div>\n                        <div id="game_area_metalink">${s} - <a href="${e.url}?utm_source=enhanced-steam-itad&utm_medium=average" target="_blank">${g.str.read_reviews}</a>\n                            <img src="https://steamstore-a.akamaihd.net/public/images/ico/iconExternalLink.gif" border="0" align="bottom">\n                        </div>\n                    </div>\n                </div>\n                <div style="clear: both;"></div>\n            </div>`);let n="";for(const t of e.reviews){const e=new Date(t.date).toLocaleDateString();n+=`<p>"${t.snippet}"<br>${t.dScore} - <a href="${t.rUrl}" target="_blank" data-tooltip-text="${t.author}, ${e}">${t.name}</a></p>`}if(n){const t=`<div id="es_opencritic_reviews">\n                ${n}\n                <div class="chart-footer">\n                    ${g.str.read_more_reviews}\n                    <a href="${e.url}?utm_source=enhanced-steam-itad&utm_medium=reviews" target="_blank">OpenCritic.com</a>\n                </div>\n            </div>`,s=document.getElementById("game_area_reviews");s?r.beforeEnd(s,t):r.beforeBegin(document.getElementById("game_area_description").parentElement.parentElement,`<div id="game_area_reviews" class="game_area_description">\n                        <h2>${g.str.reviews}</h2>\n                        ${t}\n                    </div>`)}}}class pe extends C{checkPrerequisites(){return!this.context.isOwned()&&k.action("itad.isconnected")}async apply(){const e=await k.action("itad.getfromcollection",this.context.storeid);if(!e)return;const t=e.map((e=>`<strong>${e}</strong>`)).join(", ");r.afterEnd(".queue_overflow_ctn",`<div class="game_area_already_owned page_content" style="background-image: linear-gradient(to right, #856d0e 0%, #d1a906 100%);">\n                <div class="ds_owned_flag ds_flag" style="background-color: #856d0e;">${g.str.coll.in_collection.toUpperCase()}&nbsp;&nbsp;</div>\n                <div class="already_in_library" style="color: #ffe000;">${g.str.owned_elsewhere.replace("__gametitle__",this.context.appName).replace("__storelist__",t)}</div>\n            </div>`)}}class he extends C{checkPrerequisites(){return!(!$.isSignedIn||!h.get("purchase_dates"))&&(this._node=document.querySelector(".game_area_already_owned .already_in_library"),this._node)}async apply(){const e=this.context.appName.replace(/:/g,"").trim(),t=await $.getPurchaseDate(d.getCurrentSteamLanguage(),e);t?this._node.textContent+=" "+g.str.purchase_date.replace("__date__",t):console.warn("Failed to retrieve purchase date")}}class ge extends C{checkPrerequisites(){return this._moreLikeThis=document.querySelector("#recommended_block"),this._moreLikeThis}async apply(){r.afterEnd(this._moreLikeThis.querySelector(".block_header"),'<div class="es_tabs">\n                <div class="home_tabs_row">\n                    <div id="es_tab_steamsimilar" class="es_tab home_tab active">\n                        <div class="tab_content">Steam</div>\n                    </div>\n                    <div id="es_tab_steampeek" class="es_tab home_tab">\n                        <div class="tab_content">SteamPeek</div>\n                    </div>\n                </div>\n            </div>'),r.beforeEnd(this._moreLikeThis.querySelector(".store_horizontal_autoslider_ctn"),'<div class="block_responsive_horizontal_scroll store_horizontal_autoslider block_content nopad"\n                        id="es_steampeek_content"></div>'),await z.runInPageContext((()=>new Promise((e=>{window.SteamFacade.onDynamicStoreReady((()=>{e()}))}))),null,!0);const[e,t,s]=this._moreLikeThis.querySelectorAll("#es_tab_steamsimilar, #es_tab_steampeek, #recommended_block_content");e.addEventListener("click",(()=>{t.classList.remove("active"),e.classList.add("active"),s.classList.remove("es_sp_active"),s.classList.add("es_steam_active"),m.set("steampeek",!1),this._adjustScroller()}));let a=!1;t.addEventListener("click",(async()=>{if(t.classList.add("active"),e.classList.remove("active"),s.classList.add("es_sp_active"),s.classList.remove("es_steam_active"),m.set("steampeek",!0),!a){a=!0;for(const e of s.querySelectorAll(":scope > a"))e.classList.add("es_steam_similar");const e=await k.action("steampeek",this.context.appid);if(!e)return;const t=s.querySelector(":scope > :last-child");for(const{title:s,appid:a}of e)r.beforeBegin(t,`<a class="small_cap es_sp_similar" data-ds-appid="${a}" href="https://store.steampowered.com/app/${a}/">\n                            <img src="https://steamcdn-a.akamaihd.net/steam/apps/${a}/capsule_184x69.jpg" class="small_cap_img"></img>\n                            <h4>${s}</h4>\n                        </a>`),z.runInPageContext((e=>{window.SteamFacade.storeItemDataBindHover("#recommended_block_content > a:last-of-type",e)}),[a]);z.runInPageContext((()=>{window.SteamFacade.dynamicStoreDecorateItems("#recommended_block_content > a.es_sp_similar")})),Z.highlightAndTag(s.querySelectorAll("a.es_sp_similar"),!0),r.beforeBegin(t,`<a class="small_cap es_sp_similar" href="http://steampeek.hu/?appid=${this.context.appid}" target="_blank">\n                        <div class="es_sp_similar__link">${g.str.more_on_steampeek}</div>\n                    </a>`)}this._adjustScroller()})),m.get("steampeek",!1)&&t.click()}_adjustScroller(){z.runInPageContext((()=>{window.SteamFacade.jq("#recommended_block_content").trigger("v_contentschanged")}))}}class me extends C{constructor(e){super(e),this._levelMap={A:"gold",B:"silver",C:"limited",Incomplete:"incomplete",Unsupported:"unsupported"}}async checkPrerequisites(){if(!this.context.isDlc()&&h.get("showwsgf")){const e=await this.context.data;if(e&&e.wsgf)return this._data=e.wsgf,!0}return!1}_getType(e,t,s){let a="",n="";const r=this._levelMap[e];return r&&(a=u.getURL(`img/wsgf/${t}-${r}.png`),n=g.str.wsgf[r].replace(/__type__/g,s)),[a,n]}apply(){const{Path:e,WideScreenGrade:t,MultiMonitorGrade:s,Grade4k:a,UltraWideScreenGrade:n}=this._data,[i,o]=this._getType(t,"ws","Widescreen"),[c,l]=this._getType(s,"mm","Multi-Monitor"),[d,_]=this._getType(n,"uw","Ultra-Widescreen"),[u,p]=this._getType(a,"4k","4k UHD");r.afterEnd("div.game_details",`<div class="block responsive_apppage_details_right heading">${g.str.wsgf.certifications}</div>\n            <div class="block underlined_links es_wsgf">\n                <div class="block_content">\n                    <div class="block_content_inner">\n                        <div class="details_block">\n                            ${t?`<img src="${r.escape(i)}" title="${r.escape(o)}">`:""}\n                            ${s?`<img src="${r.escape(c)}" title="${r.escape(l)}">`:""}\n                            ${n?`<img src="${r.escape(d)}" title="${r.escape(_)}">`:""}\n                            ${a?`<img src="${r.escape(u)}" title="${r.escape(p)}">`:""}\n                        </div>\n                        <br>\n                        <a class="linkbar" target="_blank" href="${r.escape(e)}">\n                            ${g.str.rating_details}\n                            <img src="//store.steampowered.com/public/images/v5/ico_external_link.gif">\n                        </a>\n                    </div>\n                </div>\n            </div>`)}}class fe extends C{async checkPrerequisites(){if(!h.get("showhltb")||this.context.isDlc())return!1;const e=await this.context.data;return!(!e||!e.hltb||!e.hltb.success)}async apply(){const e=(await this.context.data).hltb,t="//store.steampowered.com/public/images/v5/ico_external_link.gif";let s=`<div class="block responsive_apppage_details_right heading">${g.str.hltb.title}</div>\n                    <div class="block game_details underlined_links es_hltb">\n                    <div class="block_content"><div class="block_content_inner"><div class="details_block">`;e.success?(e.main_story&&(s+=`<b>${g.str.hltb.main}:</b><span>${r.escape(e.main_story)}</span><br>`),e.main_extras&&(s+=`<b>${g.str.hltb.main_e}:</b><span>${r.escape(e.main_extras)}</span><br>`),e.comp&&(s+=`<b>${g.str.hltb.compl}:</b><span>${r.escape(e.comp)}</span><br>`),s+=`</div>\n                    <a class="linkbar" href="${r.escape(e.url)}" target="_blank">${g.str.more_information} <img src="${t}"></a>\n                    <a class="linkbar" href="${r.escape(e.submit_url)}" target="_blank">${g.str.hltb.submit} <img src="${t}"></a>`):s+=g.str.hltb.no_data+"</div>",s+="</div></div></div>",r.afterEnd("div.game_details",s)}}class ye extends C{async checkPrerequisites(){if(!h.get("exfgls"))return!1;const e=await this.context.data;return e&&e.exfgls&&e.exfgls.excluded}apply(){r.beforeBegin("#game_area_purchase",`<div id="purchase_note">\n                <div class="notice_box_top"></div>\n                    <div class="notice_box_content">${g.str.family_sharing_notice}</div>\n                <div class="notice_box_bottom"></div>\n            </div>`)}}class ve extends C{apply(){for(const e of document.querySelectorAll(".game_area_purchase_game_wrapper:not(.bundle_hidden_by_preferences)")){if(e.querySelector(".btn_packageinfo"))continue;let t=e.querySelector("h1").textContent;t=t.toLowerCase().replace(/-/g," ");let s="";e.querySelector("p")&&(s=e.querySelector("p").textContent),t.includes("2 pack")||t.includes("two pack")||t.includes("tower wars friend pack")||s.includes("gift copy")||s.includes("extra copy")?this._splitPack(e,2):t.includes("3 pack")||t.includes("three pack")||t.includes("tower wars team pack")?this._splitPack(e,3):t.includes("4 pack")||t.includes("four pack")||t.includes("clan pack")?this._splitPack(e,4):t.includes("5 pack")||t.includes("five pack")?this._splitPack(e,5):(t.includes("6 pack")||t.includes("six pack"))&&this._splitPack(e,6)}}_splitPack(e,t){const s=e.querySelector("[data-price-final]");if(!s)return;const a=10**R.fromType(R.storeCurrency).format.decimalPlaces;let n=Number(s.dataset.priceFinal)/100/t;n=Math.ceil(n*a)/a,r.afterBegin(e.querySelector(".game_purchase_action_bg"),`<div class="es_each_box">\n                <div class="es_each_price">${new F(n)}</div>\n                <div class="es_each">${g.str.each}</div>\n            </div>`)}}class we extends C{checkPrerequisites(){return h.get("show_package_info")}apply(){for(const e of document.querySelectorAll(".game_area_purchase_game_wrapper:not(.bundle_hidden_by_preferences):not(.game_purchase_sub_dropdown)")){if(e.querySelector(".btn_packageinfo"))return;const t=e.querySelector("input[name=subid]");if(!t)return;r.afterBegin(e.querySelector(".game_purchase_action"),`<div class="game_purchase_action_bg">\n                    <div class="btn_addtocart btn_packageinfo">\n                        <a class="btn_blue_steamui btn_medium" href="//store.steampowered.com/sub/${t.value}/">\n                            <span>${g.str.package_info}</span>\n                        </a>\n                    </div>\n                </div>`)}}}class be extends C{async checkPrerequisites(){if(!h.get("show_steamchart_info")||this.context.isDlc()||!document.querySelector(".sys_req"))return!1;const e=await this.context.data;return e&&e.charts&&e.charts.chart&&e.charts.chart.peakall&&(this._chart=e.charts.chart),void 0!==this._chart}apply(){r.beforeBegin(document.querySelector(".sys_req").parentNode,`<div id="steam-charts" class="game_area_description">\n                <h2>${g.str.charts.current}</h2>\n                <div class="chart-content">\n                    <div class="chart-stat"><span class="num">${r.escape(this._chart.current)}</span><br>${g.str.charts.playing_now}</div>\n                    <div class="chart-stat"><span class="num">${r.escape(this._chart.peaktoday)}</span><br>${g.str.charts.peaktoday}</div>\n                    <div class="chart-stat"><span class="num">${r.escape(this._chart.peakall)}</span><br>${g.str.charts.peakall}</div>\n                </div>\n                <span class="chart-footer">${g.str.powered_by.replace("__link__",`<a href="https://steamcharts.com/app/${this.context.appid}" target="_blank">SteamCharts.com</a>`)}</span>\n            </div>`)}}class Se extends C{async checkPrerequisites(){if(!h.get("show_steamspy_info")||this.context.isDlc()||!document.querySelector(".sys_req"))return!1;const e=await this.context.data;return e&&e.steamspy&&e.steamspy.owners&&(this._data=e.steamspy),void 0!==this._data}apply(){const e=this._data.owners.split(".."),t=r.escape(e[0].trim()),s=r.escape(e[1].trim()),a=this._getTimeString(this._data.average_forever),n=this._getTimeString(this._data.average_2weeks);r.beforeBegin(document.querySelector(".sys_req").parentNode,`<div id="steam-spy" class="game_area_description">\n                <h2>${g.str.spy.player_data}</h2>\n                <div class="chart-content">\n                    <div class="chart-stat"><span class="num">${t}<br>-<br>${s}</span><br>${g.str.spy.owners}</div>\n                    <div class="chart-stat"><span class="num">${a}</span><br>${g.str.spy.average_playtime}</div>\n                    <div class="chart-stat"><span class="num">${n}</span><br>${g.str.spy.average_playtime_2weeks}</div>\n                </div>\n                <span class="chart-footer">${g.str.powered_by.replace("__link__",`<a href="https://steamspy.com/app/${this.context.appid}" target="_blank">steamspy.com</a>`)}</span>\n            </div>`)}_getTimeString(e){const t=Math.trunc(e/1440);let s=e;s-=1440*t;const a=Math.trunc(s/60);s-=60*a;let n="";return t>0&&(n+=t+"d "),n+=`${a}h ${s}m`,n}}class ke extends C{async checkPrerequisites(){if(this.context.isVideo()||this.context.isDlc()||!document.querySelector(".sys_req"))return!1;const e=await this.context.data;return e&&e.survey&&(this._survey=e.survey),void 0!==this._survey}apply(){const e=this._survey;let t=`<div id="performance_survey" class="game_area_description"><h2>${g.str.survey.performance_survey}</h2>`;if(e.success){switch(t+=`<p>${g.str.survey.users.replace("__users__",e.responses)}</p>`,t+=`<p><b>${g.str.survey.framerate}</b>: ${Math.round(e.frp)}% ${g.str.survey.framerate_response}`,e.fr){case"30":t+=` <span style="color: #8f0e10;">${g.str.survey.framerate_30}</span>`;break;case"fi":t+=` <span style="color: #e1c48a;">${g.str.survey.framerate_fi}</span>`;break;case"va":t+=` <span style="color: #8BC53F;">${g.str.survey.framerate_va}</span>`}switch(t+=`<br><b>${g.str.survey.resolution}</b>: ${g.str.survey.resolution_support}`,e.mr){case"less":t+=` <span style="color: #8f0e10;">${g.str.survey.resolution_less.replace("__pixels__","1920x1080")}</span>`;break;case"hd":t+=` <span style="color: #8BC53F;">${g.str.survey.resolution_up.replace("__pixels__","1920x1080 (HD)")}</span>`;break;case"wqhd":t+=` <span style="color: #8BC53F;">${g.str.survey.resolution_up.replace("__pixels__","2560x1440 (WQHD)")}</span>`;break;case"4k":t+=` <span style="color: #8BC53F;">${g.str.survey.resolution_up.replace("__pixels__","3840x2160 (4K)")}</span>`}t+=`<br><b>${g.str.survey.graphics_settings}</b>:`,e.gs?t+=` <span style="color: #8BC53F;">${g.str.survey.gs_y}</span></p>`:t+=` <span style="color: #8f0e10;">${g.str.survey.gs_n}</span></p>`,["nvidia","amd","intel","other"].some((t=>t in e))&&(t+=`<p><b>${g.str.survey.satisfaction}</b>:</p><div class="performance-graph">`,"nvidia"in e&&(t+=this._getBarHtml("Nvidia",e.nvidia)),"amd"in e&&(t+=this._getBarHtml("AMD",e.amd)),"intel"in e&&(t+=this._getBarHtml("Intel",e.intel)),"other"in e&&(t+=this._getBarHtml("Other",e.other)),t+="</div>")}else t+=`<p>${g.str.survey.nobody}</p>`;t+="</div>",r.beforeBegin(document.querySelector(".sys_req").parentNode,t)}_getBarHtml(e,t){return t>90||t<10?`<div class="row"><div class="left-bar ${e.toLowerCase()}" style="width: ${parseInt(t)}%;"><span>${e}&nbsp;${t}%</span></div><div class="right-bar" style="width: ${parseInt(100-t)}%;"></div></div>`:`<div class="row"><div class="left-bar ${e.toLowerCase()}" style="width: ${parseInt(t)}%;"><span>${e}</span></div><div class="right-bar" style="width: ${parseInt(100-t)}%;"><span>${t}%</span></div></div>`}}class qe extends C{apply(){r.afterBegin("#cart_status_data",`<div class="store_header_btn_gray store_header_btn" id="es_customize_btn">\n                <div class="es_customize_title">${g.str.customize}<img src="//steamstore-a.akamaihd.net/public/images/v6/btn_arrow_down_padded_white.png"></div>\n                <div class="home_viewsettings_popup">\n                    <div class="home_viewsettings_instructions">${g.str.apppage_sections}</div>\n                </div>\n            </div>`);const e=document.getElementById("es_customize_btn");e.addEventListener("click",(()=>{e.classList.toggle("active")})),e.querySelector(".home_viewsettings_popup").addEventListener("click",(e=>{e.stopPropagation()})),e.addEventListener("mouseleave",(()=>{e.classList.remove("active")})),this.context.type===x.APP?this._customizeAppPage():this.context.type===x.STORE_FRONT&&(M.onMessage("renderComplete").then((()=>{this._customizeFrontPage()})),z.runInPageContext((()=>{GHomepage.bInitialRenderComplete?window.Messenger.postMessage("renderComplete"):GHomepage=new Proxy(GHomepage,{set:(e,t,s,...a)=>("bInitialRenderComplete"===t&&!0===s&&window.Messenger.postMessage("renderComplete"),Reflect.set(e,t,s,...a))})})))}_customizeAppPage(){function e(e){const t=document.querySelector(e);return t&&t.closest(".game_page_autocollapse_ctn")}const t=new qe.Customizer("customize_apppage");t.add("franchisenotice",".franchise_notice",g.str.apppage_franchise).add("eaheader",".early_access_header:not(.es_coupon_info)",g.str.apppage_eaheader).add("eabanner",".early_access_banner",g.str.apppage_eabanner).add("recentupdates","[data-featuretarget=events-row]",g.str.apppage_recentupdates).add("reviews","#game_area_reviews").add("about",e("#game_area_description")).add("contentwarning",e("#game_area_content_descriptors")).add("steamchart","#steam-charts").add("surveys","#performance_survey").add("steamspy","#steam-spy").add("sysreq",e(".sys_req")).add("legal",e("#game_area_legal"),g.str.apppage_legal).add("moredlcfrombasegame","#moredlcfrombasegame_block").add("franchise","#franchise_block",g.str.apppage_morefromfranchise).add("morelikethis","#recommended_block").add("recommendedbycurators",".steam_curators_block").add("customerreviews","#app_reviews_hash").add("workshop",e("[href^='https://steamcommunity.com/workshop/browse']"),g.str.apppage_workshop).add("greenlight",e("[href^='https://steamcommunity.com/greenlight']"),g.str.apppage_greenlight),t.build()}_customizeFrontPage(){function e(e){const t=document.querySelector(e);return t&&t.closest(".home_ctn")}const t=new qe.Customizer("customize_frontpage");t.add("featuredrecommended",".home_cluster_ctn").add("trendingamongfriends",".friends_recently_purchased","",!0).add("discoveryqueue",".discovery_queue_ctn").add("curators",".steam_curators_ctn",g.str.homepage_curators).add("morecuratorrecommendations",".apps_recommended_by_curators_ctn",g.str.homepage_curators).add("fromdevelopersandpublishersthatyouknow",".recommended_creators_ctn").add("popularvrgames",".best_selling_vr_ctn").add("homepagetabs",".tab_container",g.str.homepage_tabs).add("gamesstreamingnow",".live_streams_ctn","",!0).add("updatesandoffers",".marketingmessage_area","",!0).add("topnewreleases",".top_new_releases",g.str.homepage_topnewreleases).add("homepagesidebar","body:not(.no_home_gutter) .home_page_gutter",g.str.homepage_sidebar).add("specialoffers",e(".special_offers")).add("browsesteam",e(".big_buttons.home_page_content")).add("recentlyupdated",e(".recently_updated_block")).add("under",e("[class*='specials_under']"));for(const e of document.querySelectorAll(".home_page_body_ctn .home_ctn:not(.esi-customizer), .home_pagecontent_ctn"))e.closest(".esi-customizer")||e.querySelector(".esi-customizer")||"none"===e.style.display||t.addDynamic(e);t.build()}}qe.Customizer=class{constructor(e){this.settingsName=e,this.settings=h.get(e)}_textValue(e){const t=e.querySelector("h1, h2, .home_title, .home_section_title");if(!t)return"";let s="";for(const e of t.childNodes)e.nodeType===Node.TEXT_NODE&&(s+=e.textContent.trim());return s}_updateState(e,t){this.settings[e]=t,h.set(this.settingsName,this.settings)}_getState(e){const t=this.settings[e];return void 0===t||t}add(e,t,s,a=!1){let n,r=s;if("string"==typeof t)n=document.querySelectorAll(t);else if(t instanceof Element)n=[t];else{if(!(t instanceof NodeList))return this;n=t}if(!n.length)return this;const i=this._getState(e);for(const t of n)("none"!==getComputedStyle(t).display||a)&&("string"==typeof r&&""!==r||(r=this._textValue(t).toLowerCase(),""!==r))&&(t.classList.toggle("esi-shown",i),t.classList.toggle("esi-hidden",!i),t.classList.add("esi-customizer"),t.dataset.esName=e,t.dataset.esText=r);return this}addDynamic(e){const t=this._textValue(e).toLowerCase();""!==t&&this.add("dynamic_"+t,e,t)}build(){const e=new Map;for(const t of document.querySelectorAll(".esi-customizer")){const s=t.dataset.esName;if(e.has(s))e.get(s).push(t);else{const a=t.classList.contains("esi-shown"),n=t.dataset.esText;r.beforeEnd("#es_customize_btn .home_viewsettings_popup",`<div class="home_viewsettings_checkboxrow ellipsis" id="${s}">\n                        <div class="home_viewsettings_checkbox ${a?"checked":""}"></div>\n                        <div class="home_viewsettings_label">${n}</div>\n                    </div>`),e.set(s,[t])}}for(const[t,s]of e){const e=document.getElementById(t);e.addEventListener("click",(a=>{const n=!e.querySelector(".checked");for(const e of s)e.classList.toggle("esi-shown",n),e.classList.toggle("esi-hidden",!n);a.target.closest(".home_viewsettings_checkboxrow").querySelector(".home_viewsettings_checkbox").classList.toggle("checked",n),this._updateState(t,n)}))}}};class $e extends C{checkPrerequisites(){return null!==document.querySelector(".game_area_dlc_section .game_area_dlc_list input[name^=subid]")}apply(){const e=document.querySelector(".game_area_dlc_section");for(const t of e.querySelectorAll(".game_area_dlc_row")){const e=t.querySelector("input[name^=subid]");if(!e)continue;const s=document.createElement("label");s.classList.add("es_dlc_label"),t.classList.contains("ds_wishlist")?s.classList.add("es_dlc_wishlist"):t.classList.contains("ds_owned")&&s.classList.add("es_dlc_owned");const a=document.createElement("input");a.type="checkbox",a.dataset.esDlcSubid=e.value;const n=t.querySelector(".discount_final_price")||t.querySelector(".game_area_dlc_price"),r=F.parseFromString(n.textContent);null!==r&&(a.dataset.esDlcPrice=r.value),s.append(a),t.insertAdjacentElement("beforebegin",s)}new MutationObserver((e=>{for(const{target:t}of e)t.classList.contains("game_area_dlc_row")&&t.previousElementSibling.classList.toggle("es_dlc_wishlist",t.classList.contains("ds_wishlist"))})).observe(e.querySelector(".gameDlcBlocks"),{subtree:!0,attributeFilter:["class"]});const t=`<div class="game_purchase_action game_purchase_action_bg" id="es_selected_btn">\n                <div class="game_purchase_price price"></div>\n                <div class="btn_addtocart">\n                    <a class="btn_green_steamui btn_medium">\n                        <span>${g.str.add_selected_dlc_to_cart}</span>\n                    </a>\n                </div>\n            </div>`,s=e.querySelector("#game_area_dlc_expanded");s?(r.afterEnd(s,t),r.afterEnd(e,'<div style="clear: both;"></div>')):r.afterEnd(e.querySelector(".gameDlcBlocks"),t);const a=document.createElement("form");a.name="add_selected_dlc_to_cart",a.action="/cart/",a.method="POST";const n=e.querySelector("#es_selected_btn");function i(e,t){const s=document.createElement("input");return s.type="hidden",s.name=e,s.value=t,s}n.insertAdjacentElement("beforebegin",a),n.addEventListener("click",(()=>{a.submit()})),r.afterEnd(e.querySelector(".gradientbg"),`<div id="es_dlc_option_panel">\n                <div class="es_dlc_option" id="unowned_dlc_check">${g.str.dlc_select.unowned_dlc}</div>\n                <div class="es_dlc_option" id="wl_dlc_check">${g.str.dlc_select.wishlisted_dlc}</div>\n                <div class="es_dlc_option" id="no_dlc_check">${g.str.dlc_select.none}</div>\n            </div>`),e.querySelector("#unowned_dlc_check").addEventListener("click",(()=>{const t=e.querySelectorAll(".es_dlc_label:not(.es_dlc_owned) > input");for(const e of t)e.checked=!0;e.dispatchEvent(new Event("change"))})),e.querySelector("#wl_dlc_check").addEventListener("click",(()=>{const t=e.querySelectorAll(".es_dlc_label.es_dlc_wishlist > input");for(const e of t)e.checked=!0;e.dispatchEvent(new Event("change"))})),e.querySelector("#no_dlc_check").addEventListener("click",(()=>{const t=e.querySelectorAll(".es_dlc_label > input:checked");for(const e of t)e.checked=!1;e.dispatchEvent(new Event("change"))}));const o=i("action","add_to_cart"),c=i("sessionid",$.sessionId);e.addEventListener("change",(()=>{a.innerHTML="",a.append(o,c);let t=0;for(const s of e.querySelectorAll(".es_dlc_label > input:checked"))a.append(i("subid[]",s.dataset.esDlcSubid)),s.dataset.esDlcPrice&&(t+=Number(s.dataset.esDlcPrice));t>0?(n.querySelector(".game_purchase_price").textContent=new F(t),n.style.display="block"):n.style.display="none"}))}}class xe extends C{checkPrerequisites(){return this.context.hasCards&&$.isSignedIn&&h.get("show_badge_progress")}async apply(){A.insertStylesheet("//steamcommunity-a.akamaihd.net/public/css/skin_1/badges.css"),r.afterEnd("#category_block",`<div id="es_badge_progress" class="block responsive_apppage_details_right heading">\n                ${g.str.badge_progress}\n            </div>\n            <div id="es_badge_progress_content" class="block responsive_apppage_details_right">\n                <div class="block_content_inner es_badges_progress_block" style="display:none;">\n                    <div class="es_normal_badge_progress es_progress_block" style="display:none;"></div>\n                    <div class="es_foil_badge_progress es_progress_block" style="display:none;"></div>\n                </div>\n            </div>`);const e=this.context.communityAppid;try{await Promise.all([k.action("cards",e).then((e=>{this._loadBadgeContent(".es_normal_badge_progress",e)})),k.action("cards",e,!0).then((e=>{this._loadBadgeContent(".es_foil_badge_progress",e)}))])}catch(e){throw document.getElementById("es_badge_progress").remove(),document.getElementById("es_badge_progress_content").remove(),e}}_loadBadgeContent(e,t){const s=i.htmlToDOM(t).querySelector(".badge_gamecard_page");s?this._displayBadgeInfo(e,s):(document.getElementById("es_badge_progress").remove(),document.getElementById("es_badge_progress_content").remove())}_displayBadgeInfo(e,t){const s=document.querySelector(e),a=t.querySelector(".badge_current");s.append(a);const n=t.querySelectorAll(".badge_detail_tasks .owned").length,i=t.querySelectorAll(".badge_detail_tasks .badge_card_set_card").length,o=t.querySelector(".gamecard_badge_progress"),c=o?o.textContent.trim().length:0,l=t.querySelectorAll(".gamecard_badge_progress .badge_info").length,d=c>0&&0===l,_=n>0&&!d,u=".es_normal_badge_progress"===e;if(u||n>0||!s.querySelector(".badge_empty_circle")){s.parentNode.style.display="block",s.style.display="block";const e=t.querySelector(".progress_info_bold");r.beforeEnd(s,`<div class="es_cards_numbers">\n                    <div class="es_cards_remaining">${e?e.textContent:""}</div>\n                </div>\n                <div class="game_area_details_specs">\n                    <div class="icon"><img src="//store.steampowered.com/public/images/v6/ico/ico_cards.png" class="category_icon"></div>\n                    <a href="//steamcommunity.com/my/gamecards/${this.context.communityAppid}${u?"/":"?border=1"}" class="name">${d?g.str.view_badge:g.str.view_badge_progress}</a>\n                </div>`),_&&r.beforeEnd(s.querySelector(".es_cards_numbers"),`<div class="es_cards_owned">${g.str.cards_owned.replace("__owned__",n).replace("__possible__",i)}</div>`);const a=s.querySelector(".badge_empty_right div:last-child");a&&(a.classList.add("badge_empty_name"),a.style="",a.textContent=g.str.badge_not_unlocked)}}}class Ee extends C{checkPrerequisites(){return h.get("showastatslink")&&this.context.hasAchievements()}apply(){const e=u.getURL("img/ico/astatsnl.png"),t="https://astats.astats.nl/astats/Steam_Game_Info.php?AppID="+this.context.communityAppid;r.beforeEnd("#achievement_block",`<div class="game_area_details_specs">\n                <div class="icon"><img class="astats_icon" src="${e}"></div>\n                <a class="name" href="${t}" target="_blank">${g.str.view_astats}</a>\n            </div>`)}}class Le extends C{checkPrerequisites(){return h.get("showachinstore")&&this.context.hasAchievements()&&document.getElementById("my_activity")}async apply(){const e=await class{static async getAchievementBar(e,t){const s=await k.action("stats",e,t),a=i.htmlToDOM(s).querySelector("#topSummaryAchievements");if(!a)return null;if(a.style.whiteSpace="nowrap",!a.querySelector("img"))return a.innerHTML;const n=a.innerHTML.match(/(\d+) of (\d+) \((\d{1,3})%\)/);return n&&4===n.length?`<div>${g.str.achievements.summary.replace("__unlocked__",n[1]).replace("__total__",n[2]).replace("__percentage__",n[3])}</div>\n                <div class="achieveBar">\n                    <div style="width: ${n[3]}%;" class="achieveBarProgress"></div>\n                </div>`:null}static async getAchievementBarForGamelist(e,t){const s=await k.action("stats",e,t),a=i.htmlToDOM(s).querySelector("#topSummaryAchievements");if(!a)return null;a.style.whiteSpace="nowrap";const n=a.innerText.match(/(\d+)\D+(\d+)\D+(\d{1,3})%/);if(!n||4!==n.length)return null;const r=g.str.achievements.summary.replace("__unlocked__",n[1]).replace("__total__",n[2]).replace("__percentage__",n[3]),o=n[1]/n[2]*185||0;return`<div class="recentAchievements">\n            ${r}\n            <br>\n            <img src="https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarLeft.gif" width="2" height="12" border="0">\n            <img src="https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarFull.gif" width="${o}" height="12" border="0">\n            <img src="https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarEmpty.gif" width="${185-o}" height="12" border="0">\n            <img src="https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarRight.gif" width="2" height="12" border="0">\n            <br>\n        </div>`.replace(/>\s+</g,"><")}}.getAchievementBar("/my",this.context.communityAppid);e?r.afterBegin("#my_activity",`<div class="es-achieveBar-store">${e}</div>`):console.warn("Failed to retrieve achievement stats")}}class Ce extends C{checkPrerequisites(){const e=h.get("regional_countries");return e&&e.length>0&&"off"!==h.get("showregionalprice")}async apply(){let e="unknown";const t=h.get("showregionalprice"),s=h.get("regional_countries"),a=$.storeCountry.toLowerCase();s.includes(a)||s.push(a),this.context.type===x.APP?e="app":this.context.type===x.SALE&&(e="sale");for(const a of this.context.getAllSubids()){const n={};await Promise.all(s.map((async e=>{const t=await q.getJson(`https://store.steampowered.com/api/packagedetails/?packageids=${a}&cc=${e}`);t&&t[a]&&t[a].success&&t[a].data.price&&(n[e]=t[a].data.price)})));const i=document.querySelector(`input[name=subid][value="${a}"]`).closest(".game_area_purchase_game_wrapper,#game_area_purchase,.sale_page_purchase_item").querySelector(".game_purchase_action"),o=n[$.storeCountry.toLowerCase()];if(void 0===o)continue;let c;try{c=new F(o.final/100,o.currency).inCurrency(R.customCurrency)}catch(e){console.group("Regional pricing"),console.error(e),console.warn("Can't show relative price differences to any other currencies"),console.groupEnd()}const l=document.createElement("div");l.classList.add("es_regional_container"),l.classList.add("es_regional_"+e),"mouse"===t&&r.afterBegin(l,'<div class="es_regional_arrow"></div>');for(const e of s){const t=n[e];let s="";if(t){const a=new F(t.final/100,t.currency);let n;try{n=a.inCurrency(R.customCurrency)}catch(t){console.group("Regional pricing"),console.error(t),console.warn('Not able to show converted price and relative price differences for country code "%s"',e.toUpperCase()),console.groupEnd()}if(s=`<div class="es-regprice es-flag es-flag--${e}">${a}`,c&&n){let e="equal",t=(n.value/c.value*100-100).toFixed(2);t<0?(t=Math.abs(t),e="lower"):t>0&&(e="higher"),s+=`<span class="es-regprice__converted">${n}</span>\n                                <span class="es-regprice__perc es-regprice__perc--${e}">${t}%</span>`}s+="</div>"}else s=` <div class="es-regprice es-flag es-flag--${e}">\n                                <span class="es-regprice__none">${g.str.region_unavailable}</span>\n                            </div>`;r.beforeEnd(l,s)}const d=i.closest(".game_area_purchase_game,.sale_page_purchase_item");if(d.classList.add("es_regional_prices"),"always"===t)i.insertAdjacentElement("beforebegin",l),d.classList.add("es_regional_always");else{const e=i.querySelector(".price,.discount_prices");e.insertAdjacentElement("beforeend",l),e.classList.add("es_regional_onmouse"),h.get("regional_hideworld")||e.classList.add("es_regional_icon")}}}}class Ae extends C{checkPrerequisites(){return null!==document.getElementById("review_create")}apply(){const e=document.querySelector("#review_create h1"),t=document.createElement("div");t.classList.add("es_review_section"),t.append(...document.getElementById("review_create").querySelectorAll("p, .avatar_block, .content")),e.insertAdjacentElement("afterend",t),r.beforeEnd(e,`<div class="btnv6_lightblue_blue btn_medium" id="es_review_toggle">\n                <div data-tooltip-text="${g.str.expand_slider}" class="es_review_expand">▼</div>\n                <div data-tooltip-text="${g.str.contract_slider}" class="es_review_contract">▲</div>\n            </div>`),document.querySelector("#es_review_toggle").addEventListener("click",(()=>{this._toggleReviews()})),this._toggleReviews(m.get("show_review_section",!0))}_toggleReviews(e){let t=e;void 0===t&&(t=!m.get("show_review_section",!0),m.set("show_review_section",t)),document.getElementById("review_create").classList.toggle("es_contracted",!t)}}class Pe extends C{checkPrerequisites(){return $.isSignedIn&&document.querySelector(".game_area_play_stats .already_owned_actions")}apply(){const e=document.querySelector(".game_area_play_stats .already_owned_actions"),t=this.context.appid,s=e.querySelector("a[href^='https://store.steampowered.com/about/']"),a=h.get("installsteam");"hide"===a?s.remove():"replace"===a&&(s.querySelector("span").textContent=g.str.viewinclient,s.href="steam://store/"+t),h.get("showviewinlibrary")&&r.afterBegin(e,`<div class="game_area_already_owned_btn">\n                    <a class="btnv6_lightblue_blue btnv6_border_2px btn_medium" href="steam://nav/games/details/${t}">\n                        <span>${g.str.view_in_library}</span>\n                    </a>\n                </div>`),r.afterEnd(e,`<div class="game_area_already_owned_btn">\n                <a class="btnv6_lightblue_blue btnv6_border_2px btn_medium" href="//help.steampowered.com/wizard/HelpWithGame/?appid=${t}">\n                    <span>${g.str.get_help}</span>\n                </a>\n            </div>`)}}class Ie extends C{async checkPrerequisites(){if(this.context.isDlc()||!h.get("showsupportinfo"))return!1;let e=m.get("support_info",null);(!e||!e.expiry||e.expiry<Date.now())&&(e={data:{},expiry:Date.now()+26784e5});const t=this.context.appid;if(this._supportInfo=e.data[t],!this._supportInfo){const s=await k.action("appdetails",t,"support_info");if(!s||!s.success)return console.warn("Failed to retrieve support info"),!1;this._supportInfo=s.data.support_info,e.data[t]=this._supportInfo,m.set("support_info",e)}return this._supportInfo.url||this._supportInfo.email}apply(){const e=this._supportInfo.url,t=this._supportInfo.email;let s="";e&&(s+=`<a href="${e}">${g.str.website}</a>`),t&&(e&&(s+=", "),/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)?s+=`<a href="mailto:${t}">${g.str.email}</a>`:s+=`<a href="${t}">${g.str.contact}</a>`),r.beforeEnd(".glance_ctn .user_reviews",`<div class="release_date">\n                <div class="subtitle column">${g.str.support}:</div>\n                <div class="summary column" id="es_support_list">${s}</div>\n            </div>`)}}class Te extends C{checkPrerequisites(){return h.get("removebroadcasts")&&null!==document.querySelector("[data-featuretarget=broadcast-embed]")}apply(){document.querySelector("[data-featuretarget=broadcast-embed]").remove(),z.runInPageContext((()=>{const e=window.uiBroadcastWatchStore;e&&e.m_activeVideo&&e.StopVideo(e.m_activeVideo)}))}}(new class extends z{}).run(class extends class extends class extends class{constructor(e,t){this._callbacks=[],this.type=e,this.features=t.map((e=>new e(this)))}applyFeatures(){return class{static async apply(e){for(this._promisesMap=new Map,this._stats={completed:0,failed:0,dependency:0};e.length>0;){const t=e.pop(),s=this._generateFeatureChain(t);null===s?e.unshift(t):this._promisesMap.set(t.constructor,s)}await Promise.allSettled(Array.from(this._promisesMap.values())),console.log("Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors",this._stats.completed,this._stats.failed,this._stats.dependency)}static _generateFeatureChain(e){let t=!0,s=Promise.resolve(!0);if(Array.isArray(e.constructor.dependencies)){for(const s of e.constructor.dependencies)if(!this._promisesMap.has(s)){t=!1;break}t&&(s=Promise.all(Array.from(this._promisesMap.entries()).filter((([t])=>e.constructor.dependencies.includes(t))).map((([,e])=>e))))}return t?s.then((t=>{let s=!0;return e.constructor.weakDependency||(s=Array.isArray(t)?t.every((e=>e)):t),s&&e.checkPrerequisites()})).then((async t=>(t&&(await e.apply(),++this._stats.completed),t))).catch((t=>{const s=e.constructor.name;if(t instanceof n.FeatureDependencyError)throw console.warn("Not applying feature %s due to an error in the dependency chain (namely %s)",s,t.featureName),++this._stats.dependency,t;throw console.group(s),console.error("Error while applying feature %s",s),console.error(t),console.groupEnd(),++this._stats.failed,new n.FeatureDependencyError("Failed to apply",s)})):null}}.apply(this.features)}registerCallback(e){this._callbacks.push(e)}triggerCallbacks(...e){for(const t of this._callbacks)t(...e)}}{constructor(e=x.STORE_DEFAULT,t=[]){t.push(Z,ee,X),super(e,t),this._observeChanges()}_observeChanges(){const e=document.querySelectorAll(".tag_browse_ctn, .tabarea, .browse_ctn_background");if(!e)return;const t=new MutationObserver((()=>{Z.highlightAndTag(),B.showEarlyAccess()}));e.forEach((e=>t.observe(e,{childList:!0,subtree:!0})))}}{getAllSubids(){const e=[];for(const t of document.querySelectorAll("input[name=subid]"))t.value&&e.push(t.value);return e}}{constructor(){if(document.getElementById("error_box"))return void super(x.APP);super(x.APP,[te,se,ae,ne,re,ie,oe,ce,le,W,de,G,_e,ue,pe,he,ge,me,fe,V,ye,ve,we,be,Se,ke,qe,$e,xe,Ee,Le,Ce,Ae,Pe,Ie,U,Te]),this.userNotes=new Q,this.appid=w.getAppid(window.location.host+window.location.pathname),this.storeid="app/"+this.appid,this.hasCards=null!==document.querySelector('#category_block img[src$="/ico_cards.png"]'),this.onWishAndWaitlistRemove=null;const e=document.querySelector(".apphub_AppIcon img").getAttribute("src");this.communityAppid=w.getAppidImgSrc(e),this.communityAppid||(this.communityAppid=this.appid);const t=document.querySelector("#game_area_metalink a");this.metalink=t&&t.getAttribute("href"),this.data=this.storePageDataPromise().catch((e=>{console.error(e)})),this.appName=document.querySelector(".apphub_AppName").textContent,qe.dependencies=[Se,be,ke],qe.weakDependency=!0}storePageDataPromise(){return k.action("storepagedata",this.appid,this.metalink,h.get("showoc"))}isOwned(){return null!==document.querySelector(".game_area_already_owned")}isDlc(){return null!==document.querySelector("div.game_area_dlc_bubble")}isVideo(){return null!==document.querySelector('.game_area_purchase_game span[class*="streaming"], div.series_seasons')}hasAchievements(){return null!==document.querySelector(".communitylink_achievement_images")}removeFromWishlist(){return k.action("wishlist.remove",this.appid,$.sessionId)}removeFromWaitlist(){return k.action("itad.removefromwaitlist",this.appid)}toggleVideoDefinition(e,t){let s=!1;const a=e.parentNode.offsetHeight>0&&e.parentNode.offsetWidth>0,n=e.classList.contains("es_loaded_src"),r=m.get("playback_hd")||e.classList.contains("es_video_hd"),i=e.currentTime||0,o=e.paused;return a&&(e.preload="metadata",e.addEventListener("loadedmetadata",(function t(){this.currentTime=i,!o&&e.play&&Promise.resolve(e.play()).catch((()=>{})),e.removeEventListener("loadedmetadata",t,!1)}),!1)),!r&&void 0===t||!0===t?(s=!0,e.src=e.dataset.hdSrc):n&&(e.src=e.dataset.sdSrc),a&&n&&e.load(),e.classList.add("es_loaded_src"),e.classList.toggle("es_video_sd",!s),e.classList.toggle("es_video_hd",s),e.parentNode.classList.toggle("es_playback_sd",!s),e.parentNode.classList.toggle("es_playback_hd",s),s}})})();
//# sourceMappingURL=app.js.map