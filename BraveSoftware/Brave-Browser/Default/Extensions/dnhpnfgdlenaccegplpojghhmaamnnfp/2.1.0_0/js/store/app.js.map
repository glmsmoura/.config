{"version":3,"sources":["webpack:///./src/js/Core/Errors/Errors.js","webpack:///./src/js/Core/Html/Html.js","webpack:///./src/js/Core/Html/HtmlParser.js","webpack:///./src/js/Core/Storage/CookieStorage.js","webpack:///./src/js/Core/Environment.js","webpack:///./src/js/Core/Localization/Language.js","webpack:///./src/js/Core/BackgroundSimple.js","webpack:///./src/js/Core/ExtensionResources.js","webpack:///./src/js/Core/Info.js","webpack:///./src/js/Core/Storage/SyncedStorage.js","webpack:///./src/js/Core/Localization/Localization.js","webpack:///./src/js/Core/Storage/LocalStorage.js","webpack:///./src/js/Core/Utils/TimeUtils.js","webpack:///./src/js/Core/GameId.js","webpack:///./src/js/Core/Permissions.js","webpack:///./src/js/Core/Version.js","webpack:///./src/js/Content/Modules/Widgets/ProgressBar.js","webpack:///./src/js/Content/Modules/Background.js","webpack:///./src/js/Core/Errors/ErrorParser.js","webpack:///./src/js/Content/Modules/RequestData.js","webpack:///./src/js/Content/Modules/User.js","webpack:///./src/js/Content/Modules/Feature/FeatureManager.js","webpack:///./src/js/Content/Modules/Context/ContextType.js","webpack:///./src/js/Content/Modules/Data/DynamicStore.js","webpack:///./src/js/Content/Modules/Data/Inventory.js","webpack:///./src/js/Content/Modules/Feature/Feature.js","webpack:///./src/js/Content/Modules/DOMHelper.js","webpack:///./src/js/Content/Modules/Widgets/HorizontalScroller.js","webpack:///./src/js/config.js","webpack:///./src/js/Content/Modules/AugmentedSteam.js","webpack:///./src/js/Core/Utils/StringUtils.js","webpack:///./src/js/Content/Modules/CurrencyManager.js","webpack:///./src/js/Content/Modules/EarlyAccess.js","webpack:///./src/js/Content/Modules/ITAD.js","webpack:///./src/js/Content/Modules/Messenger.js","webpack:///./src/js/Content/Modules/Price.js","webpack:///./src/js/Content/Modules/Prices.js","webpack:///./src/js/setup.js","webpack:///./src/js/Content/Features/Page.js","webpack:///./src/js/Content/Modules/SteamFacade.js","webpack:///./src/js/Content/Modules/UpdateHandler.js","webpack:///./src/js/Content/Modules/Widgets/SortBox.js","webpack:///./src/js/Content/Features/Common/FMediaExpander.js","webpack:///./src/js/Content/Features/Store/Common/FITADPrices.js","webpack:///./src/js/Content/Features/Store/Common/FDRMWarnings.js","webpack:///./src/js/Content/Features/Store/Common/FExtraLinks.js","webpack:///./src/js/Core/Storage/UserNotesAdapter.js","webpack:///./src/js/Content/Features/Store/Common/UserNotes.js","webpack:///./src/js/Content/Features/Common/FHighlightsTags.js","webpack:///./src/js/Content/Features/Common/FHideTrademarks.js","webpack:///./src/js/Content/Features/Store/Common/FAlternativeLinuxIcon.js","webpack:///./src/js/Content/Features/Store/App/FReplaceDevPubLinks.js","webpack:///./src/js/Content/Features/Store/App/FRemoveFromWishlist.js","webpack:///./src/js/Content/Features/Store/App/FForceMP4.js","webpack:///./src/js/Content/Features/Store/App/FHDPlayer.js","webpack:///./src/js/Content/Features/Store/App/FUserNotes.js","webpack:///./src/js/Content/Features/Store/App/FWaitlistDropdown.js","webpack:///./src/js/Content/Features/Store/App/FNewQueue.js","webpack:///./src/js/Content/Features/Store/App/FFullscreenScreenshotView.js","webpack:///./src/js/Content/Features/Store/App/FShowCoupon.js","webpack:///./src/js/Content/Features/Store/App/FDLCInfo.js","webpack:///./src/js/Content/Features/Store/App/FMetacriticUserScore.js","webpack:///./src/js/Content/Features/Store/App/FOpenCritic.js","webpack:///./src/js/Content/Features/Store/App/FOwnedElsewhere.js","webpack:///./src/js/Content/Features/Store/App/FPurchaseDate.js","webpack:///./src/js/Content/Features/Store/App/FSteamPeek.js","webpack:///./src/js/Content/Features/Store/App/FWidescreenCertification.js","webpack:///./src/js/Content/Features/Store/App/FHowLongToBeat.js","webpack:///./src/js/Content/Features/Store/App/FFamilySharingNotice.js","webpack:///./src/js/Content/Features/Store/App/FPackBreakdown.js","webpack:///./src/js/Content/Features/Store/App/FPackageInfoButton.js","webpack:///./src/js/Content/Features/Store/App/FSteamChart.js","webpack:///./src/js/Content/Features/Store/App/FSteamSpy.js","webpack:///./src/js/Content/Features/Store/App/FSurveyData.js","webpack:///./src/js/Content/Features/Store/Common/FCustomizer.js","webpack:///./src/js/Content/Features/Store/App/FDLCCheckboxes.js","webpack:///./src/js/Content/Features/Store/App/FBadgeProgress.js","webpack:///./src/js/Content/Features/Store/App/FAStatsLink.js","webpack:///./src/js/Content/Features/Store/App/FAchievementBar.js","webpack:///./src/js/Content/Modules/Stats.js","webpack:///./src/js/Content/Features/Store/Common/FRegionalPricing.js","webpack:///./src/js/Content/Features/Store/App/FReviewToggleButton.js","webpack:///./src/js/Content/Features/Store/App/FOwnedActionsButtons.js","webpack:///./src/js/Content/Features/Store/App/FSupportInfo.js","webpack:///./src/js/Content/Features/Store/App/FRemoveBroadcasts.js","webpack:///./src/js/Content/Features/Store/App/PApp.js","webpack:///./src/js/Content/Features/StorePage.js","webpack:///./src/js/Content/Features/Store/App/CApp.js","webpack:///./src/js/Content/Features/Store/Common/CStore.js","webpack:///./src/js/Content/Features/Store/Common/CStoreBase.js","webpack:///./src/js/Content/Modules/Context/Context.js"],"names":["LoginError","Error","type","super","this","name","ServerOutageError","msg","HTTPError","code","message","FeatureDependencyError","featureName","Errors","HTML","str","map","replace","m","html","template","document","createElement","innerHTML","DOMPurify","sanitize","content","fragment","firstElementChild","node","_node","console","warn","querySelector","Element","_getNode","outerHTML","wrapper","element","replaceWith","append","position","insertAdjacentHTML","adjacent","HTMLParser","string","text","regex","RegExp","match","parseInt","JSON","parse","dom","querySelectorAll","value","getVariableFromText","textContent","CookieStorage","defaultValue","_name","trim","cache","has","get","val","ttl","_val","set","encodeURIComponent","cookie","delete","Map","key","split","kv","decodeURIComponent","init","ContextType","Object","freeze","currentContext","browser","extension","getBackgroundPage","bgPage","window","BACKGROUND","OPTIONS","CONTENT_SCRIPT","Language","_currentSteamLanguage","script","language","URL","src","searchParams","isContentScript","languages","array","includes","getCurrentSteamLanguage","BackgroundSimple","runtime","sendMessage","requested","params","length","ExtensionResources","pathname","getURL","fetch","then","r","json","Info","getManifest","version","prototype","hasOwnProperty","call","_cache","defaults","_adapter","entries","remove","prefix","keys","filter","k","startsWith","force","tmp","persistent","reduce","acc","option","clear","import","storage","onChanged","addListener","changes","assign","onDone","onCatch","stringify","QUOTA_BYTES_PER_ITEM","sync","local","Localization","getJSON","_promise","currentSteamLanguage","storedSteamLanguage","deepAssign","target","source","action","getLanguageCode","codes","push","Promise","all","lc","loadLocalization","english","path","reverse","current","pop","LocalStorage","item","localStorage","getItem","err","setItem","removeItem","result","i","Timer","duration","resolve","_id","setTimeout","onSuccess","onFail","clearTimeout","ResettableTimer","reset","_running","async","TimeUtils","Math","trunc","Date","now","GameId","id","_text","HTMLElement","appid","dataset","dsAppid","parseId","href","subid","dsPackageid","bundleid","dsBundleid","storeId","Number","slice","indexOf","res","exec","Version","major","minor","patch","assert","isInteger","fromString","Array","isArray","fromArray","v","from","toString","isSameOrAfter","_version","coerce","isSame","isBefore","isSameOrBefore","ProgressBar","afterEnd","ready","_progress","setAttribute","loading","requests","classList","style","width","initiated","progress","completed","_value","add","parentElement","server_outage","warningNode","nodeError","failed","_failedRequests","Background","startRequest","finishRequest","errObj","errStr","info","serverOutage","_errorHandlers","some","handler","RequestData","url","settings","responseType","_url","_settings","location","origin","response","protocol","_fetchFn","ok","status","statusText","formData","returnJSON","getHttp","bind","country","_storeCountry","substr","avatarNode","loginPromise","profileUrl","profilePath","login","isSignedIn","steamId","catch","error","newCountry","hostname","endsWith","getElementsByTagName","config","COUNTRY","group","groupEnd","promise","_sessionId","getVariableFromDom","lang","appName","_appName","clearSpecialSymbols","getJson","success","data","webapi_token","allSettled","promises","reason","DynamicStore","multiple","trimmedIds","statusList","trimStoreId","dsStatusList","trimmedId","owned","_fetch","Inventory","appids","options","getStatusObject","giftsAndPasses","hasCoupon","Boolean","opts","coupons","results","marketHashes","context","args","constructor","DOMHelper","container","parent","parentNode","insertBefore","removeChild","selector","nodes","stylesheet","rel","head","appendChild","onload","isAsync","HorizontalScroller","controlLeftNode","controlRightNode","lastScroll","addEventListener","e","preventDefault","stopPropagation","deltaY","click","AugmentedSteam","afterBegin","thewordoptions","clear_cache","contribute","bug_feature","website","SteamFacade","showMenu","hideMenu","clearCache","reload","btn","body","scroll","toggle","scrollY","stopShowingHandler","el","update","dont_show","hide","closest","getElementById","insertAdjacentElement","currentLanguage","warningLanguage","strings","_addWarning","using_language","using_language_return","ChangeLanguage","viewinclient","games","wishlist","beforeEnd","reviews","removeLinkFilter","MutationObserver","mutations","mutation","addedNodes","nodeType","Node","ELEMENT_NODE","observe","beforeBegin","activate","logoutNode","accountName","communityName","pageHeader","test","title","launch_random","getRandomApp","gamename","gameid","fullgame","playGameStr","visitStore","showConfirmDialog","done","play_game","visit_store","checked","tab","links","link","contains","create","_loginWarningAdded","host","login_warning","_addBackToTop","_addMenu","_addLanguageWarning","_handleInstallSteamButton","_disableLinkFilter","_skipGotSteam","_keepSteamSubscriberAgreementState","_defaultCommunityTab","_horizontalScrolling","_addUsernameSubmenuLinks","_addRedeemLink","_replaceAccountName","_launchRandomButton","_bindLogout","StringUtils","SteamCurrency","abbr","symbol","hint","multiplier","unit","formatPlaces","formatHidePlaces","formatSymbol","formatGroupSeparator","formatGroupSize","formatDecimalSeparator","formatPostfixSymbol","format","price","_price","groupSeparator","decimalSeparator","parseFloat","isNaN","withSymbol","sign","decimals","s","abs","toFixed","decimalPlaces","g","j","groupSize","unshift","substring","join","hidePlacesWhenZero","postfix","cur","escapeRegExp","CurrencyManager","currencyNode","hasAttribute","getAttribute","walletCurrency","g_rgWalletInfo","wallet_currency","currencyNumberToType","currency","_getCurrencyFromDom","_getCurrencyFromWallet","to","_rates","fromType","number","fromNumber","_indices","_defaultCurrency","storeCurrency","_getStoreCurrency","currencySetting","customCurrency","toCurrencies","_isInitialized","currencies","symbols","_loadCurrency","_loadRates","onFailure","EarlyAccess","selectorModifier","appidsMap","linkNode","imgHeader","getAppid","getAppidImgSrc","String","eaStatus","values","selectors","_selectorModifier","getEaNodes","wrap","early_access","_imageUrl","_checkNodes","imageName","isCurrentLanguageOneOf","_handleStore","_handleCommunity","ITAD","onHover","updateLastImport","htmlStr","itad","toLocaleString","never","inner","last_import","sync_now","hover","syncDiv","timeout","display","timer","storeIds","collection","waitlist","resolved","inCollection","inWaitlist","Messenger","msgID","postMessage","callback","information","removeEventListener","Price","otherPrice","_otherPrice","inCurrency","desiredCurrency","rate","getRate","currencyType","valueOf","Prices","subids","bundleids","priceCallback","bundleCallback","_bundles","apiParams","stores","cc","coupon","priceData","pricingStr","prices","pricesStr","cutStr","cut","store","meta","pricing","hasData","lowestData","lowest","bundledCount","bundles","count","urlData","urls","voucherStr","price_voucher","voucher","escape","with_voucher","storeStr","_getPricingStrings","drmStr","drm","infoUrl","storeUrl","lowest_price","historical","dateStr","recorded","toLocaleDateString","history","historical_low","bundledUrl","bundle_history","bundledStr","bundle_count","bundled","purchase","bundle","live","tiers","endDate","expiry","currentDate","getTime","bundleNormalized","page","sorted","t","sort","bundlePrice","buy_package","offer_ends","tierNum","tier","tierName","note","tierPrice","tier_includes","gameList","details","buy","_getApiParams","_processPrices","_processBundles","finally","defineProperty","initialized","ev","localStack","stack","insertScript","strTitle","strDescription","rgModalParams","ShowDialog","strOKButton","strCancelButton","strSecondaryActionButton","ShowConfirmDialog","ShowAlertDialog","ShowBlockingWaitDialog","ShowNicknameModal","CModal","DismissActiveModal","elemLink","elemPopup","align","valign","bLinkHasBorder","ShowMenu","HideMenu","CollapseLongStrings","BindAutoFlyoutEvents","GDynamicStore","InvalidateCache","bForceRecalculate","DecorateDynamicItems","$J","OnReady","unAppID","unPackageID","unBundleID","rgAdditionalParams","GStoreItemData","BindHoverEvents","isHtml","isStore","v_tooltip","amount","publisherFee","CalculateFeeAmount","currencyCode","v_currencyformat","ToggleManageFriends","chatId","OpenFriendChatInWebChat","SubmitGuide","InitMiniprofileHovers","Modal","groupID","steamIDInvitee","InviteUserToGroup","GetCheckedAccounts","navid","ExecFriendAction","CScrollOffsetWatcher","ForceRecalc","InventoryFirstPage","InventoryLastPage","InventoryGoToPage","ReloadCommunityInventory","itemDesc","GetMarketHashName","pricehistory_zoomDays","g_plotPriceHistory","g_timePriceHistoryEarliest","g_timePriceHistoryLatest","SellItemDialog","m_plotPriceHistory","m_timePriceHistoryEarliest","m_timePriceHistoryLatest","UpdateSelection","selectAll","selectNone","selectInverse","on","ajax","post","registerErrorHandler","addLoginWarning","fun","withPromise","argsString","msgId","_msgCounter","onMessage","documentElement","ContextClass","purifyConfig","ADD_ATTR","addHook","attrName","attrValue","keepAttr","setConfig","setup","log","onUpdate","lastVersion","isAfter","_showChangelog","_migrateSettings","dialog","connectBtn","itadConnected","updatedStr","showAlertDialog","updated","oldVersion","emoticons","checkVersion","showEarlyAccess","_activeDropLists","_lastSelectHideTime","_handleMouseClick","ulAboveEvent","_hide","index","bSetSelected","droplist","trigger","rgItems","highlightedItem","className","yOffset","offsetTop","clientHeight","curVisibleOffset","scrollTop","bScrolledDown","nMaxLoopIterations","nLoopCounter","input","dispatchEvent","Event","_classCheck","d","focus","_show","initialOption","changeFn","storageOption","reversed","box","sort_by","getTrimmedValue","onChange","reverseEl","_onFocus","_onBlur","_onTriggerClick","ul","trimmedOption","a","_highlightItem","_pageSpecificFeatures","applyFeatures","FMediaExpander","_details","expand_slider","contract_slider","_buildSideDetails","opacity","sliderToggle","_clickSliderToggle","sketchfabNode","top","_detailsBuilt","matches","detailsClone","cloneNode","detailsWrap","sideDetails","transition","FITADPrices","getAllSubids","contentNode","placement","banner","newParent","header","load","FDRMWarnings","toLowerCase","drmNames","enabled","drmString","drm_third_party","drm_third_party_sub","nextSibling","FExtraLinks","_type","_gameid","_moveExtraLinks","customLink","customUrl","icon","_getRightColLinkHtml","view_on_website","youtube_reviews","youtube_gameplay","wiki_article","hasCards","communityAppid","cls","iconUrl","usefulLinks","UserNotesAdapter","Adapter","adapters","toType","currentAdapter","getAdapter","newAdapter","export","OutOfCapacityError","ratio","CapacityInfo","closeToFull","utilization","_notes","oldNote","storageUsage","_getNotesSize","notes","UserNotes","_str","user_note","noteModalTemplate","capInfo","_showDialog","appname","nodeSelector","onNoteUpdate","strSave","strCancel","deferred","jQuery","Deferred","fnOk","fnCancel","reject","buttons","okBtn","_BuildDialogButton","cancelBtn","modal","_BuildDialog","_BindOnEnterKeyPressForDialog","always","Dismiss","noteInput","setSelectionRange","textLength","fail","Show","add_for_game","save","cancel","exceeded","desc","not_enough_space_desc","close_on_storage_desc","storage_warning_desc","adapterType","strCloudStorage","strLocalStorage","not_enough_space","close_on_storage","save_itad","save_synced_storage","save_local","changeAdapter","FHighlightsTags","onDynamicStoreReady","searchBoxContents","records","highlightAndTag","highlightTitle","_selector","hasDsInfo","storeIdsMap","nodeToHighlight","nextElementSibling","aNode","getAppidFromId","getSubid","getBundleid","arr","highlightOwned","wishlisted","highlightWishlist","ignored","highlightIgnored","trimmedStoreIds","includeDsInfo","dsStatus","itadStatus","invStatus","getAppStatus","waitlisted","collected","gift","guestPass","it","storeid","forEach","highlightCollection","highlightWaitlist","next","highlightInvGift","highlightInvGuestpass","highlightInvCoupon","tag","tagShort","_tagCssLoaded","tagCss","_types","color","tags","root","htmlToElement","n","_highlightCssLoaded","hlCss","previousElementSibling","_highlightNode","_addTag","sel","FHideTrademarks","replaceSymbols","observer","FAlternativeLinuxIcon","cssText","FReplaceDevPubLinks","devs","pubs","franchise","homepageLink","homepage","moreBtn","collapseLongStrings","FRemoveFromWishlist","isOwned","successBtn","tooltipText","remove_from_wishlist_tooltip","imgNode","removeWaitlist","removeFromWishlist","removeFromWaitlist","onWishAndWaitlistRemove","dynamicStoreInvalidateCache","logError","FForceMP4","mp4","mp4Source","mp4hd","mp4HdSource","webmSource","webmHdSource","video","sdSrc","hdSrc","toggleVideoDefinition","FHDPlayer","that","movieNode","playInHD","toggleFullscreen","videoControl","fullscreenEnabled","mozFullScreenEnabled","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","exitFullscreen","mozCancelFullScreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","addHDControl","newNode","firstVideoIsPlaying","clickInitialHD","currentTarget","FUserNotes","userNotes","noteText","cssClass","inactiveStyle","activeStyle","toggleState","active","button","showModalDialog","FWaitlistDropdown","wishlistDivs","wishlistArea","wishlistSuccessArea","theworddefault","add_to_wishlist","add_to_waitlist","menu","menuArrow","wishlistOption","waitlistOption","updateDiv","oneActive","on_wishlist","on_waitlist","lastChild","jq","ajaxComplete","xhr","unbind","FNewQueue","queue","new_tooltip","new","f","vTooltip","jqOnClick","queueType","global","jqAjax","serialize","FFullscreenScreenshotView","toggleFullScreen","initFSVButtons","modalFooter","nextButton","nextButtonOffsetWidth","offsetWidth","fsvButton","modalTitleLink","open","FShowCoupon","getCoupon","couponDate","valid","m0","m1","coupon_available","coupon_application_note","coupon_learn_more","image_url","discount_note","purchaseDiv","discount_doesnt_stack","priceNode","scaleFactor","originalPrice","priceFinal","newFinalPrice","floor","discount","FDLCInfo","isDlc","dlc_details","FMetacriticUserScore","userscore","metauserscore","rating","user_score","FOpenCritic","oc","ocImg","award","score","read_reviews","review","date","snippet","dScore","rUrl","author","read_more_reviews","reviewsNode","FOwnedElsewhere","storeList","coll","in_collection","toUpperCase","owned_elsewhere","FPurchaseDate","purchase_date","FSteamPeek","_moreLikeThis","steamTab","steamPeekTab","_adjustScroller","spLoaded","storeItemDataBindHover","dynamicStoreDecorateItems","more_on_steampeek","FWidescreenCertification","_levelMap","wsgf","_data","imgPrefix","typeName","level","wsg","mmg","fkg","uws","wsgIcon","wsgText","_getType","mmgIcon","mmgText","uwsIcon","uwsText","fkgIcon","fkgText","certifications","rating_details","FHowLongToBeat","hltb","icoImg","main_story","main","main_extras","main_e","comp","compl","more_information","submit_url","submit","no_data","FFamilySharingNotice","exfgls","excluded","family_sharing_notice","FPackBreakdown","_splitPack","ways","unitPrice","ceil","each","FPackageInfoButton","package_info","FSteamChart","charts","chart","peakall","_chart","playing_now","peaktoday","powered_by","FSteamSpy","steamspy","owners","ownersFrom","ownersTo","averageTotal","_getTimeString","average_forever","average2weeks","average_2weeks","spy","player_data","average_playtime","average_playtime_2weeks","days","hours","FSurveyData","isVideo","survey","_survey","performance_survey","users","responses","framerate","round","frp","framerate_response","fr","framerate_30","framerate_fi","framerate_va","resolution","resolution_support","mr","resolution_less","resolution_up","graphics_settings","gs","gs_y","gs_n","satisfaction","_getBarHtml","nvidia","amd","intel","other","nobody","FCustomizer","customize","apppage_sections","customizeBtn","_customizeAppPage","_customizeFrontPage","GHomepage","bInitialRenderComplete","Proxy","prop","Reflect","getParentEl","customizer","Customizer","apppage_franchise","apppage_eaheader","apppage_eabanner","apppage_recentupdates","apppage_legal","apppage_morefromfranchise","apppage_workshop","apppage_greenlight","build","homepage_curators","homepage_tabs","homepage_topnewreleases","homepage_sidebar","addDynamic","settingsName","textNode","childNodes","TEXT_NODE","state","targets","forceShow","elements","NodeList","_getState","getComputedStyle","_textValue","esName","esText","customizerEntries","checkboxrow","_updateState","FDLCCheckboxes","dlcSection","dlcRow","subidNode","label","checkbox","esDlcSubid","parseFromString","esDlcPrice","add_selected_dlc_to_cart","expandedNode","cartForm","method","cartBtn","createHiddenInput","dlc_select","unowned_dlc","wishlisted_dlc","none","inputAction","inputSessionId","total","FBadgeProgress","insertStylesheet","badge_progress","_loadBadgeContent","targetSelector","badge","htmlToDOM","_displayBadgeInfo","badgeNode","blockSel","cardNumOwned","cardNumTotal","progressTextLength","nextLevelEmptyBadge","badgeCompleted","showCardNum","isNormalBadge","progressBold","view_badge","view_badge_progress","cards_owned","last","badge_not_unlocked","FAStatsLink","hasAchievements","imgUrl","view_astats","FAchievementBar","achieveBar","achNode","whiteSpace","stats","achievements","summary","innerText","achievementStr","achBarWidth","getAchievementBar","FRegionalPricing","countries","showRegionalPrice","localCountry","apiPrice","priceLocal","final","pricingDiv","priceRegion","priceUser","percentageIndicator","percentage","region_unavailable","purchaseArea","FReviewToggleButton","_toggleReviews","_state","FOwnedActionsButtons","view_in_library","get_help","FSupportInfo","_supportInfo","support_info","email","support","contact","FRemoveBroadcasts","bcStore","uiBroadcastWatchStore","m_activeVideo","StopVideo","run","features","_callbacks","Ref","_promisesMap","_stats","feature","_generateFeatureChain","dependency","dependencies","dep","ftr","previousCheck","prev","weakDependency","every","checkPrerequisites","fulfilled","apply","fn","_observeChanges","tabAreaNodes","tabAreaNode","communityAppidSrc","metalinkNode","metalink","storePageDataPromise","setHD","videoIsHD","videoIsVisible","offsetHeight","loadedSrc","videoPosition","currentTime","videoPaused","paused","preload","onLoadedMetaData","play"],"mappings":"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","file":"js/store/app.js","sourcesContent":["\r\nclass LoginError extends Error {\r\n    constructor(type) {\r\n        super(type);\r\n        this.name = \"LoginError\";\r\n    }\r\n}\r\n\r\nclass ServerOutageError extends Error {\r\n    constructor(msg) {\r\n        super(msg);\r\n        this.name = \"ServerOutageError\";\r\n    }\r\n}\r\n\r\nclass HTTPError extends Error {\r\n    constructor(code, message) {\r\n        super(message);\r\n        this.code = code;\r\n    }\r\n}\r\n\r\n\r\nclass FeatureDependencyError extends Error {\r\n    constructor(msg, featureName) {\r\n        super(msg);\r\n        this.featureName = featureName;\r\n    }\r\n}\r\n\r\nconst Errors = {\r\n    \"LoginError\": LoginError,\r\n    \"ServerOutageError\": ServerOutageError,\r\n    \"HTTPError\": HTTPError,\r\n    \"FeatureDependencyError\": FeatureDependencyError\r\n};\r\n\r\nexport {Errors};\r\n","\r\nclass HTML {\r\n\r\n    static escape(str) {\r\n\r\n        // @see https://stackoverflow.com/a/4835406\r\n        const map = {\r\n            \"&\": \"&amp;\",\r\n            \"<\": \"&lt;\",\r\n            \">\": \"&gt;\",\r\n            '\"': \"&quot;\",\r\n            \"'\": \"&#039;\"\r\n        };\r\n\r\n        return str.replace(/[&<>\"']/g, (m) => { return map[m]; });\r\n    }\r\n\r\n    static fragment(html) {\r\n        const template = document.createElement(\"template\");\r\n        template.innerHTML = DOMPurify.sanitize(html);\r\n        return template.content;\r\n    }\r\n\r\n    static element(html) {\r\n        return HTML.fragment(html).firstElementChild;\r\n    }\r\n\r\n    static _getNode(node) {\r\n        let _node = node;\r\n\r\n        if (typeof _node == \"undefined\" || _node === null) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n        if (typeof _node == \"string\") {\r\n            _node = document.querySelector(_node);\r\n        }\r\n        if (!(_node instanceof Element)) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n\r\n        return _node;\r\n    }\r\n\r\n    static inner(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.innerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static replace(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.outerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static wrap(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            const wrapper = HTML.element(html);\r\n            _node.replaceWith(wrapper);\r\n            wrapper.append(_node);\r\n            return wrapper;\r\n        } else {\r\n            return _node;\r\n        }\r\n    }\r\n\r\n    static adjacent(node, position, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.insertAdjacentHTML(position, DOMPurify.sanitize(html));\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static beforeBegin(node, html) {\r\n        HTML.adjacent(node, \"beforebegin\", html);\r\n    }\r\n\r\n    static afterBegin(node, html) {\r\n        HTML.adjacent(node, \"afterbegin\", html);\r\n    }\r\n\r\n    static beforeEnd(node, html) {\r\n        HTML.adjacent(node, \"beforeend\", html);\r\n    }\r\n\r\n    static afterEnd(node, html) {\r\n        HTML.adjacent(node, \"afterend\", html);\r\n    }\r\n}\r\n\r\nexport {HTML};\r\n","import {HTML} from \"./Html\";\r\n\r\nclass HTMLParser {\r\n\r\n    static clearSpecialSymbols(string) {\r\n        return string.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\");\r\n    }\r\n\r\n    static htmlToDOM(html) {\r\n        return HTML.fragment(html);\r\n    }\r\n\r\n    static htmlToElement(html) {\r\n        return HTML.element(html);\r\n    }\r\n\r\n    static getVariableFromText(text, name, type) {\r\n        let regex;\r\n        if (type === \"object\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\{.+?\\\\});`);\r\n        } else if (type === \"array\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\[.+?\\\\]);`);\r\n        } else if (type === \"int\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(.+?);`);\r\n        } else if (type === \"string\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\\".+?\\\\\");`);\r\n        } else {\r\n            return null;\r\n        }\r\n\r\n        const m = text.match(regex);\r\n        if (m) {\r\n            if (type === \"int\") {\r\n                return parseInt(m[1]);\r\n            }\r\n            return JSON.parse(m[1]);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getVariableFromDom(name, type, dom = document) {\r\n        for (const node of dom.querySelectorAll(\"script\")) {\r\n            const value = HTMLParser.getVariableFromText(node.textContent, name, type);\r\n\r\n            if (value !== null) {\r\n                return value;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n\r\nexport {HTMLParser};\r\n","\r\nclass CookieStorage {\r\n\r\n    static get(name, defaultValue) {\r\n        const _name = name.trim();\r\n\r\n        if (!CookieStorage.cache.has(_name)) {\r\n            return defaultValue;\r\n        }\r\n        return CookieStorage.cache.get(_name);\r\n    }\r\n\r\n    static set(name, val, ttl = 60 * 60 * 24 * 365) {\r\n        let _name = name.trim();\r\n        let _val = val.trim();\r\n\r\n        CookieStorage.cache.set(_name, _val);\r\n\r\n        _name = encodeURIComponent(_name);\r\n        _val = encodeURIComponent(_val);\r\n        document.cookie = `${_name}=${_val}; max-age=${ttl}`;\r\n    }\r\n\r\n    static remove(name) {\r\n        let _name = name.trim();\r\n        CookieStorage.cache.delete(_name);\r\n        _name = encodeURIComponent(_name);\r\n        document.cookie = `${_name}; expires=Thu, 01 Jan 1970 00:00:00 GMT`;\r\n    }\r\n\r\n    static init() {\r\n        CookieStorage.cache = new Map();\r\n        for (let [key, val] of document.cookie.split(\";\").map(kv => kv.split(\"=\"))) {\r\n            key = key.trim();\r\n            CookieStorage.cache.set(key, decodeURIComponent(val));\r\n        }\r\n    }\r\n}\r\n\r\nCookieStorage.init();\r\n\r\nexport {CookieStorage};\r\n","\r\nconst ContextType = Object.freeze({\r\n    \"BACKGROUND\": 1,\r\n    \"CONTENT_SCRIPT\": 2,\r\n    \"OPTIONS\": 3,\r\n});\r\n\r\nlet currentContext;\r\nif (browser.extension.getBackgroundPage) {\r\n    const bgPage = browser.extension.getBackgroundPage();\r\n\r\n    currentContext = (bgPage === window)\r\n        ? ContextType.BACKGROUND\r\n        : ContextType.OPTIONS;\r\n} else {\r\n    currentContext = ContextType.CONTENT_SCRIPT;\r\n}\r\n\r\nclass Environment {\r\n\r\n    static isBackgroundScript() {\r\n        return currentContext === ContextType.BACKGROUND;\r\n    }\r\n\r\n    static isContentScript() {\r\n        return currentContext === ContextType.CONTENT_SCRIPT;\r\n    }\r\n\r\n    static isOptions() {\r\n        return currentContext === ContextType.OPTIONS;\r\n    }\r\n}\r\n\r\nexport {Environment};\r\n","import {CookieStorage} from \"../Storage/CookieStorage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass Language {\r\n\r\n    static getCurrentSteamLanguage() {\r\n        if (this._currentSteamLanguage !== null) {\r\n            return this._currentSteamLanguage;\r\n        }\r\n\r\n        for (const script of document.querySelectorAll(\"script[src]\")) {\r\n            const language = new URL(script.src).searchParams.get(\"l\");\r\n            if (language) {\r\n                Language._currentSteamLanguage = language;\r\n                return this._currentSteamLanguage;\r\n            }\r\n        }\r\n\r\n        // In a Content Context, we can check for a cookie\r\n        if (Environment.isContentScript()) {\r\n            Language._currentSteamLanguage = CookieStorage.get(\"Steam_Language\") || null;\r\n        }\r\n\r\n        return this._currentSteamLanguage;\r\n    }\r\n\r\n    static getLanguageCode(language) {\r\n        const code = Language.languages[language];\r\n        return code || \"en\";\r\n    }\r\n\r\n    static isCurrentLanguageOneOf(array) {\r\n        return array.includes(Language.getCurrentSteamLanguage());\r\n    }\r\n}\r\n\r\nLanguage._currentSteamLanguage = null;\r\nLanguage.languages = {\r\n    \"english\": \"en\",\r\n    \"bulgarian\": \"bg\",\r\n    \"czech\": \"cs\",\r\n    \"danish\": \"da\",\r\n    \"dutch\": \"nl\",\r\n    \"finnish\": \"fi\",\r\n    \"french\": \"fr\",\r\n    \"greek\": \"el\",\r\n    \"german\": \"de\",\r\n    \"hungarian\": \"hu\",\r\n    \"italian\": \"it\",\r\n    \"japanese\": \"ja\",\r\n    \"koreana\": \"ko\",\r\n    \"norwegian\": \"no\",\r\n    \"polish\": \"pl\",\r\n    \"portuguese\": \"pt-PT\",\r\n    \"brazilian\": \"pt-BR\",\r\n    \"russian\": \"ru\",\r\n    \"romanian\": \"ro\",\r\n    \"schinese\": \"zh-CN\",\r\n    \"spanish\": \"es-ES\",\r\n    \"latam\": \"es-419\",\r\n    \"swedish\": \"sv-SE\",\r\n    \"tchinese\": \"zh-TW\",\r\n    \"thai\": \"th\",\r\n    \"turkish\": \"tr\",\r\n    \"ukrainian\": \"ua\",\r\n    \"vietnamese\": \"vi\",\r\n};\r\n\r\nexport {Language};\r\n","\r\nclass BackgroundSimple {\r\n    static message(message) {\r\n        return browser.runtime.sendMessage(message);\r\n    }\r\n\r\n    static action(requested, ...params) {\r\n        if (!params.length) { return this.message({\"action\": requested}); }\r\n        return this.message({\"action\": requested, \"params\": params});\r\n    }\r\n}\r\n\r\nexport {BackgroundSimple};\r\n","\r\nclass ExtensionResources {\r\n\r\n    static getURL(pathname) {\r\n        return browser.runtime.getURL(pathname);\r\n    }\r\n\r\n    static get(pathname) {\r\n        return fetch(ExtensionResources.getURL(pathname));\r\n    }\r\n\r\n    static getJSON(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.json());\r\n    }\r\n\r\n    static getText(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.text());\r\n    }\r\n}\r\n\r\nexport {ExtensionResources};\r\n","\r\nconst Info = {\r\n    \"version\": browser.runtime.getManifest().version,\r\n    \"db_version\": 3,\r\n};\r\n\r\nexport {Info};\r\n","import {Info} from \"../Info\";\r\n\r\nclass SyncedStorage {\r\n\r\n    /*\r\n     * browser.storage.sync limits\r\n     * QUOTA_BYTES = 102400 // 100KB\r\n     * QUOTA_BYTES_PER_ITEM = 8192 // 8KB\r\n     * MAX_ITEMS = 512\r\n     * MAX_WRITE_OPERATIONS_PER_HOUR = 1800\r\n     * MAX_WRITE_OPERATIONS_PER_MINUTE = 120\r\n     */\r\n    static has(key) {\r\n        return Object.prototype.hasOwnProperty.call(this._cache, key);\r\n    }\r\n\r\n    static get(key) {\r\n        if (typeof this._cache[key] == \"undefined\") {\r\n            if (typeof this.defaults[key] == \"undefined\") {\r\n                console.warn(`Unrecognized SyncedStorage key \"${key}\"`);\r\n            }\r\n            return this.defaults[key];\r\n        }\r\n        return this._cache[key];\r\n    }\r\n\r\n    static set(key, value) {\r\n        this._cache[key] = value;\r\n        return this._adapter.set({[key]: value});\r\n\r\n        // this will throw if MAX_WRITE_*, MAX_ITEMS, QUOTA_BYTES* are exceeded\r\n    }\r\n\r\n    static import(entries) {\r\n        for (const [key, value] of Object.entries(entries)) {\r\n            this._cache[key] = value;\r\n        }\r\n        return this._adapter.set(entries);\r\n    }\r\n\r\n    static remove(key) {\r\n        if (typeof this._cache[key] !== \"undefined\") {\r\n            delete this._cache[key];\r\n        }\r\n        return this._adapter.remove(key);\r\n\r\n        // can throw if MAX_WRITE* is exceeded\r\n    }\r\n\r\n    static keys(prefix = \"\") {\r\n        return Object.keys(this._cache).filter(k => k.startsWith(prefix));\r\n    }\r\n\r\n    static entries() {\r\n        return Object.entries(this._cache);\r\n    }\r\n\r\n    static async clear(force = false) {\r\n\r\n        let tmp;\r\n        if (force) {\r\n            this._cache = {};\r\n        } else {\r\n            tmp = this.persistent.reduce((acc, option) => {\r\n                acc[option] = this._cache[option];\r\n                return acc;\r\n            }, {});\r\n        }\r\n\r\n        // can throw if MAX_WRITE* is exceeded\r\n        await this._adapter.clear();\r\n\r\n        if (!force) {\r\n            await this.import(tmp);\r\n        }\r\n    }\r\n\r\n    // load whole storage and make local copy\r\n    static async init() {\r\n        browser.storage.onChanged.addListener(changes => {\r\n            for (const [key, {\"newValue\": val}] of Object.entries(changes)) {\r\n                this._cache[key] = val;\r\n            }\r\n        });\r\n\r\n        const storage = await this._adapter.get(null);\r\n        Object.assign(this._cache, storage);\r\n\r\n        return this._cache;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return this.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static toJson() {\r\n        return JSON.stringify(this._cache);\r\n    }\r\n}\r\n\r\nSyncedStorage.QUOTA_BYTES_PER_ITEM = 8192;\r\n\r\nSyncedStorage._adapter = browser.storage.sync || browser.storage.local;\r\nSyncedStorage._cache = {};\r\nSyncedStorage.defaults = Object.freeze({\r\n    \"language\": \"english\",\r\n\r\n    \"version\": Info.version,\r\n    \"version_show\": true,\r\n\r\n    \"highlight_owned_color\": \"#00ce67\",\r\n    \"highlight_wishlist_color\": \"#0491bf\",\r\n    \"highlight_coupon_color\": \"#a26426\",\r\n    \"highlight_inv_gift_color\": \"#800040\",\r\n    \"highlight_inv_guestpass_color\": \"#513c73\",\r\n    \"highlight_notinterested_color\": \"#4f4f4f\",\r\n    \"highlight_collection_color\": \"#856d0e\",\r\n    \"highlight_waitlist_color\": \"#4c7521\",\r\n\r\n    \"tag_owned_color\": \"#00b75b\",\r\n    \"tag_wishlist_color\": \"#0383b4\",\r\n    \"tag_coupon_color\": \"#c27120\",\r\n    \"tag_inv_gift_color\": \"#b10059\",\r\n    \"tag_inv_guestpass_color\": \"#65449a\",\r\n    \"tag_notinterested_color\": \"#4f4f4f\",\r\n    \"tag_collection_color\": \"#856d0e\",\r\n    \"tag_waitlist_color\": \"#4c7521\",\r\n\r\n    \"highlight_owned\": true,\r\n    \"highlight_wishlist\": true,\r\n    \"highlight_coupon\": false,\r\n    \"highlight_inv_gift\": false,\r\n    \"highlight_inv_guestpass\": false,\r\n    \"highlight_notinterested\": false,\r\n    \"highlight_excludef2p\": false,\r\n    \"highlight_collection\": true,\r\n    \"highlight_waitlist\": true,\r\n\r\n    \"tag_owned\": false,\r\n    \"tag_wishlist\": false,\r\n    \"tag_coupon\": false,\r\n    \"tag_inv_gift\": false,\r\n    \"tag_inv_guestpass\": false,\r\n    \"tag_notinterested\": true,\r\n    \"tag_collection\": false,\r\n    \"tag_waitlist\": false,\r\n    \"tag_short\": false,\r\n\r\n    \"hidetmsymbols\": false,\r\n\r\n    \"showlowestprice\": true,\r\n    \"showlowestprice_onwishlist\": true,\r\n    \"showlowestpricecoupon\": true,\r\n    \"showallstores\": true,\r\n    \"stores\": [],\r\n    \"override_price\": \"auto\",\r\n    \"showregionalprice\": \"mouse\",\r\n    \"regional_countries\": [\"us\", \"gb\", \"ru\", \"br\", \"au\", \"jp\"],\r\n\r\n    \"show_es_homepagetabs\": true,\r\n    \"showmarkettotal\": false,\r\n    \"showsteamrepapi\": true,\r\n    \"showmcus\": true,\r\n    \"showoc\": true,\r\n    \"showhltb\": true,\r\n    \"showyoutube\": true,\r\n    \"showtwitch\": true,\r\n    \"showpcgw\": true,\r\n    \"showcompletionistme\": false,\r\n    \"showprotondb\": false,\r\n    \"showviewinlibrary\": false,\r\n    \"showsteamcardexchange\": false,\r\n    \"showitadlinks\": true,\r\n    \"showsteamdb\": true,\r\n    \"showbartervg\": false,\r\n    \"showastatslink\": true,\r\n    \"showyoutubegameplay\": true,\r\n    \"showyoutubereviews\": true,\r\n    \"showwsgf\": true,\r\n    \"exfgls\": true,\r\n    \"app_custom_link\": [\r\n        {\r\n            \"enabled\": false,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]+[NAME]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n\r\n    \"customize_apppage\": {\r\n        \"recentupdates\": true,\r\n        \"reviews\": true,\r\n        \"about\": true,\r\n        \"contentwarning\": true,\r\n        \"steamchart\": true,\r\n        \"steamspy\": true,\r\n        \"surveys\": true,\r\n        \"sysreq\": true,\r\n        \"legal\": true,\r\n        \"morelikethis\": true,\r\n        \"recommendedbycurators\": true,\r\n        \"customerreviews\": true\r\n    },\r\n\r\n    \"customize_frontpage\": {\r\n        \"featuredrecommended\": true,\r\n        \"specialoffers\": true,\r\n        \"trendingamongfriends\": true,\r\n        \"discoveryqueue\": true,\r\n        \"browsesteam\": true,\r\n        \"curators\": true,\r\n        \"morecuratorrecommendations\": true,\r\n        \"recentlyupdated\": true,\r\n        \"fromdevelopersandpublishersthatyouknow\": true,\r\n        \"popularvrgames\": true,\r\n        \"homepagetabs\": true,\r\n        \"gamesstreamingnow\": true,\r\n        \"under\": true,\r\n        \"updatesandoffers\": true,\r\n        \"homepagesidebar\": true\r\n    },\r\n\r\n    // 'show_keylol_links': false, // not in use, option is commented out\r\n    \"show_package_info\": false,\r\n    \"show_steamchart_info\": true,\r\n    \"show_steamspy_info\": true,\r\n    \"show_early_access\": true,\r\n    \"show_alternative_linux_icon\": false,\r\n    \"show_itad_button\": false,\r\n    \"skip_got_steam\": false,\r\n\r\n    \"installsteam\": \"show\",\r\n    \"openinnewtab\": false,\r\n    \"keepssachecked\": false,\r\n    \"showemptywishlist\": true,\r\n    \"user_notes_app\": true,\r\n    \"user_notes_wishlist\": true,\r\n    \"showwishliststats\": true,\r\n    \"user_notes\": {},\r\n    \"user_notes_adapter\": \"synced_storage\",\r\n    \"replaceaccountname\": true,\r\n    \"showlanguagewarning\": true,\r\n    \"showlanguagewarninglanguage\": \"english\",\r\n    \"homepage_tab_selection\": \"remember\",\r\n    \"homepage_tab_last\": null,\r\n    \"send_age_info\": true,\r\n    \"removebroadcasts\": false,\r\n    \"mp4video\": false,\r\n    \"horizontalscrolling\": true,\r\n    \"showsupportinfo\": true,\r\n    \"showdrm\": true,\r\n    \"regional_hideworld\": false,\r\n    \"showinvnav\": true,\r\n    \"quickinv\": true,\r\n    \"quickinv_diff\": -0.01,\r\n    \"community_default_tab\": \"\",\r\n    \"showallachievements\": false,\r\n    \"showallstats\": true,\r\n    \"showachinstore\": true,\r\n    \"showcomparelinks\": false,\r\n    \"hideactivelistings\": false,\r\n    \"showlowestmarketprice\": true,\r\n    \"hidespamcomments\": false,\r\n    \"spamcommentregex\": \"[\\\\u2500-\\\\u25FF]\",\r\n    \"wlbuttoncommunityapp\": true,\r\n    \"removeguideslanguagefilter\": false,\r\n    \"disablelinkfilter\": false,\r\n    \"sortfriendsby\": \"default_ASC\",\r\n    \"sortreviewsby\": \"default_ASC\",\r\n    \"sortgroupsby\": \"default_ASC\",\r\n    \"show1clickgoo\": true,\r\n    \"show_profile_link_images\": \"gray\",\r\n    \"show_custom_themes\": true,\r\n    \"profile_steamrepcn\": true,\r\n    \"profile_steamgifts\": true,\r\n    \"profile_steamtrades\": true,\r\n    \"profile_bartervg\": true,\r\n    \"profile_steamrep\": true,\r\n    \"profile_steamdbcalc\": true,\r\n    \"profile_astats\": true,\r\n    \"profile_backpacktf\": true,\r\n    \"profile_astatsnl\": true,\r\n    \"profile_steamid\": true,\r\n    \"profile_custom_link\": [\r\n        {\r\n            \"enabled\": true,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n    \"fav_emoticons\": [],\r\n    \"group_steamgifts\": true,\r\n    \"steamcardexchange\": true,\r\n    \"purchase_dates\": true,\r\n    \"show_badge_progress\": true,\r\n    \"show_coupon\": true,\r\n    \"show_wishlist_link\": true,\r\n    \"show_wishlist_count\": true,\r\n    \"show_progressbar\": true,\r\n    \"show_backtotop\": false,\r\n\r\n    \"profile_showcase_twitch\": true,\r\n    \"profile_showcase_own_twitch\": false,\r\n    \"profile_showcase_twitch_profileonly\": false,\r\n\r\n    \"itad_import_library\": false,\r\n    \"itad_import_wishlist\": false,\r\n    \"add_to_waitlist\": false,\r\n\r\n    \"context_steam_store\": false,\r\n    \"context_steam_market\": false,\r\n    \"context_itad\": false,\r\n    \"context_bartervg\": false,\r\n    \"context_steamdb\": false,\r\n    \"context_steamdb_instant\": false,\r\n    \"context_steam_keys\": false,\r\n});\r\nSyncedStorage.persistent = [\r\n    \"user_notes\",\r\n    \"user_notes_adapter\",\r\n];\r\n\r\nexport {SyncedStorage};\r\n","import {BackgroundSimple} from \"../BackgroundSimple\";\r\nimport {ExtensionResources} from \"../ExtensionResources\";\r\nimport {Language} from \"./Language\";\r\nimport {SyncedStorage} from \"../Storage/SyncedStorage\";\r\n\r\n\r\nclass Localization {\r\n\r\n    static loadLocalization(code) {\r\n        return ExtensionResources.getJSON(`/localization/${code}.json`);\r\n    }\r\n\r\n    static init() {\r\n        if (Localization._promise) { return Localization._promise; }\r\n\r\n        let currentSteamLanguage = Language.getCurrentSteamLanguage();\r\n        const storedSteamLanguage = SyncedStorage.get(\"language\");\r\n        if (currentSteamLanguage === null) {\r\n            currentSteamLanguage = storedSteamLanguage;\r\n        } else if (currentSteamLanguage !== storedSteamLanguage) {\r\n            SyncedStorage.set(\"language\", currentSteamLanguage);\r\n            BackgroundSimple.action(\"clearpurchases\");\r\n        }\r\n\r\n        function deepAssign(target, source) {\r\n\r\n            // Object.assign() but deep-assigning objects recursively\r\n            for (const [key, val] of Object.entries(source)) {\r\n                if (typeof target[key] === \"undefined\") {\r\n                    console.warn(\"The key %s doesn't exist in the English localization file\", key);\r\n                    continue;\r\n                }\r\n                if (typeof val === \"object\") {\r\n                    deepAssign(target[key], val);\r\n                } else if (val !== \"\") {\r\n                    target[key] = val;\r\n                }\r\n            }\r\n            return target;\r\n        }\r\n\r\n        const local = Language.getLanguageCode(currentSteamLanguage);\r\n        const codes = [\"en\"];\r\n        if (local !== null && local !== \"en\") {\r\n            codes.push(local);\r\n        }\r\n        Localization._promise = Promise.all(\r\n            codes.map(lc => Localization.loadLocalization(lc))\r\n        ).then(([english, local]) => {\r\n            Localization.str = english;\r\n            if (local) {\r\n                deepAssign(Localization.str, local);\r\n            }\r\n            return Localization.str;\r\n        });\r\n        return Localization._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return Localization.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static getString(key) {\r\n\r\n        // Source: http://stackoverflow.com/a/24221895\r\n        const path = key.split(\".\").reverse();\r\n        let current = Localization.str;\r\n\r\n        while (path.length) {\r\n            if (typeof current !== \"object\") {\r\n                return null;\r\n            }\r\n            current = current[path.pop()];\r\n        }\r\n        return current;\r\n    }\r\n}\r\n\r\nLocalization._promise = null;\r\n\r\n\r\nexport {Localization};\r\n","\r\n// TODO use https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage\r\nclass LocalStorage {\r\n    static get(key, defaultValue) {\r\n        const item = localStorage.getItem(key);\r\n        if (!item) { return defaultValue; }\r\n        try {\r\n            return JSON.parse(item);\r\n        } catch (err) {\r\n            return defaultValue;\r\n        }\r\n    }\r\n\r\n    static set(key, value) {\r\n        localStorage.setItem(key, JSON.stringify(value));\r\n    }\r\n\r\n    static has(key) {\r\n        return localStorage.getItem(key) !== null;\r\n    }\r\n\r\n    static remove(key) {\r\n        localStorage.removeItem(key);\r\n    }\r\n\r\n    static keys() {\r\n        const result = [];\r\n        for (let i = localStorage.length - 1; i >= 0; --i) {\r\n            result.push(localStorage.key(i));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static clear() {\r\n        localStorage.clear();\r\n    }\r\n}\r\n\r\nexport {LocalStorage};\r\n","class Timer {\r\n\r\n    constructor(duration) {\r\n        this._promise = new Promise(resolve => {\r\n            this._id = setTimeout(() => { resolve(); }, duration);\r\n        });\r\n    }\r\n\r\n    then(onSuccess, onFail) {\r\n        if (this._promise) {\r\n            return this._promise.then(onSuccess, onFail);\r\n        }\r\n\r\n        throw new Error(\"Timer has been cleared before\");\r\n    }\r\n\r\n    clear() {\r\n        clearTimeout(this._id);\r\n        this._promise = null;\r\n    }\r\n}\r\n\r\nclass ResettableTimer {\r\n\r\n    constructor(onDone, duration) {\r\n        this.onDone = onDone;\r\n        this.duration = duration;\r\n\r\n        this.reset();\r\n    }\r\n\r\n    get running() { return this._running; }\r\n\r\n    reset() {\r\n        if (typeof this._id !== \"undefined\") {\r\n            clearTimeout(this._id);\r\n        }\r\n\r\n        this._id = setTimeout(async() => {\r\n            await this.onDone();\r\n            this._running = false;\r\n        }, this.duration);\r\n\r\n        this._running = true;\r\n    }\r\n}\r\n\r\nclass TimeUtils {\r\n\r\n    static timer(duration) {\r\n        return new Timer(duration);\r\n    }\r\n\r\n    static resettableTimer(onDone, duration) {\r\n        return new ResettableTimer(onDone, duration);\r\n    }\r\n\r\n    static now() {\r\n        return Math.trunc(Date.now() / 1000);\r\n    }\r\n}\r\n\r\nexport {TimeUtils};\r\n","\r\nclass GameId {\r\n\r\n    static parseId(id) {\r\n        if (!id) { return null; }\r\n\r\n        const intId = parseInt(id);\r\n        if (!intId) { return null; }\r\n\r\n        return intId;\r\n    }\r\n\r\n    static getAppid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const appid = _text.dataset.dsAppid;\r\n            if (appid) { return GameId.parseId(appid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        // app, market/listing\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/(?:app|market\\/listings)\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getSubid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const subid = _text.dataset.dsPackageid;\r\n            if (subid) { return GameId.parseId(subid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/sub\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getBundleid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const bundleid = _text.dataset.dsBundleid;\r\n            if (bundleid) { return GameId.parseId(bundleid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/bundle\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static trimStoreId(storeId) {\r\n        return Number(storeId.slice(storeId.indexOf(\"/\") + 1));\r\n    }\r\n\r\n    static getAppidImgSrc(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/(?:cdn\\.akamai\\.steamstatic\\.com\\/steam|steamcdn-a\\.akamaihd\\.net\\/steam|steamcommunity\\/public\\/images)\\/apps\\/(\\d+)\\//);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidUriQuery(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/appid=(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppids(text) {\r\n        const regex = /(?:store\\.steampowered|steamcommunity)\\.com\\/app\\/(\\d+)\\/?/g;\r\n        const res = [];\r\n        let m;\r\n        while ((m = regex.exec(text)) !== null) {\r\n            const id = GameId.parseId(m[1]);\r\n            if (id) {\r\n                res.push(id);\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n\r\n    static getAppidFromId(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/game_(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidFromGameCard(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/\\/gamecards\\/(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n}\r\n\r\nexport {GameId};\r\n","import {SyncedStorage} from \"./Storage/SyncedStorage\";\r\n\r\nconst PermissionOptions = Object.freeze({\r\n    \"context_steam_store\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steam_market\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_itad\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_bartervg\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steamdb\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steamdb_instant\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steam_keys\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n});\r\n\r\nclass Permissions {\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static contains(permissionList) {\r\n        return browser.permissions.contains({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static async request(permissionList) {\r\n        // Prevents requesting permissions that are not optional (contextMenus for Firefox)\r\n        if (await this.contains(permissionList)) { return true; }\r\n\r\n        return browser.permissions.request({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static remove(permissionList) {\r\n        if (permissionList.includes(\"contextMenus\")) {\r\n            browser.contextMenus.removeAll();\r\n        }\r\n        return browser.permissions.remove({\"permissions\": permissionList});\r\n    }\r\n\r\n    static async when(permission, onAdded, onRemoved) {\r\n        if (onAdded) {\r\n            if (await Permissions.contains([permission])) {\r\n                onAdded();\r\n            }\r\n\r\n            browser.permissions.onAdded.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onAdded();\r\n                }\r\n            });\r\n        }\r\n\r\n        if (onRemoved) {\r\n            browser.permissions.onRemoved.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onRemoved();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    static requestOption(option) {\r\n        return Permissions.request(PermissionOptions[option].permissions);\r\n    }\r\n\r\n    static removeOption(optionToRemove) {\r\n\r\n        // If any of the permissions is in use by another option, don't remove.\r\n        const unusedPermissions = Permissions._getUnusedPermissions(optionToRemove);\r\n        if (unusedPermissions.length === 0) {\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        return Permissions.remove(unusedPermissions);\r\n    }\r\n\r\n    static _getUnusedPermissions(option) {\r\n        const used = new Set();\r\n        for (const [key, setup] of Object.entries(PermissionOptions)) {\r\n            if (option === key || (setup.persistent && !SyncedStorage.get(key))) {\r\n                continue;\r\n            }\r\n\r\n            for (const p of setup.permissions) {\r\n                used.add(p);\r\n            }\r\n        }\r\n\r\n        const unused = new Set();\r\n        for (const p of PermissionOptions[option].permissions) {\r\n            if (!used.has(p)) {\r\n                unused.add(p);\r\n            }\r\n        }\r\n\r\n        return Array.from(unused.values());\r\n    }\r\n}\r\n\r\nexport {PermissionOptions, Permissions};\r\n","import {Info} from \"./Info\";\r\n\r\nclass Version {\r\n\r\n    constructor(major, minor = 0, patch = 0) {\r\n        console.assert([major, minor, patch].filter(Number.isInteger).length === 3, `${major}.${minor}.${patch} must be integers`);\r\n        this.major = major;\r\n        this.minor = minor;\r\n        this.patch = patch;\r\n    }\r\n\r\n    static from(version) {\r\n        if (version instanceof Version) {\r\n            return new Version(version.major, version.minor, version.patch);\r\n        }\r\n        if (typeof version == \"string\") {\r\n            return Version.fromString(version);\r\n        }\r\n        if (Array.isArray(version)) {\r\n            return Version.fromArray(version);\r\n        }\r\n        throw new Error(`Could not construct a Version from ${version}`);\r\n    }\r\n\r\n    static fromArray(version) {\r\n        return new Version(...version.map(v => parseInt(v)));\r\n    }\r\n\r\n    static fromString(version) {\r\n        return Version.fromArray(version.split(\".\"));\r\n    }\r\n\r\n    static coerce(version) {\r\n        if (version instanceof Version) {\r\n            return version;\r\n        }\r\n        return Version.from(version);\r\n    }\r\n\r\n    toString() {\r\n        return `${this.major}.${this.minor}.${this.patch}`;\r\n    }\r\n\r\n    toArray() {\r\n        return [this.major, this.minor, this.patch];\r\n    }\r\n\r\n    toJSON() {\r\n        return this.toString();\r\n    }\r\n\r\n    isCurrent() {\r\n        return this.isSameOrAfter(Info.version);\r\n    }\r\n\r\n    isSame(version) {\r\n        const _version = Version.coerce(version);\r\n        return this.major === _version.major\r\n            && this.minor === _version.minor\r\n            && this.patch === _version.patch;\r\n    }\r\n\r\n    isBefore(version) {\r\n        const _version = Version.coerce(version);\r\n        if (this.major < _version.major) { return true; }\r\n        if (this.major > _version.major) { return false; }\r\n\r\n        // this.major == _version.major\r\n        if (this.minor < _version.minor) { return true; }\r\n        if (this.minor > _version.minor) { return false; }\r\n\r\n        // this.minor == _version.minor\r\n        if (this.patch < _version.patch) { return true; }\r\n        return false;\r\n    }\r\n\r\n    isSameOrBefore(version) {\r\n        return this.isSame(version) || this.isBefore(version);\r\n    }\r\n\r\n    isAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isBefore(this);\r\n    }\r\n\r\n    isSameOrAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isSameOrBefore(this);\r\n    }\r\n}\r\n\r\nexport {Version};\r\n","import {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\n\r\nclass ProgressBar {\r\n    static create() {\r\n        if (!SyncedStorage.get(\"show_progressbar\")) { return; }\r\n\r\n        HTML.afterEnd(\"#global_actions\",\r\n            `<div class=\"es_progress__wrap\">\r\n                <div class=\"es_progress es_progress--complete\" title=\"${Localization.str.ready.ready}\">\r\n                    <div class=\"es_progress__bar\">\r\n                        <div class=\"es_progress__value\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n        ProgressBar._progress = document.querySelector(\".es_progress\");\r\n    }\r\n\r\n    static loading() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.loading);\r\n\r\n        ProgressBar.requests = {\"initiated\": 0, \"completed\": 0};\r\n        ProgressBar._progress.classList.remove(\"es_progress--complete\");\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = \"18px\";\r\n    }\r\n\r\n    static startRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.initiated++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static finishRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.completed++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static progress(value) {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        let _value = value;\r\n\r\n        if (!_value) {\r\n            if (!ProgressBar.requests) { return; }\r\n            if (ProgressBar.requests.initiated > 0) {\r\n                _value = 100 * ProgressBar.requests.completed / ProgressBar.requests.initiated;\r\n            }\r\n        }\r\n        if (_value > 100) {\r\n            _value = 100;\r\n        }\r\n\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = `${_value}px`;\r\n\r\n        if (_value >= 100) {\r\n            ProgressBar._progress.classList.add(\"es_progress--complete\");\r\n            ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.ready);\r\n            ProgressBar.requests = null;\r\n        }\r\n    }\r\n\r\n    static serverOutage() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.classList.add(\"es_progress--warning\");\r\n        ProgressBar.requests = null;\r\n\r\n        if (!ProgressBar._progress.parentElement.querySelector(\".es_progress__warning, .es_progress__error\")) {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__warning\">${Localization.str.ready.server_outage}</div>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static failed() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        const warningNode = ProgressBar._progress.parentElement.querySelector(\".es_progress__warning\");\r\n        if (warningNode) {\r\n            ProgressBar._progress.classList.remove(\"es_progress--warning\"); // Errors have higher precedence\r\n            warningNode.remove();\r\n        }\r\n        ProgressBar._progress.classList.add(\"es_progress--error\");\r\n        ProgressBar.requests = null;\r\n\r\n        const nodeError = ProgressBar._progress.parentElement.querySelector(\".es_progress__error\");\r\n        if (nodeError) {\r\n            nodeError.textContent = Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests);\r\n        } else {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__error\">${\r\n                    Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests)\r\n                }</div>`\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nProgressBar._progress = null;\r\nProgressBar._failedRequests = 0;\r\n\r\nexport {ProgressBar};\r\n","import {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {ErrorParser} from \"../../Core/Errors/ErrorParser\";\r\nimport {ProgressBar} from \"./Widgets/ProgressBar\";\r\n\r\nclass Background extends BackgroundSimple {\r\n    static async message(message) {\r\n        ProgressBar.startRequest();\r\n\r\n        let result;\r\n        try {\r\n            result = await super.message(message);\r\n            ProgressBar.finishRequest();\r\n            return result;\r\n        } catch (err) {\r\n            const errObj = ErrorParser.parse(err.message);\r\n\r\n            switch (errObj.name) {\r\n                case \"ServerOutageError\":\r\n                    ProgressBar.serverOutage();\r\n                    break;\r\n                default: {\r\n                    if (!Background._errorHandlers.some(handler => handler(errObj))) {\r\n                        ProgressBar.failed();\r\n                    }\r\n                }\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @callback registerErrorHandlerCallback\r\n     * @param {string} name - The error name\r\n     * @param {string} msg - The error message\r\n     * @returns {boolean} - Whether the error has been handled\r\n     */\r\n\r\n    /**\r\n     * @param {registerErrorHandlerCallback} handler - The callback that will (eventually) handle the error\r\n     */\r\n    static registerErrorHandler(handler) {\r\n        Background._errorHandlers.push(handler);\r\n    }\r\n}\r\nBackground._errorHandlers = [];\r\n\r\nexport {Background};\r\n","\r\n/**\r\n * Convenience class for passing errors between contexts.\r\n * Errors thrown in the context of a message callback on the background page are\r\n * {@link https://github.com/mozilla/webextension-polyfill/blob/87bdfa844da054d189ac28423cf01b64ebfe1e5b/src/browser-polyfill.js#L418\r\n *  cut down to only send the message of the error},\r\n * losing information about the type.\r\n */\r\n/* eslint-enable max-len */\r\nclass ErrorParser {\r\n\r\n    /**\r\n     * Takes an Error string and parses it by splitting it into name and message\r\n     * @param {String} errStr a string created by Error.prototype.toString\r\n     * @returns {{name: String, msg: String}} an object containing information about the error name and its message\r\n     */\r\n    static parse(errStr) {\r\n        const info = errStr.match(/(.*):\\s(.+)/);\r\n\r\n        return {\"name\": info[1] || \"\", \"msg\": info[2] || \"\"};\r\n    }\r\n}\r\n\r\nexport {ErrorParser};\r\n","import {ProgressBar} from \"./Widgets/ProgressBar\";\r\nimport {Errors} from \"../../Core/Errors/Errors\";\r\n\r\nclass RequestData {\r\n\r\n    static async getHttp(url, settings = {}, responseType = \"text\") {\r\n\r\n        let _url = url;\r\n        const _settings = {\r\n            \"method\": \"GET\",\r\n            \"credentials\": \"include\",\r\n            \"headers\": {\"origin\": window.location.origin},\r\n            \"referrer\": window.location.origin + window.location.pathname,\r\n            ...settings\r\n        };\r\n\r\n        ProgressBar.startRequest();\r\n\r\n        if (_url.startsWith(\"//\")) { // TODO remove when not needed\r\n            _url = window.location.protocol + url;\r\n            console.warn(\"Requesting URL without protocol, please update\");\r\n        }\r\n\r\n        let response;\r\n\r\n        try {\r\n            response = await RequestData._fetchFn(_url, _settings);\r\n\r\n            if (!response.ok) {\r\n                throw new Errors.HTTPError(response.status, `HTTP ${response.status} ${response.statusText} for ${response.url}`);\r\n            }\r\n        } catch (err) {\r\n            ProgressBar.failed();\r\n            throw err;\r\n        }\r\n\r\n        ProgressBar.finishRequest();\r\n\r\n        return response[responseType]();\r\n    }\r\n\r\n    static post(url, formData, settings, returnJSON) {\r\n        return RequestData.getHttp(url, Object.assign(settings || {}, {\r\n            \"method\": \"POST\",\r\n            \"body\": formData\r\n        }), returnJSON ? \"json\" : \"text\");\r\n    }\r\n\r\n    static getJson(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"json\");\r\n    }\r\n\r\n    static getBlob(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"blob\");\r\n    }\r\n}\r\n\r\n/**\r\n * In Firefox, the global fetch lies in the sandbox environment, thus we have to\r\n * access the fetch function of the content window.\r\n * See https://bugzilla.mozilla.org/show_bug.cgi?id=1579347#c5\r\n */\r\nRequestData._fetchFn\r\n    // eslint-disable-next-line no-undef\r\n    = (typeof content !== \"undefined\" && content && content.fetch) // content is only available in FF environments\r\n    || fetch.bind(window);\r\n\r\nexport {RequestData};\r\n","import {CookieStorage} from \"../../Core/Storage/CookieStorage\";\r\nimport {HTMLParser} from \"../../Core/Html/HtmlParser\";\r\nimport {Background} from \"./Background\";\r\nimport {RequestData} from \"./RequestData\";\r\n\r\nclass User {\r\n\r\n    static get storeCountry() {\r\n\r\n        const url = new URL(window.location.href);\r\n\r\n        let country;\r\n        if (url.searchParams && url.searchParams.has(\"cc\")) {\r\n            country = url.searchParams.get(\"cc\");\r\n        } else {\r\n            country = User._storeCountry;\r\n            if (!country) {\r\n                country = CookieStorage.get(\"steamCountry\");\r\n            }\r\n        }\r\n\r\n        if (!country) {\r\n            console.warn(\"Failed to detect store country, falling back to US\");\r\n            country = \"US\";\r\n        }\r\n\r\n        return country.substr(0, 2);\r\n    }\r\n\r\n    static promise() {\r\n        if (User._promise) { return User._promise; }\r\n\r\n        const avatarNode = document.querySelector(\"#global_actions > a.user_avatar\");\r\n        let loginPromise;\r\n\r\n        if (avatarNode) {\r\n            User.profileUrl = avatarNode.href;\r\n            User.profilePath = avatarNode.pathname;\r\n\r\n            loginPromise = Background.action(\"login\", User.profilePath)\r\n                .then(login => {\r\n                    if (!login) { return; }\r\n                    User.isSignedIn = true;\r\n                    User.steamId = login.steamId;\r\n                });\r\n        } else {\r\n            loginPromise = Background.action(\"logout\");\r\n        }\r\n\r\n        User._promise = loginPromise\r\n            .then(() => Background.action(\"storecountry\"))\r\n            .catch(({message}) => { console.error(message); })\r\n            .then(country => {\r\n                if (country) {\r\n                    User._storeCountry = country;\r\n                    return null;\r\n                }\r\n\r\n                let newCountry;\r\n\r\n                if (window.location.hostname.endsWith(\"steampowered.com\")) {\r\n\r\n                    // Search through all scripts in case the order gets changed or a new one gets added\r\n                    for (const script of document.getElementsByTagName(\"script\")) {\r\n                        const match = script.textContent.match(/GDynamicStore\\.Init\\(.+?, '([A-Z]{2})/);\r\n                        if (match) {\r\n                            newCountry = match[1];\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                } else if (window.location.hostname === \"steamcommunity.com\") {\r\n                    const config = document.querySelector(\"#webui_config,#application_config\");\r\n                    if (config) {\r\n                        newCountry = JSON.parse(config.dataset.config).COUNTRY;\r\n                    }\r\n                }\r\n\r\n                if (newCountry) {\r\n                    User._storeCountry = newCountry;\r\n                    return Background.action(\"storecountry\", newCountry)\r\n                        .catch(({message}) => { console.error(message); });\r\n                } else {\r\n                    throw new Error(\"Script with user store country not found\");\r\n                }\r\n\r\n            })\r\n            .catch(err => {\r\n                console.group(\"Store country detection\");\r\n                console.warn(\"Failed to detect store country from page\");\r\n                console.error(err);\r\n                console.groupEnd();\r\n            });\r\n\r\n        return User._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return User.promise().then(onDone, onCatch);\r\n    }\r\n\r\n    static get sessionId() {\r\n        if (!User._sessionId) {\r\n            User._sessionId = HTMLParser.getVariableFromDom(\"g_sessionID\", \"string\");\r\n        }\r\n        return User._sessionId;\r\n    }\r\n\r\n    static getPurchaseDate(lang, appName) {\r\n        const _appName = HTMLParser.clearSpecialSymbols(appName);\r\n        return Background.action(\"purchases\", _appName, lang);\r\n    }\r\n\r\n    /*\r\n     * Retrieve user access token to use in new style WebAPI calls (Services)\r\n     * https://github.com/Revadike/UnofficialSteamWebAPI/wiki/Get-Points-Summary-Config\r\n     */\r\n    static async getUserToken() {\r\n        // Use relative URL, so it matches domain (works on any steam domain)\r\n        const response = await RequestData.getJson(\"/pointssummary/ajaxgetasyncconfig\").catch(() => false);\r\n        if (!response || !response.success) {\r\n            throw new Error(\"Failed to get webapi token\");\r\n        }\r\n\r\n        return response.data.webapi_token;\r\n    }\r\n}\r\n\r\nexport {User};\r\n","import {Errors} from \"../../../Core/Errors/Errors\";\r\n\r\n// Polyfill from https://gist.github.com/davidbarral/d0d4da70fa9e6f615595d01f54276e0b#file-promises-js\r\nif (!Promise.allSettled) {\r\n    Promise.allSettled = promises => Promise.all(\r\n        promises.map(promise => promise\r\n            .then(value => ({\r\n                \"status\": \"fulfilled\",\r\n                value,\r\n            }))\r\n            .catch(reason => ({\r\n                \"status\": \"rejected\",\r\n                reason,\r\n            })))\r\n    );\r\n}\r\n\r\nclass FeatureManager {\r\n    static async apply(features) {\r\n\r\n        this._promisesMap = new Map();\r\n\r\n        this._stats = {\r\n            \"completed\": 0,\r\n            \"failed\": 0,\r\n            \"dependency\": 0,\r\n        };\r\n\r\n        while (features.length > 0) {\r\n\r\n            const feature = features.pop();\r\n            const promise = this._generateFeatureChain(feature);\r\n\r\n            if (promise === null) {\r\n                features.unshift(feature);\r\n            } else {\r\n                this._promisesMap.set(feature.constructor, promise);\r\n            }\r\n        }\r\n\r\n        await Promise.allSettled(Array.from(this._promisesMap.values()));\r\n\r\n        console.log(\r\n            \"Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors\",\r\n            this._stats.completed,\r\n            this._stats.failed,\r\n            this._stats.dependency\r\n        );\r\n    }\r\n\r\n    static _generateFeatureChain(feature) {\r\n\r\n        let ready = true;\r\n        let promise = Promise.resolve(true);\r\n\r\n        if (Array.isArray(feature.constructor.dependencies)) {\r\n\r\n            // Ensure that all dependencies have generated a dependency chain for themselves\r\n            for (const dep of feature.constructor.dependencies) {\r\n                if (this._promisesMap.has(dep)) { continue; }\r\n\r\n                ready = false;\r\n                break;\r\n            }\r\n\r\n            if (ready) {\r\n\r\n                // Promise that waits for all dependencies to finish executing\r\n                promise = Promise.all(\r\n                    Array.from(this._promisesMap.entries())\r\n                        .filter(([ftr]) => feature.constructor.dependencies.includes(ftr))\r\n                        .map(([, promise]) => promise)\r\n                );\r\n            }\r\n        }\r\n\r\n        if (!ready) { return null; }\r\n\r\n        return promise\r\n            .then(previousCheck => { // Check if the dependencies have all their prerequisites fulfilled\r\n                let prev = true;\r\n\r\n                if (!feature.constructor.weakDependency) {\r\n                    if (Array.isArray(previousCheck)) {\r\n                        prev = previousCheck.every(res => res);\r\n                    } else {\r\n                        prev = previousCheck;\r\n                    }\r\n                }\r\n\r\n                return prev && feature.checkPrerequisites();\r\n            })\r\n            .then(async fulfilled => { // If the feature's prerequisites are fulfilled, apply it\r\n                if (fulfilled) {\r\n                    await feature.apply();\r\n                    ++this._stats.completed;\r\n                }\r\n                return fulfilled;\r\n            })\r\n            .catch(err => {\r\n\r\n                const featureName = feature.constructor.name;\r\n\r\n                if (err instanceof Errors.FeatureDependencyError) {\r\n                    console.warn(\r\n                        \"Not applying feature %s due to an error in the dependency chain (namely %s)\",\r\n                        featureName,\r\n                        err.featureName\r\n                    );\r\n                    ++this._stats.dependency;\r\n                    throw err;\r\n                }\r\n\r\n                console.group(featureName);\r\n                console.error(\"Error while applying feature %s\", featureName);\r\n                console.error(err);\r\n                console.groupEnd();\r\n\r\n                ++this._stats.failed;\r\n                throw new Errors.FeatureDependencyError(\"Failed to apply\", featureName);\r\n            });\r\n\r\n    }\r\n}\r\n\r\nexport {FeatureManager};\r\n","\r\nexport default Object.freeze({\r\n    \"ACCOUNT\": 1,\r\n    \"APP\": 2,\r\n    \"BUNDLE\": 3,\r\n    \"STORE_DEFAULT\": 4,\r\n    \"FUNDS\": 5,\r\n    \"REGISTER_KEY\": 6,\r\n    \"SALE\": 7,\r\n    \"SEARCH\": 8,\r\n    \"STATS\": 9,\r\n    \"STORE_FRONT\": 10,\r\n    \"SUB\": 11,\r\n    \"WISHLIST\": 12,\r\n    \"AGECHECK\": 13,\r\n    \"COMMUNITY_DEFAULT\": 14,\r\n    \"WORKSHOP\": 15,\r\n    \"PROFILE_ACTIVITY\": 16,\r\n    \"GAMES\": 17,\r\n    \"PROFILE_EDIT\": 18,\r\n    \"BADGES\": 19,\r\n    \"GAME_CARD\": 20,\r\n    \"FRIENDS_THAT_PLAY\": 21,\r\n    \"FRIENDS\": 22,\r\n    \"GROUPS\": 23,\r\n    \"INVENTORY\": 24,\r\n    \"MARKET_LISTING\": 25,\r\n    \"MARKET\": 26,\r\n    \"PROFILE_HOME\": 27,\r\n    \"GROUP_HOME\": 28,\r\n    \"GUIDES\": 29,\r\n    \"COMMUNITY_APP\": 30,\r\n    \"COMMUNITY_STATS\": 31,\r\n    \"MY_WORKSHOP\": 32,\r\n    \"SHARED_FILES\": 33,\r\n    \"WORKSHOP_BROWSE\": 34,\r\n    \"EDIT_GUIDE\": 35,\r\n    \"RECOMMENDED\": 36,\r\n    \"BOOSTER_CREATOR\": 37,\r\n    \"TRADE_OFFER\": 38,\r\n});\r\n\r\n","import {GameId} from \"../../../Core/GameId\";\r\nimport {Background} from \"../Background\";\r\nimport {User} from \"../User\";\r\n\r\nclass DynamicStore {\r\n\r\n    /*\r\n     * FIXME\r\n     *  1. Check usage of `await DynamicStore`, currently it does nothing\r\n     *  2. getAppStatus() is not properly waiting for initialization of the DynamicStore\r\n     *  3. There is no guarante that `User` is initialized before `_fetch()` is called\r\n     *  4. getAppStatus() should probably be simplified if we force array even when only one storeId was requested\r\n     */\r\n\r\n    static clear() {\r\n        return Background.action(\"dynamicstore.clear\");\r\n    }\r\n\r\n    static async getAppStatus(storeId) {\r\n        const multiple = Array.isArray(storeId);\r\n        let promise;\r\n        let trimmedIds;\r\n\r\n        if (multiple) {\r\n            trimmedIds = storeId.map(id => GameId.trimStoreId(id));\r\n            promise = Background.action(\"dynamicstorestatus\", trimmedIds);\r\n        } else {\r\n            promise = Background.action(\"dynamicstorestatus\", GameId.trimStoreId(storeId));\r\n        }\r\n\r\n        let statusList;\r\n        const dsStatusList = await promise;\r\n\r\n        if (multiple) {\r\n            statusList = {};\r\n            for (let i = 0; i < storeId.length; ++i) {\r\n                const trimmedId = trimmedIds[i];\r\n                const id = storeId[i];\r\n                statusList[id] = {\r\n                    \"ignored\": dsStatusList[trimmedId].includes(\"ignored\"),\r\n                    \"wishlisted\": dsStatusList[trimmedId].includes(\"wishlisted\"),\r\n                };\r\n                if (id.startsWith(\"app/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedApps\");\r\n                } else if (id.startsWith(\"sub/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedPackages\");\r\n                }\r\n            }\r\n        } else {\r\n            statusList = {\r\n                \"ignored\": dsStatusList.includes(\"ignored\"),\r\n                \"wishlisted\": dsStatusList.includes(\"wishlisted\"),\r\n            };\r\n            if (storeId.startsWith(\"app/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedApps\");\r\n            } else if (storeId.startsWith(\"sub/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedPackages\");\r\n            }\r\n        }\r\n\r\n        return statusList;\r\n    }\r\n\r\n    static async getRandomApp() {\r\n        await DynamicStore._fetch();\r\n        return Background.action(\"dynamicStore.randomApp\");\r\n    }\r\n\r\n    static _fetch() {\r\n        if (!User.isSignedIn) {\r\n            return DynamicStore.clear();\r\n        }\r\n        return Promise.resolve(null);\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        if (!DynamicStore._promise) {\r\n            DynamicStore._promise = DynamicStore._fetch();\r\n        }\r\n        return DynamicStore._promise.then(onDone, onCatch);\r\n    }\r\n}\r\n\r\nexport {DynamicStore};\r\n","import {Background} from \"../Background\";\r\n\r\nclass Inventory {\r\n\r\n    static getCoupon(appid) {\r\n        return Background.action(\"coupon\", appid);\r\n    }\r\n\r\n    static async getAppStatus(appids, options) {\r\n\r\n        function getStatusObject(giftsAndPasses, hasCoupon) {\r\n            return {\r\n                \"gift\": giftsAndPasses.includes(\"gifts\"),\r\n                \"guestPass\": giftsAndPasses.includes(\"passes\"),\r\n                \"coupon\": Boolean(hasCoupon),\r\n            };\r\n        }\r\n\r\n        const opts = {\"giftsAndPasses\": true,\r\n            \"coupons\": true,\r\n            ...options};\r\n\r\n        if (!opts.giftsAndPasses && !opts.coupons) { return null; }\r\n\r\n        const multiple = Array.isArray(appids);\r\n\r\n        try {\r\n            const [giftsAndPasses, coupons] = await Promise.all([\r\n                opts.giftsAndPasses ? Background.action(\"hasgiftsandpasses\", appids) : Promise.resolve(),\r\n                opts.coupons ? Background.action(\"hascoupon\", appids) : Promise.resolve(),\r\n            ]);\r\n\r\n            if (multiple) {\r\n                const results = {};\r\n\r\n                for (const id of appids) {\r\n                    results[id] = getStatusObject(giftsAndPasses ? giftsAndPasses[id] : [], coupons ? coupons[id] : false);\r\n                }\r\n\r\n                return results;\r\n            }\r\n            return getStatusObject(giftsAndPasses || [], typeof coupons === \"undefined\" ? false : coupons);\r\n        } catch (err) {\r\n            if (multiple) {\r\n                const results = {};\r\n                for (const id of appids) {\r\n                    results[id] = getStatusObject([], false);\r\n                }\r\n                return results;\r\n            }\r\n\r\n            return getStatusObject([], false);\r\n        }\r\n    }\r\n\r\n    static hasInMarketInventory(marketHashes) {\r\n        return Background.action(\"hasitem\", marketHashes);\r\n    }\r\n}\r\n\r\nexport {Inventory};\r\n","\r\nclass Feature {\r\n\r\n    /**\r\n     * @param {Context} context\r\n     */\r\n    constructor(context) {\r\n        this.context = context;\r\n    }\r\n\r\n    checkPrerequisites() {\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n        throw new Error(\"Stub\");\r\n    }\r\n\r\n    logError(err, msg, ...args) {\r\n        console.group(this.constructor.name);\r\n        console.error(msg, ...args);\r\n        console.error(err);\r\n        console.groupEnd();\r\n    }\r\n}\r\n\r\nexport {Feature};\r\n","\r\nclass DOMHelper {\r\n\r\n    static wrap(container, node) {\r\n        const parent = node.parentNode;\r\n        parent.insertBefore(container, node);\r\n        parent.removeChild(node);\r\n        container.append(node);\r\n    }\r\n\r\n    static remove(selector) {\r\n        const node = document.querySelector(selector);\r\n        if (!node) { return; }\r\n        node.remove();\r\n    }\r\n\r\n    // TODO extend Node itself?\r\n    static selectLastNode(parent, selector) {\r\n        const nodes = parent.querySelectorAll(selector);\r\n        return nodes.length === 0 ? null : nodes[nodes.length - 1];\r\n    }\r\n\r\n    static insertStylesheet(href) {\r\n        const stylesheet = document.createElement(\"link\");\r\n        stylesheet.rel = \"stylesheet\";\r\n        stylesheet.type = \"text/css\";\r\n        stylesheet.href = href;\r\n        document.head.appendChild(stylesheet);\r\n    }\r\n\r\n    static insertScript({src, content}, id, onload, isAsync = true) {\r\n        const script = document.createElement(\"script\");\r\n\r\n        if (onload) { script.onload = onload; }\r\n        if (id) { script.id = id; }\r\n        if (src) { script.src = src; }\r\n        if (content) { script.textContent = content; }\r\n        script.async = isAsync;\r\n\r\n        document.head.appendChild(script);\r\n    }\r\n}\r\n\r\nexport {DOMHelper};\r\n","\r\nclass HorizontalScroller {\r\n\r\n    static create(parentNode, controlLeftNode, controlRightNode) {\r\n\r\n        let lastScroll = 0;\r\n\r\n        parentNode.addEventListener(\"wheel\", e => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            if (Date.now() - lastScroll < 200) { return; }\r\n            lastScroll = Date.now();\r\n\r\n            const isScrollDown = e.deltaY > 0;\r\n            if (isScrollDown) {\r\n                controlRightNode.click();\r\n            } else {\r\n                controlLeftNode.click();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {HorizontalScroller};\r\n","// This is the basic configuration for the Augmented Steam extension\r\n\r\nexport default {\r\n    \"ApiServerHost\": \"https://esapi.isthereanydeal.com\",\r\n    \"PublicHost\": \"https://augmentedsteam.com\",\r\n    \"ITADApiServerHost\": \"https://api.isthereanydeal.com\",\r\n    \"ITADClientId\": \"5fe78af07889f43a\"\r\n};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Language} from \"../../Core/Localization/Language\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {Background} from \"./Background\";\r\nimport {DOMHelper} from \"./DOMHelper\";\r\nimport {HorizontalScroller} from \"./Widgets/HorizontalScroller\";\r\nimport {DynamicStore} from \"./Data/DynamicStore\";\r\nimport {User} from \"./User\";\r\nimport {Page} from \"../Features/Page\";\r\nimport config from \"../../config\";\r\n\r\nclass AugmentedSteam {\r\n\r\n    static _addMenu() {\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_menu\">\r\n                <span id=\"es_pulldown\" class=\"pulldown global_action_link\">Augmented Steam</span>\r\n                <div id=\"es_popup\" class=\"popup_block_new\">\r\n                    <div class=\"popup_body popup_menu\">\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${ExtensionResources.getURL(\"html/options.html\")}\">${Localization.str.thewordoptions}</a>\r\n                        <a class=\"popup_menu_item\" id=\"es_clear_cache\" href=\"#clear_cache\">${Localization.str.clear_cache}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/tfedor/AugmentedSteam\">${Localization.str.contribute}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/tfedor/AugmentedSteam/issues\">${Localization.str.bug_feature}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${config.PublicHost}\">${Localization.str.website}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://isthereanydeal.com/\">IsThereAnyDeal</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://discord.gg/yn57q7f\">Discord</a>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_pulldown\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.showMenu(\"es_pulldown\", \"es_popup\", \"right\", \"bottom\", true);\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_menu\").addEventListener(\"click\", e => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        document.querySelector(\"#es_popup\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.hideMenu(\"es_pulldown\", \"es_popup\");\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_clear_cache\").addEventListener(\"click\", e => {\r\n            e.preventDefault();\r\n\r\n            AugmentedSteam.clearCache();\r\n            window.location.reload();\r\n        });\r\n    }\r\n\r\n    static _addBackToTop() {\r\n        if (!SyncedStorage.get(\"show_backtotop\")) { return; }\r\n\r\n        // Remove Steam's back-to-top button\r\n        DOMHelper.remove(\"#BackToTop\");\r\n\r\n        const btn = document.createElement(\"div\");\r\n        btn.classList.add(\"es_btt\");\r\n        btn.textContent = \"\";\r\n\r\n        document.body.append(btn);\r\n\r\n        btn.addEventListener(\"click\", () => {\r\n            window.scroll({\r\n                \"top\": 0,\r\n                \"left\": 0,\r\n                \"behavior\": \"smooth\"\r\n            });\r\n        });\r\n\r\n        window.addEventListener(\"scroll\", () => {\r\n            btn.classList.toggle(\"is-visible\", window.scrollY >= 400);\r\n        });\r\n    }\r\n\r\n    static _bindLogout() {\r\n\r\n        // TODO there should be a better detection of logout, probably\r\n        const logoutNode = document.querySelector(\"a[href$='javascript:Logout();']\");\r\n        logoutNode.addEventListener(\"click\", () => {\r\n            AugmentedSteam.clearCache();\r\n        });\r\n    }\r\n\r\n    static _addWarning(innerHTML, stopShowingHandler) {\r\n        const el = HTML.element(\r\n            `<div class=\"es_warn js-warn\">\r\n                <div class=\"es_warn__cnt\">\r\n                    <div>${innerHTML}</div>\r\n                    <div class=\"es_warn__control\">\r\n                        <a class=\"es_warn__btn js-warn-close\">${Localization.str.update.dont_show}</a>\r\n                        <a class=\"es_warn__btn js-warn-hide\">${Localization.str.hide}</a>\r\n                    </div>\r\n                </div>\r\n            </div>`\r\n        );\r\n\r\n        el.querySelector(\".js-warn-close\").addEventListener(\"click\", () => {\r\n            if (stopShowingHandler) {\r\n                stopShowingHandler();\r\n            }\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        el.querySelector(\".js-warn-hide\").addEventListener(\"click\", () => {\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        document.getElementById(\"global_header\").insertAdjacentElement(\"afterend\", el);\r\n    }\r\n\r\n    /**\r\n     * Display warning if browsing using a different language\r\n     */\r\n    static _addLanguageWarning() {\r\n        if (!SyncedStorage.get(\"showlanguagewarning\")) { return; }\r\n\r\n        const currentLanguage = Language.getCurrentSteamLanguage();\r\n        if (!currentLanguage) { return; }\r\n\r\n        if (!SyncedStorage.has(\"showlanguagewarninglanguage\")) {\r\n            SyncedStorage.set(\"showlanguagewarninglanguage\", currentLanguage);\r\n        }\r\n\r\n        const warningLanguage = SyncedStorage.get(\"showlanguagewarninglanguage\");\r\n\r\n        if (currentLanguage === warningLanguage) { return; }\r\n\r\n        Localization.loadLocalization(Language.getLanguageCode(warningLanguage)).then((strings) => {\r\n            AugmentedSteam._addWarning(\r\n                `${strings.using_language.replace(\"__current__\", strings.options.lang[currentLanguage] || currentLanguage)}\r\n                <a href=\"#\" id=\"es_reset_language_code\">\r\n                ${strings.using_language_return.replace(\"__base__\", strings.options.lang[warningLanguage] || warningLanguage)}\r\n                </a>`,\r\n                () => { SyncedStorage.set(\"showlanguagewarning\", false); }\r\n            );\r\n\r\n            document.querySelector(\"#es_reset_language_code\").addEventListener(\"click\", (e) => {\r\n                e.preventDefault();\r\n                // eslint-disable-next-line no-undef, new-cap\r\n                Page.runInPageContext(warningLanguage => { ChangeLanguage(warningLanguage); }, [warningLanguage]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _handleInstallSteamButton() {\r\n        const option = SyncedStorage.get(\"installsteam\");\r\n        if (option === \"hide\") {\r\n            DOMHelper.remove(\"div.header_installsteam_btn\");\r\n        } else if (option === \"replace\") {\r\n            const btn = document.querySelector(\"div.header_installsteam_btn > a\");\r\n            btn.textContent = Localization.str.viewinclient;\r\n            btn.href = `steam://openurl/${window.location.href}`;\r\n            btn.classList.add(\"es_steamclient_btn\");\r\n        }\r\n    }\r\n\r\n    static _addUsernameSubmenuLinks() {\r\n        const node = document.querySelector(\".supernav_container .submenu_username\");\r\n\r\n        HTML.afterEnd(\r\n            node.querySelector(\"a\"),\r\n            `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/games/\">${Localization.str.games}</a>`\r\n        );\r\n        HTML.afterEnd(\r\n            node.querySelector(\"a:nth-child(2)\"),\r\n            `<a class=\"submenuitem\" href=\"//store.steampowered.com/wishlist/\">${Localization.str.wishlist}</a>`\r\n        );\r\n        HTML.beforeEnd(\r\n            node,\r\n            `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/recommended/\">${Localization.str.reviews}</a>`\r\n        );\r\n    }\r\n\r\n    static _disableLinkFilter() {\r\n        if (!SyncedStorage.get(\"disablelinkfilter\")) { return; }\r\n\r\n        function removeLinkFilter(parent = document) {\r\n            const selector = \"a[href*='/linkfilter/']\";\r\n\r\n            for (const node of parent.querySelectorAll(selector)) {\r\n                node.href = node.href.replace(/^.+?\\/linkfilter\\/\\?url=/, \"\");\r\n            }\r\n        }\r\n\r\n        removeLinkFilter();\r\n\r\n        new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (node.nodeType !== Node.ELEMENT_NODE) { continue; }\r\n                    removeLinkFilter(node);\r\n                }\r\n            }\r\n        }).observe(document, {\"childList\": true, \"subtree\": true});\r\n    }\r\n\r\n    static _addRedeemLink() {\r\n        HTML.beforeBegin(\r\n            \"#account_language_pulldown\",\r\n            `<a class=\"popup_menu_item\" href=\"https://store.steampowered.com/account/registerkey\">${Localization.str.activate}</a>`\r\n        );\r\n    }\r\n\r\n    static _replaceAccountName() {\r\n        if (!SyncedStorage.get(\"replaceaccountname\")) { return; }\r\n\r\n        const logoutNode = document.querySelector(\"#account_dropdown .persona.online\");\r\n        const accountName = logoutNode.textContent.trim();\r\n        const communityName = document.querySelector(\"#account_pulldown\").textContent.trim();\r\n\r\n        logoutNode.textContent = communityName;\r\n\r\n        // Replace page header on account related pages\r\n        if (location.href.startsWith(\"https://store.steampowered.com/account\")) {\r\n            const pageHeader = document.querySelector(\"h2.pageheader\");\r\n            if (pageHeader) {\r\n                pageHeader.textContent = pageHeader.textContent.replace(new RegExp(accountName, \"i\"), communityName);\r\n            }\r\n        }\r\n\r\n        // Don't replace title on user pages that aren't mine\r\n        const isUserPage = /.*(id|profiles)\\/.+/g.test(location.pathname);\r\n        if (!isUserPage || location.pathname.includes(User.profilePath)) {\r\n            document.title = document.title.replace(accountName, communityName);\r\n        }\r\n    }\r\n\r\n    static _launchRandomButton() {\r\n\r\n        HTML.beforeEnd(\r\n            \"#es_popup .popup_menu\",\r\n            `<div class=\"hr\"></div>\r\n             <a id=\"es_random_game\" class=\"popup_menu_item\" style=\"cursor: pointer;\">${Localization.str.launch_random}</a>`\r\n        );\r\n\r\n        document.querySelector(\"#es_random_game\").addEventListener(\"click\", async() => {\r\n            const appid = await DynamicStore.getRandomApp();\r\n            if (!appid) { return; }\r\n\r\n            Background.action(\"appdetails\", appid).then(response => {\r\n                if (!response || !response.success) { return; }\r\n                const data = response.data;\r\n\r\n                let gameid = appid;\r\n                let gamename;\r\n                if (data.fullgame) {\r\n                    gameid = data.fullgame.appid;\r\n                    gamename = data.fullgame.name;\r\n                } else {\r\n                    gamename = data.name;\r\n                }\r\n\r\n                Page.runInPageContext((playGameStr, gameid, visitStore) => {\r\n                    const prompt = window.SteamFacade.showConfirmDialog(\r\n                        playGameStr,\r\n                        `<img src=\"//steamcdn-a.akamaihd.net/steam/apps/${gameid}/header.jpg\">`,\r\n                        null,\r\n                        null,\r\n                        visitStore\r\n                    );\r\n\r\n                    prompt.done(result => {\r\n                        if (result === \"OK\") { window.location.assign(`steam://run/${gameid}`); }\r\n                        if (result === \"SECONDARY\") { window.location.assign(`//store.steampowered.com/app/${gameid}`); }\r\n                    });\r\n                },\r\n                [\r\n                    Localization.str.play_game.replace(\"__gamename__\", gamename.replace(\"'\", \"\").trim()),\r\n                    gameid,\r\n                    Localization.str.visit_store,\r\n                ]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _skipGotSteam() {\r\n        if (!SyncedStorage.get(\"skip_got_steam\")) { return; }\r\n\r\n        for (const node of document.querySelectorAll(\"a[href^='javascript:ShowGotSteamModal']\")) {\r\n            node.href = node.href.split(\"'\")[1];\r\n        }\r\n    }\r\n\r\n    static _keepSteamSubscriberAgreementState() {\r\n        const nodes = document.querySelectorAll(\"#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa\");\r\n        for (const node of nodes) {\r\n            node.checked = SyncedStorage.get(\"keepssachecked\");\r\n\r\n            node.addEventListener(\"click\", () => {\r\n                SyncedStorage.set(\"keepssachecked\", !SyncedStorage.get(\"keepssachecked\"));\r\n            });\r\n        }\r\n    }\r\n\r\n    static _defaultCommunityTab() {\r\n        const tab = SyncedStorage.get(\"community_default_tab\");\r\n        if (!tab) { return; }\r\n\r\n        const links = document.querySelectorAll(\"a[href^='https://steamcommunity.com/app/']\");\r\n        for (const link of links) {\r\n            if (link.classList.contains(\"apphub_sectionTab\")) { continue; }\r\n            if (!/^\\/app\\/[0-9]+\\/?$/.test(link.pathname)) { continue; }\r\n            if (!link.pathname.endsWith(\"/\")) {\r\n                link.pathname += \"/\";\r\n            }\r\n            link.pathname += `${tab}/`;\r\n        }\r\n    }\r\n\r\n    static _horizontalScrolling() {\r\n        if (!SyncedStorage.get(\"horizontalscrolling\")) { return; }\r\n\r\n        for (const node of document.querySelectorAll(\".slider_ctn:not(.spotlight)\")) {\r\n            HorizontalScroller.create(\r\n                node.parentNode.querySelector(\"#highlight_strip, .store_horizontal_autoslider_ctn\"),\r\n                node.querySelector(\".slider_left\"),\r\n                node.querySelector(\".slider_right\"),\r\n            );\r\n        }\r\n    }\r\n\r\n    static addLoginWarning(type) {\r\n        if (AugmentedSteam._loginWarningAdded || LocalStorage.get(`hide_login_warn_${type}`)) { return; }\r\n\r\n        let host;\r\n\r\n        if (type === \"store\") {\r\n            host = \"store.steampowered.com\";\r\n        } else if (type === \"community\") {\r\n            host = \"steamcommunity.com\";\r\n        } else {\r\n            console.warn(\"Unknown login warning type %s\", type);\r\n            return;\r\n        }\r\n\r\n        AugmentedSteam._addWarning(\r\n            `${Localization.str.login_warning.replace(\"__link__\", `<a href=\"https://${host}/login/\">${host}</a>`)}`,\r\n            () => { LocalStorage.set(`hide_login_warn_${type}`, true); }\r\n        );\r\n        AugmentedSteam._loginWarningAdded = true;\r\n\r\n        console.warn(\"Are you logged into %s?\", host);\r\n    }\r\n\r\n    static clearCache() {\r\n        localStorage.clear();\r\n        SyncedStorage.remove(\"user_currency\");\r\n        SyncedStorage.remove(\"store_sessionid\");\r\n        Background.action(\"cache.clear\");\r\n    }\r\n\r\n    static init() {\r\n        AugmentedSteam._addBackToTop();\r\n        AugmentedSteam._addMenu();\r\n        AugmentedSteam._addLanguageWarning();\r\n        AugmentedSteam._handleInstallSteamButton();\r\n        AugmentedSteam._disableLinkFilter();\r\n        AugmentedSteam._skipGotSteam();\r\n        AugmentedSteam._keepSteamSubscriberAgreementState();\r\n        AugmentedSteam._defaultCommunityTab();\r\n        AugmentedSteam._horizontalScrolling();\r\n\r\n        if (User.isSignedIn) {\r\n            AugmentedSteam._addUsernameSubmenuLinks();\r\n            AugmentedSteam._addRedeemLink();\r\n            AugmentedSteam._replaceAccountName();\r\n            AugmentedSteam._launchRandomButton();\r\n            AugmentedSteam._bindLogout();\r\n        }\r\n    }\r\n}\r\n\r\nexport {AugmentedSteam};\r\n","\r\nclass StringUtils {\r\n\r\n    // https://stackoverflow.com/a/6969486/7162651\r\n    static escapeRegExp(str) {\r\n        return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\"); // $& means the whole matched string\r\n    }\r\n}\r\n\r\nexport {StringUtils};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {StringUtils} from \"../../Core/Utils/StringUtils\";\r\nimport {Background} from \"./Background\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass SteamCurrency {\r\n\r\n    /*\r\n     * Example:\r\n     * {\r\n     *  \"id\": 1,\r\n     *  \"abbr\": \"USD\",\r\n     *  \"symbol\": \"$\",\r\n     *  \"hint\": \"United States Dollars\",\r\n     *  \"multiplier\": 100,\r\n     *  \"unit\": 1,\r\n     *  \"format\": {\r\n     *      \"places\": 2,\r\n     *      \"hidePlacesWhenZero\": false,\r\n     *      \"symbolFormat\": \"$\",\r\n     *      \"thousand\": \",\",\r\n     *      \"decimal\": \".\",\r\n     *      \"right\": false\r\n     *  }\r\n     * }\r\n     */\r\n\r\n    constructor({\r\n        id,\r\n        abbr = \"USD\",\r\n        symbol = \"$\",\r\n        hint = \"Default Currency\",\r\n        multiplier = 100,\r\n        unit = 1,\r\n        \"format\": {\r\n            \"places\": formatPlaces = 2,\r\n            \"hidePlacesWhenZero\": formatHidePlaces = false,\r\n            \"symbolFormat\": formatSymbol = \"$\",\r\n            \"thousand\": formatGroupSeparator = \",\",\r\n            \"group\": formatGroupSize = 3,\r\n            \"decimal\": formatDecimalSeparator = \".\",\r\n            \"right\": formatPostfixSymbol = false,\r\n        },\r\n    }) {\r\n\r\n        // console.assert(id && Number.isInteger(id))\r\n        Object.assign(this, {\r\n            \"id\": id, // Steam Currency ID, integer, 1-41 (at time of writing)\r\n            \"abbr\": abbr, // TLA for the currency\r\n            \"symbol\": symbol, // Symbol used to represent/recognize the currency, this is NULL for CNY to avoid collision with JPY\r\n            \"hint\": hint, // English label for the currency to reduce mistakes editing the JSON\r\n            \"multiplier\": multiplier, // multiplier used by Steam when writing values\r\n            \"unit\": unit, // Minimum transactional unit required by Steam.\r\n            \"format\": {\r\n                \"decimalPlaces\": formatPlaces, // How many decimal places does this currency have?\r\n                \"hidePlacesWhenZero\": formatHidePlaces, // Does this currency show decimal places for a .0 value?\r\n                \"symbol\": formatSymbol, // Symbol used when generating a string value of this currency\r\n                \"groupSeparator\": formatGroupSeparator, // Thousands separator\r\n                \"groupSize\": formatGroupSize, // Digits to a \"thousand\" for the thousands separator\r\n                \"decimalSeparator\": formatDecimalSeparator,\r\n                \"postfix\": formatPostfixSymbol, // Should format.symbol be post-fixed?\r\n            },\r\n        });\r\n        Object.freeze(this.format);\r\n        Object.freeze(this);\r\n    }\r\n\r\n    valueOf(price) {\r\n\r\n        // remove separators\r\n        let _price = price.trim()\r\n            .replace(this.format.groupSeparator, \"\");\r\n        if (this.format.decimalSeparator !== \".\") {\r\n            _price = _price.replace(this.format.decimalSeparator, \".\");\r\n        } // as expected by parseFloat()\r\n        _price = _price.replace(/[^\\d.]/g, \"\");\r\n\r\n        const value = parseFloat(_price);\r\n\r\n        if (Number.isNaN(value)) { return null; }\r\n        return value; // this.multiplier?\r\n    }\r\n\r\n    stringify(value, withSymbol = true) {\r\n        const sign = value < 0 ? \"-\" : \"\";\r\n        const _value = Math.abs(value);\r\n\r\n        let s = _value.toFixed(this.format.decimalPlaces),\r\n            decimals;\r\n\r\n        [s, decimals] = s.split(\".\");\r\n\r\n        const g = [];\r\n        let j = s.length;\r\n\r\n        for (; j > this.format.groupSize; j -= this.format.groupSize) {\r\n            g.unshift(s.substring(j - this.format.groupSize, j));\r\n        }\r\n        g.unshift(s.substring(0, j));\r\n        s = [sign, g.join(this.format.groupSeparator)];\r\n        if (this.format.decimalPlaces > 0) {\r\n            if (!this.format.hidePlacesWhenZero || parseInt(decimals) > 0) {\r\n                s.push(this.format.decimalSeparator);\r\n                s.push(decimals);\r\n            }\r\n        }\r\n        if (withSymbol) {\r\n            if (this.format.postfix) {\r\n                s.push(this.format.symbol);\r\n            } else {\r\n                s.unshift(this.format.symbol);\r\n            }\r\n        }\r\n        return s.join(\"\");\r\n    }\r\n\r\n    placeholder() {\r\n        let str = `1${this.format.groupSeparator}`;\r\n        let cur = 2;\r\n        for (let i = 0; i < this.format.groupSize; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n\r\n        if (this.format.decimalPlaces === 0) {\r\n            return str;\r\n        }\r\n\r\n        str += this.format.decimalSeparator;\r\n        for (let i = 0; i < this.format.decimalPlaces; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n        return str;\r\n    }\r\n\r\n    regExp() {\r\n        let regex = `^(?:\\\\d{1,${\r\n            this.format.groupSize\r\n        }}(?:${\r\n            StringUtils.escapeRegExp(this.format.groupSeparator)\r\n        }\\\\d{${\r\n            this.format.groupSize\r\n        }})+|\\\\d*)`;\r\n\r\n        if (this.format.decimalPlaces > 0) {\r\n            regex += `(?:${StringUtils.escapeRegExp(this.format.decimalSeparator)}\\\\d{0,${this.format.decimalPlaces}})?`;\r\n        }\r\n        regex += \"$\";\r\n\r\n        return new RegExp(regex);\r\n    }\r\n}\r\n\r\nclass CurrencyManager {\r\n\r\n    static _getCurrencyFromDom() {\r\n        const currencyNode = document.querySelector('meta[itemprop=\"priceCurrency\"]');\r\n        if (currencyNode && currencyNode.hasAttribute(\"content\")) {\r\n            return currencyNode.getAttribute(\"content\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getCurrencyFromWallet() {\r\n        const walletCurrency = await Page.runInPageContext(\r\n            // eslint-disable-next-line no-undef, camelcase\r\n            () => (typeof g_rgWalletInfo !== \"undefined\" && g_rgWalletInfo ? g_rgWalletInfo.wallet_currency : null),\r\n            null,\r\n            \"walletCurrency\"\r\n        );\r\n\r\n        if (walletCurrency) {\r\n            return CurrencyManager.currencyNumberToType(walletCurrency);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getStoreCurrency(context) {\r\n        let currency = CurrencyManager._getCurrencyFromDom();\r\n\r\n        if (!currency) {\r\n            currency = await CurrencyManager._getCurrencyFromWallet(context);\r\n        }\r\n\r\n        if (!currency) {\r\n            try {\r\n                currency = await Background.action(\"currency\");\r\n            } catch (error) {\r\n                console.error(`Couldn't load currency${error}`);\r\n            }\r\n        }\r\n\r\n        if (!currency) {\r\n            currency = \"USD\"; // fallback\r\n        }\r\n\r\n        return currency;\r\n    }\r\n\r\n    static getRate(from, to) {\r\n        if (from === to) { return 1; }\r\n\r\n        if (CurrencyManager._rates[from] && CurrencyManager._rates[from][to]) {\r\n            return CurrencyManager._rates[from][to];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getCurrencySymbolFromString(str) {\r\n        const re = /(?:R\\$|S\\$|\\$|RM|kr|Rp|||||p|P|||TL||Mex\\$|CDN\\$|A\\$|HK\\$|NT\\$||SR|R |DH|CHF|CLP\\$|S\\/\\.|COL\\$|NZ\\$|ARS\\$||||KD|z|QR|\\$U)/;\r\n        const match = str.match(re);\r\n        return match ? match[0] : \"\";\r\n    }\r\n\r\n    static currencyTypeToNumber(type) {\r\n        return CurrencyManager.fromType(type).id;\r\n    }\r\n\r\n    static currencyNumberToType(number) {\r\n        return CurrencyManager.fromNumber(number).abbr;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromType(type) {\r\n        return CurrencyManager._indices.abbr[type] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromNumber(number) {\r\n        return CurrencyManager._indices.id[number] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    static async _loadCurrency(context) {\r\n        CurrencyManager.storeCurrency = await CurrencyManager._getStoreCurrency(context);\r\n        const currencySetting = SyncedStorage.get(\"override_price\");\r\n        CurrencyManager.customCurrency = (currencySetting === \"auto\")\r\n            ? CurrencyManager.storeCurrency\r\n            : currencySetting;\r\n    }\r\n\r\n    static async _loadRates() {\r\n        const toCurrencies = [CurrencyManager.storeCurrency];\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            toCurrencies.push(CurrencyManager.customCurrency);\r\n        }\r\n        CurrencyManager._rates = await Background.action(\"rates\", toCurrencies);\r\n    }\r\n\r\n    static async init(context) {\r\n        if (CurrencyManager._isInitialized) { return; }\r\n\r\n        const currencies = await Background.action(\"steam.currencies\");\r\n\r\n        for (let currency of currencies) {\r\n\r\n            currency = new SteamCurrency(currency);\r\n            CurrencyManager._indices.abbr[currency.abbr] = currency;\r\n            CurrencyManager._indices.id[currency.id] = currency;\r\n\r\n            if (currency.symbol) { // CNY && JPY use the same symbol\r\n                CurrencyManager._indices.symbols[currency.symbol] = currency;\r\n            }\r\n        }\r\n        CurrencyManager._defaultCurrency = CurrencyManager._indices.id[1]; // USD\r\n\r\n        try {\r\n            await CurrencyManager._loadCurrency(context);\r\n            await CurrencyManager._loadRates();\r\n        } catch (e) {\r\n            console.error(\"Failed to initialize Currency\");\r\n            console.error(e);\r\n        }\r\n\r\n        CurrencyManager._isInitialized = true;\r\n    }\r\n\r\n    static then(onSuccess, onFailure) {\r\n        return CurrencyManager.init().then(onSuccess, onFailure);\r\n    }\r\n}\r\nCurrencyManager._isInitialized = false;\r\nCurrencyManager._indices = {\r\n    \"id\": {},\r\n    \"abbr\": {},\r\n    \"symbols\": {},\r\n};\r\n\r\nexport {CurrencyManager};\r\n","import {GameId} from \"../../Core/GameId\";\r\nimport {HTML} from \"../../Core/Html/Html\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Language} from \"../../Core/Localization/Language\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Background} from \"./Background\";\r\nimport {DOMHelper} from \"./DOMHelper\";\r\n\r\nclass EarlyAccess {\r\n\r\n    static async getEaNodes(nodes, selectorModifier) {\r\n\r\n        const appidsMap = new Map();\r\n\r\n        for (const node of nodes) {\r\n            node.classList.add(\"es_ea_checked\");\r\n\r\n            const linkNode = node.querySelector(\"a\");\r\n            const href = linkNode && linkNode.hasAttribute(\"href\") ? linkNode.getAttribute(\"href\") : node.getAttribute(\"href\");\r\n            const imgHeader = node.querySelector(`img${selectorModifier}`);\r\n            const appid = GameId.getAppid(href) || GameId.getAppidImgSrc(imgHeader ? imgHeader.getAttribute(\"src\") : null);\r\n\r\n            if (appid) {\r\n                appidsMap.set(String(appid), node);\r\n            }\r\n        }\r\n\r\n        const eaStatus = await Background.action(\"isea\", Array.from(appidsMap.keys()));\r\n\r\n        for (const appid of appidsMap.keys()) {\r\n            if (!eaStatus[appid]) {\r\n                appidsMap.delete(appid);\r\n            }\r\n        }\r\n\r\n        return Array.from(appidsMap.values());\r\n    }\r\n\r\n    static async _checkNodes(selectors, selectorModifier) {\r\n        const _selectorModifier = typeof selectorModifier === \"string\" ? selectorModifier : \"\";\r\n        const selector = selectors.map(selector => `${selector}:not(.es_ea_checked)`).join(\",\");\r\n\r\n        for (const node of await EarlyAccess.getEaNodes(document.querySelectorAll(selector), _selectorModifier)) {\r\n            node.classList.add(\"es_early_access\");\r\n\r\n            const imgHeader = node.querySelector(`img${_selectorModifier}`);\r\n            const container = document.createElement(\"span\");\r\n            container.classList.add(\"es_overlay_container\");\r\n            DOMHelper.wrap(container, imgHeader);\r\n\r\n            HTML.afterBegin(\r\n                container,\r\n                `<span class=\"es_overlay\"><img title=\"${Localization.str.early_access}\" src=\"${EarlyAccess._imageUrl}\"></span>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static _handleStore() {\r\n\r\n        // TODO refactor these checks to appropriate page calls\r\n        switch (true) {\r\n            case /^\\/app\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".game_header_image_ctn\", \".small_cap\"]);\r\n                break;\r\n            case /^\\/(?:genre|browse|tag)\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".tab_item\",\r\n                    \".special_tiny_cap\",\r\n                    \".cluster_capsule\",\r\n                    \".game_capsule\",\r\n                    \".browse_tag_game\",\r\n                    \".dq_item:not(:first-child)\",\r\n                    \".discovery_queue:not(:first-child)\"]);\r\n                break;\r\n            case /^\\/search\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".search_result_row\"]);\r\n                break;\r\n            case /^\\/recommended/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".friendplaytime_appheader\",\r\n                    \".header_image\",\r\n                    \".appheader\",\r\n                    \".recommendation_carousel_item .carousel_cap\",\r\n                    \".game_capsule\",\r\n                    \".game_capsule_area\",\r\n                    \".similar_grid_capsule\"]);\r\n                break;\r\n            case /^\\/tag\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".cluster_capsule\",\r\n                    \".tab_row\",\r\n                    \".browse_tag_game_cap\"]);\r\n                break;\r\n            case /^\\/(?:curator|developer|dlc|publisher)\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\"#curator_avatar_image\",\r\n                    \".capsule\"]);\r\n                break;\r\n            case /^\\/$/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".cap\",\r\n                    \".special\",\r\n                    \".game_capsule\",\r\n                    \".cluster_capsule\",\r\n                    \".recommended_spotlight_ctn\",\r\n                    \".curated_app_link\",\r\n                    \".dailydeal_ctn a\",\r\n                    \".tab_item:last-of-type\",\r\n\r\n                    // Sales fields\r\n                    \".large_sale_caps a\",\r\n                    \".small_sale_caps a\",\r\n                    \".spotlight_img\"]);\r\n                break;\r\n\r\n            // EarlyAccess._checkNodes($(\".sale_capsule_image\").parent()); // TODO check/remove\r\n        }\r\n    }\r\n\r\n    static _handleCommunity() {\r\n\r\n        // TODO refactor these checks to appropriate page calls\r\n        switch (true) {\r\n            case /^\\/(?:id|profiles)\\/.+\\/(wishlist|games|followedgames)/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".gameListRowLogo\"]);\r\n                break;\r\n            case /^\\/(?:id|profiles)\\/.+\\/\\b(home|myactivity)\\b/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".blotter_gamepurchase_content a\"]);\r\n                break;\r\n            case /^\\/(?:id|profiles)\\/.+\\/\\b(reviews|recommended)\\b/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".leftcol\"]);\r\n                break;\r\n            case /^\\/(?:id|profiles)\\/.+/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".game_info_cap\",\r\n                    \".showcase_gamecollector_game\",\r\n                    \".favoritegame_showcase_game\"]);\r\n        }\r\n    }\r\n\r\n    static showEarlyAccess() {\r\n        if (!SyncedStorage.get(\"show_early_access\")) { return; }\r\n\r\n        let imageName = \"img/overlay/early_access_banner_english.png\";\r\n        if (Language.isCurrentLanguageOneOf([\r\n            \"brazilian\",\r\n            \"french\",\r\n            \"italian\",\r\n            \"japanese\",\r\n            \"koreana\",\r\n            \"polish\",\r\n            \"portuguese\",\r\n            \"russian\",\r\n            \"schinese\",\r\n            \"spanish\",\r\n            \"latam\",\r\n            \"tchinese\",\r\n            \"thai\"\r\n        ])) {\r\n            imageName = `img/overlay/early_access_banner_${Language.getCurrentSteamLanguage()}.png`;\r\n        }\r\n        EarlyAccess._imageUrl = ExtensionResources.getURL(imageName);\r\n\r\n        switch (window.location.host) {\r\n            case \"store.steampowered.com\":\r\n                EarlyAccess._handleStore();\r\n                break;\r\n            case \"steamcommunity.com\":\r\n                EarlyAccess._handleCommunity();\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\nexport {EarlyAccess};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {TimeUtils} from \"../../modulesCore\";\r\n\r\nclass ITAD {\r\n    static async create() {\r\n        if (!await Background.action(\"itad.isconnected\")) { return; }\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_itad\">\r\n                <img id=\"es_itad_logo\" src=\"${ExtensionResources.getURL(\"img/itad.png\")}\">\r\n                <span id=\"es_itad_status\"></span>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_itad\").addEventListener(\"mouseenter\", ITAD.onHover);\r\n\r\n        if (User.isSignedIn && (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\"))) {\r\n            Background.action(\"itad.import\");\r\n        }\r\n    }\r\n\r\n    static async onHover() {\r\n\r\n        async function updateLastImport() {\r\n            const {from, to} = await Background.action(\"itad.lastimport\");\r\n\r\n            let htmlStr\r\n                = `<div>${Localization.str.itad.from}</div>\r\n                   <div>${from ? new Date(from * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n\r\n            if (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\")) {\r\n                htmlStr\r\n                    += `<div>${Localization.str.itad.to}</div>\r\n                        <div>${to ? new Date(to * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n            }\r\n\r\n            HTML.inner(\".es-itad-hover__last-import\", htmlStr);\r\n        }\r\n\r\n        if (!document.querySelector(\".es-itad-hover\")) {\r\n            HTML.afterEnd(\"#es_itad_status\",\r\n                `<div class=\"es-itad-hover\">\r\n                    <div class=\"es-itad-hover__content\">\r\n                        <h4>${Localization.str.itad.last_import}</h4>\r\n                        <div class=\"es-itad-hover__last-import\"></div>\r\n                        <div class=\"es-itad-hover__sync-now\">\r\n                            <span class=\"es-itad-hover__sync-now-text\">${Localization.str.itad.sync_now}</span>\r\n                            <div class=\"loader\"></div>\r\n                            <span class=\"es-itad-hover__sync-failed\">&#10060;</span>\r\n                            <span class=\"es-itad-hover__sync-success\">&#10003;</span>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"es-itad-hover__arrow\"></div>\r\n                </div>`);\r\n\r\n            const hover = document.querySelector(\".es-itad-hover\");\r\n\r\n            const syncDiv = document.querySelector(\".es-itad-hover__sync-now\");\r\n            document.querySelector(\".es-itad-hover__sync-now-text\").addEventListener(\"click\", async() => {\r\n                syncDiv.classList.remove(\"es-itad-hover__sync-now--failed\", \"es-itad-hover__sync-now--success\");\r\n                syncDiv.classList.add(\"es-itad-hover__sync-now--loading\");\r\n                hover.style.display = \"block\";\r\n\r\n                let timeout;\r\n\r\n                try {\r\n                    await Background.action(\"itad.sync\");\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--success\");\r\n                    await updateLastImport();\r\n\r\n                    timeout = 1000;\r\n                } catch (err) {\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--failed\");\r\n\r\n                    console.group(\"ITAD sync\");\r\n                    console.error(\"Failed to sync with ITAD\");\r\n                    console.error(err);\r\n                    console.groupEnd();\r\n\r\n                    timeout = 3000;\r\n                } finally {\r\n                    TimeUtils.timer(timeout).then(() => { hover.style.display = \"\"; });\r\n                    syncDiv.classList.remove(\"es-itad-hover__sync-now--loading\");\r\n                }\r\n            });\r\n        }\r\n\r\n        await updateLastImport();\r\n    }\r\n\r\n    static async getAppStatus(storeIds, options) {\r\n        const opts = {\"waitlist\": true,\r\n            \"collection\": true,\r\n            ...options};\r\n\r\n        if (!opts.collection && !opts.waitlist) { return null; }\r\n\r\n        const multiple = Array.isArray(storeIds);\r\n        const promises = [];\r\n        const resolved = Promise.resolve(multiple ? {} : false);\r\n\r\n        if (await Background.action(\"itad.isconnected\")) {\r\n            if (opts.collection) {\r\n                promises.push(Background.action(\"itad.incollection\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n            if (opts.waitlist) {\r\n                promises.push(Background.action(\"itad.inwaitlist\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n        } else {\r\n            promises.push(resolved, resolved);\r\n        }\r\n\r\n        const [inCollection, inWaitlist] = await Promise.all(promises);\r\n\r\n        if (multiple) {\r\n            const result = {};\r\n            for (const id of storeIds) {\r\n                result[id] = {\r\n                    \"collected\": inCollection[id],\r\n                    \"waitlisted\": inWaitlist[id],\r\n                };\r\n            }\r\n            return result;\r\n        } else {\r\n            return {\r\n                \"collected\": inCollection,\r\n                \"waitlisted\": inWaitlist,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport {ITAD};\r\n","\r\n/**\r\n * NOTE FOR ADDON REVIEWER:\r\n * This class is meant to simplify communication between extension context and page context.\r\n * Basically, we have wrapped postMessage API in this class.\r\n */\r\nclass Messenger {\r\n    static postMessage(msgID, info) {\r\n        window.postMessage({\r\n            \"type\": `es_${msgID}`,\r\n            \"information\": info\r\n        }, window.location.origin);\r\n    }\r\n\r\n    // Used for one-time events\r\n    static onMessage(msgID) {\r\n        return new Promise(resolve => {\r\n            function callback(e) {\r\n                if (e.source !== window) { return; }\r\n                if (!e.data || !e.data.type) { return; }\r\n                if (e.data.type === `es_${msgID}`) {\r\n                    resolve(e.data.information);\r\n                    window.removeEventListener(\"message\", callback);\r\n                }\r\n            }\r\n            window.addEventListener(\"message\", callback);\r\n        });\r\n    }\r\n\r\n    // Used for setting up a listener that should be able to receive more than one callback\r\n    static addMessageListener(msgID, callback) {\r\n        window.addEventListener(\"message\", e => {\r\n            if (e.source !== window) { return; }\r\n            if (!e.data || !e.data.type) { return; }\r\n            if (e.data.type === `es_${msgID}`) {\r\n                callback(e.data.information);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Messenger};\r\n","import {CurrencyManager} from \"./CurrencyManager\";\r\n\r\nclass Price {\r\n\r\n    constructor(value = 0, currency = CurrencyManager.storeCurrency) {\r\n        this.value = value;\r\n        this.currency = currency;\r\n        Object.freeze(this);\r\n    }\r\n\r\n    formattedValue() {\r\n        return CurrencyManager.fromType(this.currency).stringify(this.value, false);\r\n    }\r\n\r\n    toString() {\r\n        return CurrencyManager.fromType(this.currency).stringify(this.value);\r\n    }\r\n\r\n    /*\r\n     * Not currently in use\r\n     * totalValue = totalValue.add(somePrice)\r\n     */\r\n    add(otherPrice) {\r\n        let _otherPrice = otherPrice;\r\n        if (otherPrice.currency !== this.currency) {\r\n            _otherPrice = otherPrice.inCurrency(this.currency);\r\n        }\r\n        return new Price(this.value + _otherPrice.value, this.currency);\r\n    }\r\n\r\n    inCurrency(desiredCurrency) {\r\n        if (this.currency === desiredCurrency) {\r\n            return new Price(this.value, this.currency);\r\n        }\r\n        const rate = CurrencyManager.getRate(this.currency, desiredCurrency);\r\n        if (!rate) {\r\n            throw new Error(`Could not establish conversion rate between ${this.currency} and ${desiredCurrency}`);\r\n        }\r\n        return new Price(this.value * rate, desiredCurrency);\r\n    }\r\n\r\n    static parseFromString(str, currencyType = CurrencyManager.storeCurrency) {\r\n        const currency = CurrencyManager.fromType(currencyType);\r\n        let value = currency.valueOf(str);\r\n        if (value !== null) {\r\n            value = new Price(value, currencyType);\r\n        }\r\n        return value;\r\n    }\r\n}\r\n\r\nexport {Price};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {HTML} from \"../../Core/Html/Html\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {Price} from \"./Price\";\r\nimport {CurrencyManager} from \"./CurrencyManager\";\r\n\r\nclass Prices {\r\n\r\n    constructor() {\r\n        this.appids = [];\r\n        this.subids = [];\r\n        this.bundleids = [];\r\n\r\n        this.priceCallback = null;\r\n        this.bundleCallback = null;\r\n\r\n        this._bundles = [];\r\n    }\r\n\r\n    _getApiParams() {\r\n        const apiParams = {};\r\n\r\n        if (!SyncedStorage.get(\"showallstores\") && SyncedStorage.get(\"stores\").length > 0) {\r\n            apiParams.stores = SyncedStorage.get(\"stores\").join(\",\");\r\n        }\r\n\r\n        const cc = User.storeCountry;\r\n        if (cc) {\r\n            apiParams.cc = cc;\r\n        }\r\n\r\n        apiParams.appids = this.appids.join(\",\");\r\n        apiParams.subids = this.subids.join(\",\");\r\n        apiParams.bundleids = this.bundleids.join(\",\");\r\n\r\n        if (SyncedStorage.get(\"showlowestpricecoupon\")) {\r\n            apiParams.coupon = true;\r\n        }\r\n\r\n        if (!apiParams.appids && !apiParams.subids && !apiParams.bundleids) { return null; }\r\n\r\n        return apiParams;\r\n    }\r\n\r\n    /**\r\n     * @param priceData\r\n     * @param {Price} price\r\n     * @param {string} pricingStr\r\n     */\r\n    _getPricingStrings(priceData, price, pricingStr) {\r\n        let prices = price.toString();\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            const priceAlt = price.inCurrency(CurrencyManager.storeCurrency);\r\n            prices += ` (${priceAlt.toString()})`;\r\n        }\r\n        const pricesStr = `<span class=\"itad-pricing__price\">${prices}</span>`;\r\n\r\n        let cutStr = \"\";\r\n        if (priceData.cut > 0) {\r\n            cutStr = `<span class=\"itad-pricing__cut\">-${priceData.cut}%</span> `;\r\n        }\r\n\r\n        const storeStr = pricingStr.store.replace(\"__store__\", priceData.store);\r\n        return [pricesStr, cutStr, storeStr];\r\n    }\r\n\r\n    _processPrices(gameid, meta, info) {\r\n        if (!this.priceCallback) { return; }\r\n\r\n        const [type, id] = gameid.split(\"/\");\r\n\r\n        const node = document.createElement(\"div\");\r\n        node.classList.add(\"itad-pricing\");\r\n        node.id = `es_price_${id}`;\r\n\r\n        const pricingStr = Localization.str.pricing;\r\n\r\n        let hasData = false;\r\n        const priceData = info.price;\r\n        const lowestData = info.lowest;\r\n        const bundledCount = info.bundles.count;\r\n        const urlData = info.urls;\r\n\r\n        // Current best\r\n        if (priceData) {\r\n            hasData = true;\r\n\r\n            let lowest;\r\n            let voucherStr = \"\";\r\n            if (SyncedStorage.get(\"showlowestpricecoupon\") && priceData.price_voucher) {\r\n                lowest = new Price(priceData.price_voucher, meta.currency);\r\n\r\n                const voucher = HTML.escape(priceData.voucher);\r\n                voucherStr = `${pricingStr.with_voucher.replace(\r\n                    \"__voucher__\",\r\n                    `<span class=\"itad-pricing__voucher\">${voucher}</span>`\r\n                )} `;\r\n            } else {\r\n                lowest = new Price(priceData.price, meta.currency);\r\n            }\r\n\r\n            lowest = lowest.inCurrency(CurrencyManager.customCurrency);\r\n            const [pricesStr, cutStr, storeStr] = this._getPricingStrings(priceData, lowest, pricingStr);\r\n\r\n            let drmStr = \"\";\r\n            if (priceData.drm.length > 0 && priceData.store !== \"Steam\") {\r\n                drmStr = `<span class=\"itad-pricing__drm\">(${priceData.drm[0]})</span>`;\r\n            }\r\n\r\n            const infoUrl = HTML.escape(urlData.info);\r\n            const storeUrl = HTML.escape(priceData.url.toString());\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${infoUrl}\" target=\"_blank\">${pricingStr.lowest_price}</a>`);\r\n            HTML.beforeEnd(node, pricesStr);\r\n            HTML.beforeEnd(\r\n                node,\r\n                `<a href=\"${storeUrl}\" class=\"itad-pricing__main\" target=\"_blank\">${cutStr}${voucherStr}${storeStr} ${drmStr}</a>`\r\n            );\r\n        }\r\n\r\n        // Historical low\r\n        if (lowestData) {\r\n            hasData = true;\r\n\r\n            const historical = new Price(lowestData.price, meta.currency).inCurrency(CurrencyManager.customCurrency);\r\n            const [pricesStr, cutStr, storeStr] = this._getPricingStrings(lowestData, historical, pricingStr);\r\n            const dateStr = new Date(lowestData.recorded * 1000).toLocaleDateString();\r\n\r\n            const infoUrl = HTML.escape(urlData.history);\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${infoUrl}\" target=\"_blank\">${pricingStr.historical_low}</a>`);\r\n            HTML.beforeEnd(node, pricesStr);\r\n            HTML.beforeEnd(node, `<div class=\"itad-pricing__main\">${cutStr}${storeStr} ${dateStr}</div>`);\r\n        }\r\n\r\n        // times bundled\r\n        if (bundledCount > 0) {\r\n            hasData = true;\r\n\r\n            const bundledUrl = HTML.escape(urlData.bundles || urlData.bundle_history);\r\n            const bundledStr = pricingStr.bundle_count.replace(\"__count__\", bundledCount);\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${bundledUrl}\" target=\"_blank\">${pricingStr.bundled}</a>`);\r\n            HTML.beforeEnd(node, `<div class=\"itad-pricing__bundled\">${bundledStr}</div>`);\r\n        }\r\n\r\n        if (hasData) {\r\n            this.priceCallback(type, id, node);\r\n        }\r\n    }\r\n\r\n    _processBundles(meta, info) {\r\n        if (!this.bundleCallback) { return; }\r\n\r\n        let purchase = \"\";\r\n\r\n        for (const bundle of info.bundles.live) {\r\n            const tiers = bundle.tiers;\r\n\r\n            let endDate;\r\n            if (bundle.expiry) {\r\n                endDate = new Date(bundle.expiry * 1000);\r\n            }\r\n\r\n            const currentDate = new Date().getTime();\r\n            if (endDate && currentDate > endDate) { continue; }\r\n\r\n            const bundleNormalized = JSON.stringify({\r\n                \"page\":  bundle.page || \"\",\r\n                \"title\": bundle.title || \"\",\r\n                \"url\":   bundle.url || \"\",\r\n                \"tiers\": (() => {\r\n                    const sorted = [];\r\n                    for (const t of Object.keys(tiers)) {\r\n                        sorted.push((tiers[t].games || []).sort());\r\n                    }\r\n                    return sorted;\r\n                })(),\r\n            });\r\n\r\n            if (this._bundles.indexOf(bundleNormalized) >= 0) { continue; }\r\n            this._bundles.push(bundleNormalized);\r\n\r\n            if (bundle.page) {\r\n                const bundlePage = Localization.str.buy_package.replace(\"__package__\", `${bundle.page} ${bundle.title}`);\r\n                purchase\r\n                    += `<div class=\"game_area_purchase_game\">\r\n                            <div class=\"game_area_purchase_platform\"></div>\r\n                            <h1>${bundlePage}</h1>`;\r\n            } else {\r\n                const bundleTitle = Localization.str.buy_package.replace(\"__package__\", bundle.title);\r\n                purchase\r\n                    += `<div class=\"game_area_purchase_game_wrapper\">\r\n                            <div class=\"game_area_purchase_game\"></div>\r\n                            <div class=\"game_area_purchase_platform\"></div>\r\n                            <h1>${bundleTitle}</h1>`;\r\n            }\r\n\r\n            if (endDate) {\r\n                purchase += `<p class=\"game_purchase_discount_countdown\">${Localization.str.bundle.offer_ends} ${endDate}</p>`;\r\n            }\r\n\r\n            purchase += '<p class=\"package_contents\">';\r\n\r\n            let bundlePrice;\r\n            const appName = document.querySelector(\".apphub_AppName\").textContent;\r\n\r\n            for (let i = 0; i < tiers.length; ++i) {\r\n                const tierNum = i + 1;\r\n                const tier = tiers[i];\r\n\r\n                purchase += \"<b>\";\r\n                if (tiers.length > 1) {\r\n                    const tierName = tier.note || Localization.str.bundle.tier.replace(\"__num__\", tierNum);\r\n                    const tierPrice = (new Price(tier.price, meta.currency).inCurrency(CurrencyManager.customCurrency))\r\n                        .toString();\r\n\r\n                    purchase += Localization.str.bundle.tier_includes.replace(\"__tier__\", tierName).replace(\"__price__\", tierPrice)\r\n                        .replace(\"__num__\", tier.games.length);\r\n                } else {\r\n                    purchase += Localization.str.bundle.includes.replace(\"__num__\", tier.games.length);\r\n                }\r\n                purchase += \":</b> \";\r\n\r\n                const gameList = tier.games.join(\", \");\r\n                if (gameList.includes(appName)) {\r\n                    purchase += gameList.replace(appName, `<u>${appName}</u>`);\r\n                    bundlePrice = tier.price;\r\n                } else {\r\n                    purchase += gameList;\r\n                }\r\n\r\n                purchase += \"<br>\";\r\n            }\r\n\r\n            purchase += \"</p>\";\r\n            purchase += `<div class=\"game_purchase_action\">\r\n                            <div class=\"game_purchase_action_bg\">\r\n                                <div class=\"btn_addtocart btn_packageinfo\">\r\n                                    <a class=\"btn_blue_steamui btn_medium\" href=\"${bundle.details}\" target=\"_blank\">\r\n                                        <span>${Localization.str.bundle.info}</span>\r\n                                    </a>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"game_purchase_action_bg\">`;\r\n\r\n            if (bundlePrice && bundlePrice > 0) {\r\n                bundlePrice = (new Price(bundlePrice, meta.currency).inCurrency(CurrencyManager.customCurrency))\r\n                    .toString();\r\n                purchase += `<div class=\"game_purchase_price price\" itemprop=\"price\">${bundlePrice}</div>`;\r\n            }\r\n\r\n            purchase += `<div class=\"btn_addtocart\">\r\n                            <a class=\"btn_green_steamui btn_medium\" href=\"${bundle.url}\" target=\"_blank\">\r\n                                <span>${Localization.str.buy}</span>\r\n                            </a>\r\n                        </div></div></div></div>`;\r\n        }\r\n\r\n        if (purchase) {\r\n            this.bundleCallback(purchase);\r\n        }\r\n    }\r\n\r\n    load() {\r\n        const apiParams = this._getApiParams();\r\n        if (!apiParams) { return; }\r\n\r\n        Background.action(\"prices\", apiParams).then(response => {\r\n            const meta = response[\".meta\"];\r\n\r\n            for (const [gameid, info] of Object.entries(response.data)) {\r\n                this._processPrices(gameid, meta, info);\r\n                this._processBundles(meta, info);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Prices};\r\n","import {SyncedStorage} from \"./Core/Storage/SyncedStorage\";\r\n\r\n/*\r\n * Shim for Promise.finally() for browsers (Waterfox/FF 56) that don't have it\r\n * https://github.com/domenic/promises-unwrapping/issues/18#issuecomment-57801572\r\n */\r\nif (typeof Promise.prototype.finally === \"undefined\") {\r\n    // eslint-disable-next-line no-extend-native\r\n    Object.defineProperty(Promise.prototype, \"finally\", {\r\n        \"value\": function(callback) {\r\n            const constructor = this.constructor;\r\n            return this.then((value) => {\r\n                return constructor.resolve(callback()).then(() => {\r\n                    return value;\r\n                });\r\n            }, (reason) => {\r\n                return constructor.resolve(callback()).then(() => {\r\n                    console.error(reason);\r\n                    throw reason;\r\n                });\r\n            });\r\n        },\r\n    });\r\n}\r\n\r\nlet initialized = false;\r\n\r\n/**\r\n * DOMPurify setup\r\n * @see https://github.com/cure53/DOMPurify\r\n */\r\nexport default function() {\r\n\r\n    if (initialized) { return; }\r\n    initialized = true;\r\n\r\n    const allowOpenInNewTab = SyncedStorage.get(\"openinnewtab\");\r\n\r\n    /*\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * We are modifying default DOMPurify settings to allow other protocols in URLs\r\n     * and to allow links to safely open in new tabs.\r\n     *\r\n     * We took the original Regex and aded chrome-extension://, moz-extension:// and steam://\r\n     * First two are needed for linking local resources from extension,\r\n     * steam:// protocol is used by Steam store to open their own client (e.g. when you want to launch a game).\r\n     *\r\n     * The addition of the `target` attribute to the allowed attributes is done in order to be able to open links in a new tab.\r\n     * We only allow target=\"_blank\" while adding rel=\"noreferrer noopener\" to prevent child window to access window.opener\r\n     * as described in https://www.jitbit.com/alexblog/256-targetblank---the-most-underestimated-vulnerability-ever/\r\n     */\r\n\r\n    const purifyConfig = {\r\n        \"ALLOWED_URI_REGEXP\": /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\\-:]|$))/i\r\n    };\r\n\r\n    if (allowOpenInNewTab) {\r\n        purifyConfig.ADD_ATTR = [\"target\"];\r\n\r\n        DOMPurify.addHook(\"uponSanitizeAttribute\", (node, data) => {\r\n            if (data.attrName === \"target\") {\r\n                if (data.attrValue === \"_blank\") {\r\n                    node.setAttribute(\"rel\", \"noreferrer noopener\");\r\n                } else {\r\n                    data.keepAttr = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    DOMPurify.setConfig(purifyConfig);\r\n}\r\n","import {Info, Localization, SyncedStorage} from \"../../modulesCore\";\r\nimport {\r\n    AugmentedSteam, Background,\r\n    CurrencyManager,\r\n    DOMHelper,\r\n    EarlyAccess,\r\n    ITAD, Messenger, ProgressBar,\r\n    Sortbox,\r\n    UpdateHandler,\r\n    User\r\n} from \"../modulesContent\";\r\nimport {SteamFacade} from \"../Modules/SteamFacade\";\r\nimport setup from \"../../setup\";\r\nimport config from \"../../config\";\r\n\r\n/**\r\n * Event handler for uncaught Background errors\r\n */\r\nfunction unhandledrejection(ev) {\r\n    const err = ev.reason;\r\n    if (!err || !err.error) { return; } // Not a background error\r\n    ev.preventDefault();\r\n    ev.stopPropagation();\r\n    console.group(\"An error occurred in the background context.\");\r\n    console.error(err.localStack);\r\n    console.error(err.stack);\r\n    console.groupEnd();\r\n}\r\nwindow.addEventListener(\"unhandledrejection\", unhandledrejection);\r\n\r\n/**\r\n *  Inject the Messenger, SteamFacade class into the DOM, providing the same interface for the page context side\r\n */\r\nDOMHelper.insertScript({\"content\": `window.Messenger = ${Messenger.toString()}`});\r\nDOMHelper.insertScript({\"content\": `window.SteamFacade = ${SteamFacade.toString()}`});\r\n\r\nBackground.registerErrorHandler(({name, msg}) => {\r\n    if (name !== \"LoginError\") { return false; }\r\n\r\n    AugmentedSteam.addLoginWarning(msg);\r\n    ProgressBar.finishRequest();\r\n    return true;\r\n});\r\n\r\nclass Page {\r\n\r\n    /*\r\n     * NOTE: use cautiously!\r\n     * Run script in the context of the current tab\r\n     */\r\n    static runInPageContext(fun, args, withPromise) {\r\n        const script = document.createElement(\"script\");\r\n        let promise;\r\n        const argsString = Array.isArray(args) ? JSON.stringify(args) : \"[]\";\r\n\r\n        if (withPromise) {\r\n            const msgId = `msg_${++Page._msgCounter}`;\r\n            promise = Messenger.onMessage(msgId);\r\n            script.textContent = `(async () => { Messenger.postMessage(\"${msgId}\", await (${fun})(...${argsString})); })();`;\r\n        } else {\r\n            script.textContent = `(${fun})(...${argsString});`;\r\n        }\r\n\r\n        document.documentElement.appendChild(script);\r\n        script.parentNode.removeChild(script);\r\n        return promise;\r\n    }\r\n\r\n    async run(ContextClass) {\r\n        if (!document.getElementById(\"global_header\")) { return; }\r\n\r\n        try {\r\n            // TODO What errors can be \"suppressed\" here?\r\n            try {\r\n                await SyncedStorage;\r\n                setup();\r\n            } catch (err) {\r\n                console.error(err);\r\n            }\r\n\r\n            await Promise.all([Localization, User, CurrencyManager]);\r\n        } catch (err) {\r\n            console.group(\"Augmented Steam initialization\");\r\n            console.error(\"Failed to initiliaze Augmented Steam\");\r\n            console.error(err);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        console.log(\r\n            `%c Augmented %cSteam v${Info.version} %c ${config.PublicHost}`,\r\n            \"background: #000000; color: #046eb2\",\r\n            \"background: #000000; color: #ffffff\",\r\n            \"\",\r\n        );\r\n\r\n        ProgressBar.create();\r\n        ProgressBar.loading();\r\n        AugmentedSteam.init();\r\n        UpdateHandler.checkVersion(AugmentedSteam.clearCache);\r\n        EarlyAccess.showEarlyAccess();\r\n        ITAD.create();\r\n        Sortbox.init();\r\n        this._pageSpecificFeatures();\r\n\r\n        const context = new ContextClass();\r\n        context.applyFeatures();\r\n    }\r\n\r\n    _pageSpecificFeatures() {\r\n        // left for overrides\r\n    }\r\n}\r\nPage._msgCounter = 0;\r\n\r\nexport {Page};\r\n","\r\n/* eslint-disable no-undef,new-cap */\r\n\r\n// noinspection JSUnresolvedFunction,JSUnresolvedVariable\r\nclass SteamFacade {\r\n\r\n    // variables\r\n\r\n    static global(name) {\r\n        return window[name];\r\n    }\r\n\r\n    static globalSet(name, value) {\r\n        window[name] = value;\r\n    }\r\n\r\n    // dialogs\r\n\r\n    static showDialog(strTitle, strDescription, rgModalParams) {\r\n        ShowDialog(strTitle, strDescription, rgModalParams);\r\n    }\r\n\r\n    static showConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton) {\r\n        return ShowConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton);\r\n    }\r\n\r\n    static showAlertDialog(strTitle, strDescription, strOKButton) {\r\n        return ShowAlertDialog(strTitle, strDescription, strOKButton);\r\n    }\r\n\r\n    static showBlockingWaitDialog(strTitle, strDescription) {\r\n        return ShowBlockingWaitDialog(strTitle, strDescription);\r\n    }\r\n\r\n    static showNicknameModal() {\r\n        return ShowNicknameModal();\r\n    }\r\n\r\n    static dismissActiveModal() {\r\n        CModal.DismissActiveModal();\r\n    }\r\n\r\n    // menu\r\n\r\n    static showMenu(elemLink, elemPopup, align, valign, bLinkHasBorder) {\r\n        return ShowMenu(elemLink, elemPopup, align, valign, bLinkHasBorder);\r\n    }\r\n\r\n    static hideMenu(elemLink, elemPopup) {\r\n        return HideMenu(elemLink, elemPopup);\r\n    }\r\n\r\n    // app pages\r\n\r\n    static collapseLongStrings(selector) {\r\n        return CollapseLongStrings(selector);\r\n    }\r\n\r\n    // events\r\n\r\n    static bindAutoFlyoutEvents() {\r\n        return BindAutoFlyoutEvents();\r\n    }\r\n\r\n    // dynamic store\r\n\r\n    static dynamicStoreInvalidateCache() {\r\n        return GDynamicStore.InvalidateCache();\r\n    }\r\n\r\n    static dynamicStoreDecorateItems(selector, bForceRecalculate) {\r\n        return GDynamicStore.DecorateDynamicItems($J(selector), bForceRecalculate);\r\n    }\r\n\r\n    static onDynamicStoreReady(callback) {\r\n        return GDynamicStore.OnReady(callback);\r\n    }\r\n\r\n    static storeItemDataBindHover(selector, unAppID, unPackageID, unBundleID, rgAdditionalParams) {\r\n        GStoreItemData.BindHoverEvents($J(selector), unAppID, unPackageID, unBundleID, rgAdditionalParams);\r\n    }\r\n\r\n    // tooltips\r\n\r\n    static vTooltip(selector, isHtml = false) {\r\n        const isStore = window.location.host === \"store.steampowered.com\";\r\n\r\n        $J(selector).v_tooltip({\r\n            \"tooltipClass\": isStore ? \"store_tooltip\" : \"community_tooltip\",\r\n            \"dataName\": isHtml ? \"tooltipHtml\" : \"tooltipText\",\r\n            \"defaultType\": isHtml ? \"html\" : \"text\",\r\n            \"replaceExisting\": false\r\n        });\r\n    }\r\n\r\n    // market\r\n\r\n    static calculateFeeAmount(amount, publisherFee) {\r\n        return CalculateFeeAmount(amount, publisherFee);\r\n    }\r\n\r\n    static vCurrencyFormat(amount, currencyCode) {\r\n        return v_currencyformat(amount, currencyCode);\r\n    }\r\n\r\n    // friends\r\n\r\n    static toggleManageFriends() {\r\n        return ToggleManageFriends();\r\n    }\r\n\r\n    static openFriendChatInWebChat(chatId) {\r\n        return OpenFriendChatInWebChat(chatId);\r\n    }\r\n\r\n    // community\r\n\r\n    static submitGuide() {\r\n        return SubmitGuide();\r\n    }\r\n\r\n    static initMiniprofileHovers() {\r\n        return InitMiniprofileHovers();\r\n    }\r\n\r\n    static inviteUserToGroup(Modal, groupID, steamIDInvitee) {\r\n        return InviteUserToGroup(Modal, groupID, steamIDInvitee);\r\n    }\r\n\r\n    static getCheckedAccounts(selector) {\r\n        return GetCheckedAccounts(selector);\r\n    }\r\n\r\n    static execFriendAction(action, navid) {\r\n        return ExecFriendAction(action, navid);\r\n    }\r\n\r\n    static scrollOffsetForceRecalc() {\r\n        CScrollOffsetWatcher.ForceRecalc();\r\n    }\r\n\r\n    // inventory\r\n\r\n    static firstPage() {\r\n        return InventoryFirstPage();\r\n    }\r\n\r\n    static lastPage() {\r\n        return InventoryLastPage();\r\n    }\r\n\r\n    static goToPage() {\r\n        return InventoryGoToPage();\r\n    }\r\n\r\n    static reloadCommunityInventory() {\r\n        return ReloadCommunityInventory();\r\n    }\r\n\r\n    static getMarketHashName(itemDesc) {\r\n        return GetMarketHashName(itemDesc);\r\n    }\r\n\r\n    static zoomYear() {\r\n        pricehistory_zoomDays(g_plotPriceHistory, g_timePriceHistoryEarliest, g_timePriceHistoryLatest, 365);\r\n    }\r\n\r\n    static zoomYearForSellDialog() {\r\n        pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory, SellItemDialog.m_timePriceHistoryEarliest, SellItemDialog.m_timePriceHistoryLatest, 365);\r\n    }\r\n      \r\n    // selections\r\n\r\n    static updateSelection() {\r\n        return UpdateSelection();\r\n    }\r\n\r\n    static selectAll() {\r\n        return selectAll();\r\n    }\r\n\r\n    static selectNone() {\r\n        return selectNone();\r\n    }\r\n\r\n    static selectInverse() {\r\n        return selectInverse();\r\n    }\r\n\r\n\r\n    // jQuery functions\r\n\r\n    static jq(selector) {\r\n        return $J(selector);\r\n    }\r\n\r\n    static jqOnClick(selector, callback) {\r\n        $J(selector).on(\"click\", callback);\r\n    }\r\n\r\n    static jqAjax(settings) {\r\n        return $J.ajax(settings);\r\n    }\r\n\r\n    static jqGet(url, settings) {\r\n        return $J.get(url, settings);\r\n    }\r\n\r\n    static jqPost(url, settings) {\r\n        return $J.post(url, settings);\r\n    }\r\n}\r\n\r\nexport {SteamFacade};\r\n","import {Version} from \"../../Core/Version\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Info} from \"../../Core/Info\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {Background} from \"./Background\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {ITAD} from \"./ITAD\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass UpdateHandler {\r\n\r\n    static checkVersion(onUpdate) {\r\n        const lastVersion = Version.fromString(SyncedStorage.get(\"version\"));\r\n        const currentVersion = Version.fromString(Info.version);\r\n\r\n        if (currentVersion.isAfter(lastVersion)) {\r\n            if (SyncedStorage.get(\"version_show\")) {\r\n                this._showChangelog();\r\n            }\r\n            this._migrateSettings(lastVersion);\r\n            onUpdate();\r\n        }\r\n\r\n        SyncedStorage.set(\"version\", Info.version);\r\n    }\r\n\r\n    static async _showChangelog() {\r\n\r\n        const changelog = await ExtensionResources.getJSON(\"changelog.json\");\r\n        const html = changelog[Info.version];\r\n        if (!html) { return; }\r\n\r\n        const logo = ExtensionResources.getURL(\"img/logo/as128.png\");\r\n        const dialog = `<div class=\"es_changelog\"><img src=\"${logo}\"><div>${html}</div></div>`;\r\n\r\n        const connectBtn = document.querySelector(\"#itad_connect\");\r\n        function itadConnected() { connectBtn.replaceWith(\"\"); }\r\n\r\n        Page.runInPageContext(\r\n            (updatedStr, dialog) => {\r\n                window.SteamFacade.showAlertDialog(updatedStr, dialog);\r\n            },\r\n            [Localization.str.update.updated.replace(\"__version__\", Info.version), dialog]\r\n        );\r\n\r\n        if (Version.fromString(Info.version).isSame(new Version(1, 4))) {\r\n\r\n            if (await BackgroundSimple.action(\"itad.isconnected\")) {\r\n                itadConnected();\r\n            } else {\r\n                connectBtn.addEventListener(\"click\", async() => {\r\n                    await BackgroundSimple.action(\"itad.authorize\");\r\n                    ITAD.create();\r\n                    itadConnected();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    static _migrateSettings(oldVersion) {\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.3.1\")) {\r\n            BackgroundSimple.action(\"cache.clear\");\r\n\r\n            SyncedStorage.set(\"horizontalscrolling\", SyncedStorage.get(\"horizontalmediascrolling\"));\r\n            SyncedStorage.remove(\"horizontalmediascrolling\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4\")) {\r\n            SyncedStorage.remove(\"show_sysreqcheck\");\r\n        }\r\n\r\n        if (oldVersion.isSame(\"1.4\")) {\r\n            Background.action(\"migrate.notesToSyncedStorage\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.1\")) {\r\n            SyncedStorage.set(\"profile_steamid\", SyncedStorage.get(\"profile_permalink\"));\r\n            SyncedStorage.remove(\"profile_permalink\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.3\")) {\r\n            SyncedStorage.remove(\"contscroll\");\r\n            Background.action(\"logout\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.7\")) {\r\n            const emoticons = LocalStorage.get(\"fav_emoticons\");\r\n            if (Array.isArray(emoticons)) {\r\n                SyncedStorage.set(\"fav_emoticons\", emoticons);\r\n            }\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.0\")) {\r\n            SyncedStorage.remove(\"showfakeccwarning\");\r\n            SyncedStorage.remove(\"hideaboutlinks\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.1\")) {\r\n            SyncedStorage.remove(\"hide_dlcunownedgames\");\r\n            SyncedStorage.remove(\"hide_wishlist\");\r\n            SyncedStorage.remove(\"hide_cart\");\r\n            SyncedStorage.remove(\"hide_notdiscounted\");\r\n            SyncedStorage.remove(\"hide_mixed\");\r\n            SyncedStorage.remove(\"hide_negative\");\r\n            SyncedStorage.remove(\"hide_priceabove\");\r\n            SyncedStorage.remove(\"priceabove_value\");\r\n            SyncedStorage.remove(\"hide_owned\");\r\n            SyncedStorage.remove(\"hide_ignored\");\r\n            SyncedStorage.remove(\"highlight_notdiscounted\");\r\n\r\n            SyncedStorage.remove(\"showallfriendsthatown\");\r\n\r\n            if (SyncedStorage.has(\"showusernotes\")) {\r\n                const val = SyncedStorage.get(\"showusernotes\");\r\n                SyncedStorage.set(\"user_notes_app\", val);\r\n                SyncedStorage.set(\"user_notes_wishlist\", val);\r\n                SyncedStorage.remove(\"showusernotes\");\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {UpdateHandler};\r\n","\r\n// Most of the code here comes from dselect.js\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\n\r\nclass Sortbox {\r\n\r\n    static init() {\r\n        this._activeDropLists = {};\r\n        this._lastSelectHideTime = 0;\r\n\r\n        document.addEventListener(\"mousedown\", e => this._handleMouseClick(e));\r\n    }\r\n\r\n    static _handleMouseClick(e) {\r\n        for (const key of Object.keys(this._activeDropLists)) {\r\n            if (!this._activeDropLists[key]) { continue; }\r\n\r\n            const ulAboveEvent = e.target.closest(\"ul\");\r\n\r\n            if (ulAboveEvent && ulAboveEvent.id === `${key}_droplist`) { continue; }\r\n\r\n            this._hide(key);\r\n        }\r\n    }\r\n\r\n    static _highlightItem(id, index, bSetSelected) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n        const rgItems = droplist.getElementsByTagName(\"a\");\r\n\r\n        if (index >= 0 && index < rgItems.length) {\r\n            const item = rgItems[index];\r\n\r\n            if (typeof trigger.highlightedItem !== \"undefined\" && trigger.highlightedItem !== index) {\r\n                rgItems[trigger.highlightedItem].className = \"inactive_selection\";\r\n            }\r\n\r\n            trigger.highlightedItem = index;\r\n            rgItems[index].className = \"highlighted_selection\";\r\n\r\n            let yOffset = rgItems[index].offsetTop + rgItems[index].clientHeight;\r\n            let curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n            let bScrolledDown = false;\r\n            const nMaxLoopIterations = rgItems.length;\r\n            let nLoopCounter = 0;\r\n\r\n            while (curVisibleOffset < yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                droplist.scrollTop += rgItems[index].clientHeight;\r\n                curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n                bScrolledDown = true;\r\n            }\r\n\r\n            if (!bScrolledDown) {\r\n                nLoopCounter = 0;\r\n                yOffset = rgItems[index].offsetTop;\r\n                curVisibleOffset = droplist.scrollTop;\r\n                while (curVisibleOffset > yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                    droplist.scrollTop -= rgItems[index].clientHeight;\r\n                    curVisibleOffset = droplist.scrollTop;\r\n                }\r\n            }\r\n\r\n            if (bSetSelected) {\r\n                HTML.inner(trigger, item.innerHTML);\r\n                const input = document.querySelector(`#${id}`);\r\n                input.value = item.id;\r\n                input.dispatchEvent(new Event(\"change\"));\r\n\r\n                this._hide(id);\r\n            }\r\n        }\r\n    }\r\n\r\n    static _onFocus(id) {\r\n        this._activeDropLists[id] = true;\r\n    }\r\n\r\n    static _onBlur(id) {\r\n        if (!this._classCheck(document.querySelector(`#${id}_trigger`), \"activetrigger\")) { this._activeDropLists[id] = false; }\r\n    }\r\n\r\n    static _hide(id) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        const d = new Date();\r\n        this._lastSelectHideTime = d.valueOf();\r\n\r\n        trigger.className = \"trigger\";\r\n        droplist.className = \"dropdownhidden\";\r\n        this._activeDropLists[id] = false;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _show(id) {\r\n        const d = new Date();\r\n        if (d - this._lastSelectHideTime < 50) { return; }\r\n\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        trigger.className = \"activetrigger\";\r\n        droplist.className = \"dropdownvisible\";\r\n        this._activeDropLists[id] = true;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _onTriggerClick(id) {\r\n        if (!this._classCheck(document.querySelector(`#${id}_trigger`), \"activetrigger\")) {\r\n            this._show(id);\r\n        }\r\n    }\r\n\r\n    static _classCheck(element, className) {\r\n        return new RegExp(`\\\\b${className}\\\\b`).test(element.className);\r\n    }\r\n\r\n    /**\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * Elements returned by this function are already sanitized (calls to HTML class),\r\n     * so they can be safely inserted without being sanitized again.\r\n     * If we would sanitize them again, all event listeners would be lost due to\r\n     * DOMPurify only returning HTML strings.\r\n     */\r\n    static get(name, options, initialOption, changeFn, storageOption) {\r\n\r\n        const id = `sort_by_${name}`;\r\n        let reversed = initialOption.endsWith(\"_DESC\");\r\n\r\n        const arrowDown = \"\";\r\n        const arrowUp = \"\";\r\n\r\n        const box = HTML.element(\r\n            `<div class=\"es-sortbox es-sortbox--${name}\">\r\n                <div class=\"es-sortbox__label\">${Localization.str.sort_by}</div>\r\n                <div class=\"es-sortbox__container\">\r\n                    <input id=\"${id}\" type=\"hidden\" name=\"${name}\" value=\"${initialOption}\">\r\n                    <a class=\"trigger\" id=\"${id}_trigger\"></a>\r\n                    <div class=\"es-dropdown\">\r\n                        <ul id=\"${id}_droplist\" class=\"es-dropdown__list dropdownhidden\"></ul>\r\n                    </div>\r\n                </div>\r\n                <span class=\"es-sortbox__reverse\">${arrowDown}</span>\r\n            </div>`\r\n        );\r\n\r\n        const input = box.querySelector(`#${id}`);\r\n\r\n        function getTrimmedValue(val) { return val.replace(/(_ASC|_DESC)$/, \"\"); }\r\n\r\n        function onChange(val, reversed) {\r\n            const _val = getTrimmedValue(val);\r\n            changeFn(_val, reversed);\r\n            if (storageOption) { SyncedStorage.set(storageOption, `${_val}_${reversed ? \"DESC\" : \"ASC\"}`); }\r\n        }\r\n\r\n        input.addEventListener(\"change\", () => { onChange(input.value.replace(`${id}_`, \"\"), reversed); });\r\n\r\n        // Trigger changeFn for initial option\r\n        if (initialOption !== \"default_ASC\") {\r\n            input.dispatchEvent(new Event(\"change\"));\r\n        }\r\n\r\n        const reverseEl = box.querySelector(\".es-sortbox__reverse\");\r\n        reverseEl.addEventListener(\"click\", () => {\r\n            reversed = !reversed;\r\n            reverseEl.textContent = reversed ? arrowUp : arrowDown;\r\n            onChange(input.value.replace(`${id}_`, \"\"), reversed);\r\n        });\r\n        if (reversed) { reverseEl.textContent = arrowUp; }\r\n\r\n        const trigger = box.querySelector(`#${id}_trigger`);\r\n        trigger.addEventListener(\"focus\", () => this._onFocus(id));\r\n        trigger.addEventListener(\"blur\", () => this._onBlur(id));\r\n        trigger.addEventListener(\"click\", () => this._onTriggerClick(id));\r\n\r\n        const ul = box.querySelector(\"ul\");\r\n        const trimmedOption = getTrimmedValue(initialOption);\r\n        for (let i = 0; i < options.length; ++i) {\r\n            const [key, text] = options[i];\r\n\r\n            let toggle = \"inactive\";\r\n            if (key === trimmedOption) {\r\n                box.querySelector(`#${id}`).value = key;\r\n                box.querySelector(\".trigger\").textContent = text;\r\n                toggle = \"highlighted\";\r\n            }\r\n\r\n            HTML.beforeEnd(ul,\r\n                `<li>\r\n                    <a class=\"${toggle}_selection\" tabindex=\"99999\" id=\"${id}_${key}\">${text}</a>\r\n                </li>`);\r\n\r\n            const a = ul.querySelector(\"li:last-child > a\");\r\n\r\n            // a.href = \"javascript:DSelectNoop()\";\r\n            a.addEventListener(\"mouseover\", () => this._highlightItem(id, i, false));\r\n            a.addEventListener(\"click\", () => this._highlightItem(id, i, true));\r\n        }\r\n\r\n        return box;\r\n    }\r\n}\r\n\r\nexport {Sortbox};\r\n","import {HTML, LocalStorage, Localization, TimeUtils} from \"../../../modulesCore\";\r\nimport {Feature} from \"../../modulesContent\";\r\n\r\nexport default class FMediaExpander extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        this._details = document.querySelector(\"#game_highlights .rightcol, .workshop_item_header .col_right\");\r\n        return this._details !== null;\r\n    }\r\n\r\n    apply() {\r\n        HTML.beforeEnd(\"#highlight_player_area\",\r\n            `<div class=\"es_slider_toggle btnv6_blue_hoverfade btn_medium\">\r\n                <div data-tooltip-text=\"${Localization.str.expand_slider}\" class=\"es_slider_expand\"><i class=\"es_slider_toggle_icon\"></i></div>\r\n                <div data-tooltip-text=\"${Localization.str.contract_slider}\" class=\"es_slider_contract\"><i class=\"es_slider_toggle_icon\"></i></div>\r\n            </div>`);\r\n\r\n        const expandSlider = LocalStorage.get(\"expand_slider\", false);\r\n        if (expandSlider) {\r\n            this._buildSideDetails();\r\n\r\n            for (const node of document.querySelectorAll(\r\n                \".es_slider_toggle, #game_highlights, .workshop_item_header, .es_side_details, .es_side_details_wrap\"\r\n            )) {\r\n                node.classList.add(\"es_expanded\");\r\n            }\r\n            for (const node of document.querySelectorAll(\".es_side_details_wrap, .es_side_details\")) {\r\n\r\n                // shrunk => expanded\r\n                node.style.display = null;\r\n                node.style.opacity = 1;\r\n            }\r\n\r\n            // Triggers the adjustment of the slider scroll bar\r\n            TimeUtils.timer(250).then(() => {\r\n                window.dispatchEvent(new Event(\"resize\"));\r\n            });\r\n        }\r\n\r\n        const sliderToggle = document.querySelector(\".es_slider_toggle\");\r\n\r\n        sliderToggle.addEventListener(\"click\", (e) => { this._clickSliderToggle(e); });\r\n\r\n        /*\r\n         * Prevent the slider toggle from overlapping a sketchfab model's \"X\"\r\n         * Example: https://steamcommunity.com/sharedfiles/filedetails/?id=606009216\r\n         */\r\n        const sketchfabNode = document.querySelector(\".highlight_sketchfab_model\");\r\n        if (sketchfabNode) {\r\n            const container = document.getElementById(\"highlight_player_area\");\r\n            container.addEventListener(\"mouseenter\", () => {\r\n                if (sketchfabNode.style.display === \"none\") { return; }\r\n                sliderToggle.style.top = \"32px\";\r\n            });\r\n            container.addEventListener(\"mouseleave\", () => {\r\n                sliderToggle.style.top = null;\r\n            });\r\n        }\r\n    }\r\n\r\n    _buildSideDetails() {\r\n        if (this._detailsBuilt) { return; }\r\n        this._detailsBuilt = true;\r\n\r\n        const details = this._details;\r\n\r\n        if (details.matches(\".rightcol\")) {\r\n\r\n            // Clone details on a store page\r\n            let detailsClone = details.querySelector(\".glance_ctn\");\r\n            if (!detailsClone) { return; }\r\n            detailsClone = detailsClone.cloneNode(true);\r\n            detailsClone.classList.add(\"es_side_details\", \"block\", \"responsive_apppage_details_left\");\r\n\r\n            for (const node of detailsClone.querySelectorAll(\".app_tag.add_button, .glance_tags_ctn.your_tags_ctn\")) {\r\n\r\n                // There are some issues with having duplicates of these on page when trying to add tags\r\n                node.remove();\r\n            }\r\n\r\n            const detailsWrap = HTML.wrap(detailsClone, '<div class=\"es_side_details_wrap\"></div>');\r\n            const target = document.querySelector(\"div.rightcol.game_meta_data\");\r\n            if (target) {\r\n                target.insertAdjacentElement(\"afterbegin\", detailsWrap);\r\n            }\r\n        } else {\r\n\r\n            // Clone details in the workshop\r\n            const detailsClone = details.cloneNode(true);\r\n            detailsClone.classList.add(\"panel\", \"es_side_details\");\r\n            HTML.afterBegin(detailsClone, `<div class=\"title\">${Localization.str.details}</div><div class=\"hr padded\"></div>`);\r\n            let target = document.querySelector(\".sidebar\");\r\n            if (target) {\r\n                target.insertAdjacentElement(\"afterbegin\", detailsClone);\r\n            }\r\n\r\n            // Sometimes for a split second the slider pushes the details down, this fixes it\r\n            target = document.querySelector(\".highlight_ctn\");\r\n            if (target) {\r\n                HTML.wrap(target, '<div class=\"leftcol\"></div>');\r\n            }\r\n        }\r\n    }\r\n\r\n    _clickSliderToggle(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const el = e.target.closest(\".es_slider_toggle\");\r\n        this._buildSideDetails();\r\n\r\n        // Fade In/Out sideDetails\r\n        const sideDetails = document.querySelector(\".es_side_details_wrap, .es_side_details\");\r\n        if (sideDetails) {\r\n            if (el.classList.contains(\"es_expanded\")) {\r\n\r\n                // expanded => shrunk\r\n                sideDetails.style.opacity = 0;\r\n\r\n                TimeUtils.timer(250).then(() => {\r\n                    // Hide after transition completes\r\n                    if (!el.classList.contains(\"es_expanded\")) {\r\n                        sideDetails.style.display = \"none\";\r\n                    }\r\n                });\r\n            } else {\r\n\r\n                // shrunk => expanded\r\n                sideDetails.style.display = null;\r\n                sideDetails.style.opacity = 1;\r\n            }\r\n        }\r\n\r\n        // On every animation/transition end check the slider state\r\n        document.querySelector(\".highlight_ctn\").addEventListener(\"transitionend\", () => {\r\n\r\n            // Save slider state\r\n            LocalStorage.set(\"expand_slider\", el.classList.contains(\"es_expanded\"));\r\n            const details = this._details;\r\n\r\n            // If slider was contracted show the extended details\r\n            if (!el.classList.contains(\"es_expanded\")) {\r\n                details.style.transition = \"\";\r\n                details.style.opacity = \"0\";\r\n                details.style.transition = \"opacity 250ms\";\r\n                details.style.display = null;\r\n                details.style.opacity = \"1\";\r\n            }\r\n\r\n            TimeUtils.timer(250).then(() => {\r\n                // Triggers the adjustment of the slider scroll bar\r\n                window.dispatchEvent(new Event(\"resize\"));\r\n            });\r\n        });\r\n\r\n        for (const node of document.querySelectorAll(\r\n            \".es_slider_toggle, #game_highlights, .workshop_item_header, .es_side_details, .es_side_details_wrap\"\r\n        )) {\r\n            node.classList.toggle(\"es_expanded\");\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, Prices} from \"../../../modulesContent\";\r\n\r\nexport default class FITADPrices extends Feature {\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showlowestprice\");\r\n    }\r\n\r\n    apply() {\r\n        const prices = new Prices();\r\n\r\n        prices.subids = this.context.getAllSubids();\r\n\r\n        prices.bundleids = [];\r\n        for (const node of document.querySelectorAll(\"[data-ds-bundleid]\")) {\r\n            prices.bundleids.push(node.dataset.dsBundleid);\r\n        }\r\n\r\n        prices.priceCallback = function(type, id, contentNode) {\r\n            let node;\r\n            let placement = \"afterbegin\";\r\n            if (type === \"sub\") {\r\n                node = document.querySelector(`input[name=subid][value=\"${id}\"]`).parentNode.parentNode.parentNode;\r\n            } else if (type === \"bundle\") {\r\n                node = document.querySelector(`.game_area_purchase_game_wrapper[data-ds-bundleid=\"${id}\"]`);\r\n                if (node) {\r\n\r\n                    // Move any \"Complete your Collection!\" banner out of the way\r\n                    const banner = node.querySelector(\".ds_completetheset\");\r\n                    const newParent = node.querySelector(\".game_area_purchase_game\");\r\n                    if (banner && newParent) {\r\n                        newParent.appendChild(banner);\r\n                    }\r\n                } else {\r\n                    node = document.querySelector(`.game_area_purchase_game[data-ds-bundleid=\"${id}\"]`);\r\n                    placement = \"beforebegin\";\r\n                }\r\n            }\r\n\r\n            node.insertAdjacentElement(placement, contentNode);\r\n        };\r\n\r\n        prices.bundleCallback = function(html) {\r\n\r\n            HTML.afterEnd(\"#game_area_purchase\",\r\n                `<h2 class=\"gradientbg es_bundle_info\">${Localization.str.bundle.header} <img src=\"//store.steampowered.com/public/images/v5/ico_external_link.gif\"></h2>\r\n                ${html}`);\r\n        };\r\n\r\n        prices.load();\r\n    }\r\n}\r\n","import {ContextType, Feature} from \"../../../modulesContent\";\r\n\r\nimport {HTML} from \"../../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\n\r\nexport default class FDRMWarnings extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showdrm\")) { return false; }\r\n\r\n        // Prevent false-positives\r\n        return !this.context.type === ContextType.APP || (\r\n            this.context.appid !== 21690 // Resident Evil 5, at Capcom's request\r\n            && this.context.appid !== 1157970 // Special K\r\n        );\r\n    }\r\n\r\n    apply() {\r\n\r\n        let text = \"\";\r\n        for (const node of document.querySelectorAll(\".game_area_sys_req, #game_area_legal, .game_details, .DRM_notice\")) {\r\n            text += node.textContent.toLowerCase();\r\n        }\r\n\r\n        // Games for Windows Live detection\r\n        const gfwl\r\n                = text.includes(\"games for windows live\")\r\n            || text.includes(\"games for windows - live\")\r\n            || text.includes(\"online play requires log-in to games for windows\")\r\n            || text.includes(\"installation of the games for windows live software\")\r\n            || text.includes(\"multiplayer play and other live features included at no charge\")\r\n            || text.includes(\"www.gamesforwindows.com/live\");\r\n\r\n        // Ubisoft Uplay detection\r\n        const uplay\r\n                = text.includes(\"uplay\")\r\n            || text.includes(\"ubisoft account\");\r\n\r\n        // Securom detection\r\n        const securom = text.includes(\"securom\");\r\n\r\n        // Tages detection\r\n        const tages\r\n                = text.match(/\\b(tages|solidshield)\\b/)\r\n            && !text.match(/angebote des tages/);\r\n\r\n        // Stardock account detection\r\n        const stardock = text.includes(\"stardock account\");\r\n\r\n        // Rockstar social club detection\r\n        const rockstar\r\n                = text.includes(\"rockstar social club\")\r\n            || text.includes(\"rockstar games social club\");\r\n\r\n        // Kalypso Launcher detection\r\n        const kalypso = text.includes(\"requires a kalypso account\");\r\n\r\n        // Denuvo Antitamper detection\r\n        const denuvo = text.includes(\"denuvo\");\r\n\r\n        // EA origin detection\r\n        const origin = text.includes(\"origin client\");\r\n\r\n        // Microsoft Xbox Live account detection\r\n        const xbox = text.includes(\"xbox live\");\r\n\r\n        const drmNames = [\r\n            [gfwl, \"Games for Windows Live\"],\r\n            [uplay, \"Ubisoft Uplay\"],\r\n            [securom, \"SecuROM\"],\r\n            [tages, \"Tages\"],\r\n            [stardock, \"Stardock Account Required\"],\r\n            [rockstar, \"Rockstar Social Club\"],\r\n            [kalypso, \"Kalypso Launcher\"],\r\n            [denuvo, \"Denuvo Anti-tamper\"],\r\n            [origin, \"EA Origin\"],\r\n            [xbox, \"Microsoft Xbox Live\"],\r\n        ].filter(([enabled]) => enabled)\r\n            .map(([, name]) => name);\r\n\r\n        let drmString;\r\n        if (drmNames.length > 0) {\r\n            drmString = this.context.type === ContextType.APP\r\n                ? Localization.str.drm_third_party\r\n                : Localization.str.drm_third_party_sub;\r\n\r\n            drmString = drmString.replace(\"__drmlist__\", `(${drmNames.join(\", \")})`);\r\n\r\n        } else { // Detect other DRM\r\n            const regex = /\\b(drm|account|steam)\\b/i;\r\n            if (this.context.type === ContextType.APP) {\r\n                for (const node of document.querySelectorAll(\"#category_block > .DRM_notice\")) {\r\n                    const text = node.textContent;\r\n                    if (regex.test(text)) {\r\n                        drmString = text;\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                const node = document.querySelector(\".game_details .details_block > p > b:last-of-type\");\r\n                const text = node.textContent + node.nextSibling.textContent;\r\n                if (regex.test(text)) {\r\n                    drmString = text;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (drmString) {\r\n            const node = document.querySelector(\"#game_area_purchase .game_area_description_bodylabel\");\r\n            if (node) {\r\n                HTML.afterEnd(node, `<div class=\"game_area_already_owned es_drm_warning\"><span>${drmString}</span></div>`);\r\n            } else {\r\n                HTML.afterBegin(\"#game_area_purchase\", `<div class=\"es_drm_warning\"><span>${drmString}</span></div>`);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {HTML, HTMLParser, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FExtraLinks extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        const context = this.context;\r\n\r\n        if (context.type === ContextType.APP) {\r\n            this._type = \"app\";\r\n            this._gameid = context.appid;\r\n            this._node = document.querySelector(\"#shareEmbedRow\");\r\n        } else if (context.type === ContextType.SUB) {\r\n            this._type = \"sub\";\r\n            this._gameid = context.subid;\r\n            this._node = document.querySelector(\".share\").parentNode;\r\n        } else if (context.type === ContextType.BUNDLE) {\r\n            this._type = \"bundle\";\r\n            this._gameid = context.bundleid;\r\n            this._node = document.querySelector(\".share, .rightcol .game_details\");\r\n        }\r\n\r\n        if (!this._node) {\r\n            console.warn(\"Couldn't find element to insert extra links\");\r\n        }\r\n\r\n        return this._node !== null && (\r\n\r\n            // Even if the user doesn't want to see any extra links, the place of the native links is changed (see _moveExtraLinks)\r\n            this._type === \"app\"\r\n\r\n            // Preferences for links shown on all pages\r\n            || (SyncedStorage.get(\"showbartervg\")\r\n            || SyncedStorage.get(\"showsteamdb\")\r\n            || SyncedStorage.get(\"showitadlinks\"))\r\n        );\r\n    }\r\n\r\n    apply() {\r\n\r\n        if (this._type === \"app\") {\r\n\r\n            this._moveExtraLinks();\r\n\r\n            const appName = HTMLParser.clearSpecialSymbols(this.context.appName);\r\n\r\n            // custom app link\r\n            for (const customLink of SyncedStorage.get(\"app_custom_link\")) {\r\n                if (!customLink || !customLink.enabled) {\r\n                    continue;\r\n                }\r\n\r\n                const customUrl = customLink.url;\r\n                const name = HTML.escape(customLink.name);\r\n                const link = `//${HTML.escape(customUrl\r\n                    .replace(\"[NAME]\", encodeURIComponent(appName))\r\n                    .replace(\"[ID]\", this.context.appid))}`;\r\n                let icon;\r\n                if (customLink.icon) {\r\n                    icon = `//${HTML.escape(customLink.icon)}`;\r\n                }\r\n\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        null,\r\n                        link,\r\n                        Localization.str.view_on_website.replace(\"__website__\", name),\r\n                        icon,\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showyoutubereviews\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"youtube_btn\",\r\n                        `https://www.youtube.com/results?search_query=${encodeURIComponent(`${appName} \"PC\" intitle:Review`)}`,\r\n                        Localization.str.youtube_reviews,\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showyoutubegameplay\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"youtube_btn\",\r\n                        `https://www.youtube.com/results?search_query=${encodeURIComponent(`${appName} \"PC Gameplay\"`)}`,\r\n                        Localization.str.youtube_gameplay,\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showyoutube\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"youtube_btn\",\r\n                        `https://www.youtube.com/results?search_query=${encodeURIComponent(appName)}`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"YouTube\"),\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showtwitch\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"twitch_btn\",\r\n                        `https://www.twitch.tv/directory/game/${encodeURIComponent(appName)}`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"Twitch\"),\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showpcgw\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"pcgw_btn\",\r\n                        `https://pcgamingwiki.com/api/appid.php?appid=${this.context.appid}`,\r\n                        Localization.str.wiki_article.replace(\"__pcgw__\", \"PCGamingWiki\"),\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showcompletionistme\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"completionistme_btn\",\r\n                        `https://completionist.me/steam/app/${this.context.appid}/`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"Completionist.me\"),\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showprotondb\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"protondb_btn\",\r\n                        `https://www.protondb.com/app/${this.context.appid}/`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"ProtonDB\"),\r\n                    ));\r\n            }\r\n\r\n            if (this.context.hasCards && SyncedStorage.get(\"showsteamcardexchange\")) {\r\n\r\n                // FIXME some dlc have card category yet no card\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"cardexchange_btn\",\r\n                        `https://www.steamcardexchange.net/index.php?gamepage-appid-${this.context.communityAppid}/`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"Steam Card Exchange\"),\r\n                    ));\r\n            }\r\n        }\r\n\r\n        if (SyncedStorage.get(\"showbartervg\")) {\r\n            HTML.afterBegin(this._node,\r\n                this._getRightColLinkHtml(\r\n                    \"bartervg_ico\",\r\n                    `https://barter.vg/steam/${this._type}/${this._gameid}/`,\r\n                    Localization.str.view_on_website.replace(\"__website__\", \"Barter.vg\"),\r\n                ));\r\n        }\r\n\r\n        if (SyncedStorage.get(\"showsteamdb\")) {\r\n            HTML.afterBegin(this._node,\r\n                this._getRightColLinkHtml(\r\n                    \"steamdb_ico\",\r\n                    `https://steamdb.info/${this._type}/${this._gameid}/`,\r\n                    Localization.str.view_on_website.replace(\"__website__\", \"Steam Database\"),\r\n                ));\r\n        }\r\n\r\n        if (SyncedStorage.get(\"showitadlinks\")) {\r\n            HTML.afterBegin(this._node,\r\n                this._getRightColLinkHtml(\r\n                    \"itad_ico\",\r\n                    `https://isthereanydeal.com/steam/${this._type}/${this._gameid}/`,\r\n                    Localization.str.view_on_website.replace(\"__website__\", \"IsThereAnyDeal\"),\r\n                ));\r\n        }\r\n    }\r\n\r\n    _getRightColLinkHtml(cls, url, str, iconUrl) {\r\n        const icon = cls ? \"\" : `style=\"background: ${iconUrl ? `url('${iconUrl}')` : \"none\"}; background-size: contain;\"`;\r\n        return `<a class=\"btnv6_blue_hoverfade btn_medium es_app_btn ${cls || \"\"}\" target=\"_blank\" href=\"${url}\">\r\n                    <span><i class=\"ico16\" ${icon}></i>&nbsp;&nbsp; ${str}</span>\r\n                </a>`;\r\n    }\r\n\r\n    _moveExtraLinks() {\r\n\r\n        const usefulLinks = this._node;\r\n        usefulLinks.classList.add(\"es_useful_link\");\r\n\r\n        const sideDetails = document.querySelector(\".es_side_details_wrap\");\r\n        if (sideDetails) {\r\n            sideDetails.insertAdjacentElement(\"afterend\", usefulLinks);\r\n        } else {\r\n            document.querySelector(\"div.rightcol.game_meta_data\").insertAdjacentElement(\"afterbegin\", usefulLinks);\r\n        }\r\n    }\r\n}\r\n","import {SyncedStorage} from \"../../modulesCore\";\r\nimport {BackgroundSimple} from \"../BackgroundSimple\";\r\n\r\nclass UserNotesAdapter {\r\n\r\n    static getAdapter() {\r\n\r\n        if (typeof UserNotesAdapter._adapter === \"undefined\") {\r\n\r\n            let Adapter = UserNotesAdapter.adapters[SyncedStorage.get(\"user_notes_adapter\")];\r\n\r\n            if (typeof Adapter === \"undefined\") {\r\n                SyncedStorage.remove(\"user_notes_adapter\");\r\n                Adapter = UserNotesAdapter.adapters[SyncedStorage.defaults.user_notes_adapter];\r\n            }\r\n\r\n            UserNotesAdapter._adapter = new Adapter();\r\n        }\r\n\r\n        return UserNotesAdapter._adapter;\r\n    }\r\n\r\n    static async changeAdapter(toType) {\r\n\r\n        const currentAdapter = UserNotesAdapter.getAdapter();\r\n        const newAdapter = new UserNotesAdapter.adapters[toType]();\r\n\r\n        await newAdapter.import(await currentAdapter.export());\r\n        await currentAdapter.clear();\r\n\r\n        UserNotesAdapter._adapter = newAdapter;\r\n        return UserNotesAdapter._adapter;\r\n    }\r\n}\r\n\r\nclass OutOfCapacityError extends Error {\r\n    constructor(ratio, ...params) {\r\n        super(...params);\r\n\r\n        this.name = this.constructor.name;\r\n\r\n        this.ratio = ratio;\r\n    }\r\n}\r\n\r\nclass CapacityInfo {\r\n    constructor(closeToFull = false, utilization = null) {\r\n        this.closeToFull = closeToFull;\r\n        this.utilization = utilization;\r\n    }\r\n}\r\n\r\nclass SyncedStorageAdapter {\r\n\r\n    constructor() {\r\n        this._notes = SyncedStorage.get(\"user_notes\");\r\n    }\r\n\r\n    get(appid) {\r\n        return this._notes[appid] || null;\r\n    }\r\n\r\n    async set(appid, note) {\r\n\r\n        const oldNote = this._notes[appid];\r\n        this._notes[appid] = note;\r\n\r\n        const storageUsage = this._getNotesSize() / SyncedStorage.QUOTA_BYTES_PER_ITEM;\r\n        if (storageUsage > 1) {\r\n            this._notes[appid] = oldNote;\r\n            throw new OutOfCapacityError(storageUsage, \"Can't set this user note, out of capacity\");\r\n        }\r\n\r\n        await SyncedStorage.set(\"user_notes\", this._notes);\r\n\r\n        return new CapacityInfo(storageUsage > 0.85, storageUsage);\r\n    }\r\n\r\n    delete(appid) {\r\n        delete this._notes[appid];\r\n        return SyncedStorage.set(\"user_notes\", this._notes);\r\n    }\r\n\r\n    export() {\r\n        return this._notes;\r\n    }\r\n\r\n    import(notes) {\r\n\r\n        const storageUsage = this._getNotesSize(notes) / SyncedStorage.QUOTA_BYTES_PER_ITEM;\r\n        if (storageUsage > 1) {\r\n            throw new OutOfCapacityError(storageUsage, \"Import to synced storage failed, too much data for this adapter\");\r\n        }\r\n\r\n        this._notes = notes;\r\n        return SyncedStorage.set(\"user_notes\", this._notes);\r\n    }\r\n\r\n    clear() {\r\n        return SyncedStorage.remove(\"user_notes\");\r\n    }\r\n\r\n    _getNotesSize(notes = this._notes) {\r\n        return \"user_notes\".length + JSON.stringify(notes).length;\r\n    }\r\n}\r\n\r\nclass IdbAdapter {\r\n\r\n    get(appid) {\r\n        return BackgroundSimple.action(\"notes.get\", appid);\r\n    }\r\n\r\n    set(appid, note) {\r\n        return BackgroundSimple.action(\"notes.set\", appid, note);\r\n    }\r\n\r\n    delete(appid) {\r\n        return BackgroundSimple.action(\"notes.delete\", appid);\r\n    }\r\n\r\n    export() {\r\n        return BackgroundSimple.action(\"notes.getall\");\r\n    }\r\n\r\n    import(notes) {\r\n        return BackgroundSimple.action(\"notes.setall\", notes);\r\n    }\r\n\r\n    clear() {\r\n        return BackgroundSimple.action(\"notes.clear\");\r\n    }\r\n}\r\n\r\n/*\r\n * TODO Implement\r\n * class ItadAdapter extends IdbAdapter {}\r\n */\r\n\r\nUserNotesAdapter.adapters = Object.freeze({\r\n    \"synced_storage\": SyncedStorageAdapter,\r\n    \"idb\": IdbAdapter,\r\n    // \"itad\": ItadAdapter,\r\n});\r\n\r\nexport {CapacityInfo, OutOfCapacityError, UserNotesAdapter};\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Messenger} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\nimport {CapacityInfo, OutOfCapacityError, UserNotesAdapter} from \"../../../../Core/Storage/UserNotesAdapter\";\r\nimport {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\n\r\nclass UserNotes {\r\n    constructor() {\r\n        this._str = Localization.str.user_note;\r\n        this._adapter = UserNotesAdapter.getAdapter();\r\n\r\n        this.noteModalTemplate\r\n            = `<div class=\"es_note_prompt newmodal_prompt_with_textarea gray_bevel fullwidth\">\r\n                <textarea name=\"es_note_input\" id=\"es_note_input\" rows=\"6\" cols=\"12\">__note__</textarea>\r\n            </div>`;\r\n    }\r\n\r\n    get(...args) { return this._adapter.get(...args); }\r\n\r\n    async set(...args) {\r\n\r\n        let capInfo = null;\r\n\r\n        try {\r\n            capInfo = await this._adapter.set(...args);\r\n        } catch (err) {\r\n            if (err instanceof OutOfCapacityError) {\r\n                return (await this._showDialog(true, err.ratio)) ? this.set(...args) : false;\r\n            }\r\n\r\n            throw err;\r\n        }\r\n\r\n        if (capInfo instanceof CapacityInfo && capInfo.closeToFull) {\r\n            await this._showDialog(false, capInfo.utilization);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    delete(...args) { return this._adapter.delete(...args); }\r\n\r\n    async showModalDialog(appname, appid, nodeSelector, onNoteUpdate) {\r\n\r\n        let note = await this.get(appid) || \"\";\r\n\r\n        // Partly copied from shared_global.js\r\n        Page.runInPageContext((title, template, strSave, strCancel) => {\r\n            /* eslint-disable no-undef, new-cap, camelcase */\r\n\r\n            const deferred = new jQuery.Deferred();\r\n            function fnOk() {\r\n                deferred.resolve(\r\n                    document.querySelector(\"#es_note_input\").value\r\n                        .trim()\r\n                        .replace(/\\s\\s+/g, \" \")\r\n                );\r\n            }\r\n\r\n            function fnCancel() {\r\n                deferred.reject();\r\n            }\r\n\r\n            const buttons = [];\r\n\r\n            const okBtn = _BuildDialogButton(strSave, true);\r\n            okBtn.click(fnOk);\r\n            buttons.push(okBtn);\r\n\r\n            const cancelBtn = _BuildDialogButton(strCancel, false);\r\n            cancelBtn.click(fnCancel);\r\n            buttons.push(cancelBtn);\r\n\r\n            const modal = _BuildDialog(title, template, buttons, fnCancel);\r\n\r\n            _BindOnEnterKeyPressForDialog(modal, deferred, fnOk);\r\n            deferred.always(() => modal.Dismiss());\r\n\r\n            const noteInput = document.getElementById(\"es_note_input\");\r\n            noteInput.focus();\r\n            noteInput.setSelectionRange(0, noteInput.textLength);\r\n\r\n            deferred.promise(modal);\r\n\r\n            modal\r\n                .done(note => { window.Messenger.postMessage(\"noteClosed\", note); })\r\n                .fail(() => { window.Messenger.postMessage(\"noteClosed\", null); });\r\n\r\n            modal.Show();\r\n            /* eslint-enable no-undef */\r\n        },\r\n        [\r\n            this._str.add_for_game.replace(\"__gamename__\", appname),\r\n            this.noteModalTemplate.replace(\"__appid__\", appid).replace(\"__note__\", note)\r\n                .replace(\"__selector__\", encodeURIComponent(nodeSelector)),\r\n            Localization.str.save,\r\n            Localization.str.cancel,\r\n        ],\r\n        true);\r\n\r\n        const oldNote = note;\r\n\r\n        note = await Messenger.onMessage(\"noteClosed\");\r\n        if (note === null) { return; }\r\n\r\n        note = HTML.escape(note);\r\n        if (note === oldNote) { return; }\r\n\r\n        const node = document.querySelector(nodeSelector);\r\n\r\n        if (note.length === 0) {\r\n            this.delete(appid);\r\n            node.textContent = this._str.add;\r\n        } else {\r\n            if (!await this.set(appid, note)) { return; }\r\n            HTML.inner(node, `\"${note}\"`);\r\n        }\r\n\r\n        onNoteUpdate(node, note.length !== 0);\r\n    }\r\n\r\n    async _showDialog(exceeded, ratio) {\r\n\r\n        const str = this._str;\r\n\r\n        const desc\r\n            = `${(exceeded ? str.not_enough_space_desc : str.close_on_storage_desc).replace(\"__perc__\", (ratio * 100).toFixed(0))}\r\n            <br>\r\n            ${str.storage_warning_desc}`;\r\n\r\n        Page.runInPageContext((title, desc, strCloudStorage, strCancel, strLocalStorage) => {\r\n            const modal = window.SteamFacade.showConfirmDialog(title, desc, strLocalStorage, strCancel);\r\n\r\n            modal\r\n                .done(res => window.Messenger.postMessage(\"storageOption\", res))\r\n                .fail(() => window.Messenger.postMessage(\"storageOption\", null));\r\n        },\r\n        [\r\n            exceeded ? str.not_enough_space : str.close_on_storage,\r\n            desc,\r\n            str.save_itad,\r\n            str.save_synced_storage,\r\n            str.save_local,\r\n        ]);\r\n\r\n        const buttonPressed = await Messenger.onMessage(\"storageOption\");\r\n        let adapterType;\r\n\r\n        if (buttonPressed === \"OK\") {\r\n            adapterType = \"idb\";\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this._adapter = await UserNotesAdapter.changeAdapter(adapterType);\r\n        await SyncedStorage.set(\"user_notes_adapter\", adapterType);\r\n        return true;\r\n    }\r\n}\r\n\r\nexport {UserNotes};\r\n","import {GameId, HTML, HTMLParser, Localization, SyncedStorage} from \"../../../modulesCore\";\r\nimport {DynamicStore, Feature, ITAD, Inventory} from \"../../modulesContent\";\r\nimport {Page} from \"../Page\";\r\n\r\nexport default class FHighlightsTags extends Feature {\r\n\r\n    async apply() {\r\n\r\n        await Page.runInPageContext(() => new Promise(resolve => {\r\n            window.SteamFacade.onDynamicStoreReady(() => { resolve(); });\r\n        }), null, true);\r\n\r\n        const searchBoxContents = document.getElementById(\"search_suggestion_contents\");\r\n        if (searchBoxContents) {\r\n            const observer = new MutationObserver(records => {\r\n                FHighlightsTags.highlightAndTag(records[0].addedNodes);\r\n            });\r\n            observer.observe(searchBoxContents, {\"childList\": true});\r\n        }\r\n\r\n        return Promise.all([\r\n            FHighlightsTags.highlightTitle(this.context.appid),\r\n            FHighlightsTags.highlightAndTag(),\r\n        ]);\r\n    }\r\n\r\n    static highlightTitle(appid) {\r\n\r\n        const title = document.querySelector(\".apphub_AppName\");\r\n        if (!title) { return null; }\r\n\r\n        title.dataset.dsAppid = appid;\r\n\r\n        return FHighlightsTags.highlightAndTag([title], false);\r\n    }\r\n\r\n    /**\r\n     * Highlights and tags DOM nodes that are owned, wishlisted, ignored, collected, waitlisted\r\n     * or that the user has a gift, a guest pass or coupon for.\r\n     *\r\n     * Additionally hides non-discounted titles if wished by the user.\r\n     * @param {NodeList|Array} nodes - The nodes that should get highlighted\r\n     * (defaults to all known nodes that are highlightable and taggable)\r\n     * @param {boolean} hasDsInfo - Whether or not the supplied nodes contain dynamic store info (defaults to true)\r\n     * @param {Object} options - The highlights/tags that should be applied (defaults to all enabled)\r\n     * @returns {Promise} - Resolved once the highlighting and tagging completed for the nodes\r\n     */\r\n    /* eslint-disable complexity -- FIXME */\r\n    static async highlightAndTag(nodes = document.querySelectorAll(this._selector), hasDsInfo = true, options = {}) {\r\n\r\n        const opts = {\"owned\": true,\r\n            \"wishlisted\": true,\r\n            \"ignored\": true,\r\n            \"collected\": true,\r\n            \"waitlisted\": true,\r\n            \"gift\": true,\r\n            \"guestPass\": true,\r\n            \"coupon\": true,\r\n            ...options};\r\n\r\n        const storeIdsMap = new Map();\r\n\r\n        for (const node of nodes) {\r\n            let nodeToHighlight = node;\r\n\r\n            if (node.classList.contains(\"item\")) {\r\n                nodeToHighlight = node.querySelector(\".info\");\r\n            } else if (node.classList.contains(\"home_area_spotlight\")) {\r\n                nodeToHighlight = node.querySelector(\".spotlight_content\");\r\n            } else if (node.parentNode.classList.contains(\"steam_curator_recommendation\")\r\n                && node.parentNode.classList.contains(\"big\")) {\r\n                nodeToHighlight = node.nextElementSibling;\r\n            } else if (node.parentNode.parentNode.classList.contains(\"curations\")) {\r\n                nodeToHighlight = node.parentNode;\r\n            } else if (node.classList.contains(\"special_img_ctn\") && node.parentElement.classList.contains(\"special\")) {\r\n                nodeToHighlight = node.parentElement;\r\n            } else if (node.classList.contains(\"blotter_userstats_game\")) {\r\n\r\n                // Small game capsules on activity page (e.g. when posting a status about a game)\r\n                nodeToHighlight = node.parentElement;\r\n            }\r\n\r\n            const aNode = node.querySelector(\"a\");\r\n\r\n            const appid = GameId.getAppid(node) || GameId.getAppid(aNode) || GameId.getAppidFromId(node.id);\r\n            const subid = GameId.getSubid(node) || GameId.getSubid(aNode);\r\n            const bundleid = GameId.getBundleid(node) || GameId.getBundleid(aNode);\r\n\r\n            let storeId;\r\n            if (appid) {\r\n                storeId = `app/${appid}`;\r\n            } else if (bundleid) {\r\n                storeId = `bundle/${bundleid}`;\r\n            } else if (subid) {\r\n                storeId = `sub/${subid}`;\r\n            }\r\n\r\n            if (storeId) {\r\n                if (storeIdsMap.has(storeId)) {\r\n                    const arr = storeIdsMap.get(storeId);\r\n                    arr.push(nodeToHighlight);\r\n                    storeIdsMap.set(storeId, arr);\r\n                } else {\r\n                    storeIdsMap.set(storeId, [nodeToHighlight]);\r\n                }\r\n            }\r\n\r\n            if (hasDsInfo) {\r\n                if (node.querySelector(\".ds_owned_flag\") && opts.owned) {\r\n                    this.highlightOwned(nodeToHighlight);\r\n                }\r\n\r\n                if (node.querySelector(\".ds_wishlist_flag\") && opts.wishlisted) {\r\n                    this.highlightWishlist(nodeToHighlight);\r\n                }\r\n\r\n                if (node.querySelector(\".ds_ignored_flag\") && opts.ignored) {\r\n                    this.highlightIgnored(nodeToHighlight);\r\n                }\r\n            }\r\n        }\r\n\r\n        const storeIds = Array.from(storeIdsMap.keys());\r\n        const trimmedStoreIds = storeIds.map(id => GameId.trimStoreId(id));\r\n\r\n        const includeDsInfo\r\n            = !hasDsInfo\r\n            && ((opts.owned && (SyncedStorage.get(\"highlight_owned\") || SyncedStorage.get(\"tag_owned\")))\r\n                || (opts.wishlisted && (SyncedStorage.get(\"highlight_wishlist\") || SyncedStorage.get(\"tag_wishlist\")))\r\n                || (opts.ignored && (SyncedStorage.get(\"highlight_notinterested\") || SyncedStorage.get(\"tag_notinterested\")))\r\n            );\r\n\r\n        const [dsStatus, itadStatus, invStatus] = await Promise.all([\r\n            includeDsInfo ? DynamicStore.getAppStatus(storeIds) : Promise.resolve(),\r\n            ITAD.getAppStatus(storeIds, {\r\n                \"waitlist\": opts.waitlisted && (SyncedStorage.get(\"highlight_waitlist\") || SyncedStorage.get(\"tag_waitlist\")),\r\n                \"collection\": opts.collected && (SyncedStorage.get(\"highlight_collection\") || SyncedStorage.get(\"tag_collection\")),\r\n            }),\r\n            Inventory.getAppStatus(trimmedStoreIds, {\r\n                \"giftsAndPasses\": (opts.gift && (SyncedStorage.get(\"highlight_inv_gift\") || SyncedStorage.get(\"tag_inv_gift\")))\r\n                    || (opts.guestPass && (SyncedStorage.get(\"highlight_inv_guestpass\") || SyncedStorage.get(\"tag_inv_guestpass\"))),\r\n                \"coupons\": opts.coupon && (SyncedStorage.get(\"highlight_coupon\") || SyncedStorage.get(\"tag_coupon\")),\r\n            }),\r\n        ]);\r\n\r\n        const it = trimmedStoreIds.values();\r\n        for (const [storeid, nodes] of storeIdsMap) {\r\n            if (dsStatus) {\r\n                if (opts.owned && dsStatus[storeid].owned) {\r\n                    nodes.forEach(node => { this.highlightOwned(node); });\r\n                }\r\n                if (opts.wishlisted && dsStatus[storeid].wishlisted) {\r\n                    nodes.forEach(node => { this.highlightWishlist(node); });\r\n                }\r\n                if (opts.ignored && dsStatus[storeid].ignored) {\r\n                    nodes.forEach(node => { this.highlightIgnored(node); });\r\n                }\r\n            }\r\n\r\n            /*\r\n             * Don't need to check for the opts object here, since the result contains\r\n             * false for every property if the highlight has been disabled\r\n             */\r\n            if (itadStatus) {\r\n                if (itadStatus[storeid].collected) {\r\n                    nodes.forEach(node => { this.highlightCollection(node); });\r\n                }\r\n                if (itadStatus[storeid].waitlisted) {\r\n                    nodes.forEach(node => { this.highlightWaitlist(node); });\r\n                }\r\n            }\r\n\r\n            if (invStatus) {\r\n                const trimmedId = it.next().value;\r\n                if (opts.gift && invStatus[trimmedId].gift) {\r\n                    nodes.forEach(node => { this.highlightInvGift(node); });\r\n                }\r\n\r\n                if (opts.guestPass && invStatus[trimmedId].guestPass) {\r\n                    nodes.forEach(node => { this.highlightInvGuestpass(node); });\r\n                }\r\n\r\n                // Same as for the ITAD highlights (don't need to check)\r\n                if (invStatus[trimmedId].coupon) {\r\n                    nodes.forEach(node => { this.highlightInvCoupon(node); });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static _addTag(node, tag) {\r\n\r\n        const tagShort = SyncedStorage.get(\"tag_short\");\r\n\r\n        // Load the colors CSS for tags\r\n        if (!this._tagCssLoaded) {\r\n            this._tagCssLoaded = true;\r\n\r\n            const tagCss = [];\r\n\r\n            for (const name of this._types) {\r\n                const color = SyncedStorage.get(`tag_${name}_color`);\r\n                tagCss.push(`.es_tag_${name} { background-color: ${color}; }`);\r\n            }\r\n\r\n            let style = document.createElement(\"style\");\r\n            style.id = \"es_tag_styles\";\r\n            style.textContent = tagCss.join(\"\\n\");\r\n            document.head.appendChild(style);\r\n            style = null;\r\n        }\r\n\r\n        // Add the tags container if needed\r\n        let tags = node.querySelectorAll(\".es_tags\");\r\n        if (tags.length === 0) {\r\n            tags = HTMLParser.htmlToElement(`<div class=\"es_tags ${tagShort ? \"es_tags_short\" : \"\"}\"></div>`);\r\n\r\n            let root;\r\n            if (node.classList.contains(\"tab_row\")) { // fixme can't find it\r\n                root = node.querySelector(\".tab_desc\").classList.remove(\"with_discount\");\r\n\r\n                node.querySelector(\".tab_discount\").style.top = \"15px\";\r\n                root.querySelector(\"h4\").insertAdjacentElement(\"afterend\", tags);\r\n            } else if (node.classList.contains(\"home_smallcap\")) {\r\n                node.querySelector(\".home_smallcap_title\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"curated_app_item\")) {\r\n                node.querySelector(\".home_headerv5_title\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"tab_item\")) {\r\n                node.querySelector(\".tab_item_name\").insertAdjacentElement(\"afterend\", tags);\r\n            } else if (node.classList.contains(\"newonsteam_headercap\") || node.classList.contains(\"comingsoon_headercap\")) {\r\n                node.querySelector(\".discount_block\").insertAdjacentElement(\"beforebegin\", tags);\r\n            } else if (node.classList.contains(\"search_result_row\")) {\r\n                node.querySelector(\"p\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"dailydeal\")) { // can't find it\r\n                root = node.parentNode;\r\n                root.querySelector(\".game_purchase_action\").insertAdjacentElement(\"beforebegin\", tags);\r\n                HTML.beforeBegin(root.querySelector(\".game_purchase_action\"), '<div style=\"clear: right;\"></div>');\r\n            } else if (node.classList.contains(\"browse_tag_game\")) {\r\n                node.querySelector(\".browse_tag_game_price\").insertAdjacentElement(\"afterend\", tags);\r\n            } else if (node.classList.contains(\"game_area_dlc_row\")) {\r\n                node.querySelector(\".game_area_dlc_price\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"wishlist_row\")) {\r\n                node.querySelector(\".addedon\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"match\")) {\r\n                node.querySelector(\".match_price\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"cluster_capsule\")) {\r\n                node.querySelector(\".main_cap_platform_area\").append(tags);\r\n            } else if (node.classList.contains(\"recommendation_highlight\")) {\r\n                node.querySelector(\".highlight_description\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"similar_grid_item\")) {\r\n                node.querySelector(\".regular_price, .discount_block\").append(tags);\r\n            } else if (node.classList.contains(\"recommendation_carousel_item\")) {\r\n                node.querySelector(\".buttons\").insertAdjacentElement(\"beforebegin\", tags);\r\n            } else if (node.classList.contains(\"friendplaytime_game\")) {\r\n                node.querySelector(\".friendplaytime_buttons\").insertAdjacentElement(\"beforebegin\", tags);\r\n            }\r\n\r\n            tags = [tags];\r\n        }\r\n\r\n        // Add the tag\r\n        for (const n of tags) {\r\n            if (!n.querySelector(`.es_tag_${tag}`)) {\r\n                HTML.beforeEnd(n, `<span class=\"es_tag_${tag}\">${Localization.str.tag[tag]}</span>`);\r\n            }\r\n        }\r\n    }\r\n    /* eslint-enable complexity */\r\n\r\n    static _highlightNode(node) {\r\n        if (SyncedStorage.get(\"highlight_excludef2p\")) {\r\n\r\n            if (node.innerHTML.match(\r\n                /<div class=\"(tab_price|large_cap_price|col search_price|main_cap_price|price)\">\\n?(.+)?(Free to Play|Play for Free!)(.+)?<\\/div>/i\r\n            )) {\r\n                return;\r\n            }\r\n            if (node.innerHTML.match(/<h5>(Free to Play|Play for Free!)<\\/h5>/i)) {\r\n                return;\r\n            }\r\n            if (node.innerHTML.match(/genre_release/) && node.querySelector(\".genre_release\").innerHTML.match(/Free to Play/i)) {\r\n                return;\r\n            }\r\n            if (node.classList.contains(\"search_result_row\") && node.innerHTML.match(/Free to Play/i)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (!this._highlightCssLoaded) {\r\n            this._highlightCssLoaded = true;\r\n\r\n            const hlCss = [];\r\n\r\n            for (const name of this._types) {\r\n                const color = SyncedStorage.get(`highlight_${name}_color`);\r\n                hlCss.push(\r\n                    `.es_highlighted_${name} {\r\n                        background: ${color} linear-gradient(135deg, rgba(0, 0, 0, 0.70) 10%, rgba(0, 0, 0, 0) 100%) !important;\r\n                    }\r\n                    .carousel_items .es_highlighted_${name}.price_inline, .curator_giant_capsule.es_highlighted_${name},\r\n                    .hero_capsule.es_highlighted_${name}, .blotter_userstatus_game.es_highlighted_${name} {\r\n                        outline: solid ${color};\r\n                    }\r\n                    #search_suggestion_contents .focus.es_highlighted_${name} {\r\n                        box-shadow: -5px 0 0 ${color};\r\n                    }\r\n                    .apphub_AppName.es_highlighted_${name} {\r\n                        background: none !important; color: ${color};\r\n                    }`\r\n                );\r\n            }\r\n\r\n            let style = document.createElement(\"style\");\r\n            style.id = \"es_highlight_styles\";\r\n            style.textContent = hlCss.join(\"\\n\");\r\n            document.head.appendChild(style);\r\n            style = null;\r\n        }\r\n\r\n        let _node = node;\r\n\r\n        // Carousel item\r\n        if (_node.classList.contains(\"cluster_capsule\")) {\r\n            _node = _node.querySelector(\".main_cap_content\").parentNode;\r\n        } else if (_node.classList.contains(\"large_cap\")) {\r\n\r\n            // Genre Carousel items\r\n            _node = _node.querySelector(\".large_cap_content\");\r\n        } else if (_node.parentNode.classList.contains(\"steam_curator_recommendation\")\r\n            && _node.parentNode.classList.contains(\"big\")) {\r\n            _node = _node.previousElementSibling;\r\n        }\r\n\r\n        // Recommendations on front page when scrolling down\r\n        if (_node.classList.contains(\"single\")) {\r\n            _node = _node.querySelector(\".gamelink\");\r\n        }\r\n\r\n        if (_node.parentNode.parentNode.classList.contains(\"apps_recommended_by_curators_v2\")) {\r\n            let r = _node.querySelectorAll(\".ds_flag\");\r\n            r.forEach(node => node.remove());\r\n            r = _node.querySelectorAll(\".ds_flagged\");\r\n            r.forEach(node => node.classList.remove(\"ds_flagged\"));\r\n        } else {\r\n\r\n            if (_node.classList.contains(\"info\") || _node.classList.contains(\"spotlight_content\")) {\r\n                _node = _node.parentElement;\r\n            }\r\n\r\n            let r = _node.querySelector(\".ds_flag\");\r\n            if (r) { r.remove(); }\r\n            r = _node.querySelector(\".ds_flagged\");\r\n            if (r) {\r\n                r.classList.remove(\"ds_flagged\");\r\n            }\r\n        }\r\n\r\n        _node.classList.remove(\"ds_flagged\");\r\n    }\r\n\r\n    static _highlightItem(node, name) {\r\n        node.classList.add(\"es_highlight_checked\");\r\n\r\n        if (SyncedStorage.get(`highlight_${name}`)) {\r\n            node.classList.add(\"es_highlighted\", `es_highlighted_${name}`);\r\n            this._highlightNode(node);\r\n        }\r\n\r\n        if (SyncedStorage.get(`tag_${name}`)) {\r\n            this._addTag(node, name);\r\n        }\r\n    }\r\n\r\n    static highlightOwned(node) {\r\n        this._highlightItem(node, \"owned\");\r\n    }\r\n\r\n    static highlightWishlist(node) {\r\n        this._highlightItem(node, \"wishlist\");\r\n    }\r\n\r\n    static highlightInvCoupon(node) {\r\n        this._highlightItem(node, \"coupon\");\r\n    }\r\n\r\n    static highlightInvGift(node) {\r\n        this._highlightItem(node, \"inv_gift\");\r\n    }\r\n\r\n    static highlightInvGuestpass(node) {\r\n        this._highlightItem(node, \"inv_guestpass\");\r\n    }\r\n\r\n    static highlightIgnored(node) {\r\n        this._highlightItem(node, \"notinterested\");\r\n    }\r\n\r\n    static highlightCollection(node) {\r\n        this._highlightItem(node, \"collection\");\r\n    }\r\n\r\n    static highlightWaitlist(node) {\r\n        this._highlightItem(node, \"waitlist\");\r\n    }\r\n}\r\n\r\nFHighlightsTags._highlightCssLoaded = false;\r\nFHighlightsTags._tagCssLoaded = false;\r\n\r\n/*\r\n * Attention, the sequence of these entries determines the precendence of the highlights!\r\n * The later it appears in the array, the higher its precedence\r\n */\r\nFHighlightsTags._types = [\r\n    \"notinterested\",\r\n    \"waitlist\",\r\n    \"wishlist\",\r\n    \"collection\",\r\n    \"owned\",\r\n    \"coupon\",\r\n    \"inv_guestpass\",\r\n    \"inv_gift\",\r\n];\r\n\r\nFHighlightsTags._selector = [\r\n    \"div.tab_row\", // Storefront rows\r\n    \"div.dailydeal_ctn\",\r\n    \".store_main_capsule\", // \"Featured & Recommended\"\r\n    \"div.wishlistRow\", // Wishlist rows\r\n    \"a.game_area_dlc_row\", // DLC on app pages\r\n    \"a.small_cap\", // Featured storefront items and \"recommended\" section on app pages\r\n    \"a.home_smallcap\",\r\n    \".home_content_item\", // Small items under \"Keep scrolling for more recommendations\"\r\n    \".home_content.single\", // Big items under \"Keep scrolling for more recommendations\"\r\n    \".home_area_spotlight\", // \"Special offers\" big items\r\n    \"a.search_result_row\", // Search result rows\r\n    \"a.match\", // Search suggestions rows\r\n    \".highlighted_app\", // For example \"Recently Recommended\" on curators page\r\n    \"a.cluster_capsule\", // Carousel items\r\n    \"div.recommendation_highlight\", // Recommendation pages\r\n    \"div.recommendation_carousel_item\", // Recommendation pages\r\n    \"div.friendplaytime_game\", // Recommendation pages\r\n    \".recommendation_row\", // \"Recent recommendations by friends\"\r\n    \".friendactivity_tab_row\", // \"Most played\" and \"Most wanted\" tabs on recommendation pages\r\n    \".friend_game_block\", // \"Friends recently bought\"\r\n    \".recommendation\", // Curator pages and the new DLC pages\r\n    \".curator_giant_capsule\",\r\n    \"div.carousel_items.curator_featured > div\", // Carousel items on Curator pages\r\n    \"div.item_ctn\", // Curator list item\r\n    \".store_capsule\", // All sorts of items on almost every page\r\n    \".newonsteam_headercap\", // explore/new/\r\n    \".comingsoon_headercap\", // explore/upcoming/\r\n    \".home_marketing_message\", // \"Updates and offers\"\r\n    \"div.dlc_page_purchase_dlc\", // DLC page rows\r\n    \"div.sale_page_purchase_item\", // Sale pages\r\n    \"div.item\", // Sale pages / featured pages\r\n    \"div.home_area_spotlight\", // Midweek and weekend deals\r\n    \"div.browse_tag_game\", // Tagged games\r\n    \"div.similar_grid_item\", // Items on the \"Similarly tagged\" pages\r\n    \".tab_item\", // Items on new homepage\r\n    \".special > .special_img_ctn\", // new homepage specials\r\n    \".special.special_img_ctn\",\r\n    \"div.curated_app_item\", // curated app items!\r\n    \".hero_capsule\", // Summer sale \"Featured\"\r\n    \".sale_capsule\" // Summer sale general capsules\r\n].map(sel => `${sel}:not(.es_highlighted)`)\r\n    .join(\",\");\r\n","import {HTML, SyncedStorage} from \"../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../modulesContent\";\r\n\r\nexport default class FHideTrademarks extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"hidetmsymbols\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        // TODO I would try to reduce number of selectors here\r\n        let selectors = \"title, .apphub_AppName, .breadcrumbs, h1, h4\";\r\n        if (this.context.type === ContextType.STORE_DEFAULT) {\r\n            selectors\r\n                += \".game_area_already_owned, .details_block, .game_description_snippet, \"\r\n                + \".game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, \"\r\n                + \".game_area_dlc_name, .tab_desc, .tab_item_name\";\r\n        } else {\r\n            selectors\r\n                += \".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, \"\r\n                + \".apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName\";\r\n        }\r\n\r\n        // Replaces \"R\", \"C\" and \"TM\" signs\r\n        function replaceSymbols(node) {\r\n\r\n            // tfedor I don't trust this won't break any inline JS\r\n            if (!node || !node.innerHTML) { return; }\r\n            HTML.inner(node, node.innerHTML.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\"));\r\n        }\r\n\r\n        for (const node of document.querySelectorAll(selectors)) {\r\n            replaceSymbols(node);\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            mutations.forEach(mutation => {\r\n                mutation.addedNodes.forEach(node => {\r\n                    replaceSymbols(node);\r\n                });\r\n            });\r\n        });\r\n\r\n        const nodes = document.querySelectorAll(\"#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn\");\r\n        for (const node of nodes) {\r\n            observer.observe(node, {\"childList\": true, \"subtree\": true});\r\n        }\r\n    }\r\n}\r\n","import {ExtensionResources, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FAlternativeLinuxIcon extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"show_alternative_linux_icon\");\r\n    }\r\n\r\n    apply() {\r\n        const url = ExtensionResources.getURL(\"img/alternative_linux_icon.png\");\r\n        const style = document.createElement(\"style\");\r\n\r\n        let cssText = `span.platform_img.linux { background-image: url(${url}) !important; }`;\r\n\r\n        if (this.context.type === ContextType.STORE_FRONT) {\r\n            cssText += \".tab_item.focus .tab_item_details span.platform_img.linux { filter: brightness(20%); }\";\r\n        }\r\n\r\n        style.textContent = cssText;\r\n        document.head.appendChild(style);\r\n    }\r\n}\r\n","import {HTML} from \"../../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../../Core/Localization/Localization\";\r\nimport {Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FReplaceDevPubLinks extends Feature {\r\n\r\n    apply() {\r\n        const devs = Array.from(\r\n            document.querySelectorAll(\"#developers_list > a, .details_block > .dev_row:first-of-type > a\")\r\n        );\r\n        const pubs = Array.from(\r\n            document.querySelectorAll(\".user_reviews > .dev_row:last-of-type a, .details_block > .dev_row:nth-of-type(2) > a\")\r\n        );\r\n        let franchise = document.querySelector(\".details_block > .dev_row:nth-of-type(3) > a\");\r\n        franchise = franchise ? [franchise] : [];\r\n\r\n        for (const node of [...devs, ...pubs, ...franchise]) {\r\n            const homepageLink = new URL(node.href);\r\n            if (homepageLink.pathname.startsWith(\"/search/\")) { continue; }\r\n\r\n            let type;\r\n            if (devs.includes(node)) {\r\n                type = \"developer\";\r\n            } else if (pubs.includes(node)) {\r\n                type = \"publisher\";\r\n            } else if (franchise === node) {\r\n                type = \"franchise\";\r\n            }\r\n            if (!type) { continue; }\r\n\r\n            node.href = `https://store.steampowered.com/search/?${type}=${encodeURIComponent(node.textContent)}`;\r\n            HTML.afterEnd(node, ` (<a href=\"${homepageLink.href}\">${Localization.str.options.homepage}</a>)`);\r\n        }\r\n\r\n        for (const moreBtn of document.querySelectorAll(\".dev_row > .more_btn\")) {\r\n            moreBtn.remove();\r\n        }\r\n\r\n        Page.runInPageContext(() => {\r\n            window.SteamFacade.collapseLongStrings(\".dev_row .summary.column\");\r\n        });\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, Localization} from \"../../../../modulesCore\";\r\nimport {DynamicStore, Feature, User} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FRemoveFromWishlist extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return User.isSignedIn && !this.context.isOwned();\r\n    }\r\n\r\n    apply() {\r\n\r\n        const successBtn = document.querySelector(\"#add_to_wishlist_area_success > a\");\r\n\r\n        // Update tooltip for wishlisted items\r\n        successBtn.dataset.tooltipText = Localization.str.remove_from_wishlist_tooltip;\r\n\r\n        const imgNode = successBtn.querySelector(\"img:last-child\");\r\n        imgNode.classList.add(\"es-in-wl\");\r\n        HTML.beforeBegin(imgNode,\r\n            `<img class=\"es-remove-wl\" src=\"${ExtensionResources.getURL(\"img/remove.png\")}\" style=\"display: none;\">\r\n            <img class=\"es-loading-wl\" src=\"//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif\" style=\"display: none;\">`);\r\n\r\n        successBtn.addEventListener(\"click\", async e => {\r\n            e.preventDefault();\r\n\r\n            const parent = successBtn.closest(\".queue_actions_ctn\");\r\n            if (parent.classList.contains(\"loading\")) { return; }\r\n            parent.classList.add(\"loading\");\r\n\r\n            const removeWaitlist = Boolean(\r\n                document.querySelector(\".queue_btn_wishlist + .queue_btn_ignore_menu.owned_elsewhere\")\r\n            );\r\n\r\n            try {\r\n                await Promise.all([\r\n                    this.context.removeFromWishlist(),\r\n                    removeWaitlist ? this.context.removeFromWaitlist() : Promise.resolve(),\r\n                ]);\r\n\r\n                if (this.context.onWishAndWaitlistRemove) { this.context.onWishAndWaitlistRemove(); }\r\n\r\n                document.getElementById(\"add_to_wishlist_area\").style.display = \"\";\r\n\r\n                DynamicStore.clear();\r\n\r\n                Page.runInPageContext(() => { window.SteamFacade.dynamicStoreInvalidateCache(); });\r\n            } catch (err) {\r\n                document.getElementById(\"add_to_wishlist_area_fail\").style.display = \"\";\r\n                this.logError(err, \"Failed to remove app from wishlist\");\r\n            } finally {\r\n                document.getElementById(\"add_to_wishlist_area_success\").style.display = \"none\";\r\n                parent.classList.remove(\"loading\");\r\n            }\r\n        });\r\n\r\n        for (const node of document.querySelectorAll(\"#add_to_wishlist_area, #add_to_wishlist_area_success, .queue_btn_ignore\")) {\r\n            node.addEventListener(\"click\", DynamicStore.clear);\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\n\r\nexport default class FForceMP4 extends Feature {\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"mp4video\");\r\n    }\r\n\r\n    apply() {\r\n        for (const node of document.querySelectorAll(\"[data-webm-source]\")) {\r\n            const mp4 = node.dataset.mp4Source;\r\n            const mp4hd = node.dataset.mp4HdSource;\r\n            if (!mp4 || !mp4hd) { continue; }\r\n\r\n            node.dataset.webmSource = mp4;\r\n            node.dataset.webmHdSource = mp4hd;\r\n\r\n            const video = node.querySelector(\"video\");\r\n            if (!video) { continue; }\r\n\r\n            video.dataset.sdSrc = mp4;\r\n            video.dataset.hdSrc = mp4hd;\r\n            this.context.toggleVideoDefinition(video, false);\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, LocalStorage, TimeUtils} from \"../../../../modulesCore\";\r\n\r\nexport default class FHDPlayer extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return document.querySelector(\"div.highlight_movie\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        const that = this;\r\n        const movieNode = document.querySelector(\"div.highlight_movie\");\r\n        let playInHD = LocalStorage.get(\"playback_hd\");\r\n\r\n        function toggleFullscreen(videoControl) {\r\n            const fullscreenAvailable = document.fullscreenEnabled || document.mozFullScreenEnabled;\r\n\r\n            // Mozilla unprefixed in v64\r\n            if (!fullscreenAvailable) { return; }\r\n\r\n            const container = videoControl.parentNode;\r\n            const isFullscreen = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement;\r\n\r\n            /*\r\n             * Mozilla unprefixed in v64\r\n             * Chrome unprefixed in v53\r\n             */\r\n\r\n            if (isFullscreen) {\r\n                if (document.exitFullscreen) {\r\n                    document.exitFullscreen();\r\n                } else if (document.mozCancelFullScreen) {\r\n                    document.mozCancelFullScreen(); // Mozilla unprefixed in v64\r\n                }\r\n            } else {\r\n                let response = null;\r\n                if (container.requestFullscreen) {\r\n                    response = container.requestFullscreen();\r\n                } else if (container.mozRequestFullScreen) {\r\n                    response = container.mozRequestFullScreen(); // Mozilla unprefixed in v64\r\n                } else if (container.webkitRequestFullscreen) {\r\n                    container.webkitRequestFullscreen(); // Chrome unprefixed in v69, no promise\r\n                }\r\n\r\n                // if response is a promise, catch any errors it throws\r\n                Promise.resolve(response).catch(err => console.error(err));\r\n            }\r\n        }\r\n\r\n        async function addHDControl(videoControl) {\r\n\r\n            playInHD = LocalStorage.get(\"playback_hd\");\r\n\r\n            // prevents a bug in Chrome which causes videos to stop playing after changing the src\r\n            await TimeUtils.timer(150);\r\n\r\n            // Add \"HD\" button to the video\r\n            if (videoControl.dataset.hdSrc) {\r\n                const node = videoControl.parentNode.querySelector(\".time\");\r\n                if (node) {\r\n                    HTML.afterEnd(node, '<div class=\"es_hd_toggle\"><span>HD</span></div>');\r\n                }\r\n            }\r\n\r\n            // Override Valve's auto switch to HD when putting a video in fullscreen\r\n            let node = videoControl.parentNode.querySelector(\".fullscreen_button\");\r\n            if (node) {\r\n                let newNode = document.createElement(\"div\");\r\n                newNode.classList.add(\"fullscreen_button\");\r\n                newNode.addEventListener(\"click\", (() => toggleFullscreen(videoControl)), false);\r\n                node.replaceWith(newNode);\r\n                node = null; // prevent memory leak\r\n                newNode = null;\r\n            }\r\n\r\n            // Toggle fullscreen on video double click\r\n            videoControl.addEventListener(\"dblclick\", (() => toggleFullscreen(videoControl)), false);\r\n\r\n            that.context.toggleVideoDefinition(videoControl, playInHD);\r\n        }\r\n\r\n        // Add HD Control to each video as it's added to the DOM\r\n        const firstVideoIsPlaying = movieNode.querySelector(\"video.highlight_movie\");\r\n        if (firstVideoIsPlaying) {\r\n            addHDControl(firstVideoIsPlaying);\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (!node.matches(\"video.highlight_movie\")) { continue; }\r\n                    addHDControl(node);\r\n                }\r\n            }\r\n        });\r\n        for (const node of document.querySelectorAll(\"div.highlight_movie\")) {\r\n            observer.observe(node, {\"childList\": true});\r\n        }\r\n\r\n        // When the \"HD\" button is clicked change the definition for all videos accordingly\r\n        document.querySelector(\"#highlight_player_area\").addEventListener(\"click\", ev => {\r\n\r\n            if (!ev.target.closest(\".es_hd_toggle\")) { return; }\r\n\r\n            ev.preventDefault();\r\n            ev.stopPropagation();\r\n\r\n            const videoControl = ev.target.closest(\"div.highlight_movie\").querySelector(\"video\");\r\n            const playInHD = this.context.toggleVideoDefinition(videoControl);\r\n\r\n            for (const node of document.querySelectorAll(\"video.highlight_movie\")) {\r\n                if (node === videoControl) { continue; }\r\n                this.context.toggleVideoDefinition(node, playInHD);\r\n            }\r\n\r\n            LocalStorage.set(\"playback_hd\", playInHD);\r\n        }, true);\r\n\r\n        // When the slider is expanded first time after the page was loaded set videos definition to HD\r\n        for (const node of document.querySelectorAll(\".es_slider_toggle\")) {\r\n            node.addEventListener(\"click\", function clickInitialHD(ev) {\r\n\r\n                ev.currentTarget.removeEventListener(\"click\", clickInitialHD, false);\r\n                if (!ev.target.classList.contains(\"es_expanded\")) { return; }\r\n                for (const node of document.querySelectorAll(\"video.highlight_movie.es_video_sd\")) {\r\n                    that.context.toggleVideoDefinition(node, true);\r\n                }\r\n                LocalStorage.set(\"playback_hd\", true);\r\n            }, false);\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, User} from \"../../../modulesContent\";\r\n\r\nexport default class FUserNotes extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return User.isSignedIn && SyncedStorage.get(\"user_notes_app\");\r\n    }\r\n\r\n    async apply() {\r\n        const userNotes = this.context.userNotes;\r\n\r\n        let noteText = \"\";\r\n        let cssClass = \"esi-note--hidden\";\r\n\r\n        let inactiveStyle = \"\";\r\n        let activeStyle = \"display:none;\";\r\n\r\n        const note = await userNotes.get(this.context.appid);\r\n\r\n        if (note !== null) {\r\n            noteText = `\"${note}\"`;\r\n            cssClass = \"\";\r\n\r\n            inactiveStyle = \"display:none;\";\r\n            activeStyle = \"\";\r\n        }\r\n\r\n        HTML.beforeBegin(\".queue_actions_ctn > :last-child\",\r\n            `<div class=\"queue_control_button js-user-note-button\">\r\n                <div id=\"es_add_note\" class=\"btnv6_blue_hoverfade btn_medium queue_btn_inactive\" style=\"${inactiveStyle}\">\r\n                    <span>${Localization.str.user_note.add}</span>\r\n                </div>\r\n                <div id=\"es_update_note\" class=\"btnv6_blue_hoverfade btn_medium queue_btn_inactive\" style=\"${activeStyle}\">\r\n                    <span>${Localization.str.user_note.update}</span>\r\n                </div>\r\n            </div>`);\r\n\r\n        HTML.beforeEnd(\".queue_actions_ctn\",\r\n            `<div id='esi-store-user-note' class='esi-note esi-note--store ${cssClass} ellipsis'>${noteText}</div>`);\r\n\r\n        function toggleState(node, active) {\r\n            const button = document.querySelector(\".js-user-note-button\");\r\n            button.querySelector(\"#es_add_note\").style.display = active ? \"none\" : null;\r\n            button.querySelector(\"#es_update_note\").style.display = active ? null : \"none\";\r\n\r\n            node.classList.toggle(\"esi-note--hidden\", !active);\r\n        }\r\n\r\n        const handler = () => {\r\n            userNotes.showModalDialog(\r\n                this.context.appName, this.context.appid, \"#esi-store-user-note\", toggleState\r\n            );\r\n        };\r\n\r\n        document.querySelector(\".js-user-note-button\").addEventListener(\"click\", handler);\r\n        document.querySelector(\"#esi-store-user-note\").addEventListener(\"click\", handler);\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FWaitlistDropdown extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        return SyncedStorage.get(\"add_to_waitlist\")\r\n            && document.querySelector(\"#add_to_wishlist_area\") !== null\r\n            && (await Background.action(\"itad.isconnected\")) === true;\r\n    }\r\n\r\n    async apply() {\r\n\r\n        // Remove Steam's temp notice and native dropdown menu\r\n        for (const node of document.querySelectorAll(\"#add_to_wishlist_area_success > div\")) {\r\n            node.remove();\r\n        }\r\n\r\n        const wishlistDivs = document.querySelectorAll(\"#add_to_wishlist_area,#add_to_wishlist_area_success\");\r\n        const [wishlistArea, wishlistSuccessArea] = wishlistDivs;\r\n\r\n        HTML.afterEnd(\".queue_actions_ctn :first-child\",\r\n            `<div style=\"position: relative; display: inline-block;\">\r\n                <div class=\"queue_control_button as_btn_wishlist\"></div>\r\n            </div>`);\r\n\r\n        /*\r\n         * Creating a common parent for #add_to_wishlist_area and #add_to_wishlist_area_success\r\n         * makes it easier to apply the dropdown menu\r\n         */\r\n        const wrapper = document.querySelector(\".as_btn_wishlist\");\r\n\r\n        // Move the wrapper such that there can't be any other elements in between the dropdown and other buttons (see #690)\r\n        document.querySelector(\".queue_actions_ctn\").insertBefore(wrapper.parentNode, wishlistArea);\r\n\r\n        wrapper.append(...wishlistDivs);\r\n\r\n        HTML.afterEnd(wrapper,\r\n            `<div class=\"queue_control_button queue_btn_menu as_btn_wishlist_menu\">\r\n                <div class=\"queue_menu_arrow btn_medium\">\r\n                    <span><img src=\"https://steamstore-a.akamaihd.net/public/images/v6/btn_arrow_down_padded.png\"></span>\r\n                </div>\r\n                <div class=\"queue_menu_flyout\">\r\n                    <div class=\"queue_menu_flyout_content\">\r\n                        <div class=\"queue_menu_option\" id=\"queue_menu_option_on_wishlist\">\r\n                            <div>\r\n                                <img class=\"queue_ignore_menu_option_image selected\" src=\"https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_selected_bright.png\">\r\n                                <img class=\"queue_ignore_menu_option_image unselected\" src=\"https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_unselected_bright.png\">\r\n                            </div>\r\n                            <div class=\"queue_menu_option_label\">\r\n                                <div class=\"option_title\">${Localization.str.wishlist} (${Localization.str.theworddefault})</div>\r\n                                <div class=\"option_subtitle\">${Localization.str.add_to_wishlist}</div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"queue_menu_option\" id=\"queue_menu_option_on_waitlist\">\r\n                            <div>\r\n                                <img class=\"queue_ignore_menu_option_image selected\" src=\"https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_selected_bright.png\">\r\n                                <img class=\"queue_ignore_menu_option_image unselected\" src=\"https://steamstore-a.akamaihd.net/public/images/v6/ico/ico_unselected_bright.png\">\r\n                            </div>\r\n                            <div class=\"queue_menu_option_label\">\r\n                                <div class=\"option_title\">Waitlist</div>\r\n                                <div class=\"option_subtitle\">${Localization.str.add_to_waitlist}</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        let wishlisted = document.querySelector(\"#add_to_wishlist_area\").style.display === \"none\";\r\n        let waitlisted = await Background.action(\"itad.inwaitlist\", this.context.storeid);\r\n\r\n        const menu = document.querySelector(\".as_btn_wishlist_menu\");\r\n        const menuArrow = menu.querySelector(\".queue_menu_arrow\");\r\n        const wishlistOption = document.querySelector(\"#queue_menu_option_on_wishlist\");\r\n        const waitlistOption = document.querySelector(\"#queue_menu_option_on_waitlist\");\r\n\r\n        function updateDiv() {\r\n            const oneActive = Boolean(wishlisted) || Boolean(waitlisted);\r\n\r\n            menuArrow.classList.toggle(\"queue_btn_active\", oneActive);\r\n\r\n            menu.classList.toggle(\"on_wishlist\", wishlisted);\r\n            menu.classList.toggle(\"on_waitlist\", waitlisted);\r\n\r\n            wishlistArea.style.display = oneActive ? \"none\" : \"\";\r\n            wishlistSuccessArea.style.display = oneActive ? \"\" : \"none\";\r\n\r\n            let text;\r\n            if (wishlisted && !waitlisted) {\r\n                text = Localization.str.on_wishlist;\r\n            } else if (!wishlisted && waitlisted) {\r\n                text = Localization.str.on_waitlist;\r\n            } else if (wishlisted && waitlisted) {\r\n                text = `${Localization.str.on_wishlist} & ${Localization.str.on_waitlist}`;\r\n            } else {\r\n                document.querySelector(\"#add_to_wishlist_area span\").textContent = ` ${Localization.str.add_to_wishlist}`;\r\n                return;\r\n            }\r\n\r\n            document.querySelector(\"#add_to_wishlist_area_success span\").lastChild.textContent = ` ${text}`;\r\n        }\r\n\r\n        updateDiv();\r\n\r\n        wishlistArea.querySelector(\"a\").addEventListener(\"click\", async() => {\r\n\r\n            await Page.runInPageContext(() => new Promise(resolve => {\r\n                const d = window.SteamFacade.jq(document);\r\n                d.ajaxComplete(function handler(e, xhr, {url}) {\r\n                    if (url === \"https://store.steampowered.com/api/addtowishlist\") {\r\n                        resolve();\r\n                        d.unbind(\"ajaxComplete\", handler);\r\n                    }\r\n                });\r\n            }), null, true);\r\n\r\n            wishlisted = !wishlisted;\r\n            updateDiv();\r\n        });\r\n\r\n        this.context.onWishAndWaitlistRemove = () => {\r\n            wishlisted = false;\r\n            waitlisted = false;\r\n            updateDiv();\r\n        };\r\n\r\n        wishlistOption.addEventListener(\"click\", async() => {\r\n            if (wishlisted) {\r\n                await this.context.removeFromWishlist();\r\n                wishlisted = !wishlisted;\r\n                updateDiv();\r\n            } else {\r\n                wishlistArea.querySelector(\"a\").click();\r\n            }\r\n        });\r\n\r\n        waitlistOption.addEventListener(\"click\", async() => {\r\n            if (waitlisted) {\r\n                await this.context.removeFromWaitlist();\r\n            } else {\r\n                await Background.action(\"itad.addtowaitlist\", this.context.appid);\r\n            }\r\n            waitlisted = !waitlisted;\r\n            updateDiv();\r\n        });\r\n    }\r\n}\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FNewQueue extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return document.querySelector(\".finish_queue_text\") !== null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        HTML.afterEnd(\".btn_next_in_queue\",\r\n            `<div id=\"es_new_queue\" class=\"btn_next_in_queue btn_next_in_queue_trigger\" data-tooltip-text=\"${Localization.str.queue.new_tooltip}\">\r\n                <div class=\"next_in_queue_content\">\r\n                    <span class=\"finish_queue_text\">${Localization.str.queue.new}</span>\r\n                </div>\r\n            </div>`);\r\n\r\n        Page.runInPageContext(() => {\r\n            const f = window.SteamFacade;\r\n            f.vTooltip(\"#es_new_queue\");\r\n\r\n            f.jqOnClick(\"#es_new_queue\", () => {\r\n                const queueType = f.global(\"g_eDiscoveryQueueType\");\r\n                f.jqAjax({\r\n                    \"url\": `https://store.steampowered.com/explore/next/${queueType}/`,\r\n                    \"type\": \"POST\",\r\n                    \"data\": f.jq(\"#next_in_queue_form\").serialize(),\r\n                    \"success\": () => { window.location.href = `https://store.steampowered.com/explore/startnew/${queueType}/`; }\r\n\r\n                    // TODO error handling, waiting on #231 and #275 to merge\r\n                });\r\n            });\r\n        });\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML} from \"../../../../modulesCore\";\r\n\r\nexport default class FFullscreenScreenshotView extends Feature {\r\n\r\n    apply() {\r\n\r\n        function toggleFullScreen(ev) {\r\n            if (document.fullscreenElement) {\r\n                document.exitFullscreen();\r\n            } else {\r\n                ev.target.closest(\".screenshot_popup_modal_content\").requestFullscreen();\r\n            }\r\n        }\r\n\r\n        function initFSVButtons() {\r\n            const modalFooter = document.querySelector(\".screenshot_popup_modal_footer\");\r\n            const nextButton = modalFooter.querySelector(\".next\");\r\n            let nextButtonOffsetWidth = nextButton.offsetWidth;\r\n            if (nextButton.style.display === \"none\") {\r\n                nextButton.style.display = \"\";\r\n                nextButtonOffsetWidth = nextButton.offsetWidth;\r\n                nextButton.style.display = \"none\";\r\n            }\r\n            HTML.beforeEnd(modalFooter,\r\n                `<div class=\"btnv6_blue_hoverfade btn_medium es_screenshot_fullscreen_toggle\" style=\"right: calc(${nextButtonOffsetWidth}px + 0.5em)\"><i></i></div>`);\r\n            const fsvButton = modalFooter.querySelector(\".es_screenshot_fullscreen_toggle\");\r\n            fsvButton.addEventListener(\"click\", toggleFullScreen);\r\n\r\n            const modalTitleLink = modalFooter.parentElement.querySelector(\".screenshot_popup_modal_title > a\");\r\n            HTML.beforeEnd(modalFooter,\r\n                `<div class=\"btnv6_blue_hoverfade btn_medium es_screenshot_open_btn\" style=\"right: calc(${nextButtonOffsetWidth + fsvButton.offsetWidth}px + 1em)\"><i></i></div>`);\r\n            const openButton = modalFooter.querySelector(\".es_screenshot_open_btn\");\r\n            openButton.addEventListener(\"click\", () => {\r\n                window.open(modalTitleLink.href, \"_blank\");\r\n            });\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (node.classList.contains(\"screenshot_popup_modal\")) {\r\n                        initFSVButtons();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        observer.observe(document.body, {\"childList\": true});\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {CurrencyManager, Feature, Inventory, Price} from \"../../../modulesContent\";\r\n\r\nexport default class FShowCoupon extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"show_coupon\");\r\n    }\r\n\r\n    async apply() {\r\n        const coupon = await Inventory.getCoupon(this.context.appid);\r\n        if (!coupon) { return; }\r\n\r\n        const couponDate = coupon.valid && coupon.valid.replace(/\\[date](.+)\\[\\/date]/, (m0, m1) => { return new Date(m1 * 1000).toLocaleString(); });\r\n\r\n        HTML.beforeBegin(\"#game_area_purchase\",\r\n            `<div class=\"early_access_header es_coupon_info\">\r\n                <div class=\"heading\">\r\n                    <h1 class=\"inset\">${Localization.str.coupon_available}</h1>\r\n                    <h2 class=\"inset\">${Localization.str.coupon_application_note}</h2>\r\n                    <p>${Localization.str.coupon_learn_more}</p>\r\n                </div>\r\n                <div class=\"devnotes\">\r\n                    <div style=\"display:flex;padding-top:10px\">\r\n                        <img src=\"//steamcommunity-a.akamaihd.net/economy/image/${coupon.image_url}\" style=\"width:96px;height:64px;\">\r\n                        <div style=\"display:flex;flex-direction:column;margin-left:10px\">\r\n                            <h1 style=\"margin-top:2px\">${coupon.title}</h1>\r\n                            <div>${coupon.discount_note || \"\"}</div>\r\n                            <div style=\"color:#a75124\">${couponDate}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        // Update the purchase box with the discounted price\r\n        const purchaseDiv = document.querySelector(\".game_area_purchase_game_wrapper .game_purchase_action\");\r\n        if (!purchaseDiv) { return; }\r\n\r\n        if (purchaseDiv.querySelector(\".game_purchase_discount\") && coupon.discount_doesnt_stack) {\r\n            return;\r\n        }\r\n\r\n        const priceNode = purchaseDiv.querySelector(\"[data-price-final]\");\r\n        if (!priceNode) { return; }\r\n\r\n        const currency = CurrencyManager.fromType(CurrencyManager.storeCurrency);\r\n        const scaleFactor = 10 ** currency.format.decimalPlaces;\r\n\r\n        const originalPrice = Number(priceNode.dataset.priceFinal) / 100;\r\n        const discountPrice = Math.floor(originalPrice * (coupon.discount / 100) * scaleFactor) / scaleFactor;\r\n        const newFinalPrice = originalPrice - discountPrice;\r\n\r\n        HTML.replace(priceNode,\r\n            `<div class=\"discount_block game_purchase_discount\">\r\n                <div class=\"discount_pct\">-${coupon.discount}%</div>\r\n                <div class=\"discount_prices\">\r\n                    <div class=\"discount_original_price\">${new Price(originalPrice)}</div>\r\n                    <div class=\"discount_final_price\">${new Price(newFinalPrice)}</div>\r\n                </div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\nimport Config from \"../../../../config\";\r\n\r\nexport default class FDLCInfo extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return this.context.isDlc();\r\n    }\r\n\r\n    async apply() {\r\n\r\n        let response;\r\n\r\n        try {\r\n            response = await Background.action(\"dlcinfo\", {\"appid\": this.context.appid, \"appname\": this.context.appName});\r\n            // TODO remove when suggestion link is fixed\r\n            if (!response || !response.length) { return; }\r\n        } catch (err) {\r\n            console.error(err);\r\n            return;\r\n        }\r\n\r\n        // const suggestUrl = `${Config.PublicHost}/gamedata/dlc_category_suggest.php?appid=${this.context.appid}&appname=${encodeURIComponent(this.context.appName)}`;\r\n\r\n        let html = `<div class=\"block responsive_apppage_details_right heading\">${Localization.str.dlc_details}</div>\r\n                   <div class=\"block es_dlc_info\">\r\n                   <div class=\"block_content\"><div class=\"block_content_inner\"><div class=\"details_block\">`;\r\n\r\n        for (const item of response) {\r\n            const iconUrl = `${Config.PublicHost}/gamedata/icons/${encodeURIComponent(item.icon)}`;\r\n            const title = HTML.escape(item.desc);\r\n            const name = HTML.escape(item.name);\r\n\r\n            html += `<div class=\"game_area_details_specs\">\r\n                        <div class=\"icon\"><img src=\"${iconUrl}\"></div>\r\n                        <a class=\"name\" title=\"${title}\">${name}</a>\r\n                    </div>`;\r\n        }\r\n\r\n        html += \"</div>\";\r\n        // html += `<br><a class=\"linkbar\" href=\"${suggestUrl}\" target=\"_blank\">${Localization.str.dlc_suggest} <img src=\"//store.steampowered.com/public/images/v5/ico_external_link.gif\"></a>`;\r\n        html += \"</div></div></div>\";\r\n\r\n        HTML.beforeBegin(document.querySelector(\"#category_block\"), html);\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML} from \"../../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\n\r\nexport default class FMetacriticUserScore extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (SyncedStorage.get(\"showmcus\") && document.querySelector(\"#game_area_metascore\")) {\r\n            const result = await this.context.data;\r\n            return result && result.data && result.data.userscore;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async apply() {\r\n        const node = document.querySelector(\"#game_area_metascore\");\r\n        const metauserscore = (await this.context.data).data.userscore * 10;\r\n\r\n        if (!isNaN(metauserscore)) {\r\n            let rating;\r\n            if (metauserscore >= 75) {\r\n                rating = \"high\";\r\n            } else if (metauserscore >= 50) {\r\n                rating = \"medium\";\r\n            } else {\r\n                rating = \"low\";\r\n            }\r\n\r\n            HTML.afterEnd(node,\r\n                `<div id=\"game_area_userscore\">\r\n                    <div class=\"score ${rating}\">${metauserscore}</div>\r\n                    <div class=\"logo\"></div>\r\n                    <div class=\"wordmark\">\r\n                        <div class=\"metacritic\">${Localization.str.user_score}</div>\r\n                    </div>\r\n                </div>`);\r\n        }\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FOpenCritic extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showoc\")) { return false; }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.oc || !result.oc.url) { return false; }\r\n\r\n        return true;\r\n    }\r\n\r\n    async apply() {\r\n        const data = (await this.context.data).oc;\r\n\r\n        const ocImg = ExtensionResources.getURL(\"img/opencritic.png\");\r\n        const award = data.award || \"NA\";\r\n\r\n        let node = document.querySelector(\"#game_area_metascore\");\r\n        if (node) {\r\n            node = node.parentNode;\r\n        } else {\r\n            node = document.querySelector(\".game_details\");\r\n        }\r\n\r\n        HTML.afterEnd(node,\r\n            `<div class=\"block responsive_apppage_reviewblock\">\r\n                <div id=\"game_area_opencritic\">\r\n                    <div class=\"score ${award.toLowerCase()}\">${data.score ? data.score : \"--\"}</div>\r\n                    <div class=\"logo\"><img src=\"${ocImg}\"></div>\r\n                    <div class=\"wordmark\">\r\n                        <div class=\"metacritic\">OpenCritic</div>\r\n                        <div id=\"game_area_metalink\">${award} - <a href=\"${data.url}?utm_source=enhanced-steam-itad&utm_medium=average\" target=\"_blank\">${Localization.str.read_reviews}</a>\r\n                            <img src=\"https://steamstore-a.akamaihd.net/public/images/ico/iconExternalLink.gif\" border=\"0\" align=\"bottom\">\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div style=\"clear: both;\"></div>\r\n            </div>`);\r\n\r\n        let reviews = \"\";\r\n        for (const review of data.reviews) {\r\n            const date = new Date(review.date).toLocaleDateString();\r\n            reviews += `<p>\"${review.snippet}\"<br>${review.dScore} - <a href=\"${review.rUrl}\" target=\"_blank\" data-tooltip-text=\"${review.author}, ${date}\">${review.name}</a></p>`;\r\n        }\r\n\r\n        if (reviews) {\r\n            const html = `<div id=\"es_opencritic_reviews\">\r\n                ${reviews}\r\n                <div class=\"chart-footer\">\r\n                    ${Localization.str.read_more_reviews}\r\n                    <a href=\"${data.url}?utm_source=enhanced-steam-itad&utm_medium=reviews\" target=\"_blank\">OpenCritic.com</a>\r\n                </div>\r\n            </div>`;\r\n\r\n            // Add data to the review section in the left column, or create one if that block doesn't exist\r\n            const reviewsNode = document.getElementById(\"game_area_reviews\");\r\n            if (reviewsNode) {\r\n                HTML.beforeEnd(reviewsNode, html);\r\n            } else {\r\n                HTML.beforeBegin(document.getElementById(\"game_area_description\").parentElement.parentElement,\r\n                    `<div id=\"game_area_reviews\" class=\"game_area_description\">\r\n                        <h2>${Localization.str.reviews}</h2>\r\n                        ${html}\r\n                    </div>`);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Background, Feature} from \"../../../modulesContent\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FOwnedElsewhere extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return !this.context.isOwned() && Background.action(\"itad.isconnected\");\r\n    }\r\n\r\n    async apply() {\r\n        const response = await Background.action(\"itad.getfromcollection\", this.context.storeid);\r\n        if (!response) { return; }\r\n\r\n        const storeList = response.map(store => `<strong>${store}</strong>`).join(\", \");\r\n\r\n        HTML.afterEnd(\".queue_overflow_ctn\",\r\n            `<div class=\"game_area_already_owned page_content\" style=\"background-image: linear-gradient(to right, #856d0e 0%, #d1a906 100%);\">\r\n                <div class=\"ds_owned_flag ds_flag\" style=\"background-color: #856d0e;\">${Localization.str.coll.in_collection.toUpperCase()}&nbsp;&nbsp;</div>\r\n                <div class=\"already_in_library\" style=\"color: #ffe000;\">${Localization.str.owned_elsewhere.replace(\"__gametitle__\", this.context.appName).replace(\"__storelist__\", storeList)}</div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {Language, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, User} from \"../../../modulesContent\";\r\n\r\nexport default class FPurchaseDate extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        if (User.isSignedIn && SyncedStorage.get(\"purchase_dates\")) {\r\n            this._node = document.querySelector(\".game_area_already_owned .already_in_library\");\r\n            return this._node;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    async apply() {\r\n        const appname = this.context.appName.replace(/:/g, \"\").trim();\r\n        const date = await User.getPurchaseDate(Language.getCurrentSteamLanguage(), appname);\r\n        if (!date) {\r\n            console.warn(\"Failed to retrieve purchase date\");\r\n            return;\r\n        }\r\n\r\n        this._node.textContent += ` ${Localization.str.purchase_date.replace(\"__date__\", date)}`;\r\n    }\r\n}\r\n","import {HTML, LocalStorage, Localization} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\nimport FHighlightsTags from \"../../Common/FHighlightsTags\";\r\n\r\nexport default class FSteamPeek extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        this._moreLikeThis = document.querySelector(\"#recommended_block\");\r\n        return this._moreLikeThis;\r\n    }\r\n\r\n    async apply() {\r\n\r\n        HTML.afterEnd(this._moreLikeThis.querySelector(\".block_header\"),\r\n            `<div class=\"es_tabs\">\r\n                <div class=\"home_tabs_row\">\r\n                    <div id=\"es_tab_steamsimilar\" class=\"es_tab home_tab active\">\r\n                        <div class=\"tab_content\">Steam</div>\r\n                    </div>\r\n                    <div id=\"es_tab_steampeek\" class=\"es_tab home_tab\">\r\n                        <div class=\"tab_content\">SteamPeek</div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        HTML.beforeEnd(\r\n            this._moreLikeThis.querySelector(\".store_horizontal_autoslider_ctn\"),\r\n            `<div class=\"block_responsive_horizontal_scroll store_horizontal_autoslider block_content nopad\"\r\n                        id=\"es_steampeek_content\"></div>`,\r\n        );\r\n\r\n        // TODO Create a global handler for DS loading\r\n        await Page.runInPageContext(() => new Promise(resolve => {\r\n            window.SteamFacade.onDynamicStoreReady(() => { resolve(); });\r\n        }), null, true);\r\n\r\n        const [steamTab, steamPeekTab, content] = this._moreLikeThis\r\n            .querySelectorAll(\"#es_tab_steamsimilar, #es_tab_steampeek, #recommended_block_content\");\r\n\r\n        steamTab.addEventListener(\"click\", () => {\r\n            steamPeekTab.classList.remove(\"active\");\r\n            steamTab.classList.add(\"active\");\r\n            content.classList.remove(\"es_sp_active\");\r\n            content.classList.add(\"es_steam_active\");\r\n\r\n            LocalStorage.set(\"steampeek\", false);\r\n\r\n            this._adjustScroller();\r\n        });\r\n\r\n        let spLoaded = false;\r\n        steamPeekTab.addEventListener(\"click\", async() => {\r\n            steamPeekTab.classList.add(\"active\");\r\n            steamTab.classList.remove(\"active\");\r\n            content.classList.add(\"es_sp_active\");\r\n            content.classList.remove(\"es_steam_active\");\r\n\r\n            LocalStorage.set(\"steampeek\", true);\r\n\r\n            if (!spLoaded) {\r\n                spLoaded = true;\r\n\r\n                for (const node of content.querySelectorAll(\":scope > a\")) {\r\n                    node.classList.add(\"es_steam_similar\");\r\n                }\r\n\r\n                const data = await Background.action(\"steampeek\", this.context.appid);\r\n                if (!data) { return; }\r\n\r\n                const lastChild = content.querySelector(\":scope > :last-child\");\r\n\r\n                for (const {title, appid} of data) {\r\n                    HTML.beforeBegin(lastChild,\r\n                        `<a class=\"small_cap es_sp_similar\" data-ds-appid=\"${appid}\" href=\"https://store.steampowered.com/app/${appid}/\">\r\n                            <img src=\"https://steamcdn-a.akamaihd.net/steam/apps/${appid}/capsule_184x69.jpg\" class=\"small_cap_img\"></img>\r\n                            <h4>${title}</h4>\r\n                        </a>`);\r\n\r\n\r\n                    Page.runInPageContext(appid => {\r\n                        window.SteamFacade.storeItemDataBindHover(\"#recommended_block_content > a:last-of-type\", appid);\r\n                    }, [appid]);\r\n                }\r\n\r\n                Page.runInPageContext(() => {\r\n                    window.SteamFacade.dynamicStoreDecorateItems(\"#recommended_block_content > a.es_sp_similar\");\r\n                });\r\n\r\n                FHighlightsTags.highlightAndTag(content.querySelectorAll(\"a.es_sp_similar\"), true);\r\n\r\n                HTML.beforeBegin(lastChild,\r\n                    `<a class=\"small_cap es_sp_similar\" href=\"http://steampeek.hu/?appid=${this.context.appid}\" target=\"_blank\">\r\n                        <div class=\"es_sp_similar__link\">${Localization.str.more_on_steampeek}</div>\r\n                    </a>`);\r\n            }\r\n\r\n            this._adjustScroller();\r\n        });\r\n\r\n        if (LocalStorage.get(\"steampeek\", false)) {\r\n            steamPeekTab.click();\r\n        }\r\n    }\r\n\r\n    _adjustScroller() {\r\n        Page.runInPageContext(() => {\r\n            window.SteamFacade.jq(\"#recommended_block_content\").trigger(\"v_contentschanged\");\r\n        });\r\n    }\r\n}\r\n","import {ExtensionResources, HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../Modules/Feature/Feature\";\r\n\r\nexport default class FWidescreenCertification extends Feature {\r\n\r\n    constructor(context) {\r\n        super(context);\r\n\r\n        this._levelMap = {\r\n            \"A\": \"gold\",\r\n            \"B\": \"silver\",\r\n            \"C\": \"limited\",\r\n            \"Incomplete\": \"incomplete\",\r\n            \"Unsupported\": \"unsupported\"\r\n        };\r\n    }\r\n\r\n    async checkPrerequisites() {\r\n        if (!this.context.isDlc() && SyncedStorage.get(\"showwsgf\")) {\r\n            const result = await this.context.data;\r\n            if (result && result.wsgf) {\r\n                this._data = result.wsgf;\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    _getType(value, imgPrefix, typeName) {\r\n\r\n        let icon = \"\";\r\n        let text = \"\";\r\n\r\n        const level = this._levelMap[value];\r\n        if (level) {\r\n            icon = ExtensionResources.getURL(`img/wsgf/${imgPrefix}-${level}.png`);\r\n            text = Localization.str.wsgf[level].replace(/__type__/g, typeName);\r\n        }\r\n        return [icon, text];\r\n    }\r\n\r\n    apply() {\r\n\r\n        const {\r\n            \"Path\": path,\r\n            \"WideScreenGrade\": wsg,\r\n            \"MultiMonitorGrade\": mmg,\r\n            \"Grade4k\": fkg,\r\n            \"UltraWideScreenGrade\": uws,\r\n        } = this._data;\r\n\r\n        const [wsgIcon, wsgText] = this._getType(wsg, \"ws\", \"Widescreen\");\r\n        const [mmgIcon, mmgText] = this._getType(mmg, \"mm\", \"Multi-Monitor\");\r\n        const [uwsIcon, uwsText] = this._getType(uws, \"uw\", \"Ultra-Widescreen\");\r\n        const [fkgIcon, fkgText] = this._getType(fkg, \"4k\", \"4k UHD\");\r\n\r\n        HTML.afterEnd(\"div.game_details\",\r\n            `<div class=\"block responsive_apppage_details_right heading\">${Localization.str.wsgf.certifications}</div>\r\n            <div class=\"block underlined_links es_wsgf\">\r\n                <div class=\"block_content\">\r\n                    <div class=\"block_content_inner\">\r\n                        <div class=\"details_block\">\r\n                            ${wsg ? `<img src=\"${HTML.escape(wsgIcon)}\" title=\"${HTML.escape(wsgText)}\">` : \"\"}\r\n                            ${mmg ? `<img src=\"${HTML.escape(mmgIcon)}\" title=\"${HTML.escape(mmgText)}\">` : \"\"}\r\n                            ${uws ? `<img src=\"${HTML.escape(uwsIcon)}\" title=\"${HTML.escape(uwsText)}\">` : \"\"}\r\n                            ${fkg ? `<img src=\"${HTML.escape(fkgIcon)}\" title=\"${HTML.escape(fkgText)}\">` : \"\"}\r\n                        </div>\r\n                        <br>\r\n                        <a class=\"linkbar\" target=\"_blank\" href=\"${HTML.escape(path)}\">\r\n                            ${Localization.str.rating_details}\r\n                            <img src=\"//store.steampowered.com/public/images/v5/ico_external_link.gif\">\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\n// import Config from \"../../../../config\";\r\n\r\nexport default class FHowLongToBeat extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showhltb\") || this.context.isDlc()) {\r\n            return false;\r\n        }\r\n\r\n        const result = await this.context.data;\r\n        if (!result || !result.hltb) { return false; }\r\n\r\n        // TODO remove when suggestion link is fixed\r\n        if (!result.hltb.success) { return false; }\r\n\r\n        return true;\r\n    }\r\n\r\n    async apply() {\r\n        const data = (await this.context.data).hltb;\r\n\r\n        // const suggestUrl = `${Config.PublicHost}/gamedata/hltb_link_suggest.php`;\r\n        const icoImg = \"//store.steampowered.com/public/images/v5/ico_external_link.gif\";\r\n\r\n        let html = `<div class=\"block responsive_apppage_details_right heading\">${Localization.str.hltb.title}</div>\r\n                    <div class=\"block game_details underlined_links es_hltb\">\r\n                    <div class=\"block_content\"><div class=\"block_content_inner\"><div class=\"details_block\">`;\r\n\r\n        if (data.success) {\r\n            if (data.main_story) {\r\n                html += `<b>${Localization.str.hltb.main}:</b><span>${HTML.escape(data.main_story)}</span><br>`;\r\n            }\r\n            if (data.main_extras) {\r\n                html += `<b>${Localization.str.hltb.main_e}:</b><span>${HTML.escape(data.main_extras)}</span><br>`;\r\n            }\r\n            if (data.comp) {\r\n                html += `<b>${Localization.str.hltb.compl}:</b><span>${HTML.escape(data.comp)}</span><br>`;\r\n            }\r\n\r\n            html += `</div>\r\n                    <a class=\"linkbar\" href=\"${HTML.escape(data.url)}\" target=\"_blank\">${Localization.str.more_information} <img src=\"${icoImg}\"></a>\r\n                    <a class=\"linkbar\" href=\"${HTML.escape(data.submit_url)}\" target=\"_blank\">${Localization.str.hltb.submit} <img src=\"${icoImg}\"></a>`;\r\n\r\n            // html += `<a class=\"linkbar\" href=\"${suggestUrl}\" id=\"es_hltb_suggest\">${Localization.str.hltb.wrong} ${Localization.str.hltb.help} <img src=\"${icoImg}\"></a>`;\r\n        } else {\r\n            html += `${Localization.str.hltb.no_data}</div>`;\r\n            // html += `<a class=\"linkbar\" href=\"${suggestUrl}\" id=\"es_hltb_suggest\">${Localization.str.hltb.help} <img src=\"${icoImg}\"></a>`;\r\n        }\r\n\r\n        html += \"</div></div></div>\";\r\n\r\n        HTML.afterEnd(\"div.game_details\", html);\r\n\r\n        /*\r\n         * document.querySelector(\"#es_hltb_suggest\").addEventListener(\"click\", () => {\r\n         *    Background.action(\"storepagedata.expire\", this.context.appid);\r\n         * });\r\n         */\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FFamilySharingNotice extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"exfgls\")) { return false; }\r\n\r\n        const result = await this.context.data;\r\n        return result && result.exfgls && result.exfgls.excluded;\r\n    }\r\n\r\n    apply() {\r\n        HTML.beforeBegin(\"#game_area_purchase\",\r\n            `<div id=\"purchase_note\">\r\n                <div class=\"notice_box_top\"></div>\r\n                    <div class=\"notice_box_content\">${Localization.str.family_sharing_notice}</div>\r\n                <div class=\"notice_box_bottom\"></div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {CurrencyManager, Feature, Price} from \"../../../modulesContent\";\r\n\r\nexport default class FPackBreakdown extends Feature {\r\n\r\n    apply() {\r\n\r\n        for (const node of document.querySelectorAll(\".game_area_purchase_game_wrapper:not(.bundle_hidden_by_preferences)\")) {\r\n\r\n            // prevent false positives on packages e.g. Doom 3\r\n            if (node.querySelector(\".btn_packageinfo\")) { continue; }\r\n\r\n            let title = node.querySelector(\"h1\").textContent;\r\n            title = title.toLowerCase().replace(/-/g, \" \");\r\n\r\n            let text = \"\";\r\n            if (node.querySelector(\"p\")) {\r\n                text = node.querySelector(\"p\").textContent;\r\n            }\r\n\r\n            if (title.includes(\"2 pack\")\r\n                || title.includes(\"two pack\")\r\n                || title.includes(\"tower wars friend pack\")\r\n                || text.includes(\"gift copy\")\r\n                || text.includes(\"extra copy\")) {\r\n\r\n                this._splitPack(node, 2);\r\n\r\n            } else if (title.includes(\"3 pack\")\r\n                || title.includes(\"three pack\")\r\n                || title.includes(\"tower wars team pack\")) {\r\n\r\n                this._splitPack(node, 3);\r\n\r\n            } else if (title.includes(\"4 pack\")\r\n                || title.includes(\"four pack\")\r\n                || title.includes(\"clan pack\")) {\r\n\r\n                this._splitPack(node, 4);\r\n\r\n            } else if (title.includes(\"5 pack\")\r\n                || title.includes(\"five pack\")) {\r\n\r\n                this._splitPack(node, 5);\r\n\r\n            } else if (title.includes(\"6 pack\")\r\n                || title.includes(\"six pack\")) {\r\n\r\n                this._splitPack(node, 6);\r\n            }\r\n        }\r\n    }\r\n\r\n    _splitPack(node, ways) {\r\n        const priceNode = node.querySelector(\"[data-price-final]\");\r\n        if (!priceNode) { return; }\r\n\r\n        const currency = CurrencyManager.fromType(CurrencyManager.storeCurrency);\r\n        const scaleFactor = 10 ** currency.format.decimalPlaces;\r\n\r\n        let unitPrice = Number(priceNode.dataset.priceFinal) / 100 / ways;\r\n        unitPrice = Math.ceil(unitPrice * scaleFactor) / scaleFactor;\r\n\r\n        HTML.afterBegin(node.querySelector(\".game_purchase_action_bg\"),\r\n            `<div class=\"es_each_box\">\r\n                <div class=\"es_each_price\">${new Price(unitPrice)}</div>\r\n                <div class=\"es_each\">${Localization.str.each}</div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FPackageInfoButton extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"show_package_info\");\r\n    }\r\n\r\n    apply() {\r\n        for (const node of document.querySelectorAll(\r\n            \".game_area_purchase_game_wrapper:not(.bundle_hidden_by_preferences):not(.game_purchase_sub_dropdown)\"\r\n        )) {\r\n            if (node.querySelector(\".btn_packageinfo\")) { return; } // TODO is it right to return here or in the if clause below?\r\n\r\n            const subid = node.querySelector(\"input[name=subid]\");\r\n            if (!subid) { return; }\r\n\r\n            HTML.afterBegin(node.querySelector(\".game_purchase_action\"),\r\n                `<div class=\"game_purchase_action_bg\">\r\n                    <div class=\"btn_addtocart btn_packageinfo\">\r\n                        <a class=\"btn_blue_steamui btn_medium\" href=\"//store.steampowered.com/sub/${subid.value}/\">\r\n                            <span>${Localization.str.package_info}</span>\r\n                        </a>\r\n                    </div>\r\n                </div>`);\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FSteamChart extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"show_steamchart_info\")\r\n            || this.context.isDlc()\r\n            || !document.querySelector(\".sys_req\")) { return false; }\r\n\r\n        const result = await this.context.data;\r\n        if (result && result.charts && result.charts.chart && result.charts.chart.peakall) {\r\n            this._chart = result.charts.chart;\r\n        }\r\n\r\n        return typeof this._chart !== \"undefined\";\r\n    }\r\n\r\n    apply() {\r\n        HTML.beforeBegin(document.querySelector(\".sys_req\").parentNode,\r\n            `<div id=\"steam-charts\" class=\"game_area_description\">\r\n                <h2>${Localization.str.charts.current}</h2>\r\n                <div class=\"chart-content\">\r\n                    <div class=\"chart-stat\"><span class=\"num\">${HTML.escape(this._chart.current)}</span><br>${Localization.str.charts.playing_now}</div>\r\n                    <div class=\"chart-stat\"><span class=\"num\">${HTML.escape(this._chart.peaktoday)}</span><br>${Localization.str.charts.peaktoday}</div>\r\n                    <div class=\"chart-stat\"><span class=\"num\">${HTML.escape(this._chart.peakall)}</span><br>${Localization.str.charts.peakall}</div>\r\n                </div>\r\n                <span class=\"chart-footer\">${Localization.str.powered_by.replace(\"__link__\", `<a href=\"https://steamcharts.com/app/${this.context.appid}\" target=\"_blank\">SteamCharts.com</a>`)}</span>\r\n            </div>`);\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FSteamSpy extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"show_steamspy_info\")\r\n            || this.context.isDlc()\r\n            || !document.querySelector(\".sys_req\")) {\r\n            return false;\r\n        }\r\n\r\n        const result = await this.context.data;\r\n        if (result && result.steamspy && result.steamspy.owners) {\r\n            this._data = result.steamspy;\r\n        }\r\n\r\n        return typeof this._data !== \"undefined\";\r\n    }\r\n\r\n    apply() {\r\n\r\n        const owners = this._data.owners.split(\"..\");\r\n        const ownersFrom = HTML.escape(owners[0].trim());\r\n        const ownersTo = HTML.escape(owners[1].trim());\r\n        const averageTotal = this._getTimeString(this._data.average_forever);\r\n        const average2weeks = this._getTimeString(this._data.average_2weeks);\r\n\r\n        HTML.beforeBegin(document.querySelector(\".sys_req\").parentNode,\r\n            `<div id=\"steam-spy\" class=\"game_area_description\">\r\n                <h2>${Localization.str.spy.player_data}</h2>\r\n                <div class=\"chart-content\">\r\n                    <div class=\"chart-stat\"><span class=\"num\">${ownersFrom}<br>-<br>${ownersTo}</span><br>${Localization.str.spy.owners}</div>\r\n                    <div class=\"chart-stat\"><span class=\"num\">${averageTotal}</span><br>${Localization.str.spy.average_playtime}</div>\r\n                    <div class=\"chart-stat\"><span class=\"num\">${average2weeks}</span><br>${Localization.str.spy.average_playtime_2weeks}</div>\r\n                </div>\r\n                <span class=\"chart-footer\">${Localization.str.powered_by.replace(\"__link__\", `<a href=\"https://steamspy.com/app/${this.context.appid}\" target=\"_blank\">steamspy.com</a>`)}</span>\r\n            </div>`);\r\n    }\r\n\r\n    _getTimeString(value) {\r\n\r\n        const days = Math.trunc(value / 1440);\r\n        let _value = value;\r\n        _value -= days * 1440;\r\n\r\n        const hours = Math.trunc(_value / 60);\r\n        _value -= hours * 60;\r\n\r\n        const minutes = _value;\r\n\r\n        let result = \"\";\r\n        if (days > 0) { result += `${days}d `; }\r\n        result += `${hours}h ${minutes}m`;\r\n\r\n        return result;\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FSurveyData extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (this.context.isVideo() || this.context.isDlc() || !document.querySelector(\".sys_req\")) { return false; }\r\n\r\n        const result = await this.context.data;\r\n        if (result && result.survey) {\r\n            this._survey = result.survey;\r\n        }\r\n\r\n        return typeof this._survey !== \"undefined\";\r\n    }\r\n\r\n    apply() {\r\n\r\n        const survey = this._survey;\r\n        let html = `<div id=\"performance_survey\" class=\"game_area_description\"><h2>${Localization.str.survey.performance_survey}</h2>`;\r\n\r\n        if (survey.success) {\r\n            html += `<p>${Localization.str.survey.users.replace(\"__users__\", survey.responses)}</p>`;\r\n\r\n            html += `<p><b>${Localization.str.survey.framerate}</b>: ${Math.round(survey.frp)}% ${Localization.str.survey.framerate_response}`;\r\n            switch (survey.fr) {\r\n                case \"30\": html += ` <span style=\"color: #8f0e10;\">${Localization.str.survey.framerate_30}</span>`; break;\r\n                case \"fi\": html += ` <span style=\"color: #e1c48a;\">${Localization.str.survey.framerate_fi}</span>`; break;\r\n                case \"va\": html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.framerate_va}</span>`; break;\r\n            }\r\n\r\n            html += `<br><b>${Localization.str.survey.resolution}</b>: ${Localization.str.survey.resolution_support}`;\r\n            switch (survey.mr) {\r\n                case \"less\": html += ` <span style=\"color: #8f0e10;\">${Localization.str.survey.resolution_less.replace(\"__pixels__\", \"1920x1080\")}</span>`; break;\r\n                case \"hd\": html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.resolution_up.replace(\"__pixels__\", \"1920x1080 (HD)\")}</span>`; break;\r\n                case \"wqhd\": html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.resolution_up.replace(\"__pixels__\", \"2560x1440 (WQHD)\")}</span>`; break;\r\n                case \"4k\": html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.resolution_up.replace(\"__pixels__\", \"3840x2160 (4K)\")}</span>`; break;\r\n            }\r\n\r\n            html += `<br><b>${Localization.str.survey.graphics_settings}</b>:`;\r\n            if (survey.gs) {\r\n                html += ` <span style=\"color: #8BC53F;\">${Localization.str.survey.gs_y}</span></p>`;\r\n            } else {\r\n                html += ` <span style=\"color: #8f0e10;\">${Localization.str.survey.gs_n}</span></p>`;\r\n            }\r\n\r\n            if ([\"nvidia\", \"amd\", \"intel\", \"other\"].some(key => key in survey)) {\r\n                html += `<p><b>${Localization.str.survey.satisfaction}</b>:</p><div class=\"performance-graph\">`;\r\n\r\n                if (\"nvidia\" in survey) { html += this._getBarHtml(\"Nvidia\", survey.nvidia); }\r\n                if (\"amd\" in survey) { html += this._getBarHtml(\"AMD\", survey.amd); }\r\n                if (\"intel\" in survey) { html += this._getBarHtml(\"Intel\", survey.intel); }\r\n                if (\"other\" in survey) { html += this._getBarHtml(\"Other\", survey.other); }\r\n\r\n                html += \"</div>\";\r\n            }\r\n        } else {\r\n            html += `<p>${Localization.str.survey.nobody}</p>`;\r\n        }\r\n\r\n        /*\r\n         * FIXME\r\n         * if (this.context.isOwned() && document.getElementById(\"my_activity\")) {\r\n         *   html += `<a class=\"btnv6_blue_blue_innerfade btn_medium es_btn_systemreqs\"\r\n         *      href=\"${Config.PublicHost}/survey/?appid=${this.context.appid}\"><span>${Localization.str.survey.take}</span></a>`;\r\n         * }\r\n         */\r\n\r\n        html += \"</div>\";\r\n\r\n        HTML.beforeBegin(document.querySelector(\".sys_req\").parentNode, html);\r\n    }\r\n\r\n    _getBarHtml(name, data) {\r\n        if (data > 90 || data < 10) {\r\n            return `<div class=\"row\"><div class=\"left-bar ${name.toLowerCase()}\" style=\"width: ${parseInt(data)}%;\"><span>${name}&nbsp;${data}%</span></div><div class=\"right-bar\" style=\"width: ${parseInt(100 - data)}%;\"></div></div>`;\r\n        } else {\r\n            return `<div class=\"row\"><div class=\"left-bar ${name.toLowerCase()}\" style=\"width: ${parseInt(data)}%;\"><span>${name}</span></div><div class=\"right-bar\" style=\"width: ${parseInt(100 - data)}%;\"><span>${data}%</span></div></div>`;\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, Feature, Messenger} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FCustomizer extends Feature {\r\n\r\n    apply() {\r\n\r\n        HTML.afterBegin(\"#cart_status_data\",\r\n            `<div class=\"store_header_btn_gray store_header_btn\" id=\"es_customize_btn\">\r\n                <div class=\"es_customize_title\">${Localization.str.customize}<img src=\"//steamstore-a.akamaihd.net/public/images/v6/btn_arrow_down_padded_white.png\"></div>\r\n                <div class=\"home_viewsettings_popup\">\r\n                    <div class=\"home_viewsettings_instructions\">${Localization.str.apppage_sections}</div>\r\n                </div>\r\n            </div>`);\r\n\r\n        const customizeBtn = document.getElementById(\"es_customize_btn\");\r\n\r\n        customizeBtn.addEventListener(\"click\", () => {\r\n            customizeBtn.classList.toggle(\"active\");\r\n        });\r\n\r\n        customizeBtn.querySelector(\".home_viewsettings_popup\").addEventListener(\"click\", e => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        customizeBtn.addEventListener(\"mouseleave\", () => {\r\n            customizeBtn.classList.remove(\"active\");\r\n        });\r\n\r\n        if (this.context.type === ContextType.APP) {\r\n            this._customizeAppPage();\r\n        } else if (this.context.type === ContextType.STORE_FRONT) {\r\n\r\n            Messenger.onMessage(\"renderComplete\").then(() => { this._customizeFrontPage(); });\r\n\r\n            /*\r\n             * Run our customizer when GHomepage.bInitialRenderComplete is set to `true`\r\n             * https://github.com/SteamDatabase/SteamTracking/blob/d22d8df5db80e844f7ae1157dbb8b59532dfe4f8/store.steampowered.com/public/javascript/home.js#L432\r\n             */\r\n            Page.runInPageContext(() => {\r\n\r\n                // eslint-disable-next-line no-undef\r\n                if (GHomepage.bInitialRenderComplete) {\r\n                    window.Messenger.postMessage(\"renderComplete\");\r\n                    return;\r\n                }\r\n\r\n                // eslint-disable-next-line no-undef\r\n                GHomepage = new Proxy(GHomepage, {\r\n                    set(target, prop, value, ...args) {\r\n                        if (prop === \"bInitialRenderComplete\" && value === true) {\r\n                            window.Messenger.postMessage(\"renderComplete\");\r\n                        }\r\n\r\n                        return Reflect.set(target, prop, value, ...args);\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    _customizeAppPage() {\r\n\r\n        function getParentEl(selector) {\r\n            const el = document.querySelector(selector);\r\n            return el && el.closest(\".game_page_autocollapse_ctn\");\r\n        }\r\n\r\n        const customizer = new FCustomizer.Customizer(\"customize_apppage\");\r\n        customizer\r\n            .add(\"franchisenotice\", \".franchise_notice\", Localization.str.apppage_franchise)\r\n            .add(\"eaheader\", \".early_access_header:not(.es_coupon_info)\", Localization.str.apppage_eaheader)\r\n            .add(\"eabanner\", \".early_access_banner\", Localization.str.apppage_eabanner)\r\n            .add(\"recentupdates\", \"[data-featuretarget=events-row]\", Localization.str.apppage_recentupdates)\r\n            .add(\"reviews\", \"#game_area_reviews\")\r\n            .add(\"about\", getParentEl(\"#game_area_description\"))\r\n            .add(\"contentwarning\", getParentEl(\"#game_area_content_descriptors\"))\r\n            .add(\"steamchart\", \"#steam-charts\")\r\n            .add(\"surveys\", \"#performance_survey\")\r\n            .add(\"steamspy\", \"#steam-spy\")\r\n            .add(\"sysreq\", getParentEl(\".sys_req\"))\r\n            .add(\"legal\", getParentEl(\"#game_area_legal\"), Localization.str.apppage_legal)\r\n            .add(\"moredlcfrombasegame\", \"#moredlcfrombasegame_block\")\r\n            .add(\"franchise\", \"#franchise_block\", Localization.str.apppage_morefromfranchise)\r\n            .add(\"morelikethis\", \"#recommended_block\")\r\n            .add(\"recommendedbycurators\", \".steam_curators_block\")\r\n            .add(\"customerreviews\", \"#app_reviews_hash\")\r\n            .add(\"workshop\", getParentEl(\"[href^='https://steamcommunity.com/workshop/browse']\"), Localization.str.apppage_workshop)\r\n            .add(\"greenlight\", getParentEl(\"[href^='https://steamcommunity.com/greenlight']\"), Localization.str.apppage_greenlight);\r\n\r\n        customizer.build();\r\n    }\r\n\r\n    _customizeFrontPage() {\r\n\r\n        function getParentEl(selector) {\r\n            const el = document.querySelector(selector);\r\n            return el && el.closest(\".home_ctn\");\r\n        }\r\n\r\n        const customizer = new FCustomizer.Customizer(\"customize_frontpage\");\r\n        customizer\r\n            .add(\"featuredrecommended\", \".home_cluster_ctn\")\r\n            .add(\"trendingamongfriends\", \".friends_recently_purchased\", \"\", true)\r\n            .add(\"discoveryqueue\", \".discovery_queue_ctn\")\r\n            .add(\"curators\", \".steam_curators_ctn\", Localization.str.homepage_curators)\r\n            .add(\"morecuratorrecommendations\", \".apps_recommended_by_curators_ctn\", Localization.str.homepage_curators)\r\n            .add(\"fromdevelopersandpublishersthatyouknow\", \".recommended_creators_ctn\")\r\n            .add(\"popularvrgames\", \".best_selling_vr_ctn\")\r\n            .add(\"homepagetabs\", \".tab_container\", Localization.str.homepage_tabs)\r\n            .add(\"gamesstreamingnow\", \".live_streams_ctn\", \"\", true)\r\n            .add(\"updatesandoffers\", \".marketingmessage_area\", \"\", true)\r\n            .add(\"topnewreleases\", \".top_new_releases\", Localization.str.homepage_topnewreleases)\r\n            .add(\"homepagesidebar\", \"body:not(.no_home_gutter) .home_page_gutter\", Localization.str.homepage_sidebar)\r\n            .add(\"specialoffers\", getParentEl(\".special_offers\"))\r\n            .add(\"browsesteam\", getParentEl(\".big_buttons.home_page_content\"))\r\n            .add(\"recentlyupdated\", getParentEl(\".recently_updated_block\"))\r\n            .add(\"under\", getParentEl(\"[class*='specials_under']\"));\r\n\r\n        for (const node of document.querySelectorAll(\r\n            \".home_page_body_ctn .home_ctn:not(.esi-customizer), .home_pagecontent_ctn\"\r\n        )) {\r\n            if (node.closest(\".esi-customizer\")\r\n                || node.querySelector(\".esi-customizer\")\r\n                || node.style.display === \"none\") { continue; }\r\n\r\n            customizer.addDynamic(node);\r\n        }\r\n\r\n        customizer.build();\r\n    }\r\n}\r\n\r\nFCustomizer.Customizer = class {\r\n\r\n    constructor(settingsName) {\r\n        this.settingsName = settingsName;\r\n        this.settings = SyncedStorage.get(settingsName);\r\n    }\r\n\r\n    _textValue(node) {\r\n        const textNode = node.querySelector(\"h1, h2, .home_title, .home_section_title\");\r\n        if (!textNode) { return \"\"; }\r\n        let str = \"\";\r\n        for (const node of textNode.childNodes) {\r\n            if (node.nodeType === Node.TEXT_NODE) {\r\n                str += node.textContent.trim();\r\n            }\r\n        }\r\n        return str;\r\n    }\r\n\r\n    _updateState(name, state) {\r\n        this.settings[name] = state;\r\n        SyncedStorage.set(this.settingsName, this.settings);\r\n    }\r\n\r\n    _getState(name) {\r\n        const state = this.settings[name];\r\n        return (typeof state === \"undefined\") || state;\r\n    }\r\n\r\n    add(name, targets, text, forceShow = false) {\r\n\r\n        let _text = text;\r\n        let elements;\r\n\r\n        if (typeof targets === \"string\") {\r\n            elements = document.querySelectorAll(targets);\r\n        } else if (targets instanceof Element) {\r\n            elements = [targets];\r\n        } else if (targets instanceof NodeList) {\r\n            elements = targets;\r\n        } else {\r\n            return this;\r\n        }\r\n\r\n        if (!elements.length) { return this; }\r\n\r\n        const state = this._getState(name);\r\n\r\n        for (const element of elements) {\r\n\r\n            if (getComputedStyle(element).display === \"none\" && !forceShow) {\r\n                continue;\r\n            }\r\n\r\n            if (typeof _text !== \"string\" || _text === \"\") {\r\n                _text = this._textValue(element).toLowerCase();\r\n                if (_text === \"\") { continue; }\r\n            }\r\n \r\n            element.classList.toggle(\"esi-shown\", state);\r\n            element.classList.toggle(\"esi-hidden\", !state);\r\n            element.classList.add(\"esi-customizer\");\r\n            element.dataset.esName = name;\r\n            element.dataset.esText = _text;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    addDynamic(node) {\r\n        const text = this._textValue(node).toLowerCase();\r\n        if (text === \"\") { return; }\r\n\r\n        this.add(`dynamic_${text}`, node, text);\r\n    }\r\n\r\n    build() {\r\n\r\n        const customizerEntries = new Map();\r\n\r\n        for (const element of document.querySelectorAll(\".esi-customizer\")) {\r\n\r\n            const name = element.dataset.esName;\r\n\r\n            if (customizerEntries.has(name)) {\r\n                customizerEntries.get(name).push(element);\r\n            } else {\r\n\r\n                const state = element.classList.contains(\"esi-shown\");\r\n                const text = element.dataset.esText;\r\n\r\n                HTML.beforeEnd(\"#es_customize_btn .home_viewsettings_popup\",\r\n                    `<div class=\"home_viewsettings_checkboxrow ellipsis\" id=\"${name}\">\r\n                        <div class=\"home_viewsettings_checkbox ${state ? \"checked\" : \"\"}\"></div>\r\n                        <div class=\"home_viewsettings_label\">${text}</div>\r\n                    </div>`);\r\n\r\n                customizerEntries.set(name, [element]);\r\n            }\r\n        }\r\n\r\n        for (const [name, elements] of customizerEntries) {\r\n            const checkboxrow = document.getElementById(name);\r\n            checkboxrow.addEventListener(\"click\", e => {\r\n                const state = !checkboxrow.querySelector(\".checked\");\r\n\r\n                for (const element of elements) {\r\n                    element.classList.toggle(\"esi-shown\", state);\r\n                    element.classList.toggle(\"esi-hidden\", !state);\r\n                }\r\n\r\n                e.target.closest(\".home_viewsettings_checkboxrow\")\r\n                    .querySelector(\".home_viewsettings_checkbox\").classList.toggle(\"checked\", state);\r\n\r\n                this._updateState(name, state);\r\n            });\r\n        }\r\n    }\r\n};\r\n","import {HTML, Localization} from \"../../../../modulesCore\";\r\nimport {Feature, Price, User} from \"../../../modulesContent\";\r\n\r\nexport default class FDLCCheckboxes extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        // check if the page has at least one purchasable DLC available\r\n        return document.querySelector(\".game_area_dlc_section .game_area_dlc_list input[name^=subid]\") !== null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const dlcSection = document.querySelector(\".game_area_dlc_section\");\r\n\r\n        for (const dlcRow of dlcSection.querySelectorAll(\".game_area_dlc_row\")) {\r\n            const subidNode = dlcRow.querySelector(\"input[name^=subid]\");\r\n            if (!subidNode) { continue; }\r\n\r\n            const label = document.createElement(\"label\");\r\n            label.classList.add(\"es_dlc_label\");\r\n\r\n            // Add dsinfo to label for use with select/unselect all\r\n            if (dlcRow.classList.contains(\"ds_wishlist\")) {\r\n                label.classList.add(\"es_dlc_wishlist\");\r\n            } else if (dlcRow.classList.contains(\"ds_owned\")) {\r\n                label.classList.add(\"es_dlc_owned\");\r\n            }\r\n\r\n            const checkbox = document.createElement(\"input\");\r\n            checkbox.type = \"checkbox\";\r\n            checkbox.dataset.esDlcSubid = subidNode.value;\r\n\r\n            // Must check \".discount_final_price\" first to get the correct price\r\n            const priceNode = dlcRow.querySelector(\".discount_final_price\")\r\n                || dlcRow.querySelector(\".game_area_dlc_price\");\r\n\r\n            const price = Price.parseFromString(priceNode.textContent);\r\n            if (price !== null) {\r\n                checkbox.dataset.esDlcPrice = price.value;\r\n            }\r\n\r\n            label.append(checkbox);\r\n            dlcRow.insertAdjacentElement(\"beforebegin\", label);\r\n        }\r\n\r\n        // Toggle dsinfo on label when adding/removing wishlist via ds_options dropdown\r\n        new MutationObserver(mutations => {\r\n            for (const {target} of mutations) {\r\n                if (!target.classList.contains(\"game_area_dlc_row\")) { continue; }\r\n                target.previousElementSibling.classList.toggle(\"es_dlc_wishlist\", target.classList.contains(\"ds_wishlist\"));\r\n            }\r\n        }).observe(dlcSection.querySelector(\".gameDlcBlocks\"), {\"subtree\": true, \"attributeFilter\": [\"class\"]});\r\n\r\n        const html = `<div class=\"game_purchase_action game_purchase_action_bg\" id=\"es_selected_btn\">\r\n                <div class=\"game_purchase_price price\"></div>\r\n                <div class=\"btn_addtocart\">\r\n                    <a class=\"btn_green_steamui btn_medium\">\r\n                        <span>${Localization.str.add_selected_dlc_to_cart}</span>\r\n                    </a>\r\n                </div>\r\n            </div>`;\r\n\r\n        const expandedNode = dlcSection.querySelector(\"#game_area_dlc_expanded\");\r\n        if (expandedNode) {\r\n            HTML.afterEnd(expandedNode, html);\r\n            HTML.afterEnd(dlcSection, '<div style=\"clear: both;\"></div>');\r\n        } else {\r\n            HTML.afterEnd(dlcSection.querySelector(\".gameDlcBlocks\"), html);\r\n        }\r\n\r\n        const cartForm = document.createElement(\"form\");\r\n        cartForm.name = \"add_selected_dlc_to_cart\";\r\n        cartForm.action = \"/cart/\";\r\n        cartForm.method = \"POST\";\r\n\r\n        const cartBtn = dlcSection.querySelector(\"#es_selected_btn\");\r\n        cartBtn.insertAdjacentElement(\"beforebegin\", cartForm);\r\n        cartBtn.addEventListener(\"click\", () => { cartForm.submit(); });\r\n\r\n        HTML.afterEnd(dlcSection.querySelector(\".gradientbg\"),\r\n            `<div id=\"es_dlc_option_panel\">\r\n                <div class=\"es_dlc_option\" id=\"unowned_dlc_check\">${Localization.str.dlc_select.unowned_dlc}</div>\r\n                <div class=\"es_dlc_option\" id=\"wl_dlc_check\">${Localization.str.dlc_select.wishlisted_dlc}</div>\r\n                <div class=\"es_dlc_option\" id=\"no_dlc_check\">${Localization.str.dlc_select.none}</div>\r\n            </div>`);\r\n\r\n        dlcSection.querySelector(\"#unowned_dlc_check\").addEventListener(\"click\", () => {\r\n            const nodes = dlcSection.querySelectorAll(\".es_dlc_label:not(.es_dlc_owned) > input\");\r\n            for (const node of nodes) {\r\n                node.checked = true;\r\n            }\r\n            dlcSection.dispatchEvent(new Event(\"change\"));\r\n        });\r\n\r\n        dlcSection.querySelector(\"#wl_dlc_check\").addEventListener(\"click\", () => {\r\n            const nodes = dlcSection.querySelectorAll(\".es_dlc_label.es_dlc_wishlist > input\");\r\n            for (const node of nodes) {\r\n                node.checked = true;\r\n            }\r\n            dlcSection.dispatchEvent(new Event(\"change\"));\r\n        });\r\n\r\n        dlcSection.querySelector(\"#no_dlc_check\").addEventListener(\"click\", () => {\r\n            const nodes = dlcSection.querySelectorAll(\".es_dlc_label > input:checked\");\r\n            for (const node of nodes) {\r\n                node.checked = false;\r\n            }\r\n            dlcSection.dispatchEvent(new Event(\"change\"));\r\n        });\r\n\r\n        function createHiddenInput(name, value) {\r\n            const input = document.createElement(\"input\");\r\n            input.type = \"hidden\";\r\n            input.name = name;\r\n            input.value = value;\r\n\r\n            return input;\r\n        }\r\n\r\n        const inputAction = createHiddenInput(\"action\", \"add_to_cart\");\r\n        const inputSessionId = createHiddenInput(\"sessionid\", User.sessionId);\r\n\r\n        dlcSection.addEventListener(\"change\", () => {\r\n\r\n            cartForm.innerHTML = \"\";\r\n            cartForm.append(inputAction, inputSessionId);\r\n\r\n            let total = 0;\r\n            for (const node of dlcSection.querySelectorAll(\".es_dlc_label > input:checked\")) {\r\n\r\n                cartForm.append(createHiddenInput(\"subid[]\", node.dataset.esDlcSubid));\r\n\r\n                if (node.dataset.esDlcPrice) {\r\n                    total += Number(node.dataset.esDlcPrice);\r\n                }\r\n            }\r\n\r\n            if (total > 0) {\r\n                cartBtn.querySelector(\".game_purchase_price\").textContent = new Price(total);\r\n                cartBtn.style.display = \"block\";\r\n            } else {\r\n                cartBtn.style.display = \"none\";\r\n            }\r\n        });\r\n    }\r\n}\r\n","import {Background, DOMHelper, Feature, User} from \"../../../modulesContent\";\r\nimport {HTML, HTMLParser, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\nexport default class FBadgeProgress extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return this.context.hasCards && User.isSignedIn && SyncedStorage.get(\"show_badge_progress\");\r\n    }\r\n\r\n    async apply() {\r\n\r\n        DOMHelper.insertStylesheet(\"//steamcommunity-a.akamaihd.net/public/css/skin_1/badges.css\");\r\n\r\n        HTML.afterEnd(\"#category_block\",\r\n            `<div id=\"es_badge_progress\" class=\"block responsive_apppage_details_right heading\">\r\n                ${Localization.str.badge_progress}\r\n            </div>\r\n            <div id=\"es_badge_progress_content\" class=\"block responsive_apppage_details_right\">\r\n                <div class=\"block_content_inner es_badges_progress_block\" style=\"display:none;\">\r\n                    <div class=\"es_normal_badge_progress es_progress_block\" style=\"display:none;\"></div>\r\n                    <div class=\"es_foil_badge_progress es_progress_block\" style=\"display:none;\"></div>\r\n                </div>\r\n            </div>`);\r\n\r\n        const appid = this.context.communityAppid;\r\n\r\n        try {\r\n            await Promise.all([\r\n                Background.action(\"cards\", appid)\r\n                    .then(result => { this._loadBadgeContent(\".es_normal_badge_progress\", result); }),\r\n                Background.action(\"cards\", appid, true)\r\n                    .then(result => { this._loadBadgeContent(\".es_foil_badge_progress\", result); }),\r\n            ]);\r\n        } catch (err) {\r\n            document.getElementById(\"es_badge_progress\").remove();\r\n            document.getElementById(\"es_badge_progress_content\").remove();\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    _loadBadgeContent(targetSelector, result) {\r\n        const dummy = HTMLParser.htmlToDOM(result);\r\n\r\n        /*\r\n         * grap badge and game cards\r\n         * when there is no badge (e.g. dlc), badge_gamecard_page class won't appear\r\n         */\r\n        const badge = dummy.querySelector(\".badge_gamecard_page\");\r\n        if (badge) {\r\n            this._displayBadgeInfo(targetSelector, badge);\r\n        } else {\r\n            document.getElementById(\"es_badge_progress\").remove();\r\n            document.getElementById(\"es_badge_progress_content\").remove();\r\n        }\r\n    }\r\n\r\n    _displayBadgeInfo(targetSelector, badgeNode) {\r\n        const blockSel = document.querySelector(targetSelector);\r\n\r\n        // show Steam badge info card\r\n        const badge = badgeNode.querySelector(\".badge_current\");\r\n        blockSel.append(badge);\r\n\r\n        // count card\r\n        const cardNumOwned = badgeNode.querySelectorAll(\".badge_detail_tasks .owned\").length;\r\n        const cardNumTotal = badgeNode.querySelectorAll(\".badge_detail_tasks .badge_card_set_card\").length;\r\n\r\n        // check if badge is completed\r\n        const progress = badgeNode.querySelector(\".gamecard_badge_progress\");\r\n        const progressTextLength = progress ? progress.textContent.trim().length : 0;\r\n        const nextLevelEmptyBadge = badgeNode.querySelectorAll(\".gamecard_badge_progress .badge_info\").length;\r\n        const badgeCompleted = (progressTextLength > 0 && nextLevelEmptyBadge === 0);\r\n\r\n        const showCardNum = (cardNumOwned > 0 && !badgeCompleted);\r\n        const isNormalBadge = targetSelector === \".es_normal_badge_progress\";\r\n\r\n        if (isNormalBadge || (cardNumOwned > 0 || !blockSel.querySelector(\".badge_empty_circle\"))) {\r\n            blockSel.parentNode.style.display = \"block\";\r\n            blockSel.style.display = \"block\";\r\n\r\n            const progressBold = badgeNode.querySelector(\".progress_info_bold\");\r\n\r\n            HTML.beforeEnd(blockSel,\r\n                `<div class=\"es_cards_numbers\">\r\n                    <div class=\"es_cards_remaining\">${progressBold ? progressBold.textContent : \"\"}</div>\r\n                </div>\r\n                <div class=\"game_area_details_specs\">\r\n                    <div class=\"icon\"><img src=\"//store.steampowered.com/public/images/v6/ico/ico_cards.png\" class=\"category_icon\"></div>\r\n                    <a href=\"//steamcommunity.com/my/gamecards/${this.context.communityAppid}${isNormalBadge ? \"/\" : \"?border=1\"}\" class=\"name\">${badgeCompleted ? Localization.str.view_badge : Localization.str.view_badge_progress}</a>\r\n                </div>`);\r\n\r\n            if (showCardNum) {\r\n                HTML.beforeEnd(blockSel.querySelector(\".es_cards_numbers\"),\r\n                    `<div class=\"es_cards_owned\">${Localization.str.cards_owned.replace(\"__owned__\", cardNumOwned).replace(\"__possible__\", cardNumTotal)}</div>`);\r\n            }\r\n\r\n            const last = blockSel.querySelector(\".badge_empty_right div:last-child\");\r\n            if (last) {\r\n                last.classList.add(\"badge_empty_name\");\r\n                last.style = \"\";\r\n                last.textContent = Localization.str.badge_not_unlocked;\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {ExtensionResources, HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\n// todo maybe integrate with other useful links?\r\nexport default class FAStatsLink extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showastatslink\") && this.context.hasAchievements();\r\n    }\r\n\r\n    apply() {\r\n        const imgUrl = ExtensionResources.getURL(\"img/ico/astatsnl.png\");\r\n        const url = `https://astats.astats.nl/astats/Steam_Game_Info.php?AppID=${this.context.communityAppid}`;\r\n\r\n        HTML.beforeEnd(\"#achievement_block\",\r\n            `<div class=\"game_area_details_specs\">\r\n                <div class=\"icon\"><img class=\"astats_icon\" src=\"${imgUrl}\"></div>\r\n                <a class=\"name\" href=\"${url}\" target=\"_blank\">${Localization.str.view_astats}</a>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, Stats} from \"../../../modulesContent\";\r\n\r\nexport default class FAchievementBar extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showachinstore\") && this.context.hasAchievements() && document.getElementById(\"my_activity\");\r\n    }\r\n\r\n    async apply() {\r\n        const achieveBar = await Stats.getAchievementBar(\"/my\", this.context.communityAppid);\r\n        if (!achieveBar) {\r\n            console.warn(\"Failed to retrieve achievement stats\");\r\n            return;\r\n        }\r\n\r\n        HTML.afterBegin(\"#my_activity\", `<div class=\"es-achieveBar-store\">${achieveBar}</div>`);\r\n    }\r\n}\r\n","import {HTMLParser} from \"../../Core/Html/HtmlParser\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {Background} from \"./Background\";\r\n\r\nclass Stats {\r\n\r\n    static async getAchievementBar(path, appid) {\r\n\r\n        const html = await Background.action(\"stats\", path, appid);\r\n        const dummy = HTMLParser.htmlToDOM(html);\r\n        const achNode = dummy.querySelector(\"#topSummaryAchievements\");\r\n\r\n        if (!achNode) { return null; }\r\n\r\n        achNode.style.whiteSpace = \"nowrap\";\r\n\r\n        if (!achNode.querySelector(\"img\")) {\r\n\r\n            // The size of the achievement bars for games without leaderboards/other stats is fine, return\r\n            return achNode.innerHTML;\r\n        }\r\n\r\n        const stats = achNode.innerHTML.match(/(\\d+) of (\\d+) \\((\\d{1,3})%\\)/);\r\n\r\n        // 1 full match, 3 group matches\r\n        if (!stats || stats.length !== 4) {\r\n            return null;\r\n        }\r\n\r\n        const achievementStr = Localization.str.achievements.summary\r\n            .replace(\"__unlocked__\", stats[1])\r\n            .replace(\"__total__\", stats[2])\r\n            .replace(\"__percentage__\", stats[3]);\r\n\r\n        return `<div>${achievementStr}</div>\r\n                <div class=\"achieveBar\">\r\n                    <div style=\"width: ${stats[3]}%;\" class=\"achieveBarProgress\"></div>\r\n                </div>`;\r\n    }\r\n\r\n    static async getAchievementBarForGamelist(path, appid) {\r\n\r\n        const html = await Background.action(\"stats\", path, appid);\r\n        const dummy = HTMLParser.htmlToDOM(html);\r\n        const achNode = dummy.querySelector(\"#topSummaryAchievements\");\r\n\r\n        if (!achNode) { return null; }\r\n\r\n        achNode.style.whiteSpace = \"nowrap\";\r\n\r\n        const stats = achNode.innerText.match(/(\\d+)\\D+(\\d+)\\D+(\\d{1,3})%/);\r\n\r\n        // 1 full match, 3 group matches\r\n        if (!stats || stats.length !== 4) {\r\n            return null;\r\n        }\r\n\r\n        const achievementStr = Localization.str.achievements.summary\r\n            .replace(\"__unlocked__\", stats[1])\r\n            .replace(\"__total__\", stats[2])\r\n            .replace(\"__percentage__\", stats[3]);\r\n\r\n        // https://github.com/SteamDatabase/SteamTracking/blob/master/steamcommunity.com/public/javascript/profile_gameslist_functions.js#L216-L217\r\n        const achBarWidth = 185 * (stats[1] / stats[2]) || 0; // For some reason some games report 0 total achievements, check for NaN\r\n        const achBarWidthRemainder = 185 - achBarWidth;\r\n\r\n        return `<div class=\"recentAchievements\">\r\n            ${achievementStr}\r\n            <br>\r\n            <img src=\"https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarLeft.gif\" width=\"2\" height=\"12\" border=\"0\">\r\n            <img src=\"https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarFull.gif\" width=\"${achBarWidth}\" height=\"12\" border=\"0\">\r\n            <img src=\"https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarEmpty.gif\" width=\"${achBarWidthRemainder}\" height=\"12\" border=\"0\">\r\n            <img src=\"https://community.akamai.steamstatic.com/public/images/skin_1/achieveBarRight.gif\" width=\"2\" height=\"12\" border=\"0\">\r\n            <br>\r\n        </div>`.replace(/>\\s+</g, \"><\"); // Remove whitespace between tags to avoid layout issues\r\n    }\r\n}\r\n\r\nexport {Stats};\r\n","import {HTML} from \"../../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\nimport {ContextType, CurrencyManager, Feature, Price, RequestData, User} from \"../../../modulesContent\";\r\n\r\nexport default class FRegionalPricing extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        const countries = SyncedStorage.get(\"regional_countries\");\r\n        return countries && countries.length > 0 && SyncedStorage.get(\"showregionalprice\") !== \"off\";\r\n    }\r\n\r\n    async apply() {\r\n        let type = \"unknown\";\r\n        const showRegionalPrice = SyncedStorage.get(\"showregionalprice\");\r\n        const countries = SyncedStorage.get(\"regional_countries\");\r\n        const localCountry = User.storeCountry.toLowerCase();\r\n\r\n        if (!countries.includes(localCountry)) {\r\n            countries.push(localCountry);\r\n        }\r\n\r\n        if (this.context.type === ContextType.APP) {\r\n            type = \"app\";\r\n        } else if (this.context.type === ContextType.SALE) {\r\n            type = \"sale\";\r\n        }\r\n\r\n        for (const subid of this.context.getAllSubids()) {\r\n\r\n            const prices = {};\r\n\r\n            await Promise.all(countries.map(async country => {\r\n                const result = await RequestData.getJson(\r\n                    `https://store.steampowered.com/api/packagedetails/?packageids=${subid}&cc=${country}`\r\n                );\r\n\r\n                if (!result || !result[subid] || !result[subid].success || !result[subid].data.price) { return; }\r\n                prices[country] = result[subid].data.price;\r\n            }));\r\n\r\n            const node = document.querySelector(`input[name=subid][value=\"${subid}\"]`)\r\n                .closest(\".game_area_purchase_game_wrapper,#game_area_purchase,.sale_page_purchase_item\")\r\n                .querySelector(\".game_purchase_action\");\r\n\r\n            const apiPrice = prices[User.storeCountry.toLowerCase()];\r\n\r\n            // For paid titles that have F2P versions with their own subid (see #894)\r\n            if (typeof apiPrice === \"undefined\") { continue; }\r\n\r\n            let priceLocal;\r\n            try {\r\n                priceLocal = new Price(apiPrice.final / 100, apiPrice.currency).inCurrency(CurrencyManager.customCurrency);\r\n            } catch (err) {\r\n                console.group(\"Regional pricing\");\r\n                console.error(err);\r\n                console.warn(\"Can't show relative price differences to any other currencies\");\r\n                console.groupEnd();\r\n            }\r\n\r\n            const pricingDiv = document.createElement(\"div\");\r\n            pricingDiv.classList.add(\"es_regional_container\");\r\n            pricingDiv.classList.add(`es_regional_${type}`);\r\n\r\n            if (showRegionalPrice === \"mouse\") {\r\n                HTML.afterBegin(pricingDiv, '<div class=\"es_regional_arrow\"></div>');\r\n            }\r\n\r\n            for (const country of countries) {\r\n                const apiPrice = prices[country];\r\n                let html = \"\";\r\n\r\n                if (apiPrice) {\r\n                    const priceRegion = new Price(apiPrice.final / 100, apiPrice.currency);\r\n                    let priceUser;\r\n                    try {\r\n                        priceUser = priceRegion.inCurrency(CurrencyManager.customCurrency);\r\n                    } catch (err) {\r\n                        console.group(\"Regional pricing\");\r\n                        console.error(err);\r\n                        console.warn(\r\n                            'Not able to show converted price and relative price differences for country code \"%s\"',\r\n                            country.toUpperCase()\r\n                        );\r\n                        console.groupEnd();\r\n                    }\r\n\r\n                    html = `<div class=\"es-regprice es-flag es-flag--${country}\">${priceRegion}`;\r\n\r\n                    if (priceLocal && priceUser) {\r\n                        let percentageIndicator = \"equal\";\r\n                        let percentage = (((priceUser.value / priceLocal.value) * 100) - 100).toFixed(2);\r\n\r\n                        if (percentage < 0) {\r\n                            percentage = Math.abs(percentage);\r\n                            percentageIndicator = \"lower\";\r\n                        } else if (percentage > 0) {\r\n                            percentageIndicator = \"higher\";\r\n                        }\r\n\r\n                        html\r\n                            += `<span class=\"es-regprice__converted\">${priceUser}</span>\r\n                                <span class=\"es-regprice__perc es-regprice__perc--${percentageIndicator}\">${percentage}%</span>`;\r\n                    }\r\n\r\n                    html += \"</div>\";\r\n                } else {\r\n                    html\r\n                        = ` <div class=\"es-regprice es-flag es-flag--${country}\">\r\n                                <span class=\"es-regprice__none\">${Localization.str.region_unavailable}</span>\r\n                            </div>`;\r\n                }\r\n\r\n                HTML.beforeEnd(pricingDiv, html);\r\n            }\r\n\r\n            const purchaseArea = node.closest(\".game_area_purchase_game,.sale_page_purchase_item\");\r\n            purchaseArea.classList.add(\"es_regional_prices\");\r\n\r\n            if (showRegionalPrice === \"always\") {\r\n                node.insertAdjacentElement(\"beforebegin\", pricingDiv);\r\n                purchaseArea.classList.add(\"es_regional_always\");\r\n            } else {\r\n                const priceNode = node.querySelector(\".price,.discount_prices\");\r\n                priceNode.insertAdjacentElement(\"beforeend\", pricingDiv);\r\n                priceNode.classList.add(\"es_regional_onmouse\");\r\n\r\n                if (!SyncedStorage.get(\"regional_hideworld\")) {\r\n                    priceNode.classList.add(\"es_regional_icon\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, LocalStorage, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FReviewToggleButton extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return document.getElementById(\"review_create\") !== null;\r\n    }\r\n\r\n    apply() {\r\n        const head = document.querySelector(\"#review_create h1\");\r\n\r\n        // Reparent review section nodes\r\n        const newParent = document.createElement(\"div\");\r\n        newParent.classList.add(\"es_review_section\");\r\n        newParent.append(\r\n            ...document.getElementById(\"review_create\").querySelectorAll(\"p, .avatar_block, .content\")\r\n        );\r\n\r\n        head.insertAdjacentElement(\"afterend\", newParent);\r\n\r\n        // Insert review toggle button\r\n        HTML.beforeEnd(head,\r\n            `<div class=\"btnv6_lightblue_blue btn_medium\" id=\"es_review_toggle\">\r\n                <div data-tooltip-text=\"${Localization.str.expand_slider}\" class=\"es_review_expand\"></div>\r\n                <div data-tooltip-text=\"${Localization.str.contract_slider}\" class=\"es_review_contract\"></div>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_review_toggle\").addEventListener(\"click\", () => {\r\n            this._toggleReviews();\r\n        });\r\n\r\n        this._toggleReviews(LocalStorage.get(\"show_review_section\", true));\r\n    }\r\n\r\n    _toggleReviews(state) {\r\n\r\n        let _state = state;\r\n\r\n        if (typeof _state === \"undefined\") {\r\n            _state = !LocalStorage.get(\"show_review_section\", true);\r\n            LocalStorage.set(\"show_review_section\", _state);\r\n        }\r\n\r\n        document.getElementById(\"review_create\").classList.toggle(\"es_contracted\", !_state);\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, User} from \"../../../modulesContent\";\r\n\r\nexport default class FOwnedActionsButtons extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return User.isSignedIn && document.querySelector(\".game_area_play_stats .already_owned_actions\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        const node = document.querySelector(\".game_area_play_stats .already_owned_actions\");\r\n        const appid = this.context.appid;\r\n\r\n        // handle Install Steam button\r\n        const btn = node.querySelector(\"a[href^='https://store.steampowered.com/about/']\");\r\n        const option = SyncedStorage.get(\"installsteam\");\r\n        if (option === \"hide\") {\r\n            btn.remove();\r\n        } else if (option === \"replace\") {\r\n            btn.querySelector(\"span\").textContent = Localization.str.viewinclient;\r\n            btn.href = `steam://store/${appid}`;\r\n        }\r\n\r\n        // add view in library button\r\n        if (SyncedStorage.get(\"showviewinlibrary\")) {\r\n            HTML.afterBegin(node,\r\n                `<div class=\"game_area_already_owned_btn\">\r\n                    <a class=\"btnv6_lightblue_blue btnv6_border_2px btn_medium\" href=\"steam://nav/games/details/${appid}\">\r\n                        <span>${Localization.str.view_in_library}</span>\r\n                    </a>\r\n                </div>`);\r\n        }\r\n\r\n        // add help button\r\n        HTML.afterEnd(node,\r\n            `<div class=\"game_area_already_owned_btn\">\r\n                <a class=\"btnv6_lightblue_blue btnv6_border_2px btn_medium\" href=\"//help.steampowered.com/wizard/HelpWithGame/?appid=${appid}\">\r\n                    <span>${Localization.str.get_help}</span>\r\n                </a>\r\n            </div>`);\r\n    }\r\n}\r\n","import {HTML, LocalStorage, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Background, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FSupportInfo extends Feature {\r\n\r\n    async checkPrerequisites() {\r\n        if (this.context.isDlc() || !SyncedStorage.get(\"showsupportinfo\")) { return false; }\r\n\r\n        let cache = LocalStorage.get(\"support_info\", null);\r\n\r\n        // todo IDB\r\n        if (!cache || !cache.expiry || cache.expiry < Date.now()) {\r\n            cache = {\r\n                \"data\": {},\r\n                \"expiry\": Date.now() + (31 * 86400 * 1000) // 31 days\r\n            };\r\n        }\r\n\r\n        const appid = this.context.appid;\r\n        this._supportInfo = cache.data[appid];\r\n\r\n        if (!this._supportInfo) {\r\n            const response = await Background.action(\"appdetails\", appid, \"support_info\");\r\n            if (!response || !response.success) {\r\n                console.warn(\"Failed to retrieve support info\");\r\n                return false;\r\n            }\r\n\r\n            this._supportInfo = response.data.support_info;\r\n\r\n            cache.data[appid] = this._supportInfo;\r\n            LocalStorage.set(\"support_info\", cache);\r\n        }\r\n\r\n        return this._supportInfo.url || this._supportInfo.email;\r\n    }\r\n\r\n    apply() {\r\n\r\n        const url = this._supportInfo.url;\r\n        const email = this._supportInfo.email;\r\n\r\n        let support = \"\";\r\n        if (url) {\r\n            support += `<a href=\"${url}\">${Localization.str.website}</a>`;\r\n        }\r\n\r\n        if (email) {\r\n            if (url) {\r\n                support += \", \";\r\n            }\r\n\r\n            // From https://emailregex.com/\r\n            const emailRegex\r\n                = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\r\n            if (emailRegex.test(email)) {\r\n                support += `<a href=\"mailto:${email}\">${Localization.str.email}</a>`;\r\n            } else {\r\n                support += `<a href=\"${email}\">${Localization.str.contact}</a>`;\r\n            }\r\n        }\r\n\r\n        HTML.beforeEnd(\".glance_ctn .user_reviews\",\r\n            `<div class=\"release_date\">\r\n                <div class=\"subtitle column\">${Localization.str.support}:</div>\r\n                <div class=\"summary column\" id=\"es_support_list\">${support}</div>\r\n            </div>`);\r\n    }\r\n}\r\n","import {SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../modulesContent\";\r\nimport {Page} from \"../../Page\";\r\n\r\nexport default class FRemoveBroadcasts extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"removebroadcasts\")\r\n            && document.querySelector(\"[data-featuretarget=broadcast-embed]\") !== null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        document.querySelector(\"[data-featuretarget=broadcast-embed]\").remove();\r\n\r\n        Page.runInPageContext(() => {\r\n            const bcStore = window.uiBroadcastWatchStore;\r\n            if (bcStore && bcStore.m_activeVideo) {\r\n                // eslint-disable-next-line new-cap\r\n                bcStore.StopVideo(bcStore.m_activeVideo);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import {StorePage} from \"../../StorePage\";\r\nimport {CApp} from \"./CApp\";\r\n\r\n(new StorePage()).run(CApp);\r\n","import {Page} from \"./Page\";\r\n\r\nclass StorePage extends Page {}\r\n\r\nexport {StorePage};\r\n","import {GameId, LocalStorage, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Background, ContextType, User} from \"../../../modulesContent\";\r\nimport FMediaExpander from \"../../Common/FMediaExpander\";\r\nimport FITADPrices from \"../Common/FITADPrices\";\r\nimport FDRMWarnings from \"../Common/FDRMWarnings\";\r\nimport FExtraLinks from \"../Common/FExtraLinks\";\r\nimport {UserNotes} from \"../Common/UserNotes\";\r\nimport {CStore} from \"../Common/CStore\";\r\nimport FReplaceDevPubLinks from \"./FReplaceDevPubLinks\";\r\nimport FRemoveFromWishlist from \"./FRemoveFromWishlist\";\r\nimport FForceMP4 from \"./FForceMP4\";\r\nimport FHDPlayer from \"./FHDPlayer\";\r\nimport FUserNotes from \"./FUserNotes\";\r\nimport FWaitlistDropdown from \"./FWaitlistDropdown\";\r\nimport FNewQueue from \"./FNewQueue\";\r\nimport FFullscreenScreenshotView from \"./FFullscreenScreenshotView\";\r\nimport FShowCoupon from \"./FShowCoupon\";\r\nimport FDLCInfo from \"./FDLCInfo\";\r\nimport FMetacriticUserScore from \"./FMetacriticUserScore\";\r\nimport FOpenCritic from \"./FOpenCritic\";\r\nimport FOwnedElsewhere from \"./FOwnedElsewhere\";\r\nimport FPurchaseDate from \"./FPurchaseDate\";\r\nimport FSteamPeek from \"./FSteamPeek\";\r\nimport FWidescreenCertification from \"./FWidescreenCertification\";\r\nimport FHowLongToBeat from \"./FHowLongToBeat\";\r\nimport FFamilySharingNotice from \"./FFamilySharingNotice\";\r\nimport FPackBreakdown from \"./FPackBreakdown\";\r\nimport FPackageInfoButton from \"./FPackageInfoButton\";\r\nimport FSteamChart from \"./FSteamChart\";\r\nimport FSteamSpy from \"./FSteamSpy\";\r\nimport FSurveyData from \"./FSurveyData\";\r\nimport FCustomizer from \"../Common/FCustomizer\";\r\nimport FDLCCheckboxes from \"./FDLCCheckboxes\";\r\nimport FBadgeProgress from \"./FBadgeProgress\";\r\nimport FAStatsLink from \"./FAStatsLink\";\r\nimport FAchievementBar from \"./FAchievementBar\";\r\nimport FRegionalPricing from \"../Common/FRegionalPricing\";\r\nimport FReviewToggleButton from \"./FReviewToggleButton\";\r\nimport FOwnedActionsButtons from \"./FOwnedActionsButtons\";\r\nimport FSupportInfo from \"./FSupportInfo\";\r\nimport FRemoveBroadcasts from \"./FRemoveBroadcasts\";\r\n\r\nexport class CApp extends CStore {\r\n\r\n    constructor() {\r\n        // Don't apply features if there's an error message (e.g. region-locked, age-gated)\r\n        if (document.getElementById(\"error_box\")) {\r\n            super(ContextType.APP);\r\n            return;\r\n        }\r\n\r\n        super(ContextType.APP, [\r\n            FReplaceDevPubLinks,\r\n            FRemoveFromWishlist,\r\n            FForceMP4,\r\n            FHDPlayer,\r\n            FUserNotes,\r\n            FWaitlistDropdown,\r\n            FNewQueue,\r\n            FFullscreenScreenshotView,\r\n            FShowCoupon,\r\n            FITADPrices,\r\n            FDLCInfo,\r\n            FDRMWarnings,\r\n            FMetacriticUserScore,\r\n            FOpenCritic,\r\n            FOwnedElsewhere,\r\n            FPurchaseDate,\r\n            FSteamPeek,\r\n            FWidescreenCertification,\r\n            FHowLongToBeat,\r\n            FExtraLinks,\r\n            FFamilySharingNotice,\r\n            FPackBreakdown,\r\n            FPackageInfoButton,\r\n            FSteamChart,\r\n            FSteamSpy,\r\n            FSurveyData,\r\n            FCustomizer,\r\n            FDLCCheckboxes,\r\n            FBadgeProgress,\r\n            FAStatsLink,\r\n            FAchievementBar,\r\n            FRegionalPricing,\r\n            FReviewToggleButton,\r\n            FOwnedActionsButtons,\r\n            FSupportInfo,\r\n            FMediaExpander,\r\n            FRemoveBroadcasts,\r\n        ]);\r\n\r\n        this.userNotes = new UserNotes();\r\n\r\n        this.appid = GameId.getAppid(window.location.host + window.location.pathname);\r\n        this.storeid = `app/${this.appid}`;\r\n\r\n        this.hasCards = document.querySelector('#category_block img[src$=\"/ico_cards.png\"]') !== null;\r\n\r\n        this.onWishAndWaitlistRemove = null;\r\n\r\n        // Some games (e.g. 201270, 201271) have different appid in store page and community\r\n        const communityAppidSrc = document.querySelector(\".apphub_AppIcon img\").getAttribute(\"src\");\r\n        this.communityAppid = GameId.getAppidImgSrc(communityAppidSrc);\r\n        if (!this.communityAppid) {\r\n            this.communityAppid = this.appid;\r\n        }\r\n\r\n        const metalinkNode = document.querySelector(\"#game_area_metalink a\");\r\n        this.metalink = metalinkNode && metalinkNode.getAttribute(\"href\");\r\n\r\n        this.data = this.storePageDataPromise().catch(err => { console.error(err); });\r\n        this.appName = document.querySelector(\".apphub_AppName\").textContent;\r\n\r\n        // The customizer has to wait on this data to be added in order to find the HTML elements\r\n        FCustomizer.dependencies = [FSteamSpy, FSteamChart, FSurveyData];\r\n        FCustomizer.weakDependency = true;\r\n    }\r\n\r\n    storePageDataPromise() {\r\n        return Background.action(\"storepagedata\", this.appid, this.metalink, SyncedStorage.get(\"showoc\"));\r\n    }\r\n\r\n    // TODO(tfedor) maybe make properties instead of dynamic qheck of all of these \"isXY\"? Not sure\r\n    isOwned() {\r\n        return document.querySelector(\".game_area_already_owned\") !== null;\r\n    }\r\n\r\n    isDlc() {\r\n        return document.querySelector(\"div.game_area_dlc_bubble\") !== null;\r\n    }\r\n\r\n    isVideo() {\r\n        return document.querySelector('.game_area_purchase_game span[class*=\"streaming\"], div.series_seasons') !== null;\r\n    }\r\n\r\n    hasAchievements() {\r\n        // #achievement_block is also used for point shop items\r\n        return document.querySelector(\".communitylink_achievement_images\") !== null;\r\n    }\r\n\r\n    removeFromWishlist() {\r\n        return Background.action(\"wishlist.remove\", this.appid, User.sessionId);\r\n    }\r\n\r\n    removeFromWaitlist() {\r\n        return Background.action(\"itad.removefromwaitlist\", this.appid);\r\n    }\r\n\r\n    toggleVideoDefinition(videoControl, setHD) {\r\n        let videoIsHD = false;\r\n\r\n        const videoIsVisible = videoControl.parentNode.offsetHeight > 0 && videoControl.parentNode.offsetWidth > 0,\r\n            loadedSrc = videoControl.classList.contains(\"es_loaded_src\"),\r\n            playInHD = LocalStorage.get(\"playback_hd\") || videoControl.classList.contains(\"es_video_hd\");\r\n\r\n        const videoPosition = videoControl.currentTime || 0,\r\n            videoPaused = videoControl.paused;\r\n\r\n        /** @this {HTMLVideoElement} The video element */\r\n        function onLoadedMetaData() {\r\n            this.currentTime = videoPosition;\r\n            if (!videoPaused && videoControl.play) {\r\n\r\n                Promise.resolve(videoControl.play()).catch(() => {\r\n                    // FIXME Why?\r\n\r\n                    // If response is a promise, suppress any errors it throws\r\n                });\r\n            }\r\n            videoControl.removeEventListener(\"loadedmetadata\", onLoadedMetaData, false);\r\n        }\r\n\r\n        if (videoIsVisible) {\r\n            videoControl.preload = \"metadata\";\r\n            videoControl.addEventListener(\"loadedmetadata\", onLoadedMetaData, false);\r\n        }\r\n\r\n        if ((!playInHD && typeof setHD === \"undefined\") || setHD === true) {\r\n            videoIsHD = true;\r\n            videoControl.src = videoControl.dataset.hdSrc;\r\n        } else if (loadedSrc) {\r\n            videoControl.src = videoControl.dataset.sdSrc;\r\n        }\r\n\r\n        if (videoIsVisible && loadedSrc) {\r\n            videoControl.load();\r\n        }\r\n\r\n        videoControl.classList.add(\"es_loaded_src\");\r\n        videoControl.classList.toggle(\"es_video_sd\", !videoIsHD);\r\n        videoControl.classList.toggle(\"es_video_hd\", videoIsHD);\r\n        videoControl.parentNode.classList.toggle(\"es_playback_sd\", !videoIsHD);\r\n        videoControl.parentNode.classList.toggle(\"es_playback_hd\", videoIsHD);\r\n\r\n        return videoIsHD;\r\n    }\r\n}\r\n","import {CStoreBase} from \"./CStoreBase\";\r\n\r\nexport class CStore extends CStoreBase {\r\n\r\n    getAllSubids() {\r\n        const result = [];\r\n        for (const node of document.querySelectorAll(\"input[name=subid]\")) {\r\n            if (node.value) {\r\n                result.push(node.value);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}\r\n","import {Context, ContextType, EarlyAccess} from \"../../../modulesContent\";\r\nimport FHighlightsTags from \"../../Common/FHighlightsTags\";\r\nimport FHideTrademarks from \"../../Common/FHideTrademarks\";\r\nimport FAlternativeLinuxIcon from \"./FAlternativeLinuxIcon\";\r\n\r\nexport class CStoreBase extends Context {\r\n\r\n    constructor(type = ContextType.STORE_DEFAULT, features = []) {\r\n\r\n        // TODO Split this up into the relevant contexts\r\n        features.push(\r\n            FHighlightsTags,\r\n            FAlternativeLinuxIcon,\r\n            FHideTrademarks,\r\n        );\r\n\r\n        super(type, features);\r\n\r\n        this._observeChanges();\r\n    }\r\n\r\n    _observeChanges() {\r\n\r\n        const tabAreaNodes = document.querySelectorAll(\".tag_browse_ctn, .tabarea, .browse_ctn_background\");\r\n        if (!tabAreaNodes) { return; }\r\n\r\n        const observer = new MutationObserver(() => {\r\n            FHighlightsTags.highlightAndTag();\r\n            EarlyAccess.showEarlyAccess();\r\n        });\r\n\r\n        tabAreaNodes.forEach(tabAreaNode => observer.observe(tabAreaNode, {\"childList\": true, \"subtree\": true}));\r\n    }\r\n}\r\n","import {FeatureManager} from \"../Feature/FeatureManager\";\r\n\r\nclass Context {\r\n\r\n    constructor(type, features) {\r\n        this._callbacks = [];\r\n        this.type = type;\r\n        this.features = features.map(Ref => new Ref(this));\r\n    }\r\n\r\n    applyFeatures() {\r\n        return FeatureManager.apply(this.features);\r\n    }\r\n\r\n    registerCallback(fn) {\r\n        this._callbacks.push(fn);\r\n    }\r\n\r\n    triggerCallbacks(...params) {\r\n        for (const callback of this._callbacks) {\r\n            callback(...params);\r\n        }\r\n    }\r\n}\r\n\r\nexport {Context};\r\n"],"sourceRoot":""}