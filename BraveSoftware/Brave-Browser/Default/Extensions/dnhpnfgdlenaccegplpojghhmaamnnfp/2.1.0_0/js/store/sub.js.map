{"version":3,"sources":["webpack:///./src/js/Core/Errors/Errors.js","webpack:///./src/js/Core/Html/Html.js","webpack:///./src/js/Core/Html/HtmlParser.js","webpack:///./src/js/Core/Storage/CookieStorage.js","webpack:///./src/js/Core/Environment.js","webpack:///./src/js/Core/Localization/Language.js","webpack:///./src/js/Core/BackgroundSimple.js","webpack:///./src/js/Core/ExtensionResources.js","webpack:///./src/js/Core/Info.js","webpack:///./src/js/Core/Storage/SyncedStorage.js","webpack:///./src/js/Core/Localization/Localization.js","webpack:///./src/js/Core/Utils/TimeUtils.js","webpack:///./src/js/Core/GameId.js","webpack:///./src/js/Core/Permissions.js","webpack:///./src/js/Core/Version.js","webpack:///./src/js/Content/Modules/Widgets/ProgressBar.js","webpack:///./src/js/Content/Modules/Background.js","webpack:///./src/js/Core/Errors/ErrorParser.js","webpack:///./src/js/Content/Modules/RequestData.js","webpack:///./src/js/Content/Modules/User.js","webpack:///./src/js/Content/Modules/Feature/FeatureManager.js","webpack:///./src/js/Content/Modules/Context/ContextType.js","webpack:///./src/js/Content/Modules/Data/DynamicStore.js","webpack:///./src/js/Content/Modules/Data/Inventory.js","webpack:///./src/js/Content/Modules/Feature/Feature.js","webpack:///./src/js/Core/Storage/LocalStorage.js","webpack:///./src/js/Content/Modules/DOMHelper.js","webpack:///./src/js/Content/Modules/Widgets/HorizontalScroller.js","webpack:///./src/js/config.js","webpack:///./src/js/Content/Modules/AugmentedSteam.js","webpack:///./src/js/Core/Utils/StringUtils.js","webpack:///./src/js/Content/Modules/CurrencyManager.js","webpack:///./src/js/Content/Modules/EarlyAccess.js","webpack:///./src/js/Content/Modules/ITAD.js","webpack:///./src/js/Content/Modules/Messenger.js","webpack:///./src/js/Content/Modules/Price.js","webpack:///./src/js/Content/Modules/Prices.js","webpack:///./src/js/setup.js","webpack:///./src/js/Content/Features/Page.js","webpack:///./src/js/Content/Modules/SteamFacade.js","webpack:///./src/js/Content/Modules/UpdateHandler.js","webpack:///./src/js/Content/Modules/Widgets/SortBox.js","webpack:///./src/js/Content/Features/Common/FHighlightsTags.js","webpack:///./src/js/Content/Features/Common/FHideTrademarks.js","webpack:///./src/js/Content/Features/Store/Common/FAlternativeLinuxIcon.js","webpack:///./src/js/Content/Features/Store/Common/FExtraLinks.js","webpack:///./src/js/Content/Features/Store/Common/FDRMWarnings.js","webpack:///./src/js/Content/Features/Store/Common/FITADPrices.js","webpack:///./src/js/Content/Features/Store/Common/FRegionalPricing.js","webpack:///./src/js/Content/Features/Store/Sub/FSavingsCheck.js","webpack:///./src/js/Content/Features/Store/Sub/PSub.js","webpack:///./src/js/Content/Features/StorePage.js","webpack:///./src/js/Content/Features/Store/Sub/CSub.js","webpack:///./src/js/Content/Features/Store/Common/CStore.js","webpack:///./src/js/Content/Features/Store/Common/CStoreBase.js","webpack:///./src/js/Content/Modules/Context/Context.js"],"names":["LoginError","Error","type","super","this","name","ServerOutageError","msg","HTTPError","code","message","FeatureDependencyError","featureName","Errors","HTML","str","map","replace","m","html","template","document","createElement","innerHTML","DOMPurify","sanitize","content","fragment","firstElementChild","node","_node","console","warn","querySelector","Element","_getNode","outerHTML","wrapper","element","replaceWith","append","position","insertAdjacentHTML","adjacent","string","text","regex","RegExp","match","parseInt","JSON","parse","dom","querySelectorAll","value","getVariableFromText","textContent","CookieStorage","defaultValue","_name","trim","cache","has","get","val","ttl","_val","set","encodeURIComponent","cookie","delete","Map","key","split","kv","decodeURIComponent","init","ContextType","Object","freeze","currentContext","browser","extension","getBackgroundPage","bgPage","window","BACKGROUND","OPTIONS","CONTENT_SCRIPT","Language","_currentSteamLanguage","script","language","URL","src","searchParams","isContentScript","languages","array","includes","getCurrentSteamLanguage","BackgroundSimple","runtime","sendMessage","requested","params","length","ExtensionResources","pathname","getURL","fetch","then","r","json","Info","getManifest","version","prototype","hasOwnProperty","call","_cache","defaults","_adapter","entries","remove","prefix","keys","filter","k","startsWith","force","tmp","persistent","reduce","acc","option","clear","import","storage","onChanged","addListener","changes","assign","onDone","onCatch","stringify","QUOTA_BYTES_PER_ITEM","sync","local","getJSON","_promise","currentSteamLanguage","storedSteamLanguage","deepAssign","target","source","action","getLanguageCode","codes","push","Promise","all","lc","loadLocalization","english","path","reverse","current","pop","Timer","duration","resolve","_id","setTimeout","onSuccess","onFail","clearTimeout","ResettableTimer","reset","_running","async","TimeUtils","Math","trunc","Date","now","GameId","id","_text","HTMLElement","appid","dataset","dsAppid","parseId","href","subid","dsPackageid","bundleid","dsBundleid","storeId","Number","slice","indexOf","res","exec","Version","major","minor","patch","assert","isInteger","fromString","Array","isArray","fromArray","v","from","toString","isSameOrAfter","_version","coerce","isSame","isBefore","isSameOrBefore","ProgressBar","afterEnd","_progress","setAttribute","requests","classList","style","width","initiated","progress","completed","_value","add","parentElement","warningNode","nodeError","_failedRequests","result","startRequest","finishRequest","err","errObj","errStr","info","serverOutage","_errorHandlers","some","handler","failed","RequestData","url","settings","responseType","_url","_settings","location","origin","response","protocol","_fetchFn","ok","status","statusText","formData","returnJSON","getHttp","bind","country","_storeCountry","substr","avatarNode","loginPromise","profileUrl","profilePath","login","isSignedIn","steamId","catch","error","newCountry","hostname","endsWith","getElementsByTagName","config","COUNTRY","group","groupEnd","promise","_sessionId","lang","appName","_appName","getJson","success","data","webapi_token","allSettled","promises","reason","DynamicStore","multiple","trimmedIds","statusList","trimStoreId","dsStatusList","i","trimmedId","owned","_fetch","Inventory","appids","options","getStatusObject","giftsAndPasses","hasCoupon","Boolean","opts","coupons","results","marketHashes","context","args","constructor","LocalStorage","item","localStorage","getItem","setItem","removeItem","DOMHelper","container","parent","parentNode","insertBefore","removeChild","selector","nodes","stylesheet","rel","head","appendChild","onload","isAsync","HorizontalScroller","controlLeftNode","controlRightNode","lastScroll","addEventListener","e","preventDefault","stopPropagation","deltaY","click","AugmentedSteam","afterBegin","SteamFacade","showMenu","hideMenu","clearCache","reload","btn","body","scroll","toggle","scrollY","stopShowingHandler","el","closest","getElementById","insertAdjacentElement","currentLanguage","warningLanguage","strings","_addWarning","using_language","using_language_return","ChangeLanguage","beforeEnd","removeLinkFilter","MutationObserver","mutations","mutation","addedNodes","nodeType","Node","ELEMENT_NODE","observe","beforeBegin","logoutNode","accountName","communityName","pageHeader","test","title","getRandomApp","gamename","gameid","fullgame","playGameStr","visitStore","showConfirmDialog","done","checked","tab","links","link","contains","create","_loginWarningAdded","host","_addBackToTop","_addMenu","_addLanguageWarning","_handleInstallSteamButton","_disableLinkFilter","_skipGotSteam","_keepSteamSubscriberAgreementState","_defaultCommunityTab","_horizontalScrolling","_addUsernameSubmenuLinks","_addRedeemLink","_replaceAccountName","_launchRandomButton","_bindLogout","StringUtils","SteamCurrency","abbr","symbol","hint","multiplier","unit","formatPlaces","formatHidePlaces","formatSymbol","formatGroupSeparator","formatGroupSize","formatDecimalSeparator","formatPostfixSymbol","format","price","_price","groupSeparator","decimalSeparator","parseFloat","isNaN","withSymbol","sign","decimals","s","abs","toFixed","decimalPlaces","g","j","groupSize","unshift","substring","join","hidePlacesWhenZero","postfix","cur","escapeRegExp","CurrencyManager","currencyNode","hasAttribute","getAttribute","walletCurrency","g_rgWalletInfo","wallet_currency","currencyNumberToType","currency","_getCurrencyFromDom","_getCurrencyFromWallet","to","_rates","fromType","number","fromNumber","_indices","_defaultCurrency","storeCurrency","_getStoreCurrency","currencySetting","customCurrency","toCurrencies","_isInitialized","currencies","symbols","_loadCurrency","_loadRates","onFailure","EarlyAccess","selectorModifier","appidsMap","linkNode","imgHeader","getAppid","getAppidImgSrc","String","eaStatus","values","selectors","_selectorModifier","getEaNodes","wrap","_imageUrl","_checkNodes","imageName","isCurrentLanguageOneOf","_handleStore","_handleCommunity","ITAD","onHover","updateLastImport","htmlStr","toLocaleString","inner","hover","syncDiv","timeout","display","timer","storeIds","collection","waitlist","resolved","inCollection","inWaitlist","Messenger","msgID","postMessage","callback","information","removeEventListener","Price","otherPrice","_otherPrice","inCurrency","desiredCurrency","rate","getRate","currencyType","valueOf","Prices","subids","bundleids","priceCallback","bundleCallback","_bundles","apiParams","stores","cc","coupon","priceData","pricingStr","prices","pricesStr","cutStr","cut","store","meta","hasData","lowestData","lowest","bundledCount","bundles","count","urlData","urls","voucherStr","price_voucher","voucher","escape","with_voucher","storeStr","_getPricingStrings","drmStr","drm","infoUrl","storeUrl","lowest_price","historical","dateStr","recorded","toLocaleDateString","history","historical_low","bundledUrl","bundle_history","bundledStr","bundle_count","bundled","purchase","bundle","live","tiers","endDate","expiry","currentDate","getTime","bundleNormalized","page","sorted","t","games","sort","bundlePrice","tierNum","tier","tierName","note","tierPrice","gameList","details","_getApiParams","_processPrices","_processBundles","finally","defineProperty","initialized","ev","localStack","stack","insertScript","strTitle","strDescription","rgModalParams","ShowDialog","strOKButton","strCancelButton","strSecondaryActionButton","ShowConfirmDialog","ShowAlertDialog","ShowBlockingWaitDialog","ShowNicknameModal","CModal","DismissActiveModal","elemLink","elemPopup","align","valign","bLinkHasBorder","ShowMenu","HideMenu","CollapseLongStrings","BindAutoFlyoutEvents","GDynamicStore","InvalidateCache","bForceRecalculate","DecorateDynamicItems","$J","OnReady","unAppID","unPackageID","unBundleID","rgAdditionalParams","GStoreItemData","BindHoverEvents","isHtml","isStore","v_tooltip","amount","publisherFee","CalculateFeeAmount","currencyCode","v_currencyformat","ToggleManageFriends","chatId","OpenFriendChatInWebChat","SubmitGuide","InitMiniprofileHovers","Modal","groupID","steamIDInvitee","InviteUserToGroup","GetCheckedAccounts","navid","ExecFriendAction","CScrollOffsetWatcher","ForceRecalc","InventoryFirstPage","InventoryLastPage","InventoryGoToPage","ReloadCommunityInventory","itemDesc","GetMarketHashName","pricehistory_zoomDays","g_plotPriceHistory","g_timePriceHistoryEarliest","g_timePriceHistoryLatest","SellItemDialog","m_plotPriceHistory","m_timePriceHistoryEarliest","m_timePriceHistoryLatest","UpdateSelection","selectAll","selectNone","selectInverse","on","ajax","post","addLoginWarning","fun","withPromise","argsString","msgId","_msgCounter","onMessage","documentElement","ContextClass","purifyConfig","ADD_ATTR","addHook","attrName","attrValue","keepAttr","setConfig","setup","log","loading","onUpdate","lastVersion","isAfter","_showChangelog","_migrateSettings","dialog","connectBtn","itadConnected","updatedStr","showAlertDialog","oldVersion","emoticons","checkVersion","showEarlyAccess","_activeDropLists","_lastSelectHideTime","_handleMouseClick","ulAboveEvent","_hide","index","bSetSelected","droplist","trigger","rgItems","highlightedItem","className","yOffset","offsetTop","clientHeight","curVisibleOffset","scrollTop","bScrolledDown","nMaxLoopIterations","nLoopCounter","input","dispatchEvent","Event","_classCheck","d","focus","_show","initialOption","changeFn","storageOption","reversed","box","getTrimmedValue","onChange","reverseEl","_onFocus","_onBlur","_onTriggerClick","ul","trimmedOption","a","_highlightItem","_pageSpecificFeatures","applyFeatures","FHighlightsTags","onDynamicStoreReady","searchBoxContents","records","highlightAndTag","highlightTitle","_selector","hasDsInfo","storeIdsMap","nodeToHighlight","nextElementSibling","aNode","getAppidFromId","getSubid","getBundleid","arr","highlightOwned","wishlisted","highlightWishlist","ignored","highlightIgnored","trimmedStoreIds","includeDsInfo","dsStatus","itadStatus","invStatus","getAppStatus","waitlisted","collected","gift","guestPass","it","storeid","forEach","highlightCollection","highlightWaitlist","next","highlightInvGift","highlightInvGuestpass","highlightInvCoupon","tag","tagShort","_tagCssLoaded","tagCss","_types","color","tags","root","top","n","_highlightCssLoaded","hlCss","previousElementSibling","_highlightNode","_addTag","sel","FHideTrademarks","replaceSymbols","observer","FAlternativeLinuxIcon","cssText","FExtraLinks","_type","_gameid","_moveExtraLinks","customLink","enabled","customUrl","icon","_getRightColLinkHtml","hasCards","communityAppid","cls","iconUrl","usefulLinks","sideDetails","FDRMWarnings","toLowerCase","drmNames","drmString","nextSibling","FITADPrices","getAllSubids","contentNode","placement","banner","newParent","load","FRegionalPricing","countries","showRegionalPrice","localCountry","apiPrice","priceLocal","final","pricingDiv","priceRegion","priceUser","toUpperCase","percentageIndicator","percentage","purchaseArea","priceNode","FSavingsCheck","notOwnedTotalPrice","priceContainer","parseFromString","finalPrice","selectLastNode","packagePrice","savingsNode","run","features","_callbacks","Ref","_promisesMap","_stats","feature","_generateFeatureChain","dependency","ready","dependencies","dep","ftr","previousCheck","prev","weakDependency","every","checkPrerequisites","fulfilled","apply","fn","_observeChanges","tabAreaNodes","tabAreaNode"],"mappings":"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","file":"js/store/sub.js","sourcesContent":["\r\nclass LoginError extends Error {\r\n    constructor(type) {\r\n        super(type);\r\n        this.name = \"LoginError\";\r\n    }\r\n}\r\n\r\nclass ServerOutageError extends Error {\r\n    constructor(msg) {\r\n        super(msg);\r\n        this.name = \"ServerOutageError\";\r\n    }\r\n}\r\n\r\nclass HTTPError extends Error {\r\n    constructor(code, message) {\r\n        super(message);\r\n        this.code = code;\r\n    }\r\n}\r\n\r\n\r\nclass FeatureDependencyError extends Error {\r\n    constructor(msg, featureName) {\r\n        super(msg);\r\n        this.featureName = featureName;\r\n    }\r\n}\r\n\r\nconst Errors = {\r\n    \"LoginError\": LoginError,\r\n    \"ServerOutageError\": ServerOutageError,\r\n    \"HTTPError\": HTTPError,\r\n    \"FeatureDependencyError\": FeatureDependencyError\r\n};\r\n\r\nexport {Errors};\r\n","\r\nclass HTML {\r\n\r\n    static escape(str) {\r\n\r\n        // @see https://stackoverflow.com/a/4835406\r\n        const map = {\r\n            \"&\": \"&amp;\",\r\n            \"<\": \"&lt;\",\r\n            \">\": \"&gt;\",\r\n            '\"': \"&quot;\",\r\n            \"'\": \"&#039;\"\r\n        };\r\n\r\n        return str.replace(/[&<>\"']/g, (m) => { return map[m]; });\r\n    }\r\n\r\n    static fragment(html) {\r\n        const template = document.createElement(\"template\");\r\n        template.innerHTML = DOMPurify.sanitize(html);\r\n        return template.content;\r\n    }\r\n\r\n    static element(html) {\r\n        return HTML.fragment(html).firstElementChild;\r\n    }\r\n\r\n    static _getNode(node) {\r\n        let _node = node;\r\n\r\n        if (typeof _node == \"undefined\" || _node === null) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n        if (typeof _node == \"string\") {\r\n            _node = document.querySelector(_node);\r\n        }\r\n        if (!(_node instanceof Element)) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n\r\n        return _node;\r\n    }\r\n\r\n    static inner(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.innerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static replace(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.outerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static wrap(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            const wrapper = HTML.element(html);\r\n            _node.replaceWith(wrapper);\r\n            wrapper.append(_node);\r\n            return wrapper;\r\n        } else {\r\n            return _node;\r\n        }\r\n    }\r\n\r\n    static adjacent(node, position, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.insertAdjacentHTML(position, DOMPurify.sanitize(html));\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static beforeBegin(node, html) {\r\n        HTML.adjacent(node, \"beforebegin\", html);\r\n    }\r\n\r\n    static afterBegin(node, html) {\r\n        HTML.adjacent(node, \"afterbegin\", html);\r\n    }\r\n\r\n    static beforeEnd(node, html) {\r\n        HTML.adjacent(node, \"beforeend\", html);\r\n    }\r\n\r\n    static afterEnd(node, html) {\r\n        HTML.adjacent(node, \"afterend\", html);\r\n    }\r\n}\r\n\r\nexport {HTML};\r\n","import {HTML} from \"./Html\";\r\n\r\nclass HTMLParser {\r\n\r\n    static clearSpecialSymbols(string) {\r\n        return string.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\");\r\n    }\r\n\r\n    static htmlToDOM(html) {\r\n        return HTML.fragment(html);\r\n    }\r\n\r\n    static htmlToElement(html) {\r\n        return HTML.element(html);\r\n    }\r\n\r\n    static getVariableFromText(text, name, type) {\r\n        let regex;\r\n        if (type === \"object\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\{.+?\\\\});`);\r\n        } else if (type === \"array\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\[.+?\\\\]);`);\r\n        } else if (type === \"int\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(.+?);`);\r\n        } else if (type === \"string\") {\r\n            regex = new RegExp(`${name}\\\\s*=\\\\s*(\\\\\".+?\\\\\");`);\r\n        } else {\r\n            return null;\r\n        }\r\n\r\n        const m = text.match(regex);\r\n        if (m) {\r\n            if (type === \"int\") {\r\n                return parseInt(m[1]);\r\n            }\r\n            return JSON.parse(m[1]);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getVariableFromDom(name, type, dom = document) {\r\n        for (const node of dom.querySelectorAll(\"script\")) {\r\n            const value = HTMLParser.getVariableFromText(node.textContent, name, type);\r\n\r\n            if (value !== null) {\r\n                return value;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n\r\nexport {HTMLParser};\r\n","\r\nclass CookieStorage {\r\n\r\n    static get(name, defaultValue) {\r\n        const _name = name.trim();\r\n\r\n        if (!CookieStorage.cache.has(_name)) {\r\n            return defaultValue;\r\n        }\r\n        return CookieStorage.cache.get(_name);\r\n    }\r\n\r\n    static set(name, val, ttl = 60 * 60 * 24 * 365) {\r\n        let _name = name.trim();\r\n        let _val = val.trim();\r\n\r\n        CookieStorage.cache.set(_name, _val);\r\n\r\n        _name = encodeURIComponent(_name);\r\n        _val = encodeURIComponent(_val);\r\n        document.cookie = `${_name}=${_val}; max-age=${ttl}`;\r\n    }\r\n\r\n    static remove(name) {\r\n        let _name = name.trim();\r\n        CookieStorage.cache.delete(_name);\r\n        _name = encodeURIComponent(_name);\r\n        document.cookie = `${_name}; expires=Thu, 01 Jan 1970 00:00:00 GMT`;\r\n    }\r\n\r\n    static init() {\r\n        CookieStorage.cache = new Map();\r\n        for (let [key, val] of document.cookie.split(\";\").map(kv => kv.split(\"=\"))) {\r\n            key = key.trim();\r\n            CookieStorage.cache.set(key, decodeURIComponent(val));\r\n        }\r\n    }\r\n}\r\n\r\nCookieStorage.init();\r\n\r\nexport {CookieStorage};\r\n","\r\nconst ContextType = Object.freeze({\r\n    \"BACKGROUND\": 1,\r\n    \"CONTENT_SCRIPT\": 2,\r\n    \"OPTIONS\": 3,\r\n});\r\n\r\nlet currentContext;\r\nif (browser.extension.getBackgroundPage) {\r\n    const bgPage = browser.extension.getBackgroundPage();\r\n\r\n    currentContext = (bgPage === window)\r\n        ? ContextType.BACKGROUND\r\n        : ContextType.OPTIONS;\r\n} else {\r\n    currentContext = ContextType.CONTENT_SCRIPT;\r\n}\r\n\r\nclass Environment {\r\n\r\n    static isBackgroundScript() {\r\n        return currentContext === ContextType.BACKGROUND;\r\n    }\r\n\r\n    static isContentScript() {\r\n        return currentContext === ContextType.CONTENT_SCRIPT;\r\n    }\r\n\r\n    static isOptions() {\r\n        return currentContext === ContextType.OPTIONS;\r\n    }\r\n}\r\n\r\nexport {Environment};\r\n","import {CookieStorage} from \"../Storage/CookieStorage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass Language {\r\n\r\n    static getCurrentSteamLanguage() {\r\n        if (this._currentSteamLanguage !== null) {\r\n            return this._currentSteamLanguage;\r\n        }\r\n\r\n        for (const script of document.querySelectorAll(\"script[src]\")) {\r\n            const language = new URL(script.src).searchParams.get(\"l\");\r\n            if (language) {\r\n                Language._currentSteamLanguage = language;\r\n                return this._currentSteamLanguage;\r\n            }\r\n        }\r\n\r\n        // In a Content Context, we can check for a cookie\r\n        if (Environment.isContentScript()) {\r\n            Language._currentSteamLanguage = CookieStorage.get(\"Steam_Language\") || null;\r\n        }\r\n\r\n        return this._currentSteamLanguage;\r\n    }\r\n\r\n    static getLanguageCode(language) {\r\n        const code = Language.languages[language];\r\n        return code || \"en\";\r\n    }\r\n\r\n    static isCurrentLanguageOneOf(array) {\r\n        return array.includes(Language.getCurrentSteamLanguage());\r\n    }\r\n}\r\n\r\nLanguage._currentSteamLanguage = null;\r\nLanguage.languages = {\r\n    \"english\": \"en\",\r\n    \"bulgarian\": \"bg\",\r\n    \"czech\": \"cs\",\r\n    \"danish\": \"da\",\r\n    \"dutch\": \"nl\",\r\n    \"finnish\": \"fi\",\r\n    \"french\": \"fr\",\r\n    \"greek\": \"el\",\r\n    \"german\": \"de\",\r\n    \"hungarian\": \"hu\",\r\n    \"italian\": \"it\",\r\n    \"japanese\": \"ja\",\r\n    \"koreana\": \"ko\",\r\n    \"norwegian\": \"no\",\r\n    \"polish\": \"pl\",\r\n    \"portuguese\": \"pt-PT\",\r\n    \"brazilian\": \"pt-BR\",\r\n    \"russian\": \"ru\",\r\n    \"romanian\": \"ro\",\r\n    \"schinese\": \"zh-CN\",\r\n    \"spanish\": \"es-ES\",\r\n    \"latam\": \"es-419\",\r\n    \"swedish\": \"sv-SE\",\r\n    \"tchinese\": \"zh-TW\",\r\n    \"thai\": \"th\",\r\n    \"turkish\": \"tr\",\r\n    \"ukrainian\": \"ua\",\r\n    \"vietnamese\": \"vi\",\r\n};\r\n\r\nexport {Language};\r\n","\r\nclass BackgroundSimple {\r\n    static message(message) {\r\n        return browser.runtime.sendMessage(message);\r\n    }\r\n\r\n    static action(requested, ...params) {\r\n        if (!params.length) { return this.message({\"action\": requested}); }\r\n        return this.message({\"action\": requested, \"params\": params});\r\n    }\r\n}\r\n\r\nexport {BackgroundSimple};\r\n","\r\nclass ExtensionResources {\r\n\r\n    static getURL(pathname) {\r\n        return browser.runtime.getURL(pathname);\r\n    }\r\n\r\n    static get(pathname) {\r\n        return fetch(ExtensionResources.getURL(pathname));\r\n    }\r\n\r\n    static getJSON(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.json());\r\n    }\r\n\r\n    static getText(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.text());\r\n    }\r\n}\r\n\r\nexport {ExtensionResources};\r\n","\r\nconst Info = {\r\n    \"version\": browser.runtime.getManifest().version,\r\n    \"db_version\": 3,\r\n};\r\n\r\nexport {Info};\r\n","import {Info} from \"../Info\";\r\n\r\nclass SyncedStorage {\r\n\r\n    /*\r\n     * browser.storage.sync limits\r\n     * QUOTA_BYTES = 102400 // 100KB\r\n     * QUOTA_BYTES_PER_ITEM = 8192 // 8KB\r\n     * MAX_ITEMS = 512\r\n     * MAX_WRITE_OPERATIONS_PER_HOUR = 1800\r\n     * MAX_WRITE_OPERATIONS_PER_MINUTE = 120\r\n     */\r\n    static has(key) {\r\n        return Object.prototype.hasOwnProperty.call(this._cache, key);\r\n    }\r\n\r\n    static get(key) {\r\n        if (typeof this._cache[key] == \"undefined\") {\r\n            if (typeof this.defaults[key] == \"undefined\") {\r\n                console.warn(`Unrecognized SyncedStorage key \"${key}\"`);\r\n            }\r\n            return this.defaults[key];\r\n        }\r\n        return this._cache[key];\r\n    }\r\n\r\n    static set(key, value) {\r\n        this._cache[key] = value;\r\n        return this._adapter.set({[key]: value});\r\n\r\n        // this will throw if MAX_WRITE_*, MAX_ITEMS, QUOTA_BYTES* are exceeded\r\n    }\r\n\r\n    static import(entries) {\r\n        for (const [key, value] of Object.entries(entries)) {\r\n            this._cache[key] = value;\r\n        }\r\n        return this._adapter.set(entries);\r\n    }\r\n\r\n    static remove(key) {\r\n        if (typeof this._cache[key] !== \"undefined\") {\r\n            delete this._cache[key];\r\n        }\r\n        return this._adapter.remove(key);\r\n\r\n        // can throw if MAX_WRITE* is exceeded\r\n    }\r\n\r\n    static keys(prefix = \"\") {\r\n        return Object.keys(this._cache).filter(k => k.startsWith(prefix));\r\n    }\r\n\r\n    static entries() {\r\n        return Object.entries(this._cache);\r\n    }\r\n\r\n    static async clear(force = false) {\r\n\r\n        let tmp;\r\n        if (force) {\r\n            this._cache = {};\r\n        } else {\r\n            tmp = this.persistent.reduce((acc, option) => {\r\n                acc[option] = this._cache[option];\r\n                return acc;\r\n            }, {});\r\n        }\r\n\r\n        // can throw if MAX_WRITE* is exceeded\r\n        await this._adapter.clear();\r\n\r\n        if (!force) {\r\n            await this.import(tmp);\r\n        }\r\n    }\r\n\r\n    // load whole storage and make local copy\r\n    static async init() {\r\n        browser.storage.onChanged.addListener(changes => {\r\n            for (const [key, {\"newValue\": val}] of Object.entries(changes)) {\r\n                this._cache[key] = val;\r\n            }\r\n        });\r\n\r\n        const storage = await this._adapter.get(null);\r\n        Object.assign(this._cache, storage);\r\n\r\n        return this._cache;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return this.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static toJson() {\r\n        return JSON.stringify(this._cache);\r\n    }\r\n}\r\n\r\nSyncedStorage.QUOTA_BYTES_PER_ITEM = 8192;\r\n\r\nSyncedStorage._adapter = browser.storage.sync || browser.storage.local;\r\nSyncedStorage._cache = {};\r\nSyncedStorage.defaults = Object.freeze({\r\n    \"language\": \"english\",\r\n\r\n    \"version\": Info.version,\r\n    \"version_show\": true,\r\n\r\n    \"highlight_owned_color\": \"#00ce67\",\r\n    \"highlight_wishlist_color\": \"#0491bf\",\r\n    \"highlight_coupon_color\": \"#a26426\",\r\n    \"highlight_inv_gift_color\": \"#800040\",\r\n    \"highlight_inv_guestpass_color\": \"#513c73\",\r\n    \"highlight_notinterested_color\": \"#4f4f4f\",\r\n    \"highlight_collection_color\": \"#856d0e\",\r\n    \"highlight_waitlist_color\": \"#4c7521\",\r\n\r\n    \"tag_owned_color\": \"#00b75b\",\r\n    \"tag_wishlist_color\": \"#0383b4\",\r\n    \"tag_coupon_color\": \"#c27120\",\r\n    \"tag_inv_gift_color\": \"#b10059\",\r\n    \"tag_inv_guestpass_color\": \"#65449a\",\r\n    \"tag_notinterested_color\": \"#4f4f4f\",\r\n    \"tag_collection_color\": \"#856d0e\",\r\n    \"tag_waitlist_color\": \"#4c7521\",\r\n\r\n    \"highlight_owned\": true,\r\n    \"highlight_wishlist\": true,\r\n    \"highlight_coupon\": false,\r\n    \"highlight_inv_gift\": false,\r\n    \"highlight_inv_guestpass\": false,\r\n    \"highlight_notinterested\": false,\r\n    \"highlight_excludef2p\": false,\r\n    \"highlight_collection\": true,\r\n    \"highlight_waitlist\": true,\r\n\r\n    \"tag_owned\": false,\r\n    \"tag_wishlist\": false,\r\n    \"tag_coupon\": false,\r\n    \"tag_inv_gift\": false,\r\n    \"tag_inv_guestpass\": false,\r\n    \"tag_notinterested\": true,\r\n    \"tag_collection\": false,\r\n    \"tag_waitlist\": false,\r\n    \"tag_short\": false,\r\n\r\n    \"hidetmsymbols\": false,\r\n\r\n    \"showlowestprice\": true,\r\n    \"showlowestprice_onwishlist\": true,\r\n    \"showlowestpricecoupon\": true,\r\n    \"showallstores\": true,\r\n    \"stores\": [],\r\n    \"override_price\": \"auto\",\r\n    \"showregionalprice\": \"mouse\",\r\n    \"regional_countries\": [\"us\", \"gb\", \"ru\", \"br\", \"au\", \"jp\"],\r\n\r\n    \"show_es_homepagetabs\": true,\r\n    \"showmarkettotal\": false,\r\n    \"showsteamrepapi\": true,\r\n    \"showmcus\": true,\r\n    \"showoc\": true,\r\n    \"showhltb\": true,\r\n    \"showyoutube\": true,\r\n    \"showtwitch\": true,\r\n    \"showpcgw\": true,\r\n    \"showcompletionistme\": false,\r\n    \"showprotondb\": false,\r\n    \"showviewinlibrary\": false,\r\n    \"showsteamcardexchange\": false,\r\n    \"showitadlinks\": true,\r\n    \"showsteamdb\": true,\r\n    \"showbartervg\": false,\r\n    \"showastatslink\": true,\r\n    \"showyoutubegameplay\": true,\r\n    \"showyoutubereviews\": true,\r\n    \"showwsgf\": true,\r\n    \"exfgls\": true,\r\n    \"app_custom_link\": [\r\n        {\r\n            \"enabled\": false,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]+[NAME]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n\r\n    \"customize_apppage\": {\r\n        \"recentupdates\": true,\r\n        \"reviews\": true,\r\n        \"about\": true,\r\n        \"contentwarning\": true,\r\n        \"steamchart\": true,\r\n        \"steamspy\": true,\r\n        \"surveys\": true,\r\n        \"sysreq\": true,\r\n        \"legal\": true,\r\n        \"morelikethis\": true,\r\n        \"recommendedbycurators\": true,\r\n        \"customerreviews\": true\r\n    },\r\n\r\n    \"customize_frontpage\": {\r\n        \"featuredrecommended\": true,\r\n        \"specialoffers\": true,\r\n        \"trendingamongfriends\": true,\r\n        \"discoveryqueue\": true,\r\n        \"browsesteam\": true,\r\n        \"curators\": true,\r\n        \"morecuratorrecommendations\": true,\r\n        \"recentlyupdated\": true,\r\n        \"fromdevelopersandpublishersthatyouknow\": true,\r\n        \"popularvrgames\": true,\r\n        \"homepagetabs\": true,\r\n        \"gamesstreamingnow\": true,\r\n        \"under\": true,\r\n        \"updatesandoffers\": true,\r\n        \"homepagesidebar\": true\r\n    },\r\n\r\n    // 'show_keylol_links': false, // not in use, option is commented out\r\n    \"show_package_info\": false,\r\n    \"show_steamchart_info\": true,\r\n    \"show_steamspy_info\": true,\r\n    \"show_early_access\": true,\r\n    \"show_alternative_linux_icon\": false,\r\n    \"show_itad_button\": false,\r\n    \"skip_got_steam\": false,\r\n\r\n    \"installsteam\": \"show\",\r\n    \"openinnewtab\": false,\r\n    \"keepssachecked\": false,\r\n    \"showemptywishlist\": true,\r\n    \"user_notes_app\": true,\r\n    \"user_notes_wishlist\": true,\r\n    \"showwishliststats\": true,\r\n    \"user_notes\": {},\r\n    \"user_notes_adapter\": \"synced_storage\",\r\n    \"replaceaccountname\": true,\r\n    \"showlanguagewarning\": true,\r\n    \"showlanguagewarninglanguage\": \"english\",\r\n    \"homepage_tab_selection\": \"remember\",\r\n    \"homepage_tab_last\": null,\r\n    \"send_age_info\": true,\r\n    \"removebroadcasts\": false,\r\n    \"mp4video\": false,\r\n    \"horizontalscrolling\": true,\r\n    \"showsupportinfo\": true,\r\n    \"showdrm\": true,\r\n    \"regional_hideworld\": false,\r\n    \"showinvnav\": true,\r\n    \"quickinv\": true,\r\n    \"quickinv_diff\": -0.01,\r\n    \"community_default_tab\": \"\",\r\n    \"showallachievements\": false,\r\n    \"showallstats\": true,\r\n    \"showachinstore\": true,\r\n    \"showcomparelinks\": false,\r\n    \"hideactivelistings\": false,\r\n    \"showlowestmarketprice\": true,\r\n    \"hidespamcomments\": false,\r\n    \"spamcommentregex\": \"[\\\\u2500-\\\\u25FF]\",\r\n    \"wlbuttoncommunityapp\": true,\r\n    \"removeguideslanguagefilter\": false,\r\n    \"disablelinkfilter\": false,\r\n    \"sortfriendsby\": \"default_ASC\",\r\n    \"sortreviewsby\": \"default_ASC\",\r\n    \"sortgroupsby\": \"default_ASC\",\r\n    \"show1clickgoo\": true,\r\n    \"show_profile_link_images\": \"gray\",\r\n    \"show_custom_themes\": true,\r\n    \"profile_steamrepcn\": true,\r\n    \"profile_steamgifts\": true,\r\n    \"profile_steamtrades\": true,\r\n    \"profile_bartervg\": true,\r\n    \"profile_steamrep\": true,\r\n    \"profile_steamdbcalc\": true,\r\n    \"profile_astats\": true,\r\n    \"profile_backpacktf\": true,\r\n    \"profile_astatsnl\": true,\r\n    \"profile_steamid\": true,\r\n    \"profile_custom_link\": [\r\n        {\r\n            \"enabled\": true,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n    \"fav_emoticons\": [],\r\n    \"group_steamgifts\": true,\r\n    \"steamcardexchange\": true,\r\n    \"purchase_dates\": true,\r\n    \"show_badge_progress\": true,\r\n    \"show_coupon\": true,\r\n    \"show_wishlist_link\": true,\r\n    \"show_wishlist_count\": true,\r\n    \"show_progressbar\": true,\r\n    \"show_backtotop\": false,\r\n\r\n    \"profile_showcase_twitch\": true,\r\n    \"profile_showcase_own_twitch\": false,\r\n    \"profile_showcase_twitch_profileonly\": false,\r\n\r\n    \"itad_import_library\": false,\r\n    \"itad_import_wishlist\": false,\r\n    \"add_to_waitlist\": false,\r\n\r\n    \"context_steam_store\": false,\r\n    \"context_steam_market\": false,\r\n    \"context_itad\": false,\r\n    \"context_bartervg\": false,\r\n    \"context_steamdb\": false,\r\n    \"context_steamdb_instant\": false,\r\n    \"context_steam_keys\": false,\r\n});\r\nSyncedStorage.persistent = [\r\n    \"user_notes\",\r\n    \"user_notes_adapter\",\r\n];\r\n\r\nexport {SyncedStorage};\r\n","import {BackgroundSimple} from \"../BackgroundSimple\";\r\nimport {ExtensionResources} from \"../ExtensionResources\";\r\nimport {Language} from \"./Language\";\r\nimport {SyncedStorage} from \"../Storage/SyncedStorage\";\r\n\r\n\r\nclass Localization {\r\n\r\n    static loadLocalization(code) {\r\n        return ExtensionResources.getJSON(`/localization/${code}.json`);\r\n    }\r\n\r\n    static init() {\r\n        if (Localization._promise) { return Localization._promise; }\r\n\r\n        let currentSteamLanguage = Language.getCurrentSteamLanguage();\r\n        const storedSteamLanguage = SyncedStorage.get(\"language\");\r\n        if (currentSteamLanguage === null) {\r\n            currentSteamLanguage = storedSteamLanguage;\r\n        } else if (currentSteamLanguage !== storedSteamLanguage) {\r\n            SyncedStorage.set(\"language\", currentSteamLanguage);\r\n            BackgroundSimple.action(\"clearpurchases\");\r\n        }\r\n\r\n        function deepAssign(target, source) {\r\n\r\n            // Object.assign() but deep-assigning objects recursively\r\n            for (const [key, val] of Object.entries(source)) {\r\n                if (typeof target[key] === \"undefined\") {\r\n                    console.warn(\"The key %s doesn't exist in the English localization file\", key);\r\n                    continue;\r\n                }\r\n                if (typeof val === \"object\") {\r\n                    deepAssign(target[key], val);\r\n                } else if (val !== \"\") {\r\n                    target[key] = val;\r\n                }\r\n            }\r\n            return target;\r\n        }\r\n\r\n        const local = Language.getLanguageCode(currentSteamLanguage);\r\n        const codes = [\"en\"];\r\n        if (local !== null && local !== \"en\") {\r\n            codes.push(local);\r\n        }\r\n        Localization._promise = Promise.all(\r\n            codes.map(lc => Localization.loadLocalization(lc))\r\n        ).then(([english, local]) => {\r\n            Localization.str = english;\r\n            if (local) {\r\n                deepAssign(Localization.str, local);\r\n            }\r\n            return Localization.str;\r\n        });\r\n        return Localization._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return Localization.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static getString(key) {\r\n\r\n        // Source: http://stackoverflow.com/a/24221895\r\n        const path = key.split(\".\").reverse();\r\n        let current = Localization.str;\r\n\r\n        while (path.length) {\r\n            if (typeof current !== \"object\") {\r\n                return null;\r\n            }\r\n            current = current[path.pop()];\r\n        }\r\n        return current;\r\n    }\r\n}\r\n\r\nLocalization._promise = null;\r\n\r\n\r\nexport {Localization};\r\n","class Timer {\r\n\r\n    constructor(duration) {\r\n        this._promise = new Promise(resolve => {\r\n            this._id = setTimeout(() => { resolve(); }, duration);\r\n        });\r\n    }\r\n\r\n    then(onSuccess, onFail) {\r\n        if (this._promise) {\r\n            return this._promise.then(onSuccess, onFail);\r\n        }\r\n\r\n        throw new Error(\"Timer has been cleared before\");\r\n    }\r\n\r\n    clear() {\r\n        clearTimeout(this._id);\r\n        this._promise = null;\r\n    }\r\n}\r\n\r\nclass ResettableTimer {\r\n\r\n    constructor(onDone, duration) {\r\n        this.onDone = onDone;\r\n        this.duration = duration;\r\n\r\n        this.reset();\r\n    }\r\n\r\n    get running() { return this._running; }\r\n\r\n    reset() {\r\n        if (typeof this._id !== \"undefined\") {\r\n            clearTimeout(this._id);\r\n        }\r\n\r\n        this._id = setTimeout(async() => {\r\n            await this.onDone();\r\n            this._running = false;\r\n        }, this.duration);\r\n\r\n        this._running = true;\r\n    }\r\n}\r\n\r\nclass TimeUtils {\r\n\r\n    static timer(duration) {\r\n        return new Timer(duration);\r\n    }\r\n\r\n    static resettableTimer(onDone, duration) {\r\n        return new ResettableTimer(onDone, duration);\r\n    }\r\n\r\n    static now() {\r\n        return Math.trunc(Date.now() / 1000);\r\n    }\r\n}\r\n\r\nexport {TimeUtils};\r\n","\r\nclass GameId {\r\n\r\n    static parseId(id) {\r\n        if (!id) { return null; }\r\n\r\n        const intId = parseInt(id);\r\n        if (!intId) { return null; }\r\n\r\n        return intId;\r\n    }\r\n\r\n    static getAppid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const appid = _text.dataset.dsAppid;\r\n            if (appid) { return GameId.parseId(appid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        // app, market/listing\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/(?:app|market\\/listings)\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getSubid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const subid = _text.dataset.dsPackageid;\r\n            if (subid) { return GameId.parseId(subid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/sub\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getBundleid(text) {\r\n        let _text = text;\r\n\r\n        if (!_text) { return null; }\r\n\r\n        if (_text instanceof HTMLElement) {\r\n            const bundleid = _text.dataset.dsBundleid;\r\n            if (bundleid) { return GameId.parseId(bundleid); }\r\n            _text = _text.href;\r\n            if (!_text) { return null; }\r\n        }\r\n\r\n        const m = _text.match(/(?:store\\.steampowered|steamcommunity)\\.com\\/bundle\\/(\\d+)\\/?/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static trimStoreId(storeId) {\r\n        return Number(storeId.slice(storeId.indexOf(\"/\") + 1));\r\n    }\r\n\r\n    static getAppidImgSrc(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/(?:cdn\\.akamai\\.steamstatic\\.com\\/steam|steamcdn-a\\.akamaihd\\.net\\/steam|steamcommunity\\/public\\/images)\\/apps\\/(\\d+)\\//);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidUriQuery(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/appid=(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppids(text) {\r\n        const regex = /(?:store\\.steampowered|steamcommunity)\\.com\\/app\\/(\\d+)\\/?/g;\r\n        const res = [];\r\n        let m;\r\n        while ((m = regex.exec(text)) !== null) {\r\n            const id = GameId.parseId(m[1]);\r\n            if (id) {\r\n                res.push(id);\r\n            }\r\n        }\r\n        return res;\r\n    }\r\n\r\n    static getAppidFromId(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/game_(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n\r\n    static getAppidFromGameCard(text) {\r\n        if (!text) { return null; }\r\n        const m = text.match(/\\/gamecards\\/(\\d+)/);\r\n        return m && GameId.parseId(m[1]);\r\n    }\r\n}\r\n\r\nexport {GameId};\r\n","import {SyncedStorage} from \"./Storage/SyncedStorage\";\r\n\r\nconst PermissionOptions = Object.freeze({\r\n    \"context_steam_store\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steam_market\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_itad\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_bartervg\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steamdb\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steamdb_instant\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steam_keys\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n});\r\n\r\nclass Permissions {\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static contains(permissionList) {\r\n        return browser.permissions.contains({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static async request(permissionList) {\r\n        // Prevents requesting permissions that are not optional (contextMenus for Firefox)\r\n        if (await this.contains(permissionList)) { return true; }\r\n\r\n        return browser.permissions.request({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static remove(permissionList) {\r\n        if (permissionList.includes(\"contextMenus\")) {\r\n            browser.contextMenus.removeAll();\r\n        }\r\n        return browser.permissions.remove({\"permissions\": permissionList});\r\n    }\r\n\r\n    static async when(permission, onAdded, onRemoved) {\r\n        if (onAdded) {\r\n            if (await Permissions.contains([permission])) {\r\n                onAdded();\r\n            }\r\n\r\n            browser.permissions.onAdded.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onAdded();\r\n                }\r\n            });\r\n        }\r\n\r\n        if (onRemoved) {\r\n            browser.permissions.onRemoved.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onRemoved();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    static requestOption(option) {\r\n        return Permissions.request(PermissionOptions[option].permissions);\r\n    }\r\n\r\n    static removeOption(optionToRemove) {\r\n\r\n        // If any of the permissions is in use by another option, don't remove.\r\n        const unusedPermissions = Permissions._getUnusedPermissions(optionToRemove);\r\n        if (unusedPermissions.length === 0) {\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        return Permissions.remove(unusedPermissions);\r\n    }\r\n\r\n    static _getUnusedPermissions(option) {\r\n        const used = new Set();\r\n        for (const [key, setup] of Object.entries(PermissionOptions)) {\r\n            if (option === key || (setup.persistent && !SyncedStorage.get(key))) {\r\n                continue;\r\n            }\r\n\r\n            for (const p of setup.permissions) {\r\n                used.add(p);\r\n            }\r\n        }\r\n\r\n        const unused = new Set();\r\n        for (const p of PermissionOptions[option].permissions) {\r\n            if (!used.has(p)) {\r\n                unused.add(p);\r\n            }\r\n        }\r\n\r\n        return Array.from(unused.values());\r\n    }\r\n}\r\n\r\nexport {PermissionOptions, Permissions};\r\n","import {Info} from \"./Info\";\r\n\r\nclass Version {\r\n\r\n    constructor(major, minor = 0, patch = 0) {\r\n        console.assert([major, minor, patch].filter(Number.isInteger).length === 3, `${major}.${minor}.${patch} must be integers`);\r\n        this.major = major;\r\n        this.minor = minor;\r\n        this.patch = patch;\r\n    }\r\n\r\n    static from(version) {\r\n        if (version instanceof Version) {\r\n            return new Version(version.major, version.minor, version.patch);\r\n        }\r\n        if (typeof version == \"string\") {\r\n            return Version.fromString(version);\r\n        }\r\n        if (Array.isArray(version)) {\r\n            return Version.fromArray(version);\r\n        }\r\n        throw new Error(`Could not construct a Version from ${version}`);\r\n    }\r\n\r\n    static fromArray(version) {\r\n        return new Version(...version.map(v => parseInt(v)));\r\n    }\r\n\r\n    static fromString(version) {\r\n        return Version.fromArray(version.split(\".\"));\r\n    }\r\n\r\n    static coerce(version) {\r\n        if (version instanceof Version) {\r\n            return version;\r\n        }\r\n        return Version.from(version);\r\n    }\r\n\r\n    toString() {\r\n        return `${this.major}.${this.minor}.${this.patch}`;\r\n    }\r\n\r\n    toArray() {\r\n        return [this.major, this.minor, this.patch];\r\n    }\r\n\r\n    toJSON() {\r\n        return this.toString();\r\n    }\r\n\r\n    isCurrent() {\r\n        return this.isSameOrAfter(Info.version);\r\n    }\r\n\r\n    isSame(version) {\r\n        const _version = Version.coerce(version);\r\n        return this.major === _version.major\r\n            && this.minor === _version.minor\r\n            && this.patch === _version.patch;\r\n    }\r\n\r\n    isBefore(version) {\r\n        const _version = Version.coerce(version);\r\n        if (this.major < _version.major) { return true; }\r\n        if (this.major > _version.major) { return false; }\r\n\r\n        // this.major == _version.major\r\n        if (this.minor < _version.minor) { return true; }\r\n        if (this.minor > _version.minor) { return false; }\r\n\r\n        // this.minor == _version.minor\r\n        if (this.patch < _version.patch) { return true; }\r\n        return false;\r\n    }\r\n\r\n    isSameOrBefore(version) {\r\n        return this.isSame(version) || this.isBefore(version);\r\n    }\r\n\r\n    isAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isBefore(this);\r\n    }\r\n\r\n    isSameOrAfter(version) {\r\n        const _version = Version.coerce(version);\r\n        return _version.isSameOrBefore(this);\r\n    }\r\n}\r\n\r\nexport {Version};\r\n","import {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\n\r\nclass ProgressBar {\r\n    static create() {\r\n        if (!SyncedStorage.get(\"show_progressbar\")) { return; }\r\n\r\n        HTML.afterEnd(\"#global_actions\",\r\n            `<div class=\"es_progress__wrap\">\r\n                <div class=\"es_progress es_progress--complete\" title=\"${Localization.str.ready.ready}\">\r\n                    <div class=\"es_progress__bar\">\r\n                        <div class=\"es_progress__value\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n        ProgressBar._progress = document.querySelector(\".es_progress\");\r\n    }\r\n\r\n    static loading() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.loading);\r\n\r\n        ProgressBar.requests = {\"initiated\": 0, \"completed\": 0};\r\n        ProgressBar._progress.classList.remove(\"es_progress--complete\");\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = \"18px\";\r\n    }\r\n\r\n    static startRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.initiated++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static finishRequest() {\r\n        if (!ProgressBar.requests) { return; }\r\n        ProgressBar.requests.completed++;\r\n        ProgressBar.progress();\r\n    }\r\n\r\n    static progress(value) {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        let _value = value;\r\n\r\n        if (!_value) {\r\n            if (!ProgressBar.requests) { return; }\r\n            if (ProgressBar.requests.initiated > 0) {\r\n                _value = 100 * ProgressBar.requests.completed / ProgressBar.requests.initiated;\r\n            }\r\n        }\r\n        if (_value > 100) {\r\n            _value = 100;\r\n        }\r\n\r\n        ProgressBar._progress.querySelector(\".es_progress__value\").style.width = `${_value}px`;\r\n\r\n        if (_value >= 100) {\r\n            ProgressBar._progress.classList.add(\"es_progress--complete\");\r\n            ProgressBar._progress.setAttribute(\"title\", Localization.str.ready.ready);\r\n            ProgressBar.requests = null;\r\n        }\r\n    }\r\n\r\n    static serverOutage() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        ProgressBar._progress.classList.add(\"es_progress--warning\");\r\n        ProgressBar.requests = null;\r\n\r\n        if (!ProgressBar._progress.parentElement.querySelector(\".es_progress__warning, .es_progress__error\")) {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__warning\">${Localization.str.ready.server_outage}</div>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static failed() {\r\n        if (!ProgressBar._progress) { return; }\r\n\r\n        const warningNode = ProgressBar._progress.parentElement.querySelector(\".es_progress__warning\");\r\n        if (warningNode) {\r\n            ProgressBar._progress.classList.remove(\"es_progress--warning\"); // Errors have higher precedence\r\n            warningNode.remove();\r\n        }\r\n        ProgressBar._progress.classList.add(\"es_progress--error\");\r\n        ProgressBar.requests = null;\r\n\r\n        const nodeError = ProgressBar._progress.parentElement.querySelector(\".es_progress__error\");\r\n        if (nodeError) {\r\n            nodeError.textContent = Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests);\r\n        } else {\r\n            HTML.afterEnd(\r\n                ProgressBar._progress,\r\n                `<div class=\"es_progress__error\">${\r\n                    Localization.str.ready.failed.replace(\"__amount__\", ++ProgressBar._failedRequests)\r\n                }</div>`\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nProgressBar._progress = null;\r\nProgressBar._failedRequests = 0;\r\n\r\nexport {ProgressBar};\r\n","import {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {ErrorParser} from \"../../Core/Errors/ErrorParser\";\r\nimport {ProgressBar} from \"./Widgets/ProgressBar\";\r\n\r\nclass Background extends BackgroundSimple {\r\n    static async message(message) {\r\n        ProgressBar.startRequest();\r\n\r\n        let result;\r\n        try {\r\n            result = await super.message(message);\r\n            ProgressBar.finishRequest();\r\n            return result;\r\n        } catch (err) {\r\n            const errObj = ErrorParser.parse(err.message);\r\n\r\n            switch (errObj.name) {\r\n                case \"ServerOutageError\":\r\n                    ProgressBar.serverOutage();\r\n                    break;\r\n                default: {\r\n                    if (!Background._errorHandlers.some(handler => handler(errObj))) {\r\n                        ProgressBar.failed();\r\n                    }\r\n                }\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @callback registerErrorHandlerCallback\r\n     * @param {string} name - The error name\r\n     * @param {string} msg - The error message\r\n     * @returns {boolean} - Whether the error has been handled\r\n     */\r\n\r\n    /**\r\n     * @param {registerErrorHandlerCallback} handler - The callback that will (eventually) handle the error\r\n     */\r\n    static registerErrorHandler(handler) {\r\n        Background._errorHandlers.push(handler);\r\n    }\r\n}\r\nBackground._errorHandlers = [];\r\n\r\nexport {Background};\r\n","\r\n/**\r\n * Convenience class for passing errors between contexts.\r\n * Errors thrown in the context of a message callback on the background page are\r\n * {@link https://github.com/mozilla/webextension-polyfill/blob/87bdfa844da054d189ac28423cf01b64ebfe1e5b/src/browser-polyfill.js#L418\r\n *  cut down to only send the message of the error},\r\n * losing information about the type.\r\n */\r\n/* eslint-enable max-len */\r\nclass ErrorParser {\r\n\r\n    /**\r\n     * Takes an Error string and parses it by splitting it into name and message\r\n     * @param {String} errStr a string created by Error.prototype.toString\r\n     * @returns {{name: String, msg: String}} an object containing information about the error name and its message\r\n     */\r\n    static parse(errStr) {\r\n        const info = errStr.match(/(.*):\\s(.+)/);\r\n\r\n        return {\"name\": info[1] || \"\", \"msg\": info[2] || \"\"};\r\n    }\r\n}\r\n\r\nexport {ErrorParser};\r\n","import {ProgressBar} from \"./Widgets/ProgressBar\";\r\nimport {Errors} from \"../../Core/Errors/Errors\";\r\n\r\nclass RequestData {\r\n\r\n    static async getHttp(url, settings = {}, responseType = \"text\") {\r\n\r\n        let _url = url;\r\n        const _settings = {\r\n            \"method\": \"GET\",\r\n            \"credentials\": \"include\",\r\n            \"headers\": {\"origin\": window.location.origin},\r\n            \"referrer\": window.location.origin + window.location.pathname,\r\n            ...settings\r\n        };\r\n\r\n        ProgressBar.startRequest();\r\n\r\n        if (_url.startsWith(\"//\")) { // TODO remove when not needed\r\n            _url = window.location.protocol + url;\r\n            console.warn(\"Requesting URL without protocol, please update\");\r\n        }\r\n\r\n        let response;\r\n\r\n        try {\r\n            response = await RequestData._fetchFn(_url, _settings);\r\n\r\n            if (!response.ok) {\r\n                throw new Errors.HTTPError(response.status, `HTTP ${response.status} ${response.statusText} for ${response.url}`);\r\n            }\r\n        } catch (err) {\r\n            ProgressBar.failed();\r\n            throw err;\r\n        }\r\n\r\n        ProgressBar.finishRequest();\r\n\r\n        return response[responseType]();\r\n    }\r\n\r\n    static post(url, formData, settings, returnJSON) {\r\n        return RequestData.getHttp(url, Object.assign(settings || {}, {\r\n            \"method\": \"POST\",\r\n            \"body\": formData\r\n        }), returnJSON ? \"json\" : \"text\");\r\n    }\r\n\r\n    static getJson(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"json\");\r\n    }\r\n\r\n    static getBlob(url, settings) {\r\n        return RequestData.getHttp(url, settings, \"blob\");\r\n    }\r\n}\r\n\r\n/**\r\n * In Firefox, the global fetch lies in the sandbox environment, thus we have to\r\n * access the fetch function of the content window.\r\n * See https://bugzilla.mozilla.org/show_bug.cgi?id=1579347#c5\r\n */\r\nRequestData._fetchFn\r\n    // eslint-disable-next-line no-undef\r\n    = (typeof content !== \"undefined\" && content && content.fetch) // content is only available in FF environments\r\n    || fetch.bind(window);\r\n\r\nexport {RequestData};\r\n","import {CookieStorage} from \"../../Core/Storage/CookieStorage\";\r\nimport {HTMLParser} from \"../../Core/Html/HtmlParser\";\r\nimport {Background} from \"./Background\";\r\nimport {RequestData} from \"./RequestData\";\r\n\r\nclass User {\r\n\r\n    static get storeCountry() {\r\n\r\n        const url = new URL(window.location.href);\r\n\r\n        let country;\r\n        if (url.searchParams && url.searchParams.has(\"cc\")) {\r\n            country = url.searchParams.get(\"cc\");\r\n        } else {\r\n            country = User._storeCountry;\r\n            if (!country) {\r\n                country = CookieStorage.get(\"steamCountry\");\r\n            }\r\n        }\r\n\r\n        if (!country) {\r\n            console.warn(\"Failed to detect store country, falling back to US\");\r\n            country = \"US\";\r\n        }\r\n\r\n        return country.substr(0, 2);\r\n    }\r\n\r\n    static promise() {\r\n        if (User._promise) { return User._promise; }\r\n\r\n        const avatarNode = document.querySelector(\"#global_actions > a.user_avatar\");\r\n        let loginPromise;\r\n\r\n        if (avatarNode) {\r\n            User.profileUrl = avatarNode.href;\r\n            User.profilePath = avatarNode.pathname;\r\n\r\n            loginPromise = Background.action(\"login\", User.profilePath)\r\n                .then(login => {\r\n                    if (!login) { return; }\r\n                    User.isSignedIn = true;\r\n                    User.steamId = login.steamId;\r\n                });\r\n        } else {\r\n            loginPromise = Background.action(\"logout\");\r\n        }\r\n\r\n        User._promise = loginPromise\r\n            .then(() => Background.action(\"storecountry\"))\r\n            .catch(({message}) => { console.error(message); })\r\n            .then(country => {\r\n                if (country) {\r\n                    User._storeCountry = country;\r\n                    return null;\r\n                }\r\n\r\n                let newCountry;\r\n\r\n                if (window.location.hostname.endsWith(\"steampowered.com\")) {\r\n\r\n                    // Search through all scripts in case the order gets changed or a new one gets added\r\n                    for (const script of document.getElementsByTagName(\"script\")) {\r\n                        const match = script.textContent.match(/GDynamicStore\\.Init\\(.+?, '([A-Z]{2})/);\r\n                        if (match) {\r\n                            newCountry = match[1];\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                } else if (window.location.hostname === \"steamcommunity.com\") {\r\n                    const config = document.querySelector(\"#webui_config,#application_config\");\r\n                    if (config) {\r\n                        newCountry = JSON.parse(config.dataset.config).COUNTRY;\r\n                    }\r\n                }\r\n\r\n                if (newCountry) {\r\n                    User._storeCountry = newCountry;\r\n                    return Background.action(\"storecountry\", newCountry)\r\n                        .catch(({message}) => { console.error(message); });\r\n                } else {\r\n                    throw new Error(\"Script with user store country not found\");\r\n                }\r\n\r\n            })\r\n            .catch(err => {\r\n                console.group(\"Store country detection\");\r\n                console.warn(\"Failed to detect store country from page\");\r\n                console.error(err);\r\n                console.groupEnd();\r\n            });\r\n\r\n        return User._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return User.promise().then(onDone, onCatch);\r\n    }\r\n\r\n    static get sessionId() {\r\n        if (!User._sessionId) {\r\n            User._sessionId = HTMLParser.getVariableFromDom(\"g_sessionID\", \"string\");\r\n        }\r\n        return User._sessionId;\r\n    }\r\n\r\n    static getPurchaseDate(lang, appName) {\r\n        const _appName = HTMLParser.clearSpecialSymbols(appName);\r\n        return Background.action(\"purchases\", _appName, lang);\r\n    }\r\n\r\n    /*\r\n     * Retrieve user access token to use in new style WebAPI calls (Services)\r\n     * https://github.com/Revadike/UnofficialSteamWebAPI/wiki/Get-Points-Summary-Config\r\n     */\r\n    static async getUserToken() {\r\n        // Use relative URL, so it matches domain (works on any steam domain)\r\n        const response = await RequestData.getJson(\"/pointssummary/ajaxgetasyncconfig\").catch(() => false);\r\n        if (!response || !response.success) {\r\n            throw new Error(\"Failed to get webapi token\");\r\n        }\r\n\r\n        return response.data.webapi_token;\r\n    }\r\n}\r\n\r\nexport {User};\r\n","import {Errors} from \"../../../Core/Errors/Errors\";\r\n\r\n// Polyfill from https://gist.github.com/davidbarral/d0d4da70fa9e6f615595d01f54276e0b#file-promises-js\r\nif (!Promise.allSettled) {\r\n    Promise.allSettled = promises => Promise.all(\r\n        promises.map(promise => promise\r\n            .then(value => ({\r\n                \"status\": \"fulfilled\",\r\n                value,\r\n            }))\r\n            .catch(reason => ({\r\n                \"status\": \"rejected\",\r\n                reason,\r\n            })))\r\n    );\r\n}\r\n\r\nclass FeatureManager {\r\n    static async apply(features) {\r\n\r\n        this._promisesMap = new Map();\r\n\r\n        this._stats = {\r\n            \"completed\": 0,\r\n            \"failed\": 0,\r\n            \"dependency\": 0,\r\n        };\r\n\r\n        while (features.length > 0) {\r\n\r\n            const feature = features.pop();\r\n            const promise = this._generateFeatureChain(feature);\r\n\r\n            if (promise === null) {\r\n                features.unshift(feature);\r\n            } else {\r\n                this._promisesMap.set(feature.constructor, promise);\r\n            }\r\n        }\r\n\r\n        await Promise.allSettled(Array.from(this._promisesMap.values()));\r\n\r\n        console.log(\r\n            \"Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors\",\r\n            this._stats.completed,\r\n            this._stats.failed,\r\n            this._stats.dependency\r\n        );\r\n    }\r\n\r\n    static _generateFeatureChain(feature) {\r\n\r\n        let ready = true;\r\n        let promise = Promise.resolve(true);\r\n\r\n        if (Array.isArray(feature.constructor.dependencies)) {\r\n\r\n            // Ensure that all dependencies have generated a dependency chain for themselves\r\n            for (const dep of feature.constructor.dependencies) {\r\n                if (this._promisesMap.has(dep)) { continue; }\r\n\r\n                ready = false;\r\n                break;\r\n            }\r\n\r\n            if (ready) {\r\n\r\n                // Promise that waits for all dependencies to finish executing\r\n                promise = Promise.all(\r\n                    Array.from(this._promisesMap.entries())\r\n                        .filter(([ftr]) => feature.constructor.dependencies.includes(ftr))\r\n                        .map(([, promise]) => promise)\r\n                );\r\n            }\r\n        }\r\n\r\n        if (!ready) { return null; }\r\n\r\n        return promise\r\n            .then(previousCheck => { // Check if the dependencies have all their prerequisites fulfilled\r\n                let prev = true;\r\n\r\n                if (!feature.constructor.weakDependency) {\r\n                    if (Array.isArray(previousCheck)) {\r\n                        prev = previousCheck.every(res => res);\r\n                    } else {\r\n                        prev = previousCheck;\r\n                    }\r\n                }\r\n\r\n                return prev && feature.checkPrerequisites();\r\n            })\r\n            .then(async fulfilled => { // If the feature's prerequisites are fulfilled, apply it\r\n                if (fulfilled) {\r\n                    await feature.apply();\r\n                    ++this._stats.completed;\r\n                }\r\n                return fulfilled;\r\n            })\r\n            .catch(err => {\r\n\r\n                const featureName = feature.constructor.name;\r\n\r\n                if (err instanceof Errors.FeatureDependencyError) {\r\n                    console.warn(\r\n                        \"Not applying feature %s due to an error in the dependency chain (namely %s)\",\r\n                        featureName,\r\n                        err.featureName\r\n                    );\r\n                    ++this._stats.dependency;\r\n                    throw err;\r\n                }\r\n\r\n                console.group(featureName);\r\n                console.error(\"Error while applying feature %s\", featureName);\r\n                console.error(err);\r\n                console.groupEnd();\r\n\r\n                ++this._stats.failed;\r\n                throw new Errors.FeatureDependencyError(\"Failed to apply\", featureName);\r\n            });\r\n\r\n    }\r\n}\r\n\r\nexport {FeatureManager};\r\n","\r\nexport default Object.freeze({\r\n    \"ACCOUNT\": 1,\r\n    \"APP\": 2,\r\n    \"BUNDLE\": 3,\r\n    \"STORE_DEFAULT\": 4,\r\n    \"FUNDS\": 5,\r\n    \"REGISTER_KEY\": 6,\r\n    \"SALE\": 7,\r\n    \"SEARCH\": 8,\r\n    \"STATS\": 9,\r\n    \"STORE_FRONT\": 10,\r\n    \"SUB\": 11,\r\n    \"WISHLIST\": 12,\r\n    \"AGECHECK\": 13,\r\n    \"COMMUNITY_DEFAULT\": 14,\r\n    \"WORKSHOP\": 15,\r\n    \"PROFILE_ACTIVITY\": 16,\r\n    \"GAMES\": 17,\r\n    \"PROFILE_EDIT\": 18,\r\n    \"BADGES\": 19,\r\n    \"GAME_CARD\": 20,\r\n    \"FRIENDS_THAT_PLAY\": 21,\r\n    \"FRIENDS\": 22,\r\n    \"GROUPS\": 23,\r\n    \"INVENTORY\": 24,\r\n    \"MARKET_LISTING\": 25,\r\n    \"MARKET\": 26,\r\n    \"PROFILE_HOME\": 27,\r\n    \"GROUP_HOME\": 28,\r\n    \"GUIDES\": 29,\r\n    \"COMMUNITY_APP\": 30,\r\n    \"COMMUNITY_STATS\": 31,\r\n    \"MY_WORKSHOP\": 32,\r\n    \"SHARED_FILES\": 33,\r\n    \"WORKSHOP_BROWSE\": 34,\r\n    \"EDIT_GUIDE\": 35,\r\n    \"RECOMMENDED\": 36,\r\n    \"BOOSTER_CREATOR\": 37,\r\n    \"TRADE_OFFER\": 38,\r\n});\r\n\r\n","import {GameId} from \"../../../Core/GameId\";\r\nimport {Background} from \"../Background\";\r\nimport {User} from \"../User\";\r\n\r\nclass DynamicStore {\r\n\r\n    /*\r\n     * FIXME\r\n     *  1. Check usage of `await DynamicStore`, currently it does nothing\r\n     *  2. getAppStatus() is not properly waiting for initialization of the DynamicStore\r\n     *  3. There is no guarante that `User` is initialized before `_fetch()` is called\r\n     *  4. getAppStatus() should probably be simplified if we force array even when only one storeId was requested\r\n     */\r\n\r\n    static clear() {\r\n        return Background.action(\"dynamicstore.clear\");\r\n    }\r\n\r\n    static async getAppStatus(storeId) {\r\n        const multiple = Array.isArray(storeId);\r\n        let promise;\r\n        let trimmedIds;\r\n\r\n        if (multiple) {\r\n            trimmedIds = storeId.map(id => GameId.trimStoreId(id));\r\n            promise = Background.action(\"dynamicstorestatus\", trimmedIds);\r\n        } else {\r\n            promise = Background.action(\"dynamicstorestatus\", GameId.trimStoreId(storeId));\r\n        }\r\n\r\n        let statusList;\r\n        const dsStatusList = await promise;\r\n\r\n        if (multiple) {\r\n            statusList = {};\r\n            for (let i = 0; i < storeId.length; ++i) {\r\n                const trimmedId = trimmedIds[i];\r\n                const id = storeId[i];\r\n                statusList[id] = {\r\n                    \"ignored\": dsStatusList[trimmedId].includes(\"ignored\"),\r\n                    \"wishlisted\": dsStatusList[trimmedId].includes(\"wishlisted\"),\r\n                };\r\n                if (id.startsWith(\"app/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedApps\");\r\n                } else if (id.startsWith(\"sub/\")) {\r\n                    statusList[id].owned = dsStatusList[trimmedId].includes(\"ownedPackages\");\r\n                }\r\n            }\r\n        } else {\r\n            statusList = {\r\n                \"ignored\": dsStatusList.includes(\"ignored\"),\r\n                \"wishlisted\": dsStatusList.includes(\"wishlisted\"),\r\n            };\r\n            if (storeId.startsWith(\"app/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedApps\");\r\n            } else if (storeId.startsWith(\"sub/\")) {\r\n                statusList.owned = dsStatusList.includes(\"ownedPackages\");\r\n            }\r\n        }\r\n\r\n        return statusList;\r\n    }\r\n\r\n    static async getRandomApp() {\r\n        await DynamicStore._fetch();\r\n        return Background.action(\"dynamicStore.randomApp\");\r\n    }\r\n\r\n    static _fetch() {\r\n        if (!User.isSignedIn) {\r\n            return DynamicStore.clear();\r\n        }\r\n        return Promise.resolve(null);\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        if (!DynamicStore._promise) {\r\n            DynamicStore._promise = DynamicStore._fetch();\r\n        }\r\n        return DynamicStore._promise.then(onDone, onCatch);\r\n    }\r\n}\r\n\r\nexport {DynamicStore};\r\n","import {Background} from \"../Background\";\r\n\r\nclass Inventory {\r\n\r\n    static getCoupon(appid) {\r\n        return Background.action(\"coupon\", appid);\r\n    }\r\n\r\n    static async getAppStatus(appids, options) {\r\n\r\n        function getStatusObject(giftsAndPasses, hasCoupon) {\r\n            return {\r\n                \"gift\": giftsAndPasses.includes(\"gifts\"),\r\n                \"guestPass\": giftsAndPasses.includes(\"passes\"),\r\n                \"coupon\": Boolean(hasCoupon),\r\n            };\r\n        }\r\n\r\n        const opts = {\"giftsAndPasses\": true,\r\n            \"coupons\": true,\r\n            ...options};\r\n\r\n        if (!opts.giftsAndPasses && !opts.coupons) { return null; }\r\n\r\n        const multiple = Array.isArray(appids);\r\n\r\n        try {\r\n            const [giftsAndPasses, coupons] = await Promise.all([\r\n                opts.giftsAndPasses ? Background.action(\"hasgiftsandpasses\", appids) : Promise.resolve(),\r\n                opts.coupons ? Background.action(\"hascoupon\", appids) : Promise.resolve(),\r\n            ]);\r\n\r\n            if (multiple) {\r\n                const results = {};\r\n\r\n                for (const id of appids) {\r\n                    results[id] = getStatusObject(giftsAndPasses ? giftsAndPasses[id] : [], coupons ? coupons[id] : false);\r\n                }\r\n\r\n                return results;\r\n            }\r\n            return getStatusObject(giftsAndPasses || [], typeof coupons === \"undefined\" ? false : coupons);\r\n        } catch (err) {\r\n            if (multiple) {\r\n                const results = {};\r\n                for (const id of appids) {\r\n                    results[id] = getStatusObject([], false);\r\n                }\r\n                return results;\r\n            }\r\n\r\n            return getStatusObject([], false);\r\n        }\r\n    }\r\n\r\n    static hasInMarketInventory(marketHashes) {\r\n        return Background.action(\"hasitem\", marketHashes);\r\n    }\r\n}\r\n\r\nexport {Inventory};\r\n","\r\nclass Feature {\r\n\r\n    /**\r\n     * @param {Context} context\r\n     */\r\n    constructor(context) {\r\n        this.context = context;\r\n    }\r\n\r\n    checkPrerequisites() {\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n        throw new Error(\"Stub\");\r\n    }\r\n\r\n    logError(err, msg, ...args) {\r\n        console.group(this.constructor.name);\r\n        console.error(msg, ...args);\r\n        console.error(err);\r\n        console.groupEnd();\r\n    }\r\n}\r\n\r\nexport {Feature};\r\n","\r\n// TODO use https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage\r\nclass LocalStorage {\r\n    static get(key, defaultValue) {\r\n        const item = localStorage.getItem(key);\r\n        if (!item) { return defaultValue; }\r\n        try {\r\n            return JSON.parse(item);\r\n        } catch (err) {\r\n            return defaultValue;\r\n        }\r\n    }\r\n\r\n    static set(key, value) {\r\n        localStorage.setItem(key, JSON.stringify(value));\r\n    }\r\n\r\n    static has(key) {\r\n        return localStorage.getItem(key) !== null;\r\n    }\r\n\r\n    static remove(key) {\r\n        localStorage.removeItem(key);\r\n    }\r\n\r\n    static keys() {\r\n        const result = [];\r\n        for (let i = localStorage.length - 1; i >= 0; --i) {\r\n            result.push(localStorage.key(i));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static clear() {\r\n        localStorage.clear();\r\n    }\r\n}\r\n\r\nexport {LocalStorage};\r\n","\r\nclass DOMHelper {\r\n\r\n    static wrap(container, node) {\r\n        const parent = node.parentNode;\r\n        parent.insertBefore(container, node);\r\n        parent.removeChild(node);\r\n        container.append(node);\r\n    }\r\n\r\n    static remove(selector) {\r\n        const node = document.querySelector(selector);\r\n        if (!node) { return; }\r\n        node.remove();\r\n    }\r\n\r\n    // TODO extend Node itself?\r\n    static selectLastNode(parent, selector) {\r\n        const nodes = parent.querySelectorAll(selector);\r\n        return nodes.length === 0 ? null : nodes[nodes.length - 1];\r\n    }\r\n\r\n    static insertStylesheet(href) {\r\n        const stylesheet = document.createElement(\"link\");\r\n        stylesheet.rel = \"stylesheet\";\r\n        stylesheet.type = \"text/css\";\r\n        stylesheet.href = href;\r\n        document.head.appendChild(stylesheet);\r\n    }\r\n\r\n    static insertScript({src, content}, id, onload, isAsync = true) {\r\n        const script = document.createElement(\"script\");\r\n\r\n        if (onload) { script.onload = onload; }\r\n        if (id) { script.id = id; }\r\n        if (src) { script.src = src; }\r\n        if (content) { script.textContent = content; }\r\n        script.async = isAsync;\r\n\r\n        document.head.appendChild(script);\r\n    }\r\n}\r\n\r\nexport {DOMHelper};\r\n","\r\nclass HorizontalScroller {\r\n\r\n    static create(parentNode, controlLeftNode, controlRightNode) {\r\n\r\n        let lastScroll = 0;\r\n\r\n        parentNode.addEventListener(\"wheel\", e => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            if (Date.now() - lastScroll < 200) { return; }\r\n            lastScroll = Date.now();\r\n\r\n            const isScrollDown = e.deltaY > 0;\r\n            if (isScrollDown) {\r\n                controlRightNode.click();\r\n            } else {\r\n                controlLeftNode.click();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {HorizontalScroller};\r\n","// This is the basic configuration for the Augmented Steam extension\r\n\r\nexport default {\r\n    \"ApiServerHost\": \"https://esapi.isthereanydeal.com\",\r\n    \"PublicHost\": \"https://augmentedsteam.com\",\r\n    \"ITADApiServerHost\": \"https://api.isthereanydeal.com\",\r\n    \"ITADClientId\": \"5fe78af07889f43a\"\r\n};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Language} from \"../../Core/Localization/Language\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {Background} from \"./Background\";\r\nimport {DOMHelper} from \"./DOMHelper\";\r\nimport {HorizontalScroller} from \"./Widgets/HorizontalScroller\";\r\nimport {DynamicStore} from \"./Data/DynamicStore\";\r\nimport {User} from \"./User\";\r\nimport {Page} from \"../Features/Page\";\r\nimport config from \"../../config\";\r\n\r\nclass AugmentedSteam {\r\n\r\n    static _addMenu() {\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_menu\">\r\n                <span id=\"es_pulldown\" class=\"pulldown global_action_link\">Augmented Steam</span>\r\n                <div id=\"es_popup\" class=\"popup_block_new\">\r\n                    <div class=\"popup_body popup_menu\">\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${ExtensionResources.getURL(\"html/options.html\")}\">${Localization.str.thewordoptions}</a>\r\n                        <a class=\"popup_menu_item\" id=\"es_clear_cache\" href=\"#clear_cache\">${Localization.str.clear_cache}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/tfedor/AugmentedSteam\">${Localization.str.contribute}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://github.com/tfedor/AugmentedSteam/issues\">${Localization.str.bug_feature}</a>\r\n                        <div class=\"hr\"></div>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"${config.PublicHost}\">${Localization.str.website}</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://isthereanydeal.com/\">IsThereAnyDeal</a>\r\n                        <a class=\"popup_menu_item\" target=\"_blank\" href=\"https://discord.gg/yn57q7f\">Discord</a>\r\n                    </div>\r\n                </div>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_pulldown\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.showMenu(\"es_pulldown\", \"es_popup\", \"right\", \"bottom\", true);\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_menu\").addEventListener(\"click\", e => {\r\n            e.stopPropagation();\r\n        });\r\n\r\n        document.querySelector(\"#es_popup\").addEventListener(\"click\", () => {\r\n            Page.runInPageContext(() => {\r\n                window.SteamFacade.hideMenu(\"es_pulldown\", \"es_popup\");\r\n            });\r\n        });\r\n\r\n        document.querySelector(\"#es_clear_cache\").addEventListener(\"click\", e => {\r\n            e.preventDefault();\r\n\r\n            AugmentedSteam.clearCache();\r\n            window.location.reload();\r\n        });\r\n    }\r\n\r\n    static _addBackToTop() {\r\n        if (!SyncedStorage.get(\"show_backtotop\")) { return; }\r\n\r\n        // Remove Steam's back-to-top button\r\n        DOMHelper.remove(\"#BackToTop\");\r\n\r\n        const btn = document.createElement(\"div\");\r\n        btn.classList.add(\"es_btt\");\r\n        btn.textContent = \"\";\r\n\r\n        document.body.append(btn);\r\n\r\n        btn.addEventListener(\"click\", () => {\r\n            window.scroll({\r\n                \"top\": 0,\r\n                \"left\": 0,\r\n                \"behavior\": \"smooth\"\r\n            });\r\n        });\r\n\r\n        window.addEventListener(\"scroll\", () => {\r\n            btn.classList.toggle(\"is-visible\", window.scrollY >= 400);\r\n        });\r\n    }\r\n\r\n    static _bindLogout() {\r\n\r\n        // TODO there should be a better detection of logout, probably\r\n        const logoutNode = document.querySelector(\"a[href$='javascript:Logout();']\");\r\n        logoutNode.addEventListener(\"click\", () => {\r\n            AugmentedSteam.clearCache();\r\n        });\r\n    }\r\n\r\n    static _addWarning(innerHTML, stopShowingHandler) {\r\n        const el = HTML.element(\r\n            `<div class=\"es_warn js-warn\">\r\n                <div class=\"es_warn__cnt\">\r\n                    <div>${innerHTML}</div>\r\n                    <div class=\"es_warn__control\">\r\n                        <a class=\"es_warn__btn js-warn-close\">${Localization.str.update.dont_show}</a>\r\n                        <a class=\"es_warn__btn js-warn-hide\">${Localization.str.hide}</a>\r\n                    </div>\r\n                </div>\r\n            </div>`\r\n        );\r\n\r\n        el.querySelector(\".js-warn-close\").addEventListener(\"click\", () => {\r\n            if (stopShowingHandler) {\r\n                stopShowingHandler();\r\n            }\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        el.querySelector(\".js-warn-hide\").addEventListener(\"click\", () => {\r\n            el.closest(\".js-warn\").remove();\r\n        });\r\n\r\n        document.getElementById(\"global_header\").insertAdjacentElement(\"afterend\", el);\r\n    }\r\n\r\n    /**\r\n     * Display warning if browsing using a different language\r\n     */\r\n    static _addLanguageWarning() {\r\n        if (!SyncedStorage.get(\"showlanguagewarning\")) { return; }\r\n\r\n        const currentLanguage = Language.getCurrentSteamLanguage();\r\n        if (!currentLanguage) { return; }\r\n\r\n        if (!SyncedStorage.has(\"showlanguagewarninglanguage\")) {\r\n            SyncedStorage.set(\"showlanguagewarninglanguage\", currentLanguage);\r\n        }\r\n\r\n        const warningLanguage = SyncedStorage.get(\"showlanguagewarninglanguage\");\r\n\r\n        if (currentLanguage === warningLanguage) { return; }\r\n\r\n        Localization.loadLocalization(Language.getLanguageCode(warningLanguage)).then((strings) => {\r\n            AugmentedSteam._addWarning(\r\n                `${strings.using_language.replace(\"__current__\", strings.options.lang[currentLanguage] || currentLanguage)}\r\n                <a href=\"#\" id=\"es_reset_language_code\">\r\n                ${strings.using_language_return.replace(\"__base__\", strings.options.lang[warningLanguage] || warningLanguage)}\r\n                </a>`,\r\n                () => { SyncedStorage.set(\"showlanguagewarning\", false); }\r\n            );\r\n\r\n            document.querySelector(\"#es_reset_language_code\").addEventListener(\"click\", (e) => {\r\n                e.preventDefault();\r\n                // eslint-disable-next-line no-undef, new-cap\r\n                Page.runInPageContext(warningLanguage => { ChangeLanguage(warningLanguage); }, [warningLanguage]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _handleInstallSteamButton() {\r\n        const option = SyncedStorage.get(\"installsteam\");\r\n        if (option === \"hide\") {\r\n            DOMHelper.remove(\"div.header_installsteam_btn\");\r\n        } else if (option === \"replace\") {\r\n            const btn = document.querySelector(\"div.header_installsteam_btn > a\");\r\n            btn.textContent = Localization.str.viewinclient;\r\n            btn.href = `steam://openurl/${window.location.href}`;\r\n            btn.classList.add(\"es_steamclient_btn\");\r\n        }\r\n    }\r\n\r\n    static _addUsernameSubmenuLinks() {\r\n        const node = document.querySelector(\".supernav_container .submenu_username\");\r\n\r\n        HTML.afterEnd(\r\n            node.querySelector(\"a\"),\r\n            `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/games/\">${Localization.str.games}</a>`\r\n        );\r\n        HTML.afterEnd(\r\n            node.querySelector(\"a:nth-child(2)\"),\r\n            `<a class=\"submenuitem\" href=\"//store.steampowered.com/wishlist/\">${Localization.str.wishlist}</a>`\r\n        );\r\n        HTML.beforeEnd(\r\n            node,\r\n            `<a class=\"submenuitem\" href=\"//steamcommunity.com/my/recommended/\">${Localization.str.reviews}</a>`\r\n        );\r\n    }\r\n\r\n    static _disableLinkFilter() {\r\n        if (!SyncedStorage.get(\"disablelinkfilter\")) { return; }\r\n\r\n        function removeLinkFilter(parent = document) {\r\n            const selector = \"a[href*='/linkfilter/']\";\r\n\r\n            for (const node of parent.querySelectorAll(selector)) {\r\n                node.href = node.href.replace(/^.+?\\/linkfilter\\/\\?url=/, \"\");\r\n            }\r\n        }\r\n\r\n        removeLinkFilter();\r\n\r\n        new MutationObserver(mutations => {\r\n            for (const mutation of mutations) {\r\n                for (const node of mutation.addedNodes) {\r\n                    if (node.nodeType !== Node.ELEMENT_NODE) { continue; }\r\n                    removeLinkFilter(node);\r\n                }\r\n            }\r\n        }).observe(document, {\"childList\": true, \"subtree\": true});\r\n    }\r\n\r\n    static _addRedeemLink() {\r\n        HTML.beforeBegin(\r\n            \"#account_language_pulldown\",\r\n            `<a class=\"popup_menu_item\" href=\"https://store.steampowered.com/account/registerkey\">${Localization.str.activate}</a>`\r\n        );\r\n    }\r\n\r\n    static _replaceAccountName() {\r\n        if (!SyncedStorage.get(\"replaceaccountname\")) { return; }\r\n\r\n        const logoutNode = document.querySelector(\"#account_dropdown .persona.online\");\r\n        const accountName = logoutNode.textContent.trim();\r\n        const communityName = document.querySelector(\"#account_pulldown\").textContent.trim();\r\n\r\n        logoutNode.textContent = communityName;\r\n\r\n        // Replace page header on account related pages\r\n        if (location.href.startsWith(\"https://store.steampowered.com/account\")) {\r\n            const pageHeader = document.querySelector(\"h2.pageheader\");\r\n            if (pageHeader) {\r\n                pageHeader.textContent = pageHeader.textContent.replace(new RegExp(accountName, \"i\"), communityName);\r\n            }\r\n        }\r\n\r\n        // Don't replace title on user pages that aren't mine\r\n        const isUserPage = /.*(id|profiles)\\/.+/g.test(location.pathname);\r\n        if (!isUserPage || location.pathname.includes(User.profilePath)) {\r\n            document.title = document.title.replace(accountName, communityName);\r\n        }\r\n    }\r\n\r\n    static _launchRandomButton() {\r\n\r\n        HTML.beforeEnd(\r\n            \"#es_popup .popup_menu\",\r\n            `<div class=\"hr\"></div>\r\n             <a id=\"es_random_game\" class=\"popup_menu_item\" style=\"cursor: pointer;\">${Localization.str.launch_random}</a>`\r\n        );\r\n\r\n        document.querySelector(\"#es_random_game\").addEventListener(\"click\", async() => {\r\n            const appid = await DynamicStore.getRandomApp();\r\n            if (!appid) { return; }\r\n\r\n            Background.action(\"appdetails\", appid).then(response => {\r\n                if (!response || !response.success) { return; }\r\n                const data = response.data;\r\n\r\n                let gameid = appid;\r\n                let gamename;\r\n                if (data.fullgame) {\r\n                    gameid = data.fullgame.appid;\r\n                    gamename = data.fullgame.name;\r\n                } else {\r\n                    gamename = data.name;\r\n                }\r\n\r\n                Page.runInPageContext((playGameStr, gameid, visitStore) => {\r\n                    const prompt = window.SteamFacade.showConfirmDialog(\r\n                        playGameStr,\r\n                        `<img src=\"//steamcdn-a.akamaihd.net/steam/apps/${gameid}/header.jpg\">`,\r\n                        null,\r\n                        null,\r\n                        visitStore\r\n                    );\r\n\r\n                    prompt.done(result => {\r\n                        if (result === \"OK\") { window.location.assign(`steam://run/${gameid}`); }\r\n                        if (result === \"SECONDARY\") { window.location.assign(`//store.steampowered.com/app/${gameid}`); }\r\n                    });\r\n                },\r\n                [\r\n                    Localization.str.play_game.replace(\"__gamename__\", gamename.replace(\"'\", \"\").trim()),\r\n                    gameid,\r\n                    Localization.str.visit_store,\r\n                ]);\r\n            });\r\n        });\r\n    }\r\n\r\n    static _skipGotSteam() {\r\n        if (!SyncedStorage.get(\"skip_got_steam\")) { return; }\r\n\r\n        for (const node of document.querySelectorAll(\"a[href^='javascript:ShowGotSteamModal']\")) {\r\n            node.href = node.href.split(\"'\")[1];\r\n        }\r\n    }\r\n\r\n    static _keepSteamSubscriberAgreementState() {\r\n        const nodes = document.querySelectorAll(\"#market_sell_dialog_accept_ssa,#market_buyorder_dialog_accept_ssa,#accept_ssa\");\r\n        for (const node of nodes) {\r\n            node.checked = SyncedStorage.get(\"keepssachecked\");\r\n\r\n            node.addEventListener(\"click\", () => {\r\n                SyncedStorage.set(\"keepssachecked\", !SyncedStorage.get(\"keepssachecked\"));\r\n            });\r\n        }\r\n    }\r\n\r\n    static _defaultCommunityTab() {\r\n        const tab = SyncedStorage.get(\"community_default_tab\");\r\n        if (!tab) { return; }\r\n\r\n        const links = document.querySelectorAll(\"a[href^='https://steamcommunity.com/app/']\");\r\n        for (const link of links) {\r\n            if (link.classList.contains(\"apphub_sectionTab\")) { continue; }\r\n            if (!/^\\/app\\/[0-9]+\\/?$/.test(link.pathname)) { continue; }\r\n            if (!link.pathname.endsWith(\"/\")) {\r\n                link.pathname += \"/\";\r\n            }\r\n            link.pathname += `${tab}/`;\r\n        }\r\n    }\r\n\r\n    static _horizontalScrolling() {\r\n        if (!SyncedStorage.get(\"horizontalscrolling\")) { return; }\r\n\r\n        for (const node of document.querySelectorAll(\".slider_ctn:not(.spotlight)\")) {\r\n            HorizontalScroller.create(\r\n                node.parentNode.querySelector(\"#highlight_strip, .store_horizontal_autoslider_ctn\"),\r\n                node.querySelector(\".slider_left\"),\r\n                node.querySelector(\".slider_right\"),\r\n            );\r\n        }\r\n    }\r\n\r\n    static addLoginWarning(type) {\r\n        if (AugmentedSteam._loginWarningAdded || LocalStorage.get(`hide_login_warn_${type}`)) { return; }\r\n\r\n        let host;\r\n\r\n        if (type === \"store\") {\r\n            host = \"store.steampowered.com\";\r\n        } else if (type === \"community\") {\r\n            host = \"steamcommunity.com\";\r\n        } else {\r\n            console.warn(\"Unknown login warning type %s\", type);\r\n            return;\r\n        }\r\n\r\n        AugmentedSteam._addWarning(\r\n            `${Localization.str.login_warning.replace(\"__link__\", `<a href=\"https://${host}/login/\">${host}</a>`)}`,\r\n            () => { LocalStorage.set(`hide_login_warn_${type}`, true); }\r\n        );\r\n        AugmentedSteam._loginWarningAdded = true;\r\n\r\n        console.warn(\"Are you logged into %s?\", host);\r\n    }\r\n\r\n    static clearCache() {\r\n        localStorage.clear();\r\n        SyncedStorage.remove(\"user_currency\");\r\n        SyncedStorage.remove(\"store_sessionid\");\r\n        Background.action(\"cache.clear\");\r\n    }\r\n\r\n    static init() {\r\n        AugmentedSteam._addBackToTop();\r\n        AugmentedSteam._addMenu();\r\n        AugmentedSteam._addLanguageWarning();\r\n        AugmentedSteam._handleInstallSteamButton();\r\n        AugmentedSteam._disableLinkFilter();\r\n        AugmentedSteam._skipGotSteam();\r\n        AugmentedSteam._keepSteamSubscriberAgreementState();\r\n        AugmentedSteam._defaultCommunityTab();\r\n        AugmentedSteam._horizontalScrolling();\r\n\r\n        if (User.isSignedIn) {\r\n            AugmentedSteam._addUsernameSubmenuLinks();\r\n            AugmentedSteam._addRedeemLink();\r\n            AugmentedSteam._replaceAccountName();\r\n            AugmentedSteam._launchRandomButton();\r\n            AugmentedSteam._bindLogout();\r\n        }\r\n    }\r\n}\r\n\r\nexport {AugmentedSteam};\r\n","\r\nclass StringUtils {\r\n\r\n    // https://stackoverflow.com/a/6969486/7162651\r\n    static escapeRegExp(str) {\r\n        return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\"); // $& means the whole matched string\r\n    }\r\n}\r\n\r\nexport {StringUtils};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {StringUtils} from \"../../Core/Utils/StringUtils\";\r\nimport {Background} from \"./Background\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass SteamCurrency {\r\n\r\n    /*\r\n     * Example:\r\n     * {\r\n     *  \"id\": 1,\r\n     *  \"abbr\": \"USD\",\r\n     *  \"symbol\": \"$\",\r\n     *  \"hint\": \"United States Dollars\",\r\n     *  \"multiplier\": 100,\r\n     *  \"unit\": 1,\r\n     *  \"format\": {\r\n     *      \"places\": 2,\r\n     *      \"hidePlacesWhenZero\": false,\r\n     *      \"symbolFormat\": \"$\",\r\n     *      \"thousand\": \",\",\r\n     *      \"decimal\": \".\",\r\n     *      \"right\": false\r\n     *  }\r\n     * }\r\n     */\r\n\r\n    constructor({\r\n        id,\r\n        abbr = \"USD\",\r\n        symbol = \"$\",\r\n        hint = \"Default Currency\",\r\n        multiplier = 100,\r\n        unit = 1,\r\n        \"format\": {\r\n            \"places\": formatPlaces = 2,\r\n            \"hidePlacesWhenZero\": formatHidePlaces = false,\r\n            \"symbolFormat\": formatSymbol = \"$\",\r\n            \"thousand\": formatGroupSeparator = \",\",\r\n            \"group\": formatGroupSize = 3,\r\n            \"decimal\": formatDecimalSeparator = \".\",\r\n            \"right\": formatPostfixSymbol = false,\r\n        },\r\n    }) {\r\n\r\n        // console.assert(id && Number.isInteger(id))\r\n        Object.assign(this, {\r\n            \"id\": id, // Steam Currency ID, integer, 1-41 (at time of writing)\r\n            \"abbr\": abbr, // TLA for the currency\r\n            \"symbol\": symbol, // Symbol used to represent/recognize the currency, this is NULL for CNY to avoid collision with JPY\r\n            \"hint\": hint, // English label for the currency to reduce mistakes editing the JSON\r\n            \"multiplier\": multiplier, // multiplier used by Steam when writing values\r\n            \"unit\": unit, // Minimum transactional unit required by Steam.\r\n            \"format\": {\r\n                \"decimalPlaces\": formatPlaces, // How many decimal places does this currency have?\r\n                \"hidePlacesWhenZero\": formatHidePlaces, // Does this currency show decimal places for a .0 value?\r\n                \"symbol\": formatSymbol, // Symbol used when generating a string value of this currency\r\n                \"groupSeparator\": formatGroupSeparator, // Thousands separator\r\n                \"groupSize\": formatGroupSize, // Digits to a \"thousand\" for the thousands separator\r\n                \"decimalSeparator\": formatDecimalSeparator,\r\n                \"postfix\": formatPostfixSymbol, // Should format.symbol be post-fixed?\r\n            },\r\n        });\r\n        Object.freeze(this.format);\r\n        Object.freeze(this);\r\n    }\r\n\r\n    valueOf(price) {\r\n\r\n        // remove separators\r\n        let _price = price.trim()\r\n            .replace(this.format.groupSeparator, \"\");\r\n        if (this.format.decimalSeparator !== \".\") {\r\n            _price = _price.replace(this.format.decimalSeparator, \".\");\r\n        } // as expected by parseFloat()\r\n        _price = _price.replace(/[^\\d.]/g, \"\");\r\n\r\n        const value = parseFloat(_price);\r\n\r\n        if (Number.isNaN(value)) { return null; }\r\n        return value; // this.multiplier?\r\n    }\r\n\r\n    stringify(value, withSymbol = true) {\r\n        const sign = value < 0 ? \"-\" : \"\";\r\n        const _value = Math.abs(value);\r\n\r\n        let s = _value.toFixed(this.format.decimalPlaces),\r\n            decimals;\r\n\r\n        [s, decimals] = s.split(\".\");\r\n\r\n        const g = [];\r\n        let j = s.length;\r\n\r\n        for (; j > this.format.groupSize; j -= this.format.groupSize) {\r\n            g.unshift(s.substring(j - this.format.groupSize, j));\r\n        }\r\n        g.unshift(s.substring(0, j));\r\n        s = [sign, g.join(this.format.groupSeparator)];\r\n        if (this.format.decimalPlaces > 0) {\r\n            if (!this.format.hidePlacesWhenZero || parseInt(decimals) > 0) {\r\n                s.push(this.format.decimalSeparator);\r\n                s.push(decimals);\r\n            }\r\n        }\r\n        if (withSymbol) {\r\n            if (this.format.postfix) {\r\n                s.push(this.format.symbol);\r\n            } else {\r\n                s.unshift(this.format.symbol);\r\n            }\r\n        }\r\n        return s.join(\"\");\r\n    }\r\n\r\n    placeholder() {\r\n        let str = `1${this.format.groupSeparator}`;\r\n        let cur = 2;\r\n        for (let i = 0; i < this.format.groupSize; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n\r\n        if (this.format.decimalPlaces === 0) {\r\n            return str;\r\n        }\r\n\r\n        str += this.format.decimalSeparator;\r\n        for (let i = 0; i < this.format.decimalPlaces; ++i, ++cur) {\r\n            str += cur;\r\n        }\r\n        return str;\r\n    }\r\n\r\n    regExp() {\r\n        let regex = `^(?:\\\\d{1,${\r\n            this.format.groupSize\r\n        }}(?:${\r\n            StringUtils.escapeRegExp(this.format.groupSeparator)\r\n        }\\\\d{${\r\n            this.format.groupSize\r\n        }})+|\\\\d*)`;\r\n\r\n        if (this.format.decimalPlaces > 0) {\r\n            regex += `(?:${StringUtils.escapeRegExp(this.format.decimalSeparator)}\\\\d{0,${this.format.decimalPlaces}})?`;\r\n        }\r\n        regex += \"$\";\r\n\r\n        return new RegExp(regex);\r\n    }\r\n}\r\n\r\nclass CurrencyManager {\r\n\r\n    static _getCurrencyFromDom() {\r\n        const currencyNode = document.querySelector('meta[itemprop=\"priceCurrency\"]');\r\n        if (currencyNode && currencyNode.hasAttribute(\"content\")) {\r\n            return currencyNode.getAttribute(\"content\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getCurrencyFromWallet() {\r\n        const walletCurrency = await Page.runInPageContext(\r\n            // eslint-disable-next-line no-undef, camelcase\r\n            () => (typeof g_rgWalletInfo !== \"undefined\" && g_rgWalletInfo ? g_rgWalletInfo.wallet_currency : null),\r\n            null,\r\n            \"walletCurrency\"\r\n        );\r\n\r\n        if (walletCurrency) {\r\n            return CurrencyManager.currencyNumberToType(walletCurrency);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static async _getStoreCurrency(context) {\r\n        let currency = CurrencyManager._getCurrencyFromDom();\r\n\r\n        if (!currency) {\r\n            currency = await CurrencyManager._getCurrencyFromWallet(context);\r\n        }\r\n\r\n        if (!currency) {\r\n            try {\r\n                currency = await Background.action(\"currency\");\r\n            } catch (error) {\r\n                console.error(`Couldn't load currency${error}`);\r\n            }\r\n        }\r\n\r\n        if (!currency) {\r\n            currency = \"USD\"; // fallback\r\n        }\r\n\r\n        return currency;\r\n    }\r\n\r\n    static getRate(from, to) {\r\n        if (from === to) { return 1; }\r\n\r\n        if (CurrencyManager._rates[from] && CurrencyManager._rates[from][to]) {\r\n            return CurrencyManager._rates[from][to];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    static getCurrencySymbolFromString(str) {\r\n        const re = /(?:R\\$|S\\$|\\$|RM|kr|Rp|||||p|P|||TL||Mex\\$|CDN\\$|A\\$|HK\\$|NT\\$||SR|R |DH|CHF|CLP\\$|S\\/\\.|COL\\$|NZ\\$|ARS\\$||||KD|z|QR|\\$U)/;\r\n        const match = str.match(re);\r\n        return match ? match[0] : \"\";\r\n    }\r\n\r\n    static currencyTypeToNumber(type) {\r\n        return CurrencyManager.fromType(type).id;\r\n    }\r\n\r\n    static currencyNumberToType(number) {\r\n        return CurrencyManager.fromNumber(number).abbr;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromType(type) {\r\n        return CurrencyManager._indices.abbr[type] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    /**\r\n     * @return SteamCurrency\r\n     */\r\n    static fromNumber(number) {\r\n        return CurrencyManager._indices.id[number] || CurrencyManager._defaultCurrency;\r\n    }\r\n\r\n    static async _loadCurrency(context) {\r\n        CurrencyManager.storeCurrency = await CurrencyManager._getStoreCurrency(context);\r\n        const currencySetting = SyncedStorage.get(\"override_price\");\r\n        CurrencyManager.customCurrency = (currencySetting === \"auto\")\r\n            ? CurrencyManager.storeCurrency\r\n            : currencySetting;\r\n    }\r\n\r\n    static async _loadRates() {\r\n        const toCurrencies = [CurrencyManager.storeCurrency];\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            toCurrencies.push(CurrencyManager.customCurrency);\r\n        }\r\n        CurrencyManager._rates = await Background.action(\"rates\", toCurrencies);\r\n    }\r\n\r\n    static async init(context) {\r\n        if (CurrencyManager._isInitialized) { return; }\r\n\r\n        const currencies = await Background.action(\"steam.currencies\");\r\n\r\n        for (let currency of currencies) {\r\n\r\n            currency = new SteamCurrency(currency);\r\n            CurrencyManager._indices.abbr[currency.abbr] = currency;\r\n            CurrencyManager._indices.id[currency.id] = currency;\r\n\r\n            if (currency.symbol) { // CNY && JPY use the same symbol\r\n                CurrencyManager._indices.symbols[currency.symbol] = currency;\r\n            }\r\n        }\r\n        CurrencyManager._defaultCurrency = CurrencyManager._indices.id[1]; // USD\r\n\r\n        try {\r\n            await CurrencyManager._loadCurrency(context);\r\n            await CurrencyManager._loadRates();\r\n        } catch (e) {\r\n            console.error(\"Failed to initialize Currency\");\r\n            console.error(e);\r\n        }\r\n\r\n        CurrencyManager._isInitialized = true;\r\n    }\r\n\r\n    static then(onSuccess, onFailure) {\r\n        return CurrencyManager.init().then(onSuccess, onFailure);\r\n    }\r\n}\r\nCurrencyManager._isInitialized = false;\r\nCurrencyManager._indices = {\r\n    \"id\": {},\r\n    \"abbr\": {},\r\n    \"symbols\": {},\r\n};\r\n\r\nexport {CurrencyManager};\r\n","import {GameId} from \"../../Core/GameId\";\r\nimport {HTML} from \"../../Core/Html/Html\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Language} from \"../../Core/Localization/Language\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Background} from \"./Background\";\r\nimport {DOMHelper} from \"./DOMHelper\";\r\n\r\nclass EarlyAccess {\r\n\r\n    static async getEaNodes(nodes, selectorModifier) {\r\n\r\n        const appidsMap = new Map();\r\n\r\n        for (const node of nodes) {\r\n            node.classList.add(\"es_ea_checked\");\r\n\r\n            const linkNode = node.querySelector(\"a\");\r\n            const href = linkNode && linkNode.hasAttribute(\"href\") ? linkNode.getAttribute(\"href\") : node.getAttribute(\"href\");\r\n            const imgHeader = node.querySelector(`img${selectorModifier}`);\r\n            const appid = GameId.getAppid(href) || GameId.getAppidImgSrc(imgHeader ? imgHeader.getAttribute(\"src\") : null);\r\n\r\n            if (appid) {\r\n                appidsMap.set(String(appid), node);\r\n            }\r\n        }\r\n\r\n        const eaStatus = await Background.action(\"isea\", Array.from(appidsMap.keys()));\r\n\r\n        for (const appid of appidsMap.keys()) {\r\n            if (!eaStatus[appid]) {\r\n                appidsMap.delete(appid);\r\n            }\r\n        }\r\n\r\n        return Array.from(appidsMap.values());\r\n    }\r\n\r\n    static async _checkNodes(selectors, selectorModifier) {\r\n        const _selectorModifier = typeof selectorModifier === \"string\" ? selectorModifier : \"\";\r\n        const selector = selectors.map(selector => `${selector}:not(.es_ea_checked)`).join(\",\");\r\n\r\n        for (const node of await EarlyAccess.getEaNodes(document.querySelectorAll(selector), _selectorModifier)) {\r\n            node.classList.add(\"es_early_access\");\r\n\r\n            const imgHeader = node.querySelector(`img${_selectorModifier}`);\r\n            const container = document.createElement(\"span\");\r\n            container.classList.add(\"es_overlay_container\");\r\n            DOMHelper.wrap(container, imgHeader);\r\n\r\n            HTML.afterBegin(\r\n                container,\r\n                `<span class=\"es_overlay\"><img title=\"${Localization.str.early_access}\" src=\"${EarlyAccess._imageUrl}\"></span>`\r\n            );\r\n        }\r\n    }\r\n\r\n    static _handleStore() {\r\n\r\n        // TODO refactor these checks to appropriate page calls\r\n        switch (true) {\r\n            case /^\\/app\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".game_header_image_ctn\", \".small_cap\"]);\r\n                break;\r\n            case /^\\/(?:genre|browse|tag)\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".tab_item\",\r\n                    \".special_tiny_cap\",\r\n                    \".cluster_capsule\",\r\n                    \".game_capsule\",\r\n                    \".browse_tag_game\",\r\n                    \".dq_item:not(:first-child)\",\r\n                    \".discovery_queue:not(:first-child)\"]);\r\n                break;\r\n            case /^\\/search\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".search_result_row\"]);\r\n                break;\r\n            case /^\\/recommended/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".friendplaytime_appheader\",\r\n                    \".header_image\",\r\n                    \".appheader\",\r\n                    \".recommendation_carousel_item .carousel_cap\",\r\n                    \".game_capsule\",\r\n                    \".game_capsule_area\",\r\n                    \".similar_grid_capsule\"]);\r\n                break;\r\n            case /^\\/tag\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".cluster_capsule\",\r\n                    \".tab_row\",\r\n                    \".browse_tag_game_cap\"]);\r\n                break;\r\n            case /^\\/(?:curator|developer|dlc|publisher)\\/.*/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\"#curator_avatar_image\",\r\n                    \".capsule\"]);\r\n                break;\r\n            case /^\\/$/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".cap\",\r\n                    \".special\",\r\n                    \".game_capsule\",\r\n                    \".cluster_capsule\",\r\n                    \".recommended_spotlight_ctn\",\r\n                    \".curated_app_link\",\r\n                    \".dailydeal_ctn a\",\r\n                    \".tab_item:last-of-type\",\r\n\r\n                    // Sales fields\r\n                    \".large_sale_caps a\",\r\n                    \".small_sale_caps a\",\r\n                    \".spotlight_img\"]);\r\n                break;\r\n\r\n            // EarlyAccess._checkNodes($(\".sale_capsule_image\").parent()); // TODO check/remove\r\n        }\r\n    }\r\n\r\n    static _handleCommunity() {\r\n\r\n        // TODO refactor these checks to appropriate page calls\r\n        switch (true) {\r\n            case /^\\/(?:id|profiles)\\/.+\\/(wishlist|games|followedgames)/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".gameListRowLogo\"]);\r\n                break;\r\n            case /^\\/(?:id|profiles)\\/.+\\/\\b(home|myactivity)\\b/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".blotter_gamepurchase_content a\"]);\r\n                break;\r\n            case /^\\/(?:id|profiles)\\/.+\\/\\b(reviews|recommended)\\b/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".leftcol\"]);\r\n                break;\r\n            case /^\\/(?:id|profiles)\\/.+/.test(window.location.pathname):\r\n                EarlyAccess._checkNodes([\".game_info_cap\",\r\n                    \".showcase_gamecollector_game\",\r\n                    \".favoritegame_showcase_game\"]);\r\n        }\r\n    }\r\n\r\n    static showEarlyAccess() {\r\n        if (!SyncedStorage.get(\"show_early_access\")) { return; }\r\n\r\n        let imageName = \"img/overlay/early_access_banner_english.png\";\r\n        if (Language.isCurrentLanguageOneOf([\r\n            \"brazilian\",\r\n            \"french\",\r\n            \"italian\",\r\n            \"japanese\",\r\n            \"koreana\",\r\n            \"polish\",\r\n            \"portuguese\",\r\n            \"russian\",\r\n            \"schinese\",\r\n            \"spanish\",\r\n            \"latam\",\r\n            \"tchinese\",\r\n            \"thai\"\r\n        ])) {\r\n            imageName = `img/overlay/early_access_banner_${Language.getCurrentSteamLanguage()}.png`;\r\n        }\r\n        EarlyAccess._imageUrl = ExtensionResources.getURL(imageName);\r\n\r\n        switch (window.location.host) {\r\n            case \"store.steampowered.com\":\r\n                EarlyAccess._handleStore();\r\n                break;\r\n            case \"steamcommunity.com\":\r\n                EarlyAccess._handleCommunity();\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\nexport {EarlyAccess};\r\n","import {HTML} from \"../../Core/Html/Html\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {TimeUtils} from \"../../modulesCore\";\r\n\r\nclass ITAD {\r\n    static async create() {\r\n        if (!await Background.action(\"itad.isconnected\")) { return; }\r\n\r\n        HTML.afterBegin(\"#global_action_menu\",\r\n            `<div id=\"es_itad\">\r\n                <img id=\"es_itad_logo\" src=\"${ExtensionResources.getURL(\"img/itad.png\")}\">\r\n                <span id=\"es_itad_status\"></span>\r\n            </div>`);\r\n\r\n        document.querySelector(\"#es_itad\").addEventListener(\"mouseenter\", ITAD.onHover);\r\n\r\n        if (User.isSignedIn && (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\"))) {\r\n            Background.action(\"itad.import\");\r\n        }\r\n    }\r\n\r\n    static async onHover() {\r\n\r\n        async function updateLastImport() {\r\n            const {from, to} = await Background.action(\"itad.lastimport\");\r\n\r\n            let htmlStr\r\n                = `<div>${Localization.str.itad.from}</div>\r\n                   <div>${from ? new Date(from * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n\r\n            if (SyncedStorage.get(\"itad_import_library\") || SyncedStorage.get(\"itad_import_wishlist\")) {\r\n                htmlStr\r\n                    += `<div>${Localization.str.itad.to}</div>\r\n                        <div>${to ? new Date(to * 1000).toLocaleString() : Localization.str.never}</div>`;\r\n            }\r\n\r\n            HTML.inner(\".es-itad-hover__last-import\", htmlStr);\r\n        }\r\n\r\n        if (!document.querySelector(\".es-itad-hover\")) {\r\n            HTML.afterEnd(\"#es_itad_status\",\r\n                `<div class=\"es-itad-hover\">\r\n                    <div class=\"es-itad-hover__content\">\r\n                        <h4>${Localization.str.itad.last_import}</h4>\r\n                        <div class=\"es-itad-hover__last-import\"></div>\r\n                        <div class=\"es-itad-hover__sync-now\">\r\n                            <span class=\"es-itad-hover__sync-now-text\">${Localization.str.itad.sync_now}</span>\r\n                            <div class=\"loader\"></div>\r\n                            <span class=\"es-itad-hover__sync-failed\">&#10060;</span>\r\n                            <span class=\"es-itad-hover__sync-success\">&#10003;</span>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"es-itad-hover__arrow\"></div>\r\n                </div>`);\r\n\r\n            const hover = document.querySelector(\".es-itad-hover\");\r\n\r\n            const syncDiv = document.querySelector(\".es-itad-hover__sync-now\");\r\n            document.querySelector(\".es-itad-hover__sync-now-text\").addEventListener(\"click\", async() => {\r\n                syncDiv.classList.remove(\"es-itad-hover__sync-now--failed\", \"es-itad-hover__sync-now--success\");\r\n                syncDiv.classList.add(\"es-itad-hover__sync-now--loading\");\r\n                hover.style.display = \"block\";\r\n\r\n                let timeout;\r\n\r\n                try {\r\n                    await Background.action(\"itad.sync\");\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--success\");\r\n                    await updateLastImport();\r\n\r\n                    timeout = 1000;\r\n                } catch (err) {\r\n                    syncDiv.classList.add(\"es-itad-hover__sync-now--failed\");\r\n\r\n                    console.group(\"ITAD sync\");\r\n                    console.error(\"Failed to sync with ITAD\");\r\n                    console.error(err);\r\n                    console.groupEnd();\r\n\r\n                    timeout = 3000;\r\n                } finally {\r\n                    TimeUtils.timer(timeout).then(() => { hover.style.display = \"\"; });\r\n                    syncDiv.classList.remove(\"es-itad-hover__sync-now--loading\");\r\n                }\r\n            });\r\n        }\r\n\r\n        await updateLastImport();\r\n    }\r\n\r\n    static async getAppStatus(storeIds, options) {\r\n        const opts = {\"waitlist\": true,\r\n            \"collection\": true,\r\n            ...options};\r\n\r\n        if (!opts.collection && !opts.waitlist) { return null; }\r\n\r\n        const multiple = Array.isArray(storeIds);\r\n        const promises = [];\r\n        const resolved = Promise.resolve(multiple ? {} : false);\r\n\r\n        if (await Background.action(\"itad.isconnected\")) {\r\n            if (opts.collection) {\r\n                promises.push(Background.action(\"itad.incollection\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n            if (opts.waitlist) {\r\n                promises.push(Background.action(\"itad.inwaitlist\", storeIds));\r\n            } else {\r\n                promises.push(resolved);\r\n            }\r\n        } else {\r\n            promises.push(resolved, resolved);\r\n        }\r\n\r\n        const [inCollection, inWaitlist] = await Promise.all(promises);\r\n\r\n        if (multiple) {\r\n            const result = {};\r\n            for (const id of storeIds) {\r\n                result[id] = {\r\n                    \"collected\": inCollection[id],\r\n                    \"waitlisted\": inWaitlist[id],\r\n                };\r\n            }\r\n            return result;\r\n        } else {\r\n            return {\r\n                \"collected\": inCollection,\r\n                \"waitlisted\": inWaitlist,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport {ITAD};\r\n","\r\n/**\r\n * NOTE FOR ADDON REVIEWER:\r\n * This class is meant to simplify communication between extension context and page context.\r\n * Basically, we have wrapped postMessage API in this class.\r\n */\r\nclass Messenger {\r\n    static postMessage(msgID, info) {\r\n        window.postMessage({\r\n            \"type\": `es_${msgID}`,\r\n            \"information\": info\r\n        }, window.location.origin);\r\n    }\r\n\r\n    // Used for one-time events\r\n    static onMessage(msgID) {\r\n        return new Promise(resolve => {\r\n            function callback(e) {\r\n                if (e.source !== window) { return; }\r\n                if (!e.data || !e.data.type) { return; }\r\n                if (e.data.type === `es_${msgID}`) {\r\n                    resolve(e.data.information);\r\n                    window.removeEventListener(\"message\", callback);\r\n                }\r\n            }\r\n            window.addEventListener(\"message\", callback);\r\n        });\r\n    }\r\n\r\n    // Used for setting up a listener that should be able to receive more than one callback\r\n    static addMessageListener(msgID, callback) {\r\n        window.addEventListener(\"message\", e => {\r\n            if (e.source !== window) { return; }\r\n            if (!e.data || !e.data.type) { return; }\r\n            if (e.data.type === `es_${msgID}`) {\r\n                callback(e.data.information);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Messenger};\r\n","import {CurrencyManager} from \"./CurrencyManager\";\r\n\r\nclass Price {\r\n\r\n    constructor(value = 0, currency = CurrencyManager.storeCurrency) {\r\n        this.value = value;\r\n        this.currency = currency;\r\n        Object.freeze(this);\r\n    }\r\n\r\n    formattedValue() {\r\n        return CurrencyManager.fromType(this.currency).stringify(this.value, false);\r\n    }\r\n\r\n    toString() {\r\n        return CurrencyManager.fromType(this.currency).stringify(this.value);\r\n    }\r\n\r\n    /*\r\n     * Not currently in use\r\n     * totalValue = totalValue.add(somePrice)\r\n     */\r\n    add(otherPrice) {\r\n        let _otherPrice = otherPrice;\r\n        if (otherPrice.currency !== this.currency) {\r\n            _otherPrice = otherPrice.inCurrency(this.currency);\r\n        }\r\n        return new Price(this.value + _otherPrice.value, this.currency);\r\n    }\r\n\r\n    inCurrency(desiredCurrency) {\r\n        if (this.currency === desiredCurrency) {\r\n            return new Price(this.value, this.currency);\r\n        }\r\n        const rate = CurrencyManager.getRate(this.currency, desiredCurrency);\r\n        if (!rate) {\r\n            throw new Error(`Could not establish conversion rate between ${this.currency} and ${desiredCurrency}`);\r\n        }\r\n        return new Price(this.value * rate, desiredCurrency);\r\n    }\r\n\r\n    static parseFromString(str, currencyType = CurrencyManager.storeCurrency) {\r\n        const currency = CurrencyManager.fromType(currencyType);\r\n        let value = currency.valueOf(str);\r\n        if (value !== null) {\r\n            value = new Price(value, currencyType);\r\n        }\r\n        return value;\r\n    }\r\n}\r\n\r\nexport {Price};\r\n","import {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {HTML} from \"../../Core/Html/Html\";\r\nimport {Background} from \"./Background\";\r\nimport {User} from \"./User\";\r\nimport {Price} from \"./Price\";\r\nimport {CurrencyManager} from \"./CurrencyManager\";\r\n\r\nclass Prices {\r\n\r\n    constructor() {\r\n        this.appids = [];\r\n        this.subids = [];\r\n        this.bundleids = [];\r\n\r\n        this.priceCallback = null;\r\n        this.bundleCallback = null;\r\n\r\n        this._bundles = [];\r\n    }\r\n\r\n    _getApiParams() {\r\n        const apiParams = {};\r\n\r\n        if (!SyncedStorage.get(\"showallstores\") && SyncedStorage.get(\"stores\").length > 0) {\r\n            apiParams.stores = SyncedStorage.get(\"stores\").join(\",\");\r\n        }\r\n\r\n        const cc = User.storeCountry;\r\n        if (cc) {\r\n            apiParams.cc = cc;\r\n        }\r\n\r\n        apiParams.appids = this.appids.join(\",\");\r\n        apiParams.subids = this.subids.join(\",\");\r\n        apiParams.bundleids = this.bundleids.join(\",\");\r\n\r\n        if (SyncedStorage.get(\"showlowestpricecoupon\")) {\r\n            apiParams.coupon = true;\r\n        }\r\n\r\n        if (!apiParams.appids && !apiParams.subids && !apiParams.bundleids) { return null; }\r\n\r\n        return apiParams;\r\n    }\r\n\r\n    /**\r\n     * @param priceData\r\n     * @param {Price} price\r\n     * @param {string} pricingStr\r\n     */\r\n    _getPricingStrings(priceData, price, pricingStr) {\r\n        let prices = price.toString();\r\n        if (CurrencyManager.customCurrency !== CurrencyManager.storeCurrency) {\r\n            const priceAlt = price.inCurrency(CurrencyManager.storeCurrency);\r\n            prices += ` (${priceAlt.toString()})`;\r\n        }\r\n        const pricesStr = `<span class=\"itad-pricing__price\">${prices}</span>`;\r\n\r\n        let cutStr = \"\";\r\n        if (priceData.cut > 0) {\r\n            cutStr = `<span class=\"itad-pricing__cut\">-${priceData.cut}%</span> `;\r\n        }\r\n\r\n        const storeStr = pricingStr.store.replace(\"__store__\", priceData.store);\r\n        return [pricesStr, cutStr, storeStr];\r\n    }\r\n\r\n    _processPrices(gameid, meta, info) {\r\n        if (!this.priceCallback) { return; }\r\n\r\n        const [type, id] = gameid.split(\"/\");\r\n\r\n        const node = document.createElement(\"div\");\r\n        node.classList.add(\"itad-pricing\");\r\n        node.id = `es_price_${id}`;\r\n\r\n        const pricingStr = Localization.str.pricing;\r\n\r\n        let hasData = false;\r\n        const priceData = info.price;\r\n        const lowestData = info.lowest;\r\n        const bundledCount = info.bundles.count;\r\n        const urlData = info.urls;\r\n\r\n        // Current best\r\n        if (priceData) {\r\n            hasData = true;\r\n\r\n            let lowest;\r\n            let voucherStr = \"\";\r\n            if (SyncedStorage.get(\"showlowestpricecoupon\") && priceData.price_voucher) {\r\n                lowest = new Price(priceData.price_voucher, meta.currency);\r\n\r\n                const voucher = HTML.escape(priceData.voucher);\r\n                voucherStr = `${pricingStr.with_voucher.replace(\r\n                    \"__voucher__\",\r\n                    `<span class=\"itad-pricing__voucher\">${voucher}</span>`\r\n                )} `;\r\n            } else {\r\n                lowest = new Price(priceData.price, meta.currency);\r\n            }\r\n\r\n            lowest = lowest.inCurrency(CurrencyManager.customCurrency);\r\n            const [pricesStr, cutStr, storeStr] = this._getPricingStrings(priceData, lowest, pricingStr);\r\n\r\n            let drmStr = \"\";\r\n            if (priceData.drm.length > 0 && priceData.store !== \"Steam\") {\r\n                drmStr = `<span class=\"itad-pricing__drm\">(${priceData.drm[0]})</span>`;\r\n            }\r\n\r\n            const infoUrl = HTML.escape(urlData.info);\r\n            const storeUrl = HTML.escape(priceData.url.toString());\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${infoUrl}\" target=\"_blank\">${pricingStr.lowest_price}</a>`);\r\n            HTML.beforeEnd(node, pricesStr);\r\n            HTML.beforeEnd(\r\n                node,\r\n                `<a href=\"${storeUrl}\" class=\"itad-pricing__main\" target=\"_blank\">${cutStr}${voucherStr}${storeStr} ${drmStr}</a>`\r\n            );\r\n        }\r\n\r\n        // Historical low\r\n        if (lowestData) {\r\n            hasData = true;\r\n\r\n            const historical = new Price(lowestData.price, meta.currency).inCurrency(CurrencyManager.customCurrency);\r\n            const [pricesStr, cutStr, storeStr] = this._getPricingStrings(lowestData, historical, pricingStr);\r\n            const dateStr = new Date(lowestData.recorded * 1000).toLocaleDateString();\r\n\r\n            const infoUrl = HTML.escape(urlData.history);\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${infoUrl}\" target=\"_blank\">${pricingStr.historical_low}</a>`);\r\n            HTML.beforeEnd(node, pricesStr);\r\n            HTML.beforeEnd(node, `<div class=\"itad-pricing__main\">${cutStr}${storeStr} ${dateStr}</div>`);\r\n        }\r\n\r\n        // times bundled\r\n        if (bundledCount > 0) {\r\n            hasData = true;\r\n\r\n            const bundledUrl = HTML.escape(urlData.bundles || urlData.bundle_history);\r\n            const bundledStr = pricingStr.bundle_count.replace(\"__count__\", bundledCount);\r\n\r\n            HTML.beforeEnd(node, `<a href=\"${bundledUrl}\" target=\"_blank\">${pricingStr.bundled}</a>`);\r\n            HTML.beforeEnd(node, `<div class=\"itad-pricing__bundled\">${bundledStr}</div>`);\r\n        }\r\n\r\n        if (hasData) {\r\n            this.priceCallback(type, id, node);\r\n        }\r\n    }\r\n\r\n    _processBundles(meta, info) {\r\n        if (!this.bundleCallback) { return; }\r\n\r\n        let purchase = \"\";\r\n\r\n        for (const bundle of info.bundles.live) {\r\n            const tiers = bundle.tiers;\r\n\r\n            let endDate;\r\n            if (bundle.expiry) {\r\n                endDate = new Date(bundle.expiry * 1000);\r\n            }\r\n\r\n            const currentDate = new Date().getTime();\r\n            if (endDate && currentDate > endDate) { continue; }\r\n\r\n            const bundleNormalized = JSON.stringify({\r\n                \"page\":  bundle.page || \"\",\r\n                \"title\": bundle.title || \"\",\r\n                \"url\":   bundle.url || \"\",\r\n                \"tiers\": (() => {\r\n                    const sorted = [];\r\n                    for (const t of Object.keys(tiers)) {\r\n                        sorted.push((tiers[t].games || []).sort());\r\n                    }\r\n                    return sorted;\r\n                })(),\r\n            });\r\n\r\n            if (this._bundles.indexOf(bundleNormalized) >= 0) { continue; }\r\n            this._bundles.push(bundleNormalized);\r\n\r\n            if (bundle.page) {\r\n                const bundlePage = Localization.str.buy_package.replace(\"__package__\", `${bundle.page} ${bundle.title}`);\r\n                purchase\r\n                    += `<div class=\"game_area_purchase_game\">\r\n                            <div class=\"game_area_purchase_platform\"></div>\r\n                            <h1>${bundlePage}</h1>`;\r\n            } else {\r\n                const bundleTitle = Localization.str.buy_package.replace(\"__package__\", bundle.title);\r\n                purchase\r\n                    += `<div class=\"game_area_purchase_game_wrapper\">\r\n                            <div class=\"game_area_purchase_game\"></div>\r\n                            <div class=\"game_area_purchase_platform\"></div>\r\n                            <h1>${bundleTitle}</h1>`;\r\n            }\r\n\r\n            if (endDate) {\r\n                purchase += `<p class=\"game_purchase_discount_countdown\">${Localization.str.bundle.offer_ends} ${endDate}</p>`;\r\n            }\r\n\r\n            purchase += '<p class=\"package_contents\">';\r\n\r\n            let bundlePrice;\r\n            const appName = document.querySelector(\".apphub_AppName\").textContent;\r\n\r\n            for (let i = 0; i < tiers.length; ++i) {\r\n                const tierNum = i + 1;\r\n                const tier = tiers[i];\r\n\r\n                purchase += \"<b>\";\r\n                if (tiers.length > 1) {\r\n                    const tierName = tier.note || Localization.str.bundle.tier.replace(\"__num__\", tierNum);\r\n                    const tierPrice = (new Price(tier.price, meta.currency).inCurrency(CurrencyManager.customCurrency))\r\n                        .toString();\r\n\r\n                    purchase += Localization.str.bundle.tier_includes.replace(\"__tier__\", tierName).replace(\"__price__\", tierPrice)\r\n                        .replace(\"__num__\", tier.games.length);\r\n                } else {\r\n                    purchase += Localization.str.bundle.includes.replace(\"__num__\", tier.games.length);\r\n                }\r\n                purchase += \":</b> \";\r\n\r\n                const gameList = tier.games.join(\", \");\r\n                if (gameList.includes(appName)) {\r\n                    purchase += gameList.replace(appName, `<u>${appName}</u>`);\r\n                    bundlePrice = tier.price;\r\n                } else {\r\n                    purchase += gameList;\r\n                }\r\n\r\n                purchase += \"<br>\";\r\n            }\r\n\r\n            purchase += \"</p>\";\r\n            purchase += `<div class=\"game_purchase_action\">\r\n                            <div class=\"game_purchase_action_bg\">\r\n                                <div class=\"btn_addtocart btn_packageinfo\">\r\n                                    <a class=\"btn_blue_steamui btn_medium\" href=\"${bundle.details}\" target=\"_blank\">\r\n                                        <span>${Localization.str.bundle.info}</span>\r\n                                    </a>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"game_purchase_action_bg\">`;\r\n\r\n            if (bundlePrice && bundlePrice > 0) {\r\n                bundlePrice = (new Price(bundlePrice, meta.currency).inCurrency(CurrencyManager.customCurrency))\r\n                    .toString();\r\n                purchase += `<div class=\"game_purchase_price price\" itemprop=\"price\">${bundlePrice}</div>`;\r\n            }\r\n\r\n            purchase += `<div class=\"btn_addtocart\">\r\n                            <a class=\"btn_green_steamui btn_medium\" href=\"${bundle.url}\" target=\"_blank\">\r\n                                <span>${Localization.str.buy}</span>\r\n                            </a>\r\n                        </div></div></div></div>`;\r\n        }\r\n\r\n        if (purchase) {\r\n            this.bundleCallback(purchase);\r\n        }\r\n    }\r\n\r\n    load() {\r\n        const apiParams = this._getApiParams();\r\n        if (!apiParams) { return; }\r\n\r\n        Background.action(\"prices\", apiParams).then(response => {\r\n            const meta = response[\".meta\"];\r\n\r\n            for (const [gameid, info] of Object.entries(response.data)) {\r\n                this._processPrices(gameid, meta, info);\r\n                this._processBundles(meta, info);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport {Prices};\r\n","import {SyncedStorage} from \"./Core/Storage/SyncedStorage\";\r\n\r\n/*\r\n * Shim for Promise.finally() for browsers (Waterfox/FF 56) that don't have it\r\n * https://github.com/domenic/promises-unwrapping/issues/18#issuecomment-57801572\r\n */\r\nif (typeof Promise.prototype.finally === \"undefined\") {\r\n    // eslint-disable-next-line no-extend-native\r\n    Object.defineProperty(Promise.prototype, \"finally\", {\r\n        \"value\": function(callback) {\r\n            const constructor = this.constructor;\r\n            return this.then((value) => {\r\n                return constructor.resolve(callback()).then(() => {\r\n                    return value;\r\n                });\r\n            }, (reason) => {\r\n                return constructor.resolve(callback()).then(() => {\r\n                    console.error(reason);\r\n                    throw reason;\r\n                });\r\n            });\r\n        },\r\n    });\r\n}\r\n\r\nlet initialized = false;\r\n\r\n/**\r\n * DOMPurify setup\r\n * @see https://github.com/cure53/DOMPurify\r\n */\r\nexport default function() {\r\n\r\n    if (initialized) { return; }\r\n    initialized = true;\r\n\r\n    const allowOpenInNewTab = SyncedStorage.get(\"openinnewtab\");\r\n\r\n    /*\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * We are modifying default DOMPurify settings to allow other protocols in URLs\r\n     * and to allow links to safely open in new tabs.\r\n     *\r\n     * We took the original Regex and aded chrome-extension://, moz-extension:// and steam://\r\n     * First two are needed for linking local resources from extension,\r\n     * steam:// protocol is used by Steam store to open their own client (e.g. when you want to launch a game).\r\n     *\r\n     * The addition of the `target` attribute to the allowed attributes is done in order to be able to open links in a new tab.\r\n     * We only allow target=\"_blank\" while adding rel=\"noreferrer noopener\" to prevent child window to access window.opener\r\n     * as described in https://www.jitbit.com/alexblog/256-targetblank---the-most-underestimated-vulnerability-ever/\r\n     */\r\n\r\n    const purifyConfig = {\r\n        \"ALLOWED_URI_REGEXP\": /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|chrome-extension|moz-extension|steam):|[^a-z]|[a-z+.-]+(?:[^a-z+.\\-:]|$))/i\r\n    };\r\n\r\n    if (allowOpenInNewTab) {\r\n        purifyConfig.ADD_ATTR = [\"target\"];\r\n\r\n        DOMPurify.addHook(\"uponSanitizeAttribute\", (node, data) => {\r\n            if (data.attrName === \"target\") {\r\n                if (data.attrValue === \"_blank\") {\r\n                    node.setAttribute(\"rel\", \"noreferrer noopener\");\r\n                } else {\r\n                    data.keepAttr = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    DOMPurify.setConfig(purifyConfig);\r\n}\r\n","import {Info, Localization, SyncedStorage} from \"../../modulesCore\";\r\nimport {\r\n    AugmentedSteam, Background,\r\n    CurrencyManager,\r\n    DOMHelper,\r\n    EarlyAccess,\r\n    ITAD, Messenger, ProgressBar,\r\n    Sortbox,\r\n    UpdateHandler,\r\n    User\r\n} from \"../modulesContent\";\r\nimport {SteamFacade} from \"../Modules/SteamFacade\";\r\nimport setup from \"../../setup\";\r\nimport config from \"../../config\";\r\n\r\n/**\r\n * Event handler for uncaught Background errors\r\n */\r\nfunction unhandledrejection(ev) {\r\n    const err = ev.reason;\r\n    if (!err || !err.error) { return; } // Not a background error\r\n    ev.preventDefault();\r\n    ev.stopPropagation();\r\n    console.group(\"An error occurred in the background context.\");\r\n    console.error(err.localStack);\r\n    console.error(err.stack);\r\n    console.groupEnd();\r\n}\r\nwindow.addEventListener(\"unhandledrejection\", unhandledrejection);\r\n\r\n/**\r\n *  Inject the Messenger, SteamFacade class into the DOM, providing the same interface for the page context side\r\n */\r\nDOMHelper.insertScript({\"content\": `window.Messenger = ${Messenger.toString()}`});\r\nDOMHelper.insertScript({\"content\": `window.SteamFacade = ${SteamFacade.toString()}`});\r\n\r\nBackground.registerErrorHandler(({name, msg}) => {\r\n    if (name !== \"LoginError\") { return false; }\r\n\r\n    AugmentedSteam.addLoginWarning(msg);\r\n    ProgressBar.finishRequest();\r\n    return true;\r\n});\r\n\r\nclass Page {\r\n\r\n    /*\r\n     * NOTE: use cautiously!\r\n     * Run script in the context of the current tab\r\n     */\r\n    static runInPageContext(fun, args, withPromise) {\r\n        const script = document.createElement(\"script\");\r\n        let promise;\r\n        const argsString = Array.isArray(args) ? JSON.stringify(args) : \"[]\";\r\n\r\n        if (withPromise) {\r\n            const msgId = `msg_${++Page._msgCounter}`;\r\n            promise = Messenger.onMessage(msgId);\r\n            script.textContent = `(async () => { Messenger.postMessage(\"${msgId}\", await (${fun})(...${argsString})); })();`;\r\n        } else {\r\n            script.textContent = `(${fun})(...${argsString});`;\r\n        }\r\n\r\n        document.documentElement.appendChild(script);\r\n        script.parentNode.removeChild(script);\r\n        return promise;\r\n    }\r\n\r\n    async run(ContextClass) {\r\n        if (!document.getElementById(\"global_header\")) { return; }\r\n\r\n        try {\r\n            // TODO What errors can be \"suppressed\" here?\r\n            try {\r\n                await SyncedStorage;\r\n                setup();\r\n            } catch (err) {\r\n                console.error(err);\r\n            }\r\n\r\n            await Promise.all([Localization, User, CurrencyManager]);\r\n        } catch (err) {\r\n            console.group(\"Augmented Steam initialization\");\r\n            console.error(\"Failed to initiliaze Augmented Steam\");\r\n            console.error(err);\r\n            console.groupEnd();\r\n            return;\r\n        }\r\n\r\n        console.log(\r\n            `%c Augmented %cSteam v${Info.version} %c ${config.PublicHost}`,\r\n            \"background: #000000; color: #046eb2\",\r\n            \"background: #000000; color: #ffffff\",\r\n            \"\",\r\n        );\r\n\r\n        ProgressBar.create();\r\n        ProgressBar.loading();\r\n        AugmentedSteam.init();\r\n        UpdateHandler.checkVersion(AugmentedSteam.clearCache);\r\n        EarlyAccess.showEarlyAccess();\r\n        ITAD.create();\r\n        Sortbox.init();\r\n        this._pageSpecificFeatures();\r\n\r\n        const context = new ContextClass();\r\n        context.applyFeatures();\r\n    }\r\n\r\n    _pageSpecificFeatures() {\r\n        // left for overrides\r\n    }\r\n}\r\nPage._msgCounter = 0;\r\n\r\nexport {Page};\r\n","\r\n/* eslint-disable no-undef,new-cap */\r\n\r\n// noinspection JSUnresolvedFunction,JSUnresolvedVariable\r\nclass SteamFacade {\r\n\r\n    // variables\r\n\r\n    static global(name) {\r\n        return window[name];\r\n    }\r\n\r\n    static globalSet(name, value) {\r\n        window[name] = value;\r\n    }\r\n\r\n    // dialogs\r\n\r\n    static showDialog(strTitle, strDescription, rgModalParams) {\r\n        ShowDialog(strTitle, strDescription, rgModalParams);\r\n    }\r\n\r\n    static showConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton) {\r\n        return ShowConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton);\r\n    }\r\n\r\n    static showAlertDialog(strTitle, strDescription, strOKButton) {\r\n        return ShowAlertDialog(strTitle, strDescription, strOKButton);\r\n    }\r\n\r\n    static showBlockingWaitDialog(strTitle, strDescription) {\r\n        return ShowBlockingWaitDialog(strTitle, strDescription);\r\n    }\r\n\r\n    static showNicknameModal() {\r\n        return ShowNicknameModal();\r\n    }\r\n\r\n    static dismissActiveModal() {\r\n        CModal.DismissActiveModal();\r\n    }\r\n\r\n    // menu\r\n\r\n    static showMenu(elemLink, elemPopup, align, valign, bLinkHasBorder) {\r\n        return ShowMenu(elemLink, elemPopup, align, valign, bLinkHasBorder);\r\n    }\r\n\r\n    static hideMenu(elemLink, elemPopup) {\r\n        return HideMenu(elemLink, elemPopup);\r\n    }\r\n\r\n    // app pages\r\n\r\n    static collapseLongStrings(selector) {\r\n        return CollapseLongStrings(selector);\r\n    }\r\n\r\n    // events\r\n\r\n    static bindAutoFlyoutEvents() {\r\n        return BindAutoFlyoutEvents();\r\n    }\r\n\r\n    // dynamic store\r\n\r\n    static dynamicStoreInvalidateCache() {\r\n        return GDynamicStore.InvalidateCache();\r\n    }\r\n\r\n    static dynamicStoreDecorateItems(selector, bForceRecalculate) {\r\n        return GDynamicStore.DecorateDynamicItems($J(selector), bForceRecalculate);\r\n    }\r\n\r\n    static onDynamicStoreReady(callback) {\r\n        return GDynamicStore.OnReady(callback);\r\n    }\r\n\r\n    static storeItemDataBindHover(selector, unAppID, unPackageID, unBundleID, rgAdditionalParams) {\r\n        GStoreItemData.BindHoverEvents($J(selector), unAppID, unPackageID, unBundleID, rgAdditionalParams);\r\n    }\r\n\r\n    // tooltips\r\n\r\n    static vTooltip(selector, isHtml = false) {\r\n        const isStore = window.location.host === \"store.steampowered.com\";\r\n\r\n        $J(selector).v_tooltip({\r\n            \"tooltipClass\": isStore ? \"store_tooltip\" : \"community_tooltip\",\r\n            \"dataName\": isHtml ? \"tooltipHtml\" : \"tooltipText\",\r\n            \"defaultType\": isHtml ? \"html\" : \"text\",\r\n            \"replaceExisting\": false\r\n        });\r\n    }\r\n\r\n    // market\r\n\r\n    static calculateFeeAmount(amount, publisherFee) {\r\n        return CalculateFeeAmount(amount, publisherFee);\r\n    }\r\n\r\n    static vCurrencyFormat(amount, currencyCode) {\r\n        return v_currencyformat(amount, currencyCode);\r\n    }\r\n\r\n    // friends\r\n\r\n    static toggleManageFriends() {\r\n        return ToggleManageFriends();\r\n    }\r\n\r\n    static openFriendChatInWebChat(chatId) {\r\n        return OpenFriendChatInWebChat(chatId);\r\n    }\r\n\r\n    // community\r\n\r\n    static submitGuide() {\r\n        return SubmitGuide();\r\n    }\r\n\r\n    static initMiniprofileHovers() {\r\n        return InitMiniprofileHovers();\r\n    }\r\n\r\n    static inviteUserToGroup(Modal, groupID, steamIDInvitee) {\r\n        return InviteUserToGroup(Modal, groupID, steamIDInvitee);\r\n    }\r\n\r\n    static getCheckedAccounts(selector) {\r\n        return GetCheckedAccounts(selector);\r\n    }\r\n\r\n    static execFriendAction(action, navid) {\r\n        return ExecFriendAction(action, navid);\r\n    }\r\n\r\n    static scrollOffsetForceRecalc() {\r\n        CScrollOffsetWatcher.ForceRecalc();\r\n    }\r\n\r\n    // inventory\r\n\r\n    static firstPage() {\r\n        return InventoryFirstPage();\r\n    }\r\n\r\n    static lastPage() {\r\n        return InventoryLastPage();\r\n    }\r\n\r\n    static goToPage() {\r\n        return InventoryGoToPage();\r\n    }\r\n\r\n    static reloadCommunityInventory() {\r\n        return ReloadCommunityInventory();\r\n    }\r\n\r\n    static getMarketHashName(itemDesc) {\r\n        return GetMarketHashName(itemDesc);\r\n    }\r\n\r\n    static zoomYear() {\r\n        pricehistory_zoomDays(g_plotPriceHistory, g_timePriceHistoryEarliest, g_timePriceHistoryLatest, 365);\r\n    }\r\n\r\n    static zoomYearForSellDialog() {\r\n        pricehistory_zoomDays(SellItemDialog.m_plotPriceHistory, SellItemDialog.m_timePriceHistoryEarliest, SellItemDialog.m_timePriceHistoryLatest, 365);\r\n    }\r\n      \r\n    // selections\r\n\r\n    static updateSelection() {\r\n        return UpdateSelection();\r\n    }\r\n\r\n    static selectAll() {\r\n        return selectAll();\r\n    }\r\n\r\n    static selectNone() {\r\n        return selectNone();\r\n    }\r\n\r\n    static selectInverse() {\r\n        return selectInverse();\r\n    }\r\n\r\n\r\n    // jQuery functions\r\n\r\n    static jq(selector) {\r\n        return $J(selector);\r\n    }\r\n\r\n    static jqOnClick(selector, callback) {\r\n        $J(selector).on(\"click\", callback);\r\n    }\r\n\r\n    static jqAjax(settings) {\r\n        return $J.ajax(settings);\r\n    }\r\n\r\n    static jqGet(url, settings) {\r\n        return $J.get(url, settings);\r\n    }\r\n\r\n    static jqPost(url, settings) {\r\n        return $J.post(url, settings);\r\n    }\r\n}\r\n\r\nexport {SteamFacade};\r\n","import {Version} from \"../../Core/Version\";\r\nimport {SyncedStorage} from \"../../Core/Storage/SyncedStorage\";\r\nimport {Info} from \"../../Core/Info\";\r\nimport {ExtensionResources} from \"../../Core/ExtensionResources\";\r\nimport {Localization} from \"../../Core/Localization/Localization\";\r\nimport {BackgroundSimple} from \"../../Core/BackgroundSimple\";\r\nimport {Background} from \"./Background\";\r\nimport {LocalStorage} from \"../../Core/Storage/LocalStorage\";\r\nimport {ITAD} from \"./ITAD\";\r\nimport {Page} from \"../Features/Page\";\r\n\r\nclass UpdateHandler {\r\n\r\n    static checkVersion(onUpdate) {\r\n        const lastVersion = Version.fromString(SyncedStorage.get(\"version\"));\r\n        const currentVersion = Version.fromString(Info.version);\r\n\r\n        if (currentVersion.isAfter(lastVersion)) {\r\n            if (SyncedStorage.get(\"version_show\")) {\r\n                this._showChangelog();\r\n            }\r\n            this._migrateSettings(lastVersion);\r\n            onUpdate();\r\n        }\r\n\r\n        SyncedStorage.set(\"version\", Info.version);\r\n    }\r\n\r\n    static async _showChangelog() {\r\n\r\n        const changelog = await ExtensionResources.getJSON(\"changelog.json\");\r\n        const html = changelog[Info.version];\r\n        if (!html) { return; }\r\n\r\n        const logo = ExtensionResources.getURL(\"img/logo/as128.png\");\r\n        const dialog = `<div class=\"es_changelog\"><img src=\"${logo}\"><div>${html}</div></div>`;\r\n\r\n        const connectBtn = document.querySelector(\"#itad_connect\");\r\n        function itadConnected() { connectBtn.replaceWith(\"\"); }\r\n\r\n        Page.runInPageContext(\r\n            (updatedStr, dialog) => {\r\n                window.SteamFacade.showAlertDialog(updatedStr, dialog);\r\n            },\r\n            [Localization.str.update.updated.replace(\"__version__\", Info.version), dialog]\r\n        );\r\n\r\n        if (Version.fromString(Info.version).isSame(new Version(1, 4))) {\r\n\r\n            if (await BackgroundSimple.action(\"itad.isconnected\")) {\r\n                itadConnected();\r\n            } else {\r\n                connectBtn.addEventListener(\"click\", async() => {\r\n                    await BackgroundSimple.action(\"itad.authorize\");\r\n                    ITAD.create();\r\n                    itadConnected();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    static _migrateSettings(oldVersion) {\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.3.1\")) {\r\n            BackgroundSimple.action(\"cache.clear\");\r\n\r\n            SyncedStorage.set(\"horizontalscrolling\", SyncedStorage.get(\"horizontalmediascrolling\"));\r\n            SyncedStorage.remove(\"horizontalmediascrolling\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4\")) {\r\n            SyncedStorage.remove(\"show_sysreqcheck\");\r\n        }\r\n\r\n        if (oldVersion.isSame(\"1.4\")) {\r\n            Background.action(\"migrate.notesToSyncedStorage\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.1\")) {\r\n            SyncedStorage.set(\"profile_steamid\", SyncedStorage.get(\"profile_permalink\"));\r\n            SyncedStorage.remove(\"profile_permalink\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.3\")) {\r\n            SyncedStorage.remove(\"contscroll\");\r\n            Background.action(\"logout\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"1.4.7\")) {\r\n            const emoticons = LocalStorage.get(\"fav_emoticons\");\r\n            if (Array.isArray(emoticons)) {\r\n                SyncedStorage.set(\"fav_emoticons\", emoticons);\r\n            }\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.0\")) {\r\n            SyncedStorage.remove(\"showfakeccwarning\");\r\n            SyncedStorage.remove(\"hideaboutlinks\");\r\n        }\r\n\r\n        if (oldVersion.isSameOrBefore(\"2.0.1\")) {\r\n            SyncedStorage.remove(\"hide_dlcunownedgames\");\r\n            SyncedStorage.remove(\"hide_wishlist\");\r\n            SyncedStorage.remove(\"hide_cart\");\r\n            SyncedStorage.remove(\"hide_notdiscounted\");\r\n            SyncedStorage.remove(\"hide_mixed\");\r\n            SyncedStorage.remove(\"hide_negative\");\r\n            SyncedStorage.remove(\"hide_priceabove\");\r\n            SyncedStorage.remove(\"priceabove_value\");\r\n            SyncedStorage.remove(\"hide_owned\");\r\n            SyncedStorage.remove(\"hide_ignored\");\r\n            SyncedStorage.remove(\"highlight_notdiscounted\");\r\n\r\n            SyncedStorage.remove(\"showallfriendsthatown\");\r\n\r\n            if (SyncedStorage.has(\"showusernotes\")) {\r\n                const val = SyncedStorage.get(\"showusernotes\");\r\n                SyncedStorage.set(\"user_notes_app\", val);\r\n                SyncedStorage.set(\"user_notes_wishlist\", val);\r\n                SyncedStorage.remove(\"showusernotes\");\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {UpdateHandler};\r\n","\r\n// Most of the code here comes from dselect.js\r\nimport {HTML} from \"../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../Core/Storage/SyncedStorage\";\r\n\r\nclass Sortbox {\r\n\r\n    static init() {\r\n        this._activeDropLists = {};\r\n        this._lastSelectHideTime = 0;\r\n\r\n        document.addEventListener(\"mousedown\", e => this._handleMouseClick(e));\r\n    }\r\n\r\n    static _handleMouseClick(e) {\r\n        for (const key of Object.keys(this._activeDropLists)) {\r\n            if (!this._activeDropLists[key]) { continue; }\r\n\r\n            const ulAboveEvent = e.target.closest(\"ul\");\r\n\r\n            if (ulAboveEvent && ulAboveEvent.id === `${key}_droplist`) { continue; }\r\n\r\n            this._hide(key);\r\n        }\r\n    }\r\n\r\n    static _highlightItem(id, index, bSetSelected) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n        const rgItems = droplist.getElementsByTagName(\"a\");\r\n\r\n        if (index >= 0 && index < rgItems.length) {\r\n            const item = rgItems[index];\r\n\r\n            if (typeof trigger.highlightedItem !== \"undefined\" && trigger.highlightedItem !== index) {\r\n                rgItems[trigger.highlightedItem].className = \"inactive_selection\";\r\n            }\r\n\r\n            trigger.highlightedItem = index;\r\n            rgItems[index].className = \"highlighted_selection\";\r\n\r\n            let yOffset = rgItems[index].offsetTop + rgItems[index].clientHeight;\r\n            let curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n            let bScrolledDown = false;\r\n            const nMaxLoopIterations = rgItems.length;\r\n            let nLoopCounter = 0;\r\n\r\n            while (curVisibleOffset < yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                droplist.scrollTop += rgItems[index].clientHeight;\r\n                curVisibleOffset = droplist.scrollTop + droplist.clientHeight;\r\n                bScrolledDown = true;\r\n            }\r\n\r\n            if (!bScrolledDown) {\r\n                nLoopCounter = 0;\r\n                yOffset = rgItems[index].offsetTop;\r\n                curVisibleOffset = droplist.scrollTop;\r\n                while (curVisibleOffset > yOffset && nLoopCounter++ < nMaxLoopIterations) {\r\n                    droplist.scrollTop -= rgItems[index].clientHeight;\r\n                    curVisibleOffset = droplist.scrollTop;\r\n                }\r\n            }\r\n\r\n            if (bSetSelected) {\r\n                HTML.inner(trigger, item.innerHTML);\r\n                const input = document.querySelector(`#${id}`);\r\n                input.value = item.id;\r\n                input.dispatchEvent(new Event(\"change\"));\r\n\r\n                this._hide(id);\r\n            }\r\n        }\r\n    }\r\n\r\n    static _onFocus(id) {\r\n        this._activeDropLists[id] = true;\r\n    }\r\n\r\n    static _onBlur(id) {\r\n        if (!this._classCheck(document.querySelector(`#${id}_trigger`), \"activetrigger\")) { this._activeDropLists[id] = false; }\r\n    }\r\n\r\n    static _hide(id) {\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        const d = new Date();\r\n        this._lastSelectHideTime = d.valueOf();\r\n\r\n        trigger.className = \"trigger\";\r\n        droplist.className = \"dropdownhidden\";\r\n        this._activeDropLists[id] = false;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _show(id) {\r\n        const d = new Date();\r\n        if (d - this._lastSelectHideTime < 50) { return; }\r\n\r\n        const droplist = document.querySelector(`#${id}_droplist`);\r\n        const trigger = document.querySelector(`#${id}_trigger`);\r\n\r\n        trigger.className = \"activetrigger\";\r\n        droplist.className = \"dropdownvisible\";\r\n        this._activeDropLists[id] = true;\r\n        trigger.focus();\r\n    }\r\n\r\n    static _onTriggerClick(id) {\r\n        if (!this._classCheck(document.querySelector(`#${id}_trigger`), \"activetrigger\")) {\r\n            this._show(id);\r\n        }\r\n    }\r\n\r\n    static _classCheck(element, className) {\r\n        return new RegExp(`\\\\b${className}\\\\b`).test(element.className);\r\n    }\r\n\r\n    /**\r\n     * NOTE FOR ADDON REVIEWER:\r\n     * Elements returned by this function are already sanitized (calls to HTML class),\r\n     * so they can be safely inserted without being sanitized again.\r\n     * If we would sanitize them again, all event listeners would be lost due to\r\n     * DOMPurify only returning HTML strings.\r\n     */\r\n    static get(name, options, initialOption, changeFn, storageOption) {\r\n\r\n        const id = `sort_by_${name}`;\r\n        let reversed = initialOption.endsWith(\"_DESC\");\r\n\r\n        const arrowDown = \"\";\r\n        const arrowUp = \"\";\r\n\r\n        const box = HTML.element(\r\n            `<div class=\"es-sortbox es-sortbox--${name}\">\r\n                <div class=\"es-sortbox__label\">${Localization.str.sort_by}</div>\r\n                <div class=\"es-sortbox__container\">\r\n                    <input id=\"${id}\" type=\"hidden\" name=\"${name}\" value=\"${initialOption}\">\r\n                    <a class=\"trigger\" id=\"${id}_trigger\"></a>\r\n                    <div class=\"es-dropdown\">\r\n                        <ul id=\"${id}_droplist\" class=\"es-dropdown__list dropdownhidden\"></ul>\r\n                    </div>\r\n                </div>\r\n                <span class=\"es-sortbox__reverse\">${arrowDown}</span>\r\n            </div>`\r\n        );\r\n\r\n        const input = box.querySelector(`#${id}`);\r\n\r\n        function getTrimmedValue(val) { return val.replace(/(_ASC|_DESC)$/, \"\"); }\r\n\r\n        function onChange(val, reversed) {\r\n            const _val = getTrimmedValue(val);\r\n            changeFn(_val, reversed);\r\n            if (storageOption) { SyncedStorage.set(storageOption, `${_val}_${reversed ? \"DESC\" : \"ASC\"}`); }\r\n        }\r\n\r\n        input.addEventListener(\"change\", () => { onChange(input.value.replace(`${id}_`, \"\"), reversed); });\r\n\r\n        // Trigger changeFn for initial option\r\n        if (initialOption !== \"default_ASC\") {\r\n            input.dispatchEvent(new Event(\"change\"));\r\n        }\r\n\r\n        const reverseEl = box.querySelector(\".es-sortbox__reverse\");\r\n        reverseEl.addEventListener(\"click\", () => {\r\n            reversed = !reversed;\r\n            reverseEl.textContent = reversed ? arrowUp : arrowDown;\r\n            onChange(input.value.replace(`${id}_`, \"\"), reversed);\r\n        });\r\n        if (reversed) { reverseEl.textContent = arrowUp; }\r\n\r\n        const trigger = box.querySelector(`#${id}_trigger`);\r\n        trigger.addEventListener(\"focus\", () => this._onFocus(id));\r\n        trigger.addEventListener(\"blur\", () => this._onBlur(id));\r\n        trigger.addEventListener(\"click\", () => this._onTriggerClick(id));\r\n\r\n        const ul = box.querySelector(\"ul\");\r\n        const trimmedOption = getTrimmedValue(initialOption);\r\n        for (let i = 0; i < options.length; ++i) {\r\n            const [key, text] = options[i];\r\n\r\n            let toggle = \"inactive\";\r\n            if (key === trimmedOption) {\r\n                box.querySelector(`#${id}`).value = key;\r\n                box.querySelector(\".trigger\").textContent = text;\r\n                toggle = \"highlighted\";\r\n            }\r\n\r\n            HTML.beforeEnd(ul,\r\n                `<li>\r\n                    <a class=\"${toggle}_selection\" tabindex=\"99999\" id=\"${id}_${key}\">${text}</a>\r\n                </li>`);\r\n\r\n            const a = ul.querySelector(\"li:last-child > a\");\r\n\r\n            // a.href = \"javascript:DSelectNoop()\";\r\n            a.addEventListener(\"mouseover\", () => this._highlightItem(id, i, false));\r\n            a.addEventListener(\"click\", () => this._highlightItem(id, i, true));\r\n        }\r\n\r\n        return box;\r\n    }\r\n}\r\n\r\nexport {Sortbox};\r\n","import {GameId, HTML, HTMLParser, Localization, SyncedStorage} from \"../../../modulesCore\";\r\nimport {DynamicStore, Feature, ITAD, Inventory} from \"../../modulesContent\";\r\nimport {Page} from \"../Page\";\r\n\r\nexport default class FHighlightsTags extends Feature {\r\n\r\n    async apply() {\r\n\r\n        await Page.runInPageContext(() => new Promise(resolve => {\r\n            window.SteamFacade.onDynamicStoreReady(() => { resolve(); });\r\n        }), null, true);\r\n\r\n        const searchBoxContents = document.getElementById(\"search_suggestion_contents\");\r\n        if (searchBoxContents) {\r\n            const observer = new MutationObserver(records => {\r\n                FHighlightsTags.highlightAndTag(records[0].addedNodes);\r\n            });\r\n            observer.observe(searchBoxContents, {\"childList\": true});\r\n        }\r\n\r\n        return Promise.all([\r\n            FHighlightsTags.highlightTitle(this.context.appid),\r\n            FHighlightsTags.highlightAndTag(),\r\n        ]);\r\n    }\r\n\r\n    static highlightTitle(appid) {\r\n\r\n        const title = document.querySelector(\".apphub_AppName\");\r\n        if (!title) { return null; }\r\n\r\n        title.dataset.dsAppid = appid;\r\n\r\n        return FHighlightsTags.highlightAndTag([title], false);\r\n    }\r\n\r\n    /**\r\n     * Highlights and tags DOM nodes that are owned, wishlisted, ignored, collected, waitlisted\r\n     * or that the user has a gift, a guest pass or coupon for.\r\n     *\r\n     * Additionally hides non-discounted titles if wished by the user.\r\n     * @param {NodeList|Array} nodes - The nodes that should get highlighted\r\n     * (defaults to all known nodes that are highlightable and taggable)\r\n     * @param {boolean} hasDsInfo - Whether or not the supplied nodes contain dynamic store info (defaults to true)\r\n     * @param {Object} options - The highlights/tags that should be applied (defaults to all enabled)\r\n     * @returns {Promise} - Resolved once the highlighting and tagging completed for the nodes\r\n     */\r\n    /* eslint-disable complexity -- FIXME */\r\n    static async highlightAndTag(nodes = document.querySelectorAll(this._selector), hasDsInfo = true, options = {}) {\r\n\r\n        const opts = {\"owned\": true,\r\n            \"wishlisted\": true,\r\n            \"ignored\": true,\r\n            \"collected\": true,\r\n            \"waitlisted\": true,\r\n            \"gift\": true,\r\n            \"guestPass\": true,\r\n            \"coupon\": true,\r\n            ...options};\r\n\r\n        const storeIdsMap = new Map();\r\n\r\n        for (const node of nodes) {\r\n            let nodeToHighlight = node;\r\n\r\n            if (node.classList.contains(\"item\")) {\r\n                nodeToHighlight = node.querySelector(\".info\");\r\n            } else if (node.classList.contains(\"home_area_spotlight\")) {\r\n                nodeToHighlight = node.querySelector(\".spotlight_content\");\r\n            } else if (node.parentNode.classList.contains(\"steam_curator_recommendation\")\r\n                && node.parentNode.classList.contains(\"big\")) {\r\n                nodeToHighlight = node.nextElementSibling;\r\n            } else if (node.parentNode.parentNode.classList.contains(\"curations\")) {\r\n                nodeToHighlight = node.parentNode;\r\n            } else if (node.classList.contains(\"special_img_ctn\") && node.parentElement.classList.contains(\"special\")) {\r\n                nodeToHighlight = node.parentElement;\r\n            } else if (node.classList.contains(\"blotter_userstats_game\")) {\r\n\r\n                // Small game capsules on activity page (e.g. when posting a status about a game)\r\n                nodeToHighlight = node.parentElement;\r\n            }\r\n\r\n            const aNode = node.querySelector(\"a\");\r\n\r\n            const appid = GameId.getAppid(node) || GameId.getAppid(aNode) || GameId.getAppidFromId(node.id);\r\n            const subid = GameId.getSubid(node) || GameId.getSubid(aNode);\r\n            const bundleid = GameId.getBundleid(node) || GameId.getBundleid(aNode);\r\n\r\n            let storeId;\r\n            if (appid) {\r\n                storeId = `app/${appid}`;\r\n            } else if (bundleid) {\r\n                storeId = `bundle/${bundleid}`;\r\n            } else if (subid) {\r\n                storeId = `sub/${subid}`;\r\n            }\r\n\r\n            if (storeId) {\r\n                if (storeIdsMap.has(storeId)) {\r\n                    const arr = storeIdsMap.get(storeId);\r\n                    arr.push(nodeToHighlight);\r\n                    storeIdsMap.set(storeId, arr);\r\n                } else {\r\n                    storeIdsMap.set(storeId, [nodeToHighlight]);\r\n                }\r\n            }\r\n\r\n            if (hasDsInfo) {\r\n                if (node.querySelector(\".ds_owned_flag\") && opts.owned) {\r\n                    this.highlightOwned(nodeToHighlight);\r\n                }\r\n\r\n                if (node.querySelector(\".ds_wishlist_flag\") && opts.wishlisted) {\r\n                    this.highlightWishlist(nodeToHighlight);\r\n                }\r\n\r\n                if (node.querySelector(\".ds_ignored_flag\") && opts.ignored) {\r\n                    this.highlightIgnored(nodeToHighlight);\r\n                }\r\n            }\r\n        }\r\n\r\n        const storeIds = Array.from(storeIdsMap.keys());\r\n        const trimmedStoreIds = storeIds.map(id => GameId.trimStoreId(id));\r\n\r\n        const includeDsInfo\r\n            = !hasDsInfo\r\n            && ((opts.owned && (SyncedStorage.get(\"highlight_owned\") || SyncedStorage.get(\"tag_owned\")))\r\n                || (opts.wishlisted && (SyncedStorage.get(\"highlight_wishlist\") || SyncedStorage.get(\"tag_wishlist\")))\r\n                || (opts.ignored && (SyncedStorage.get(\"highlight_notinterested\") || SyncedStorage.get(\"tag_notinterested\")))\r\n            );\r\n\r\n        const [dsStatus, itadStatus, invStatus] = await Promise.all([\r\n            includeDsInfo ? DynamicStore.getAppStatus(storeIds) : Promise.resolve(),\r\n            ITAD.getAppStatus(storeIds, {\r\n                \"waitlist\": opts.waitlisted && (SyncedStorage.get(\"highlight_waitlist\") || SyncedStorage.get(\"tag_waitlist\")),\r\n                \"collection\": opts.collected && (SyncedStorage.get(\"highlight_collection\") || SyncedStorage.get(\"tag_collection\")),\r\n            }),\r\n            Inventory.getAppStatus(trimmedStoreIds, {\r\n                \"giftsAndPasses\": (opts.gift && (SyncedStorage.get(\"highlight_inv_gift\") || SyncedStorage.get(\"tag_inv_gift\")))\r\n                    || (opts.guestPass && (SyncedStorage.get(\"highlight_inv_guestpass\") || SyncedStorage.get(\"tag_inv_guestpass\"))),\r\n                \"coupons\": opts.coupon && (SyncedStorage.get(\"highlight_coupon\") || SyncedStorage.get(\"tag_coupon\")),\r\n            }),\r\n        ]);\r\n\r\n        const it = trimmedStoreIds.values();\r\n        for (const [storeid, nodes] of storeIdsMap) {\r\n            if (dsStatus) {\r\n                if (opts.owned && dsStatus[storeid].owned) {\r\n                    nodes.forEach(node => { this.highlightOwned(node); });\r\n                }\r\n                if (opts.wishlisted && dsStatus[storeid].wishlisted) {\r\n                    nodes.forEach(node => { this.highlightWishlist(node); });\r\n                }\r\n                if (opts.ignored && dsStatus[storeid].ignored) {\r\n                    nodes.forEach(node => { this.highlightIgnored(node); });\r\n                }\r\n            }\r\n\r\n            /*\r\n             * Don't need to check for the opts object here, since the result contains\r\n             * false for every property if the highlight has been disabled\r\n             */\r\n            if (itadStatus) {\r\n                if (itadStatus[storeid].collected) {\r\n                    nodes.forEach(node => { this.highlightCollection(node); });\r\n                }\r\n                if (itadStatus[storeid].waitlisted) {\r\n                    nodes.forEach(node => { this.highlightWaitlist(node); });\r\n                }\r\n            }\r\n\r\n            if (invStatus) {\r\n                const trimmedId = it.next().value;\r\n                if (opts.gift && invStatus[trimmedId].gift) {\r\n                    nodes.forEach(node => { this.highlightInvGift(node); });\r\n                }\r\n\r\n                if (opts.guestPass && invStatus[trimmedId].guestPass) {\r\n                    nodes.forEach(node => { this.highlightInvGuestpass(node); });\r\n                }\r\n\r\n                // Same as for the ITAD highlights (don't need to check)\r\n                if (invStatus[trimmedId].coupon) {\r\n                    nodes.forEach(node => { this.highlightInvCoupon(node); });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    static _addTag(node, tag) {\r\n\r\n        const tagShort = SyncedStorage.get(\"tag_short\");\r\n\r\n        // Load the colors CSS for tags\r\n        if (!this._tagCssLoaded) {\r\n            this._tagCssLoaded = true;\r\n\r\n            const tagCss = [];\r\n\r\n            for (const name of this._types) {\r\n                const color = SyncedStorage.get(`tag_${name}_color`);\r\n                tagCss.push(`.es_tag_${name} { background-color: ${color}; }`);\r\n            }\r\n\r\n            let style = document.createElement(\"style\");\r\n            style.id = \"es_tag_styles\";\r\n            style.textContent = tagCss.join(\"\\n\");\r\n            document.head.appendChild(style);\r\n            style = null;\r\n        }\r\n\r\n        // Add the tags container if needed\r\n        let tags = node.querySelectorAll(\".es_tags\");\r\n        if (tags.length === 0) {\r\n            tags = HTMLParser.htmlToElement(`<div class=\"es_tags ${tagShort ? \"es_tags_short\" : \"\"}\"></div>`);\r\n\r\n            let root;\r\n            if (node.classList.contains(\"tab_row\")) { // fixme can't find it\r\n                root = node.querySelector(\".tab_desc\").classList.remove(\"with_discount\");\r\n\r\n                node.querySelector(\".tab_discount\").style.top = \"15px\";\r\n                root.querySelector(\"h4\").insertAdjacentElement(\"afterend\", tags);\r\n            } else if (node.classList.contains(\"home_smallcap\")) {\r\n                node.querySelector(\".home_smallcap_title\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"curated_app_item\")) {\r\n                node.querySelector(\".home_headerv5_title\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"tab_item\")) {\r\n                node.querySelector(\".tab_item_name\").insertAdjacentElement(\"afterend\", tags);\r\n            } else if (node.classList.contains(\"newonsteam_headercap\") || node.classList.contains(\"comingsoon_headercap\")) {\r\n                node.querySelector(\".discount_block\").insertAdjacentElement(\"beforebegin\", tags);\r\n            } else if (node.classList.contains(\"search_result_row\")) {\r\n                node.querySelector(\"p\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"dailydeal\")) { // can't find it\r\n                root = node.parentNode;\r\n                root.querySelector(\".game_purchase_action\").insertAdjacentElement(\"beforebegin\", tags);\r\n                HTML.beforeBegin(root.querySelector(\".game_purchase_action\"), '<div style=\"clear: right;\"></div>');\r\n            } else if (node.classList.contains(\"browse_tag_game\")) {\r\n                node.querySelector(\".browse_tag_game_price\").insertAdjacentElement(\"afterend\", tags);\r\n            } else if (node.classList.contains(\"game_area_dlc_row\")) {\r\n                node.querySelector(\".game_area_dlc_price\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"wishlist_row\")) {\r\n                node.querySelector(\".addedon\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"match\")) {\r\n                node.querySelector(\".match_price\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"cluster_capsule\")) {\r\n                node.querySelector(\".main_cap_platform_area\").append(tags);\r\n            } else if (node.classList.contains(\"recommendation_highlight\")) {\r\n                node.querySelector(\".highlight_description\").insertAdjacentElement(\"afterbegin\", tags);\r\n            } else if (node.classList.contains(\"similar_grid_item\")) {\r\n                node.querySelector(\".regular_price, .discount_block\").append(tags);\r\n            } else if (node.classList.contains(\"recommendation_carousel_item\")) {\r\n                node.querySelector(\".buttons\").insertAdjacentElement(\"beforebegin\", tags);\r\n            } else if (node.classList.contains(\"friendplaytime_game\")) {\r\n                node.querySelector(\".friendplaytime_buttons\").insertAdjacentElement(\"beforebegin\", tags);\r\n            }\r\n\r\n            tags = [tags];\r\n        }\r\n\r\n        // Add the tag\r\n        for (const n of tags) {\r\n            if (!n.querySelector(`.es_tag_${tag}`)) {\r\n                HTML.beforeEnd(n, `<span class=\"es_tag_${tag}\">${Localization.str.tag[tag]}</span>`);\r\n            }\r\n        }\r\n    }\r\n    /* eslint-enable complexity */\r\n\r\n    static _highlightNode(node) {\r\n        if (SyncedStorage.get(\"highlight_excludef2p\")) {\r\n\r\n            if (node.innerHTML.match(\r\n                /<div class=\"(tab_price|large_cap_price|col search_price|main_cap_price|price)\">\\n?(.+)?(Free to Play|Play for Free!)(.+)?<\\/div>/i\r\n            )) {\r\n                return;\r\n            }\r\n            if (node.innerHTML.match(/<h5>(Free to Play|Play for Free!)<\\/h5>/i)) {\r\n                return;\r\n            }\r\n            if (node.innerHTML.match(/genre_release/) && node.querySelector(\".genre_release\").innerHTML.match(/Free to Play/i)) {\r\n                return;\r\n            }\r\n            if (node.classList.contains(\"search_result_row\") && node.innerHTML.match(/Free to Play/i)) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (!this._highlightCssLoaded) {\r\n            this._highlightCssLoaded = true;\r\n\r\n            const hlCss = [];\r\n\r\n            for (const name of this._types) {\r\n                const color = SyncedStorage.get(`highlight_${name}_color`);\r\n                hlCss.push(\r\n                    `.es_highlighted_${name} {\r\n                        background: ${color} linear-gradient(135deg, rgba(0, 0, 0, 0.70) 10%, rgba(0, 0, 0, 0) 100%) !important;\r\n                    }\r\n                    .carousel_items .es_highlighted_${name}.price_inline, .curator_giant_capsule.es_highlighted_${name},\r\n                    .hero_capsule.es_highlighted_${name}, .blotter_userstatus_game.es_highlighted_${name} {\r\n                        outline: solid ${color};\r\n                    }\r\n                    #search_suggestion_contents .focus.es_highlighted_${name} {\r\n                        box-shadow: -5px 0 0 ${color};\r\n                    }\r\n                    .apphub_AppName.es_highlighted_${name} {\r\n                        background: none !important; color: ${color};\r\n                    }`\r\n                );\r\n            }\r\n\r\n            let style = document.createElement(\"style\");\r\n            style.id = \"es_highlight_styles\";\r\n            style.textContent = hlCss.join(\"\\n\");\r\n            document.head.appendChild(style);\r\n            style = null;\r\n        }\r\n\r\n        let _node = node;\r\n\r\n        // Carousel item\r\n        if (_node.classList.contains(\"cluster_capsule\")) {\r\n            _node = _node.querySelector(\".main_cap_content\").parentNode;\r\n        } else if (_node.classList.contains(\"large_cap\")) {\r\n\r\n            // Genre Carousel items\r\n            _node = _node.querySelector(\".large_cap_content\");\r\n        } else if (_node.parentNode.classList.contains(\"steam_curator_recommendation\")\r\n            && _node.parentNode.classList.contains(\"big\")) {\r\n            _node = _node.previousElementSibling;\r\n        }\r\n\r\n        // Recommendations on front page when scrolling down\r\n        if (_node.classList.contains(\"single\")) {\r\n            _node = _node.querySelector(\".gamelink\");\r\n        }\r\n\r\n        if (_node.parentNode.parentNode.classList.contains(\"apps_recommended_by_curators_v2\")) {\r\n            let r = _node.querySelectorAll(\".ds_flag\");\r\n            r.forEach(node => node.remove());\r\n            r = _node.querySelectorAll(\".ds_flagged\");\r\n            r.forEach(node => node.classList.remove(\"ds_flagged\"));\r\n        } else {\r\n\r\n            if (_node.classList.contains(\"info\") || _node.classList.contains(\"spotlight_content\")) {\r\n                _node = _node.parentElement;\r\n            }\r\n\r\n            let r = _node.querySelector(\".ds_flag\");\r\n            if (r) { r.remove(); }\r\n            r = _node.querySelector(\".ds_flagged\");\r\n            if (r) {\r\n                r.classList.remove(\"ds_flagged\");\r\n            }\r\n        }\r\n\r\n        _node.classList.remove(\"ds_flagged\");\r\n    }\r\n\r\n    static _highlightItem(node, name) {\r\n        node.classList.add(\"es_highlight_checked\");\r\n\r\n        if (SyncedStorage.get(`highlight_${name}`)) {\r\n            node.classList.add(\"es_highlighted\", `es_highlighted_${name}`);\r\n            this._highlightNode(node);\r\n        }\r\n\r\n        if (SyncedStorage.get(`tag_${name}`)) {\r\n            this._addTag(node, name);\r\n        }\r\n    }\r\n\r\n    static highlightOwned(node) {\r\n        this._highlightItem(node, \"owned\");\r\n    }\r\n\r\n    static highlightWishlist(node) {\r\n        this._highlightItem(node, \"wishlist\");\r\n    }\r\n\r\n    static highlightInvCoupon(node) {\r\n        this._highlightItem(node, \"coupon\");\r\n    }\r\n\r\n    static highlightInvGift(node) {\r\n        this._highlightItem(node, \"inv_gift\");\r\n    }\r\n\r\n    static highlightInvGuestpass(node) {\r\n        this._highlightItem(node, \"inv_guestpass\");\r\n    }\r\n\r\n    static highlightIgnored(node) {\r\n        this._highlightItem(node, \"notinterested\");\r\n    }\r\n\r\n    static highlightCollection(node) {\r\n        this._highlightItem(node, \"collection\");\r\n    }\r\n\r\n    static highlightWaitlist(node) {\r\n        this._highlightItem(node, \"waitlist\");\r\n    }\r\n}\r\n\r\nFHighlightsTags._highlightCssLoaded = false;\r\nFHighlightsTags._tagCssLoaded = false;\r\n\r\n/*\r\n * Attention, the sequence of these entries determines the precendence of the highlights!\r\n * The later it appears in the array, the higher its precedence\r\n */\r\nFHighlightsTags._types = [\r\n    \"notinterested\",\r\n    \"waitlist\",\r\n    \"wishlist\",\r\n    \"collection\",\r\n    \"owned\",\r\n    \"coupon\",\r\n    \"inv_guestpass\",\r\n    \"inv_gift\",\r\n];\r\n\r\nFHighlightsTags._selector = [\r\n    \"div.tab_row\", // Storefront rows\r\n    \"div.dailydeal_ctn\",\r\n    \".store_main_capsule\", // \"Featured & Recommended\"\r\n    \"div.wishlistRow\", // Wishlist rows\r\n    \"a.game_area_dlc_row\", // DLC on app pages\r\n    \"a.small_cap\", // Featured storefront items and \"recommended\" section on app pages\r\n    \"a.home_smallcap\",\r\n    \".home_content_item\", // Small items under \"Keep scrolling for more recommendations\"\r\n    \".home_content.single\", // Big items under \"Keep scrolling for more recommendations\"\r\n    \".home_area_spotlight\", // \"Special offers\" big items\r\n    \"a.search_result_row\", // Search result rows\r\n    \"a.match\", // Search suggestions rows\r\n    \".highlighted_app\", // For example \"Recently Recommended\" on curators page\r\n    \"a.cluster_capsule\", // Carousel items\r\n    \"div.recommendation_highlight\", // Recommendation pages\r\n    \"div.recommendation_carousel_item\", // Recommendation pages\r\n    \"div.friendplaytime_game\", // Recommendation pages\r\n    \".recommendation_row\", // \"Recent recommendations by friends\"\r\n    \".friendactivity_tab_row\", // \"Most played\" and \"Most wanted\" tabs on recommendation pages\r\n    \".friend_game_block\", // \"Friends recently bought\"\r\n    \".recommendation\", // Curator pages and the new DLC pages\r\n    \".curator_giant_capsule\",\r\n    \"div.carousel_items.curator_featured > div\", // Carousel items on Curator pages\r\n    \"div.item_ctn\", // Curator list item\r\n    \".store_capsule\", // All sorts of items on almost every page\r\n    \".newonsteam_headercap\", // explore/new/\r\n    \".comingsoon_headercap\", // explore/upcoming/\r\n    \".home_marketing_message\", // \"Updates and offers\"\r\n    \"div.dlc_page_purchase_dlc\", // DLC page rows\r\n    \"div.sale_page_purchase_item\", // Sale pages\r\n    \"div.item\", // Sale pages / featured pages\r\n    \"div.home_area_spotlight\", // Midweek and weekend deals\r\n    \"div.browse_tag_game\", // Tagged games\r\n    \"div.similar_grid_item\", // Items on the \"Similarly tagged\" pages\r\n    \".tab_item\", // Items on new homepage\r\n    \".special > .special_img_ctn\", // new homepage specials\r\n    \".special.special_img_ctn\",\r\n    \"div.curated_app_item\", // curated app items!\r\n    \".hero_capsule\", // Summer sale \"Featured\"\r\n    \".sale_capsule\" // Summer sale general capsules\r\n].map(sel => `${sel}:not(.es_highlighted)`)\r\n    .join(\",\");\r\n","import {HTML, SyncedStorage} from \"../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../modulesContent\";\r\n\r\nexport default class FHideTrademarks extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"hidetmsymbols\");\r\n    }\r\n\r\n    apply() {\r\n\r\n        // TODO I would try to reduce number of selectors here\r\n        let selectors = \"title, .apphub_AppName, .breadcrumbs, h1, h4\";\r\n        if (this.context.type === ContextType.STORE_DEFAULT) {\r\n            selectors\r\n                += \".game_area_already_owned, .details_block, .game_description_snippet, \"\r\n                + \".game_area_description p, .glance_details, .game_area_dlc_bubble game_area_bubble, .package_contents, \"\r\n                + \".game_area_dlc_name, .tab_desc, .tab_item_name\";\r\n        } else {\r\n            selectors\r\n                += \".game_suggestion, .appHubShortcut_Title, .apphub_CardContentNewsTitle, \"\r\n                + \".apphub_CardTextContent, .apphub_CardContentAppName, .apphub_AppName\";\r\n        }\r\n\r\n        // Replaces \"R\", \"C\" and \"TM\" signs\r\n        function replaceSymbols(node) {\r\n\r\n            // tfedor I don't trust this won't break any inline JS\r\n            if (!node || !node.innerHTML) { return; }\r\n            HTML.inner(node, node.innerHTML.replace(/[\\u00AE\\u00A9\\u2122]/g, \"\"));\r\n        }\r\n\r\n        for (const node of document.querySelectorAll(selectors)) {\r\n            replaceSymbols(node);\r\n        }\r\n\r\n        const observer = new MutationObserver(mutations => {\r\n            mutations.forEach(mutation => {\r\n                mutation.addedNodes.forEach(node => {\r\n                    replaceSymbols(node);\r\n                });\r\n            });\r\n        });\r\n\r\n        const nodes = document.querySelectorAll(\"#game_select_suggestions,#search_suggestion_contents,.tab_content_ctn\");\r\n        for (const node of nodes) {\r\n            observer.observe(node, {\"childList\": true, \"subtree\": true});\r\n        }\r\n    }\r\n}\r\n","import {ExtensionResources, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FAlternativeLinuxIcon extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"show_alternative_linux_icon\");\r\n    }\r\n\r\n    apply() {\r\n        const url = ExtensionResources.getURL(\"img/alternative_linux_icon.png\");\r\n        const style = document.createElement(\"style\");\r\n\r\n        let cssText = `span.platform_img.linux { background-image: url(${url}) !important; }`;\r\n\r\n        if (this.context.type === ContextType.STORE_FRONT) {\r\n            cssText += \".tab_item.focus .tab_item_details span.platform_img.linux { filter: brightness(20%); }\";\r\n        }\r\n\r\n        style.textContent = cssText;\r\n        document.head.appendChild(style);\r\n    }\r\n}\r\n","import {HTML, HTMLParser, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {ContextType, Feature} from \"../../../modulesContent\";\r\n\r\nexport default class FExtraLinks extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        const context = this.context;\r\n\r\n        if (context.type === ContextType.APP) {\r\n            this._type = \"app\";\r\n            this._gameid = context.appid;\r\n            this._node = document.querySelector(\"#shareEmbedRow\");\r\n        } else if (context.type === ContextType.SUB) {\r\n            this._type = \"sub\";\r\n            this._gameid = context.subid;\r\n            this._node = document.querySelector(\".share\").parentNode;\r\n        } else if (context.type === ContextType.BUNDLE) {\r\n            this._type = \"bundle\";\r\n            this._gameid = context.bundleid;\r\n            this._node = document.querySelector(\".share, .rightcol .game_details\");\r\n        }\r\n\r\n        if (!this._node) {\r\n            console.warn(\"Couldn't find element to insert extra links\");\r\n        }\r\n\r\n        return this._node !== null && (\r\n\r\n            // Even if the user doesn't want to see any extra links, the place of the native links is changed (see _moveExtraLinks)\r\n            this._type === \"app\"\r\n\r\n            // Preferences for links shown on all pages\r\n            || (SyncedStorage.get(\"showbartervg\")\r\n            || SyncedStorage.get(\"showsteamdb\")\r\n            || SyncedStorage.get(\"showitadlinks\"))\r\n        );\r\n    }\r\n\r\n    apply() {\r\n\r\n        if (this._type === \"app\") {\r\n\r\n            this._moveExtraLinks();\r\n\r\n            const appName = HTMLParser.clearSpecialSymbols(this.context.appName);\r\n\r\n            // custom app link\r\n            for (const customLink of SyncedStorage.get(\"app_custom_link\")) {\r\n                if (!customLink || !customLink.enabled) {\r\n                    continue;\r\n                }\r\n\r\n                const customUrl = customLink.url;\r\n                const name = HTML.escape(customLink.name);\r\n                const link = `//${HTML.escape(customUrl\r\n                    .replace(\"[NAME]\", encodeURIComponent(appName))\r\n                    .replace(\"[ID]\", this.context.appid))}`;\r\n                let icon;\r\n                if (customLink.icon) {\r\n                    icon = `//${HTML.escape(customLink.icon)}`;\r\n                }\r\n\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        null,\r\n                        link,\r\n                        Localization.str.view_on_website.replace(\"__website__\", name),\r\n                        icon,\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showyoutubereviews\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"youtube_btn\",\r\n                        `https://www.youtube.com/results?search_query=${encodeURIComponent(`${appName} \"PC\" intitle:Review`)}`,\r\n                        Localization.str.youtube_reviews,\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showyoutubegameplay\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"youtube_btn\",\r\n                        `https://www.youtube.com/results?search_query=${encodeURIComponent(`${appName} \"PC Gameplay\"`)}`,\r\n                        Localization.str.youtube_gameplay,\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showyoutube\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"youtube_btn\",\r\n                        `https://www.youtube.com/results?search_query=${encodeURIComponent(appName)}`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"YouTube\"),\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showtwitch\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"twitch_btn\",\r\n                        `https://www.twitch.tv/directory/game/${encodeURIComponent(appName)}`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"Twitch\"),\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showpcgw\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"pcgw_btn\",\r\n                        `https://pcgamingwiki.com/api/appid.php?appid=${this.context.appid}`,\r\n                        Localization.str.wiki_article.replace(\"__pcgw__\", \"PCGamingWiki\"),\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showcompletionistme\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"completionistme_btn\",\r\n                        `https://completionist.me/steam/app/${this.context.appid}/`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"Completionist.me\"),\r\n                    ));\r\n            }\r\n\r\n            if (SyncedStorage.get(\"showprotondb\")) {\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"protondb_btn\",\r\n                        `https://www.protondb.com/app/${this.context.appid}/`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"ProtonDB\"),\r\n                    ));\r\n            }\r\n\r\n            if (this.context.hasCards && SyncedStorage.get(\"showsteamcardexchange\")) {\r\n\r\n                // FIXME some dlc have card category yet no card\r\n                HTML.afterBegin(this._node,\r\n                    this._getRightColLinkHtml(\r\n                        \"cardexchange_btn\",\r\n                        `https://www.steamcardexchange.net/index.php?gamepage-appid-${this.context.communityAppid}/`,\r\n                        Localization.str.view_on_website.replace(\"__website__\", \"Steam Card Exchange\"),\r\n                    ));\r\n            }\r\n        }\r\n\r\n        if (SyncedStorage.get(\"showbartervg\")) {\r\n            HTML.afterBegin(this._node,\r\n                this._getRightColLinkHtml(\r\n                    \"bartervg_ico\",\r\n                    `https://barter.vg/steam/${this._type}/${this._gameid}/`,\r\n                    Localization.str.view_on_website.replace(\"__website__\", \"Barter.vg\"),\r\n                ));\r\n        }\r\n\r\n        if (SyncedStorage.get(\"showsteamdb\")) {\r\n            HTML.afterBegin(this._node,\r\n                this._getRightColLinkHtml(\r\n                    \"steamdb_ico\",\r\n                    `https://steamdb.info/${this._type}/${this._gameid}/`,\r\n                    Localization.str.view_on_website.replace(\"__website__\", \"Steam Database\"),\r\n                ));\r\n        }\r\n\r\n        if (SyncedStorage.get(\"showitadlinks\")) {\r\n            HTML.afterBegin(this._node,\r\n                this._getRightColLinkHtml(\r\n                    \"itad_ico\",\r\n                    `https://isthereanydeal.com/steam/${this._type}/${this._gameid}/`,\r\n                    Localization.str.view_on_website.replace(\"__website__\", \"IsThereAnyDeal\"),\r\n                ));\r\n        }\r\n    }\r\n\r\n    _getRightColLinkHtml(cls, url, str, iconUrl) {\r\n        const icon = cls ? \"\" : `style=\"background: ${iconUrl ? `url('${iconUrl}')` : \"none\"}; background-size: contain;\"`;\r\n        return `<a class=\"btnv6_blue_hoverfade btn_medium es_app_btn ${cls || \"\"}\" target=\"_blank\" href=\"${url}\">\r\n                    <span><i class=\"ico16\" ${icon}></i>&nbsp;&nbsp; ${str}</span>\r\n                </a>`;\r\n    }\r\n\r\n    _moveExtraLinks() {\r\n\r\n        const usefulLinks = this._node;\r\n        usefulLinks.classList.add(\"es_useful_link\");\r\n\r\n        const sideDetails = document.querySelector(\".es_side_details_wrap\");\r\n        if (sideDetails) {\r\n            sideDetails.insertAdjacentElement(\"afterend\", usefulLinks);\r\n        } else {\r\n            document.querySelector(\"div.rightcol.game_meta_data\").insertAdjacentElement(\"afterbegin\", usefulLinks);\r\n        }\r\n    }\r\n}\r\n","import {ContextType, Feature} from \"../../../modulesContent\";\r\n\r\nimport {HTML} from \"../../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\n\r\nexport default class FDRMWarnings extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        if (!SyncedStorage.get(\"showdrm\")) { return false; }\r\n\r\n        // Prevent false-positives\r\n        return !this.context.type === ContextType.APP || (\r\n            this.context.appid !== 21690 // Resident Evil 5, at Capcom's request\r\n            && this.context.appid !== 1157970 // Special K\r\n        );\r\n    }\r\n\r\n    apply() {\r\n\r\n        let text = \"\";\r\n        for (const node of document.querySelectorAll(\".game_area_sys_req, #game_area_legal, .game_details, .DRM_notice\")) {\r\n            text += node.textContent.toLowerCase();\r\n        }\r\n\r\n        // Games for Windows Live detection\r\n        const gfwl\r\n                = text.includes(\"games for windows live\")\r\n            || text.includes(\"games for windows - live\")\r\n            || text.includes(\"online play requires log-in to games for windows\")\r\n            || text.includes(\"installation of the games for windows live software\")\r\n            || text.includes(\"multiplayer play and other live features included at no charge\")\r\n            || text.includes(\"www.gamesforwindows.com/live\");\r\n\r\n        // Ubisoft Uplay detection\r\n        const uplay\r\n                = text.includes(\"uplay\")\r\n            || text.includes(\"ubisoft account\");\r\n\r\n        // Securom detection\r\n        const securom = text.includes(\"securom\");\r\n\r\n        // Tages detection\r\n        const tages\r\n                = text.match(/\\b(tages|solidshield)\\b/)\r\n            && !text.match(/angebote des tages/);\r\n\r\n        // Stardock account detection\r\n        const stardock = text.includes(\"stardock account\");\r\n\r\n        // Rockstar social club detection\r\n        const rockstar\r\n                = text.includes(\"rockstar social club\")\r\n            || text.includes(\"rockstar games social club\");\r\n\r\n        // Kalypso Launcher detection\r\n        const kalypso = text.includes(\"requires a kalypso account\");\r\n\r\n        // Denuvo Antitamper detection\r\n        const denuvo = text.includes(\"denuvo\");\r\n\r\n        // EA origin detection\r\n        const origin = text.includes(\"origin client\");\r\n\r\n        // Microsoft Xbox Live account detection\r\n        const xbox = text.includes(\"xbox live\");\r\n\r\n        const drmNames = [\r\n            [gfwl, \"Games for Windows Live\"],\r\n            [uplay, \"Ubisoft Uplay\"],\r\n            [securom, \"SecuROM\"],\r\n            [tages, \"Tages\"],\r\n            [stardock, \"Stardock Account Required\"],\r\n            [rockstar, \"Rockstar Social Club\"],\r\n            [kalypso, \"Kalypso Launcher\"],\r\n            [denuvo, \"Denuvo Anti-tamper\"],\r\n            [origin, \"EA Origin\"],\r\n            [xbox, \"Microsoft Xbox Live\"],\r\n        ].filter(([enabled]) => enabled)\r\n            .map(([, name]) => name);\r\n\r\n        let drmString;\r\n        if (drmNames.length > 0) {\r\n            drmString = this.context.type === ContextType.APP\r\n                ? Localization.str.drm_third_party\r\n                : Localization.str.drm_third_party_sub;\r\n\r\n            drmString = drmString.replace(\"__drmlist__\", `(${drmNames.join(\", \")})`);\r\n\r\n        } else { // Detect other DRM\r\n            const regex = /\\b(drm|account|steam)\\b/i;\r\n            if (this.context.type === ContextType.APP) {\r\n                for (const node of document.querySelectorAll(\"#category_block > .DRM_notice\")) {\r\n                    const text = node.textContent;\r\n                    if (regex.test(text)) {\r\n                        drmString = text;\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n                const node = document.querySelector(\".game_details .details_block > p > b:last-of-type\");\r\n                const text = node.textContent + node.nextSibling.textContent;\r\n                if (regex.test(text)) {\r\n                    drmString = text;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (drmString) {\r\n            const node = document.querySelector(\"#game_area_purchase .game_area_description_bodylabel\");\r\n            if (node) {\r\n                HTML.afterEnd(node, `<div class=\"game_area_already_owned es_drm_warning\"><span>${drmString}</span></div>`);\r\n            } else {\r\n                HTML.afterBegin(\"#game_area_purchase\", `<div class=\"es_drm_warning\"><span>${drmString}</span></div>`);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {HTML, Localization, SyncedStorage} from \"../../../../modulesCore\";\r\nimport {Feature, Prices} from \"../../../modulesContent\";\r\n\r\nexport default class FITADPrices extends Feature {\r\n    checkPrerequisites() {\r\n        return SyncedStorage.get(\"showlowestprice\");\r\n    }\r\n\r\n    apply() {\r\n        const prices = new Prices();\r\n\r\n        prices.subids = this.context.getAllSubids();\r\n\r\n        prices.bundleids = [];\r\n        for (const node of document.querySelectorAll(\"[data-ds-bundleid]\")) {\r\n            prices.bundleids.push(node.dataset.dsBundleid);\r\n        }\r\n\r\n        prices.priceCallback = function(type, id, contentNode) {\r\n            let node;\r\n            let placement = \"afterbegin\";\r\n            if (type === \"sub\") {\r\n                node = document.querySelector(`input[name=subid][value=\"${id}\"]`).parentNode.parentNode.parentNode;\r\n            } else if (type === \"bundle\") {\r\n                node = document.querySelector(`.game_area_purchase_game_wrapper[data-ds-bundleid=\"${id}\"]`);\r\n                if (node) {\r\n\r\n                    // Move any \"Complete your Collection!\" banner out of the way\r\n                    const banner = node.querySelector(\".ds_completetheset\");\r\n                    const newParent = node.querySelector(\".game_area_purchase_game\");\r\n                    if (banner && newParent) {\r\n                        newParent.appendChild(banner);\r\n                    }\r\n                } else {\r\n                    node = document.querySelector(`.game_area_purchase_game[data-ds-bundleid=\"${id}\"]`);\r\n                    placement = \"beforebegin\";\r\n                }\r\n            }\r\n\r\n            node.insertAdjacentElement(placement, contentNode);\r\n        };\r\n\r\n        prices.bundleCallback = function(html) {\r\n\r\n            HTML.afterEnd(\"#game_area_purchase\",\r\n                `<h2 class=\"gradientbg es_bundle_info\">${Localization.str.bundle.header} <img src=\"//store.steampowered.com/public/images/v5/ico_external_link.gif\"></h2>\r\n                ${html}`);\r\n        };\r\n\r\n        prices.load();\r\n    }\r\n}\r\n","import {HTML} from \"../../../../Core/Html/Html\";\r\nimport {Localization} from \"../../../../Core/Localization/Localization\";\r\nimport {SyncedStorage} from \"../../../../Core/Storage/SyncedStorage\";\r\nimport {ContextType, CurrencyManager, Feature, Price, RequestData, User} from \"../../../modulesContent\";\r\n\r\nexport default class FRegionalPricing extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        const countries = SyncedStorage.get(\"regional_countries\");\r\n        return countries && countries.length > 0 && SyncedStorage.get(\"showregionalprice\") !== \"off\";\r\n    }\r\n\r\n    async apply() {\r\n        let type = \"unknown\";\r\n        const showRegionalPrice = SyncedStorage.get(\"showregionalprice\");\r\n        const countries = SyncedStorage.get(\"regional_countries\");\r\n        const localCountry = User.storeCountry.toLowerCase();\r\n\r\n        if (!countries.includes(localCountry)) {\r\n            countries.push(localCountry);\r\n        }\r\n\r\n        if (this.context.type === ContextType.APP) {\r\n            type = \"app\";\r\n        } else if (this.context.type === ContextType.SALE) {\r\n            type = \"sale\";\r\n        }\r\n\r\n        for (const subid of this.context.getAllSubids()) {\r\n\r\n            const prices = {};\r\n\r\n            await Promise.all(countries.map(async country => {\r\n                const result = await RequestData.getJson(\r\n                    `https://store.steampowered.com/api/packagedetails/?packageids=${subid}&cc=${country}`\r\n                );\r\n\r\n                if (!result || !result[subid] || !result[subid].success || !result[subid].data.price) { return; }\r\n                prices[country] = result[subid].data.price;\r\n            }));\r\n\r\n            const node = document.querySelector(`input[name=subid][value=\"${subid}\"]`)\r\n                .closest(\".game_area_purchase_game_wrapper,#game_area_purchase,.sale_page_purchase_item\")\r\n                .querySelector(\".game_purchase_action\");\r\n\r\n            const apiPrice = prices[User.storeCountry.toLowerCase()];\r\n\r\n            // For paid titles that have F2P versions with their own subid (see #894)\r\n            if (typeof apiPrice === \"undefined\") { continue; }\r\n\r\n            let priceLocal;\r\n            try {\r\n                priceLocal = new Price(apiPrice.final / 100, apiPrice.currency).inCurrency(CurrencyManager.customCurrency);\r\n            } catch (err) {\r\n                console.group(\"Regional pricing\");\r\n                console.error(err);\r\n                console.warn(\"Can't show relative price differences to any other currencies\");\r\n                console.groupEnd();\r\n            }\r\n\r\n            const pricingDiv = document.createElement(\"div\");\r\n            pricingDiv.classList.add(\"es_regional_container\");\r\n            pricingDiv.classList.add(`es_regional_${type}`);\r\n\r\n            if (showRegionalPrice === \"mouse\") {\r\n                HTML.afterBegin(pricingDiv, '<div class=\"es_regional_arrow\"></div>');\r\n            }\r\n\r\n            for (const country of countries) {\r\n                const apiPrice = prices[country];\r\n                let html = \"\";\r\n\r\n                if (apiPrice) {\r\n                    const priceRegion = new Price(apiPrice.final / 100, apiPrice.currency);\r\n                    let priceUser;\r\n                    try {\r\n                        priceUser = priceRegion.inCurrency(CurrencyManager.customCurrency);\r\n                    } catch (err) {\r\n                        console.group(\"Regional pricing\");\r\n                        console.error(err);\r\n                        console.warn(\r\n                            'Not able to show converted price and relative price differences for country code \"%s\"',\r\n                            country.toUpperCase()\r\n                        );\r\n                        console.groupEnd();\r\n                    }\r\n\r\n                    html = `<div class=\"es-regprice es-flag es-flag--${country}\">${priceRegion}`;\r\n\r\n                    if (priceLocal && priceUser) {\r\n                        let percentageIndicator = \"equal\";\r\n                        let percentage = (((priceUser.value / priceLocal.value) * 100) - 100).toFixed(2);\r\n\r\n                        if (percentage < 0) {\r\n                            percentage = Math.abs(percentage);\r\n                            percentageIndicator = \"lower\";\r\n                        } else if (percentage > 0) {\r\n                            percentageIndicator = \"higher\";\r\n                        }\r\n\r\n                        html\r\n                            += `<span class=\"es-regprice__converted\">${priceUser}</span>\r\n                                <span class=\"es-regprice__perc es-regprice__perc--${percentageIndicator}\">${percentage}%</span>`;\r\n                    }\r\n\r\n                    html += \"</div>\";\r\n                } else {\r\n                    html\r\n                        = ` <div class=\"es-regprice es-flag es-flag--${country}\">\r\n                                <span class=\"es-regprice__none\">${Localization.str.region_unavailable}</span>\r\n                            </div>`;\r\n                }\r\n\r\n                HTML.beforeEnd(pricingDiv, html);\r\n            }\r\n\r\n            const purchaseArea = node.closest(\".game_area_purchase_game,.sale_page_purchase_item\");\r\n            purchaseArea.classList.add(\"es_regional_prices\");\r\n\r\n            if (showRegionalPrice === \"always\") {\r\n                node.insertAdjacentElement(\"beforebegin\", pricingDiv);\r\n                purchaseArea.classList.add(\"es_regional_always\");\r\n            } else {\r\n                const priceNode = node.querySelector(\".price,.discount_prices\");\r\n                priceNode.insertAdjacentElement(\"beforeend\", pricingDiv);\r\n                priceNode.classList.add(\"es_regional_onmouse\");\r\n\r\n                if (!SyncedStorage.get(\"regional_hideworld\")) {\r\n                    priceNode.classList.add(\"es_regional_icon\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","\r\nimport {HTML, Localization, TimeUtils} from \"../../../../modulesCore\";\r\nimport {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {DOMHelper} from \"../../../Modules/DOMHelper\";\r\nimport {Price} from \"../../../Modules/Price\";\r\n\r\nexport default class FSavingsCheck extends Feature {\r\n\r\n    async apply() {\r\n\r\n        // why is this here?\r\n        await TimeUtils.timer(500);\r\n\r\n        let notOwnedTotalPrice = 0;\r\n\r\n        for (const node of document.querySelectorAll(\".tab_item:not(.ds_owned)\")) {\r\n            const priceNode = node.querySelector(\".discount_final_price\");\r\n\r\n            // Only present when the product has a price associated with (so it's not free or N/A)\r\n            if (priceNode) {\r\n                const priceContainer = priceNode.textContent.trim();\r\n                if (priceContainer) {\r\n                    const price = Price.parseFromString(priceContainer);\r\n                    if (price) {\r\n                        notOwnedTotalPrice += price.value;\r\n                        continue;\r\n                    }\r\n                }\r\n            } else {\r\n                const finalPrice = node.querySelector(\".final_price\");\r\n                if (finalPrice) {\r\n                    if (finalPrice.textContent === \"N/A\") {\r\n                        notOwnedTotalPrice = null;\r\n                        break;\r\n                    }\r\n                }\r\n                continue;\r\n            }\r\n            console.warn(\"Couldn't find any price information for appid\", node.dataset.dsAppid);\r\n        }\r\n\r\n        if (notOwnedTotalPrice !== null) {\r\n            const priceNode = DOMHelper.selectLastNode(document, \".package_totals_area .price\");\r\n            const packagePrice = Price.parseFromString(priceNode.textContent);\r\n            if (!packagePrice) { return; }\r\n\r\n            notOwnedTotalPrice -= packagePrice.value;\r\n            notOwnedTotalPrice = new Price(notOwnedTotalPrice);\r\n\r\n            if (!document.querySelector(\"#package_savings_bar\")) {\r\n                HTML.beforeEnd(\".package_totals_area\",\r\n                    `<div id=\"package_savings_bar\">\r\n                        <div class=\"savings\"></div>\r\n                        <div class=\"message\">${Localization.str.bundle_saving_text}</div>\r\n                    </div>`);\r\n            }\r\n\r\n            const savingsNode = document.querySelector(\"#package_savings_bar > .savings\");\r\n            savingsNode.textContent = notOwnedTotalPrice;\r\n            if (notOwnedTotalPrice.value < 0) {\r\n                savingsNode.style.color = \"red\";\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {StorePage} from \"../../StorePage\";\r\nimport {CSub} from \"./CSub\";\r\n\r\n(new StorePage()).run(CSub);\r\n\r\n","import {Page} from \"./Page\";\r\n\r\nclass StorePage extends Page {}\r\n\r\nexport {StorePage};\r\n","import ContextType from \"../../../Modules/Context/ContextType\";\r\nimport {GameId} from \"../../../../Core/GameId\";\r\nimport {CStore} from \"../Common/CStore\";\r\nimport FExtraLinks from \"../Common/FExtraLinks\";\r\nimport FDRMWarnings from \"../Common/FDRMWarnings\";\r\nimport FITADPrices from \"../Common/FITADPrices\";\r\nimport FRegionalPricing from \"../Common/FRegionalPricing\";\r\nimport FSavingsCheck from \"./FSavingsCheck\";\r\n\r\nexport class CSub extends CStore {\r\n\r\n    constructor() {\r\n\r\n        super(ContextType.SUB, [\r\n            FExtraLinks,\r\n            FDRMWarnings,\r\n            FITADPrices,\r\n            FRegionalPricing,\r\n            FSavingsCheck,\r\n        ]);\r\n\r\n        this.subid = GameId.getSubid(window.location.host + window.location.pathname);\r\n    }\r\n}\r\n","import {CStoreBase} from \"./CStoreBase\";\r\n\r\nexport class CStore extends CStoreBase {\r\n\r\n    getAllSubids() {\r\n        const result = [];\r\n        for (const node of document.querySelectorAll(\"input[name=subid]\")) {\r\n            if (node.value) {\r\n                result.push(node.value);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}\r\n","import {Context, ContextType, EarlyAccess} from \"../../../modulesContent\";\r\nimport FHighlightsTags from \"../../Common/FHighlightsTags\";\r\nimport FHideTrademarks from \"../../Common/FHideTrademarks\";\r\nimport FAlternativeLinuxIcon from \"./FAlternativeLinuxIcon\";\r\n\r\nexport class CStoreBase extends Context {\r\n\r\n    constructor(type = ContextType.STORE_DEFAULT, features = []) {\r\n\r\n        // TODO Split this up into the relevant contexts\r\n        features.push(\r\n            FHighlightsTags,\r\n            FAlternativeLinuxIcon,\r\n            FHideTrademarks,\r\n        );\r\n\r\n        super(type, features);\r\n\r\n        this._observeChanges();\r\n    }\r\n\r\n    _observeChanges() {\r\n\r\n        const tabAreaNodes = document.querySelectorAll(\".tag_browse_ctn, .tabarea, .browse_ctn_background\");\r\n        if (!tabAreaNodes) { return; }\r\n\r\n        const observer = new MutationObserver(() => {\r\n            FHighlightsTags.highlightAndTag();\r\n            EarlyAccess.showEarlyAccess();\r\n        });\r\n\r\n        tabAreaNodes.forEach(tabAreaNode => observer.observe(tabAreaNode, {\"childList\": true, \"subtree\": true}));\r\n    }\r\n}\r\n","import {FeatureManager} from \"../Feature/FeatureManager\";\r\n\r\nclass Context {\r\n\r\n    constructor(type, features) {\r\n        this._callbacks = [];\r\n        this.type = type;\r\n        this.features = features.map(Ref => new Ref(this));\r\n    }\r\n\r\n    applyFeatures() {\r\n        return FeatureManager.apply(this.features);\r\n    }\r\n\r\n    registerCallback(fn) {\r\n        this._callbacks.push(fn);\r\n    }\r\n\r\n    triggerCallbacks(...params) {\r\n        for (const callback of this._callbacks) {\r\n            callback(...params);\r\n        }\r\n    }\r\n}\r\n\r\nexport {Context};\r\n"],"sourceRoot":""}