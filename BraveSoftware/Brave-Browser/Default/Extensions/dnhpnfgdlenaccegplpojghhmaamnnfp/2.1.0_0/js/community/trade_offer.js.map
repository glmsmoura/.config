{"version":3,"sources":["webpack:///./src/js/Core/Errors/Errors.js","webpack:///./src/js/Content/Modules/Feature/FeatureManager.js","webpack:///./src/js/Content/Modules/Context/ContextType.js","webpack:///./src/js/Content/Modules/Feature/Feature.js","webpack:///./src/js/Core/Html/Html.js","webpack:///./src/js/Core/Storage/CookieStorage.js","webpack:///./src/js/Core/Environment.js","webpack:///./src/js/Core/Localization/Language.js","webpack:///./src/js/Core/ExtensionResources.js","webpack:///./src/js/Core/Info.js","webpack:///./src/js/Core/Storage/SyncedStorage.js","webpack:///./src/js/Core/Localization/Localization.js","webpack:///./src/js/Core/BackgroundSimple.js","webpack:///./src/js/Core/Permissions.js","webpack:///./src/js/Content/Features/Community/TradeOffer/FCountTradeItems.js","webpack:///./src/js/Content/Features/Community/TradeOffer/FMyTradeOffersLink.js","webpack:///./src/js/Content/Features/Community/TradeOffer/CTradeOffer.js","webpack:///./src/js/Content/Modules/Context/Context.js","webpack:///./src/js/Content/Features/Community/TradeOffer/PTradeOffer.js"],"names":["LoginError","Error","type","super","this","name","ServerOutageError","msg","HTTPError","code","message","FeatureDependencyError","featureName","Errors","Promise","allSettled","promises","all","map","promise","then","value","catch","reason","Object","freeze","Feature","context","err","args","console","group","constructor","error","groupEnd","str","replace","m","html","template","document","createElement","innerHTML","DOMPurify","sanitize","content","fragment","firstElementChild","node","_node","warn","querySelector","Element","_getNode","outerHTML","wrapper","element","replaceWith","append","position","insertAdjacentHTML","adjacent","CookieStorage","defaultValue","_name","trim","cache","has","get","val","ttl","_val","set","encodeURIComponent","cookie","delete","Map","key","split","kv","decodeURIComponent","init","currentContext","browser","extension","getBackgroundPage","bgPage","window","BACKGROUND","OPTIONS","CONTENT_SCRIPT","Language","_currentSteamLanguage","script","querySelectorAll","language","URL","src","searchParams","isContentScript","languages","array","includes","getCurrentSteamLanguage","ExtensionResources","pathname","runtime","getURL","fetch","r","json","text","getManifest","version","prototype","hasOwnProperty","call","_cache","defaults","_adapter","entries","remove","prefix","keys","filter","k","startsWith","force","tmp","persistent","reduce","acc","option","clear","import","storage","onChanged","addListener","changes","assign","onDone","onCatch","JSON","stringify","QUOTA_BYTES_PER_ITEM","sync","local","Localization","getJSON","_promise","currentSteamLanguage","storedSteamLanguage","deepAssign","target","source","sendMessage","requested","params","length","action","getLanguageCode","codes","push","lc","loadLocalization","english","path","reverse","current","pop","FCountTradeItems","parentNode","MutationObserver","mutations","mutation","addedNodes","classList","contains","yourItemsCountNode","theirItemsCountNode","yourItems","tradeoffer","num_item","num_items","textContent","style","display","theirItems","className","add","observe","FMyTradeOffersLink","_linksNode","back","CTradeOffer","features","_callbacks","Ref","_promisesMap","_stats","feature","_generateFeatureChain","unshift","Array","from","values","log","completed","failed","dependency","ready","resolve","isArray","dependencies","dep","ftr","previousCheck","prev","weakDependency","every","res","checkPrerequisites","async","fulfilled","apply","fn","callback","ContextType","TRADE_OFFER","applyFeatures"],"mappings":"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","file":"js/community/trade_offer.js","sourcesContent":["\r\nclass LoginError extends Error {\r\n    constructor(type) {\r\n        super(type);\r\n        this.name = \"LoginError\";\r\n    }\r\n}\r\n\r\nclass ServerOutageError extends Error {\r\n    constructor(msg) {\r\n        super(msg);\r\n        this.name = \"ServerOutageError\";\r\n    }\r\n}\r\n\r\nclass HTTPError extends Error {\r\n    constructor(code, message) {\r\n        super(message);\r\n        this.code = code;\r\n    }\r\n}\r\n\r\n\r\nclass FeatureDependencyError extends Error {\r\n    constructor(msg, featureName) {\r\n        super(msg);\r\n        this.featureName = featureName;\r\n    }\r\n}\r\n\r\nconst Errors = {\r\n    \"LoginError\": LoginError,\r\n    \"ServerOutageError\": ServerOutageError,\r\n    \"HTTPError\": HTTPError,\r\n    \"FeatureDependencyError\": FeatureDependencyError\r\n};\r\n\r\nexport {Errors};\r\n","import {Errors} from \"../../../Core/Errors/Errors\";\r\n\r\n// Polyfill from https://gist.github.com/davidbarral/d0d4da70fa9e6f615595d01f54276e0b#file-promises-js\r\nif (!Promise.allSettled) {\r\n    Promise.allSettled = promises => Promise.all(\r\n        promises.map(promise => promise\r\n            .then(value => ({\r\n                \"status\": \"fulfilled\",\r\n                value,\r\n            }))\r\n            .catch(reason => ({\r\n                \"status\": \"rejected\",\r\n                reason,\r\n            })))\r\n    );\r\n}\r\n\r\nclass FeatureManager {\r\n    static async apply(features) {\r\n\r\n        this._promisesMap = new Map();\r\n\r\n        this._stats = {\r\n            \"completed\": 0,\r\n            \"failed\": 0,\r\n            \"dependency\": 0,\r\n        };\r\n\r\n        while (features.length > 0) {\r\n\r\n            const feature = features.pop();\r\n            const promise = this._generateFeatureChain(feature);\r\n\r\n            if (promise === null) {\r\n                features.unshift(feature);\r\n            } else {\r\n                this._promisesMap.set(feature.constructor, promise);\r\n            }\r\n        }\r\n\r\n        await Promise.allSettled(Array.from(this._promisesMap.values()));\r\n\r\n        console.log(\r\n            \"Feature loading complete, %i successfully loaded, %i failed to load, %i didn't load due to dependency errors\",\r\n            this._stats.completed,\r\n            this._stats.failed,\r\n            this._stats.dependency\r\n        );\r\n    }\r\n\r\n    static _generateFeatureChain(feature) {\r\n\r\n        let ready = true;\r\n        let promise = Promise.resolve(true);\r\n\r\n        if (Array.isArray(feature.constructor.dependencies)) {\r\n\r\n            // Ensure that all dependencies have generated a dependency chain for themselves\r\n            for (const dep of feature.constructor.dependencies) {\r\n                if (this._promisesMap.has(dep)) { continue; }\r\n\r\n                ready = false;\r\n                break;\r\n            }\r\n\r\n            if (ready) {\r\n\r\n                // Promise that waits for all dependencies to finish executing\r\n                promise = Promise.all(\r\n                    Array.from(this._promisesMap.entries())\r\n                        .filter(([ftr]) => feature.constructor.dependencies.includes(ftr))\r\n                        .map(([, promise]) => promise)\r\n                );\r\n            }\r\n        }\r\n\r\n        if (!ready) { return null; }\r\n\r\n        return promise\r\n            .then(previousCheck => { // Check if the dependencies have all their prerequisites fulfilled\r\n                let prev = true;\r\n\r\n                if (!feature.constructor.weakDependency) {\r\n                    if (Array.isArray(previousCheck)) {\r\n                        prev = previousCheck.every(res => res);\r\n                    } else {\r\n                        prev = previousCheck;\r\n                    }\r\n                }\r\n\r\n                return prev && feature.checkPrerequisites();\r\n            })\r\n            .then(async fulfilled => { // If the feature's prerequisites are fulfilled, apply it\r\n                if (fulfilled) {\r\n                    await feature.apply();\r\n                    ++this._stats.completed;\r\n                }\r\n                return fulfilled;\r\n            })\r\n            .catch(err => {\r\n\r\n                const featureName = feature.constructor.name;\r\n\r\n                if (err instanceof Errors.FeatureDependencyError) {\r\n                    console.warn(\r\n                        \"Not applying feature %s due to an error in the dependency chain (namely %s)\",\r\n                        featureName,\r\n                        err.featureName\r\n                    );\r\n                    ++this._stats.dependency;\r\n                    throw err;\r\n                }\r\n\r\n                console.group(featureName);\r\n                console.error(\"Error while applying feature %s\", featureName);\r\n                console.error(err);\r\n                console.groupEnd();\r\n\r\n                ++this._stats.failed;\r\n                throw new Errors.FeatureDependencyError(\"Failed to apply\", featureName);\r\n            });\r\n\r\n    }\r\n}\r\n\r\nexport {FeatureManager};\r\n","\r\nexport default Object.freeze({\r\n    \"ACCOUNT\": 1,\r\n    \"APP\": 2,\r\n    \"BUNDLE\": 3,\r\n    \"STORE_DEFAULT\": 4,\r\n    \"FUNDS\": 5,\r\n    \"REGISTER_KEY\": 6,\r\n    \"SALE\": 7,\r\n    \"SEARCH\": 8,\r\n    \"STATS\": 9,\r\n    \"STORE_FRONT\": 10,\r\n    \"SUB\": 11,\r\n    \"WISHLIST\": 12,\r\n    \"AGECHECK\": 13,\r\n    \"COMMUNITY_DEFAULT\": 14,\r\n    \"WORKSHOP\": 15,\r\n    \"PROFILE_ACTIVITY\": 16,\r\n    \"GAMES\": 17,\r\n    \"PROFILE_EDIT\": 18,\r\n    \"BADGES\": 19,\r\n    \"GAME_CARD\": 20,\r\n    \"FRIENDS_THAT_PLAY\": 21,\r\n    \"FRIENDS\": 22,\r\n    \"GROUPS\": 23,\r\n    \"INVENTORY\": 24,\r\n    \"MARKET_LISTING\": 25,\r\n    \"MARKET\": 26,\r\n    \"PROFILE_HOME\": 27,\r\n    \"GROUP_HOME\": 28,\r\n    \"GUIDES\": 29,\r\n    \"COMMUNITY_APP\": 30,\r\n    \"COMMUNITY_STATS\": 31,\r\n    \"MY_WORKSHOP\": 32,\r\n    \"SHARED_FILES\": 33,\r\n    \"WORKSHOP_BROWSE\": 34,\r\n    \"EDIT_GUIDE\": 35,\r\n    \"RECOMMENDED\": 36,\r\n    \"BOOSTER_CREATOR\": 37,\r\n    \"TRADE_OFFER\": 38,\r\n});\r\n\r\n","\r\nclass Feature {\r\n\r\n    /**\r\n     * @param {Context} context\r\n     */\r\n    constructor(context) {\r\n        this.context = context;\r\n    }\r\n\r\n    checkPrerequisites() {\r\n        return true;\r\n    }\r\n\r\n    apply() {\r\n        throw new Error(\"Stub\");\r\n    }\r\n\r\n    logError(err, msg, ...args) {\r\n        console.group(this.constructor.name);\r\n        console.error(msg, ...args);\r\n        console.error(err);\r\n        console.groupEnd();\r\n    }\r\n}\r\n\r\nexport {Feature};\r\n","\r\nclass HTML {\r\n\r\n    static escape(str) {\r\n\r\n        // @see https://stackoverflow.com/a/4835406\r\n        const map = {\r\n            \"&\": \"&amp;\",\r\n            \"<\": \"&lt;\",\r\n            \">\": \"&gt;\",\r\n            '\"': \"&quot;\",\r\n            \"'\": \"&#039;\"\r\n        };\r\n\r\n        return str.replace(/[&<>\"']/g, (m) => { return map[m]; });\r\n    }\r\n\r\n    static fragment(html) {\r\n        const template = document.createElement(\"template\");\r\n        template.innerHTML = DOMPurify.sanitize(html);\r\n        return template.content;\r\n    }\r\n\r\n    static element(html) {\r\n        return HTML.fragment(html).firstElementChild;\r\n    }\r\n\r\n    static _getNode(node) {\r\n        let _node = node;\r\n\r\n        if (typeof _node == \"undefined\" || _node === null) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n        if (typeof _node == \"string\") {\r\n            _node = document.querySelector(_node);\r\n        }\r\n        if (!(_node instanceof Element)) {\r\n            console.warn(`${_node} is not an Element.`);\r\n            return null;\r\n        }\r\n\r\n        return _node;\r\n    }\r\n\r\n    static inner(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.innerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static replace(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.outerHTML = DOMPurify.sanitize(html);\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static wrap(node, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            const wrapper = HTML.element(html);\r\n            _node.replaceWith(wrapper);\r\n            wrapper.append(_node);\r\n            return wrapper;\r\n        } else {\r\n            return _node;\r\n        }\r\n    }\r\n\r\n    static adjacent(node, position, html) {\r\n        const _node = HTML._getNode(node);\r\n\r\n        if (_node) {\r\n            _node.insertAdjacentHTML(position, DOMPurify.sanitize(html));\r\n        }\r\n        return _node;\r\n    }\r\n\r\n    static beforeBegin(node, html) {\r\n        HTML.adjacent(node, \"beforebegin\", html);\r\n    }\r\n\r\n    static afterBegin(node, html) {\r\n        HTML.adjacent(node, \"afterbegin\", html);\r\n    }\r\n\r\n    static beforeEnd(node, html) {\r\n        HTML.adjacent(node, \"beforeend\", html);\r\n    }\r\n\r\n    static afterEnd(node, html) {\r\n        HTML.adjacent(node, \"afterend\", html);\r\n    }\r\n}\r\n\r\nexport {HTML};\r\n","\r\nclass CookieStorage {\r\n\r\n    static get(name, defaultValue) {\r\n        const _name = name.trim();\r\n\r\n        if (!CookieStorage.cache.has(_name)) {\r\n            return defaultValue;\r\n        }\r\n        return CookieStorage.cache.get(_name);\r\n    }\r\n\r\n    static set(name, val, ttl = 60 * 60 * 24 * 365) {\r\n        let _name = name.trim();\r\n        let _val = val.trim();\r\n\r\n        CookieStorage.cache.set(_name, _val);\r\n\r\n        _name = encodeURIComponent(_name);\r\n        _val = encodeURIComponent(_val);\r\n        document.cookie = `${_name}=${_val}; max-age=${ttl}`;\r\n    }\r\n\r\n    static remove(name) {\r\n        let _name = name.trim();\r\n        CookieStorage.cache.delete(_name);\r\n        _name = encodeURIComponent(_name);\r\n        document.cookie = `${_name}; expires=Thu, 01 Jan 1970 00:00:00 GMT`;\r\n    }\r\n\r\n    static init() {\r\n        CookieStorage.cache = new Map();\r\n        for (let [key, val] of document.cookie.split(\";\").map(kv => kv.split(\"=\"))) {\r\n            key = key.trim();\r\n            CookieStorage.cache.set(key, decodeURIComponent(val));\r\n        }\r\n    }\r\n}\r\n\r\nCookieStorage.init();\r\n\r\nexport {CookieStorage};\r\n","\r\nconst ContextType = Object.freeze({\r\n    \"BACKGROUND\": 1,\r\n    \"CONTENT_SCRIPT\": 2,\r\n    \"OPTIONS\": 3,\r\n});\r\n\r\nlet currentContext;\r\nif (browser.extension.getBackgroundPage) {\r\n    const bgPage = browser.extension.getBackgroundPage();\r\n\r\n    currentContext = (bgPage === window)\r\n        ? ContextType.BACKGROUND\r\n        : ContextType.OPTIONS;\r\n} else {\r\n    currentContext = ContextType.CONTENT_SCRIPT;\r\n}\r\n\r\nclass Environment {\r\n\r\n    static isBackgroundScript() {\r\n        return currentContext === ContextType.BACKGROUND;\r\n    }\r\n\r\n    static isContentScript() {\r\n        return currentContext === ContextType.CONTENT_SCRIPT;\r\n    }\r\n\r\n    static isOptions() {\r\n        return currentContext === ContextType.OPTIONS;\r\n    }\r\n}\r\n\r\nexport {Environment};\r\n","import {CookieStorage} from \"../Storage/CookieStorage\";\r\nimport {Environment} from \"../Environment\";\r\n\r\nclass Language {\r\n\r\n    static getCurrentSteamLanguage() {\r\n        if (this._currentSteamLanguage !== null) {\r\n            return this._currentSteamLanguage;\r\n        }\r\n\r\n        for (const script of document.querySelectorAll(\"script[src]\")) {\r\n            const language = new URL(script.src).searchParams.get(\"l\");\r\n            if (language) {\r\n                Language._currentSteamLanguage = language;\r\n                return this._currentSteamLanguage;\r\n            }\r\n        }\r\n\r\n        // In a Content Context, we can check for a cookie\r\n        if (Environment.isContentScript()) {\r\n            Language._currentSteamLanguage = CookieStorage.get(\"Steam_Language\") || null;\r\n        }\r\n\r\n        return this._currentSteamLanguage;\r\n    }\r\n\r\n    static getLanguageCode(language) {\r\n        const code = Language.languages[language];\r\n        return code || \"en\";\r\n    }\r\n\r\n    static isCurrentLanguageOneOf(array) {\r\n        return array.includes(Language.getCurrentSteamLanguage());\r\n    }\r\n}\r\n\r\nLanguage._currentSteamLanguage = null;\r\nLanguage.languages = {\r\n    \"english\": \"en\",\r\n    \"bulgarian\": \"bg\",\r\n    \"czech\": \"cs\",\r\n    \"danish\": \"da\",\r\n    \"dutch\": \"nl\",\r\n    \"finnish\": \"fi\",\r\n    \"french\": \"fr\",\r\n    \"greek\": \"el\",\r\n    \"german\": \"de\",\r\n    \"hungarian\": \"hu\",\r\n    \"italian\": \"it\",\r\n    \"japanese\": \"ja\",\r\n    \"koreana\": \"ko\",\r\n    \"norwegian\": \"no\",\r\n    \"polish\": \"pl\",\r\n    \"portuguese\": \"pt-PT\",\r\n    \"brazilian\": \"pt-BR\",\r\n    \"russian\": \"ru\",\r\n    \"romanian\": \"ro\",\r\n    \"schinese\": \"zh-CN\",\r\n    \"spanish\": \"es-ES\",\r\n    \"latam\": \"es-419\",\r\n    \"swedish\": \"sv-SE\",\r\n    \"tchinese\": \"zh-TW\",\r\n    \"thai\": \"th\",\r\n    \"turkish\": \"tr\",\r\n    \"ukrainian\": \"ua\",\r\n    \"vietnamese\": \"vi\",\r\n};\r\n\r\nexport {Language};\r\n","\r\nclass ExtensionResources {\r\n\r\n    static getURL(pathname) {\r\n        return browser.runtime.getURL(pathname);\r\n    }\r\n\r\n    static get(pathname) {\r\n        return fetch(ExtensionResources.getURL(pathname));\r\n    }\r\n\r\n    static getJSON(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.json());\r\n    }\r\n\r\n    static getText(pathname) {\r\n        return ExtensionResources.get(pathname).then(r => r.text());\r\n    }\r\n}\r\n\r\nexport {ExtensionResources};\r\n","\r\nconst Info = {\r\n    \"version\": browser.runtime.getManifest().version,\r\n    \"db_version\": 3,\r\n};\r\n\r\nexport {Info};\r\n","import {Info} from \"../Info\";\r\n\r\nclass SyncedStorage {\r\n\r\n    /*\r\n     * browser.storage.sync limits\r\n     * QUOTA_BYTES = 102400 // 100KB\r\n     * QUOTA_BYTES_PER_ITEM = 8192 // 8KB\r\n     * MAX_ITEMS = 512\r\n     * MAX_WRITE_OPERATIONS_PER_HOUR = 1800\r\n     * MAX_WRITE_OPERATIONS_PER_MINUTE = 120\r\n     */\r\n    static has(key) {\r\n        return Object.prototype.hasOwnProperty.call(this._cache, key);\r\n    }\r\n\r\n    static get(key) {\r\n        if (typeof this._cache[key] == \"undefined\") {\r\n            if (typeof this.defaults[key] == \"undefined\") {\r\n                console.warn(`Unrecognized SyncedStorage key \"${key}\"`);\r\n            }\r\n            return this.defaults[key];\r\n        }\r\n        return this._cache[key];\r\n    }\r\n\r\n    static set(key, value) {\r\n        this._cache[key] = value;\r\n        return this._adapter.set({[key]: value});\r\n\r\n        // this will throw if MAX_WRITE_*, MAX_ITEMS, QUOTA_BYTES* are exceeded\r\n    }\r\n\r\n    static import(entries) {\r\n        for (const [key, value] of Object.entries(entries)) {\r\n            this._cache[key] = value;\r\n        }\r\n        return this._adapter.set(entries);\r\n    }\r\n\r\n    static remove(key) {\r\n        if (typeof this._cache[key] !== \"undefined\") {\r\n            delete this._cache[key];\r\n        }\r\n        return this._adapter.remove(key);\r\n\r\n        // can throw if MAX_WRITE* is exceeded\r\n    }\r\n\r\n    static keys(prefix = \"\") {\r\n        return Object.keys(this._cache).filter(k => k.startsWith(prefix));\r\n    }\r\n\r\n    static entries() {\r\n        return Object.entries(this._cache);\r\n    }\r\n\r\n    static async clear(force = false) {\r\n\r\n        let tmp;\r\n        if (force) {\r\n            this._cache = {};\r\n        } else {\r\n            tmp = this.persistent.reduce((acc, option) => {\r\n                acc[option] = this._cache[option];\r\n                return acc;\r\n            }, {});\r\n        }\r\n\r\n        // can throw if MAX_WRITE* is exceeded\r\n        await this._adapter.clear();\r\n\r\n        if (!force) {\r\n            await this.import(tmp);\r\n        }\r\n    }\r\n\r\n    // load whole storage and make local copy\r\n    static async init() {\r\n        browser.storage.onChanged.addListener(changes => {\r\n            for (const [key, {\"newValue\": val}] of Object.entries(changes)) {\r\n                this._cache[key] = val;\r\n            }\r\n        });\r\n\r\n        const storage = await this._adapter.get(null);\r\n        Object.assign(this._cache, storage);\r\n\r\n        return this._cache;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return this.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static toJson() {\r\n        return JSON.stringify(this._cache);\r\n    }\r\n}\r\n\r\nSyncedStorage.QUOTA_BYTES_PER_ITEM = 8192;\r\n\r\nSyncedStorage._adapter = browser.storage.sync || browser.storage.local;\r\nSyncedStorage._cache = {};\r\nSyncedStorage.defaults = Object.freeze({\r\n    \"language\": \"english\",\r\n\r\n    \"version\": Info.version,\r\n    \"version_show\": true,\r\n\r\n    \"highlight_owned_color\": \"#00ce67\",\r\n    \"highlight_wishlist_color\": \"#0491bf\",\r\n    \"highlight_coupon_color\": \"#a26426\",\r\n    \"highlight_inv_gift_color\": \"#800040\",\r\n    \"highlight_inv_guestpass_color\": \"#513c73\",\r\n    \"highlight_notinterested_color\": \"#4f4f4f\",\r\n    \"highlight_collection_color\": \"#856d0e\",\r\n    \"highlight_waitlist_color\": \"#4c7521\",\r\n\r\n    \"tag_owned_color\": \"#00b75b\",\r\n    \"tag_wishlist_color\": \"#0383b4\",\r\n    \"tag_coupon_color\": \"#c27120\",\r\n    \"tag_inv_gift_color\": \"#b10059\",\r\n    \"tag_inv_guestpass_color\": \"#65449a\",\r\n    \"tag_notinterested_color\": \"#4f4f4f\",\r\n    \"tag_collection_color\": \"#856d0e\",\r\n    \"tag_waitlist_color\": \"#4c7521\",\r\n\r\n    \"highlight_owned\": true,\r\n    \"highlight_wishlist\": true,\r\n    \"highlight_coupon\": false,\r\n    \"highlight_inv_gift\": false,\r\n    \"highlight_inv_guestpass\": false,\r\n    \"highlight_notinterested\": false,\r\n    \"highlight_excludef2p\": false,\r\n    \"highlight_collection\": true,\r\n    \"highlight_waitlist\": true,\r\n\r\n    \"tag_owned\": false,\r\n    \"tag_wishlist\": false,\r\n    \"tag_coupon\": false,\r\n    \"tag_inv_gift\": false,\r\n    \"tag_inv_guestpass\": false,\r\n    \"tag_notinterested\": true,\r\n    \"tag_collection\": false,\r\n    \"tag_waitlist\": false,\r\n    \"tag_short\": false,\r\n\r\n    \"hidetmsymbols\": false,\r\n\r\n    \"showlowestprice\": true,\r\n    \"showlowestprice_onwishlist\": true,\r\n    \"showlowestpricecoupon\": true,\r\n    \"showallstores\": true,\r\n    \"stores\": [],\r\n    \"override_price\": \"auto\",\r\n    \"showregionalprice\": \"mouse\",\r\n    \"regional_countries\": [\"us\", \"gb\", \"ru\", \"br\", \"au\", \"jp\"],\r\n\r\n    \"show_es_homepagetabs\": true,\r\n    \"showmarkettotal\": false,\r\n    \"showsteamrepapi\": true,\r\n    \"showmcus\": true,\r\n    \"showoc\": true,\r\n    \"showhltb\": true,\r\n    \"showyoutube\": true,\r\n    \"showtwitch\": true,\r\n    \"showpcgw\": true,\r\n    \"showcompletionistme\": false,\r\n    \"showprotondb\": false,\r\n    \"showviewinlibrary\": false,\r\n    \"showsteamcardexchange\": false,\r\n    \"showitadlinks\": true,\r\n    \"showsteamdb\": true,\r\n    \"showbartervg\": false,\r\n    \"showastatslink\": true,\r\n    \"showyoutubegameplay\": true,\r\n    \"showyoutubereviews\": true,\r\n    \"showwsgf\": true,\r\n    \"exfgls\": true,\r\n    \"app_custom_link\": [\r\n        {\r\n            \"enabled\": false,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]+[NAME]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n\r\n    \"customize_apppage\": {\r\n        \"recentupdates\": true,\r\n        \"reviews\": true,\r\n        \"about\": true,\r\n        \"contentwarning\": true,\r\n        \"steamchart\": true,\r\n        \"steamspy\": true,\r\n        \"surveys\": true,\r\n        \"sysreq\": true,\r\n        \"legal\": true,\r\n        \"morelikethis\": true,\r\n        \"recommendedbycurators\": true,\r\n        \"customerreviews\": true\r\n    },\r\n\r\n    \"customize_frontpage\": {\r\n        \"featuredrecommended\": true,\r\n        \"specialoffers\": true,\r\n        \"trendingamongfriends\": true,\r\n        \"discoveryqueue\": true,\r\n        \"browsesteam\": true,\r\n        \"curators\": true,\r\n        \"morecuratorrecommendations\": true,\r\n        \"recentlyupdated\": true,\r\n        \"fromdevelopersandpublishersthatyouknow\": true,\r\n        \"popularvrgames\": true,\r\n        \"homepagetabs\": true,\r\n        \"gamesstreamingnow\": true,\r\n        \"under\": true,\r\n        \"updatesandoffers\": true,\r\n        \"homepagesidebar\": true\r\n    },\r\n\r\n    // 'show_keylol_links': false, // not in use, option is commented out\r\n    \"show_package_info\": false,\r\n    \"show_steamchart_info\": true,\r\n    \"show_steamspy_info\": true,\r\n    \"show_early_access\": true,\r\n    \"show_alternative_linux_icon\": false,\r\n    \"show_itad_button\": false,\r\n    \"skip_got_steam\": false,\r\n\r\n    \"installsteam\": \"show\",\r\n    \"openinnewtab\": false,\r\n    \"keepssachecked\": false,\r\n    \"showemptywishlist\": true,\r\n    \"user_notes_app\": true,\r\n    \"user_notes_wishlist\": true,\r\n    \"showwishliststats\": true,\r\n    \"user_notes\": {},\r\n    \"user_notes_adapter\": \"synced_storage\",\r\n    \"replaceaccountname\": true,\r\n    \"showlanguagewarning\": true,\r\n    \"showlanguagewarninglanguage\": \"english\",\r\n    \"homepage_tab_selection\": \"remember\",\r\n    \"homepage_tab_last\": null,\r\n    \"send_age_info\": true,\r\n    \"removebroadcasts\": false,\r\n    \"mp4video\": false,\r\n    \"horizontalscrolling\": true,\r\n    \"showsupportinfo\": true,\r\n    \"showdrm\": true,\r\n    \"regional_hideworld\": false,\r\n    \"showinvnav\": true,\r\n    \"quickinv\": true,\r\n    \"quickinv_diff\": -0.01,\r\n    \"community_default_tab\": \"\",\r\n    \"showallachievements\": false,\r\n    \"showallstats\": true,\r\n    \"showachinstore\": true,\r\n    \"showcomparelinks\": false,\r\n    \"hideactivelistings\": false,\r\n    \"showlowestmarketprice\": true,\r\n    \"hidespamcomments\": false,\r\n    \"spamcommentregex\": \"[\\\\u2500-\\\\u25FF]\",\r\n    \"wlbuttoncommunityapp\": true,\r\n    \"removeguideslanguagefilter\": false,\r\n    \"disablelinkfilter\": false,\r\n    \"sortfriendsby\": \"default_ASC\",\r\n    \"sortreviewsby\": \"default_ASC\",\r\n    \"sortgroupsby\": \"default_ASC\",\r\n    \"show1clickgoo\": true,\r\n    \"show_profile_link_images\": \"gray\",\r\n    \"show_custom_themes\": true,\r\n    \"profile_steamrepcn\": true,\r\n    \"profile_steamgifts\": true,\r\n    \"profile_steamtrades\": true,\r\n    \"profile_bartervg\": true,\r\n    \"profile_steamrep\": true,\r\n    \"profile_steamdbcalc\": true,\r\n    \"profile_astats\": true,\r\n    \"profile_backpacktf\": true,\r\n    \"profile_astatsnl\": true,\r\n    \"profile_steamid\": true,\r\n    \"profile_custom_link\": [\r\n        {\r\n            \"enabled\": true,\r\n            \"name\": \"Google\",\r\n            \"url\": \"google.com/search?q=[ID]\",\r\n            \"icon\": \"www.google.com/images/branding/product/ico/googleg_lodp.ico\"\r\n        },\r\n    ],\r\n    \"fav_emoticons\": [],\r\n    \"group_steamgifts\": true,\r\n    \"steamcardexchange\": true,\r\n    \"purchase_dates\": true,\r\n    \"show_badge_progress\": true,\r\n    \"show_coupon\": true,\r\n    \"show_wishlist_link\": true,\r\n    \"show_wishlist_count\": true,\r\n    \"show_progressbar\": true,\r\n    \"show_backtotop\": false,\r\n\r\n    \"profile_showcase_twitch\": true,\r\n    \"profile_showcase_own_twitch\": false,\r\n    \"profile_showcase_twitch_profileonly\": false,\r\n\r\n    \"itad_import_library\": false,\r\n    \"itad_import_wishlist\": false,\r\n    \"add_to_waitlist\": false,\r\n\r\n    \"context_steam_store\": false,\r\n    \"context_steam_market\": false,\r\n    \"context_itad\": false,\r\n    \"context_bartervg\": false,\r\n    \"context_steamdb\": false,\r\n    \"context_steamdb_instant\": false,\r\n    \"context_steam_keys\": false,\r\n});\r\nSyncedStorage.persistent = [\r\n    \"user_notes\",\r\n    \"user_notes_adapter\",\r\n];\r\n\r\nexport {SyncedStorage};\r\n","import {BackgroundSimple} from \"../BackgroundSimple\";\r\nimport {ExtensionResources} from \"../ExtensionResources\";\r\nimport {Language} from \"./Language\";\r\nimport {SyncedStorage} from \"../Storage/SyncedStorage\";\r\n\r\n\r\nclass Localization {\r\n\r\n    static loadLocalization(code) {\r\n        return ExtensionResources.getJSON(`/localization/${code}.json`);\r\n    }\r\n\r\n    static init() {\r\n        if (Localization._promise) { return Localization._promise; }\r\n\r\n        let currentSteamLanguage = Language.getCurrentSteamLanguage();\r\n        const storedSteamLanguage = SyncedStorage.get(\"language\");\r\n        if (currentSteamLanguage === null) {\r\n            currentSteamLanguage = storedSteamLanguage;\r\n        } else if (currentSteamLanguage !== storedSteamLanguage) {\r\n            SyncedStorage.set(\"language\", currentSteamLanguage);\r\n            BackgroundSimple.action(\"clearpurchases\");\r\n        }\r\n\r\n        function deepAssign(target, source) {\r\n\r\n            // Object.assign() but deep-assigning objects recursively\r\n            for (const [key, val] of Object.entries(source)) {\r\n                if (typeof target[key] === \"undefined\") {\r\n                    console.warn(\"The key %s doesn't exist in the English localization file\", key);\r\n                    continue;\r\n                }\r\n                if (typeof val === \"object\") {\r\n                    deepAssign(target[key], val);\r\n                } else if (val !== \"\") {\r\n                    target[key] = val;\r\n                }\r\n            }\r\n            return target;\r\n        }\r\n\r\n        const local = Language.getLanguageCode(currentSteamLanguage);\r\n        const codes = [\"en\"];\r\n        if (local !== null && local !== \"en\") {\r\n            codes.push(local);\r\n        }\r\n        Localization._promise = Promise.all(\r\n            codes.map(lc => Localization.loadLocalization(lc))\r\n        ).then(([english, local]) => {\r\n            Localization.str = english;\r\n            if (local) {\r\n                deepAssign(Localization.str, local);\r\n            }\r\n            return Localization.str;\r\n        });\r\n        return Localization._promise;\r\n    }\r\n\r\n    static then(onDone, onCatch) {\r\n        return Localization.init().then(onDone, onCatch);\r\n    }\r\n\r\n    static getString(key) {\r\n\r\n        // Source: http://stackoverflow.com/a/24221895\r\n        const path = key.split(\".\").reverse();\r\n        let current = Localization.str;\r\n\r\n        while (path.length) {\r\n            if (typeof current !== \"object\") {\r\n                return null;\r\n            }\r\n            current = current[path.pop()];\r\n        }\r\n        return current;\r\n    }\r\n}\r\n\r\nLocalization._promise = null;\r\n\r\n\r\nexport {Localization};\r\n","\r\nclass BackgroundSimple {\r\n    static message(message) {\r\n        return browser.runtime.sendMessage(message);\r\n    }\r\n\r\n    static action(requested, ...params) {\r\n        if (!params.length) { return this.message({\"action\": requested}); }\r\n        return this.message({\"action\": requested, \"params\": params});\r\n    }\r\n}\r\n\r\nexport {BackgroundSimple};\r\n","import {SyncedStorage} from \"./Storage/SyncedStorage\";\r\n\r\nconst PermissionOptions = Object.freeze({\r\n    \"context_steam_store\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steam_market\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_itad\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_bartervg\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steamdb\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steamdb_instant\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n    \"context_steam_keys\": {\r\n        \"persistent\": true,\r\n        \"permissions\": [\"contextMenus\"]\r\n    },\r\n});\r\n\r\nclass Permissions {\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static contains(permissionList) {\r\n        return browser.permissions.contains({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static async request(permissionList) {\r\n        // Prevents requesting permissions that are not optional (contextMenus for Firefox)\r\n        if (await this.contains(permissionList)) { return true; }\r\n\r\n        return browser.permissions.request({\"permissions\": permissionList});\r\n    }\r\n\r\n    /**\r\n     * @return Promise\r\n     */\r\n    static remove(permissionList) {\r\n        if (permissionList.includes(\"contextMenus\")) {\r\n            browser.contextMenus.removeAll();\r\n        }\r\n        return browser.permissions.remove({\"permissions\": permissionList});\r\n    }\r\n\r\n    static async when(permission, onAdded, onRemoved) {\r\n        if (onAdded) {\r\n            if (await Permissions.contains([permission])) {\r\n                onAdded();\r\n            }\r\n\r\n            browser.permissions.onAdded.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onAdded();\r\n                }\r\n            });\r\n        }\r\n\r\n        if (onRemoved) {\r\n            browser.permissions.onRemoved.addListener(p => {\r\n                if (p.permissions.includes(permission)) {\r\n                    onRemoved();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    static requestOption(option) {\r\n        return Permissions.request(PermissionOptions[option].permissions);\r\n    }\r\n\r\n    static removeOption(optionToRemove) {\r\n\r\n        // If any of the permissions is in use by another option, don't remove.\r\n        const unusedPermissions = Permissions._getUnusedPermissions(optionToRemove);\r\n        if (unusedPermissions.length === 0) {\r\n            return Promise.resolve(true);\r\n        }\r\n\r\n        return Permissions.remove(unusedPermissions);\r\n    }\r\n\r\n    static _getUnusedPermissions(option) {\r\n        const used = new Set();\r\n        for (const [key, setup] of Object.entries(PermissionOptions)) {\r\n            if (option === key || (setup.persistent && !SyncedStorage.get(key))) {\r\n                continue;\r\n            }\r\n\r\n            for (const p of setup.permissions) {\r\n                used.add(p);\r\n            }\r\n        }\r\n\r\n        const unused = new Set();\r\n        for (const p of PermissionOptions[option].permissions) {\r\n            if (!used.has(p)) {\r\n                unused.add(p);\r\n            }\r\n        }\r\n\r\n        return Array.from(unused.values());\r\n    }\r\n}\r\n\r\nexport {PermissionOptions, Permissions};\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FCountTradeItems extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        return document.querySelector(\".error_page_links\") === null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        HTML.afterEnd(\r\n            document.querySelector(\"#your_slots\").parentNode,\r\n            '<div id=\"your_slots_count\" class=\"trade_item_box\"><span id=\"your_items_count\"></span></div>',\r\n        );\r\n        HTML.afterEnd(\r\n            document.querySelector(\"#their_slots\").parentNode,\r\n            \"<div id='their_slots_count' class='trade_item_box'><span id='their_items_count'></span></div>\",\r\n        );\r\n\r\n        new MutationObserver(mutations => {\r\n\r\n            for (const mutation of mutations) {\r\n\r\n                for (const node of mutation.addedNodes) {\r\n\r\n                    if (!node.classList || !node.classList.contains(\"item\")) { continue; }\r\n\r\n                    const yourItemsCountNode = document.querySelector(\"#your_items_count\");\r\n                    const theirItemsCountNode = document.querySelector(\"#their_items_count\");\r\n\r\n                    const yourItems = document.querySelectorAll(\"#your_slots .has_item\").length;\r\n                    if (yourItems > 0) {\r\n                        const text = yourItems === 1\r\n                            ? Localization.str.tradeoffer.num_item\r\n                            : Localization.str.tradeoffer.num_items;\r\n\r\n                        yourItemsCountNode.textContent = text.replace(\"__num__\", yourItems);\r\n                        document.querySelector(\"#your_slots_count\").style.display = \"block\"; // TODO slideDown\r\n                    } else {\r\n                        document.querySelector(\"#your_slots_count\").style.display = \"none\"; // TODO slideUp\r\n                    }\r\n\r\n                    const theirItems = document.querySelectorAll(\"#their_slots .has_item\").length;\r\n                    if (theirItems > 0) {\r\n                        const text = theirItems === 1\r\n                            ? Localization.str.tradeoffer.num_item\r\n                            : Localization.str.tradeoffer.num_items;\r\n\r\n                        theirItemsCountNode.textContent = text.replace(\"__num__\", theirItems);\r\n                        document.querySelector(\"#their_slots_count\").style.display = \"block\"; // TODO slideDown\r\n                    } else {\r\n                        document.querySelector(\"#their_slots_count\").style.display = \"none\"; // TODO slideUp\r\n                    }\r\n\r\n                    yourItemsCountNode.className = \"\";\r\n                    theirItemsCountNode.className = \"\";\r\n\r\n                    if (yourItems === theirItems) {\r\n                        yourItemsCountNode.classList.add(\"es_same\");\r\n                        theirItemsCountNode.classList.add(\"es_same\");\r\n                    } else if (yourItems > theirItems) {\r\n                        yourItemsCountNode.classList.add(\"es_higher\");\r\n                        theirItemsCountNode.classList.add(\"es_lower\");\r\n                    } else {\r\n                        yourItemsCountNode.classList.add(\"es_lower\");\r\n                        theirItemsCountNode.classList.add(\"es_higher\");\r\n                    }\r\n                }\r\n            }\r\n        }).observe(document, {\"subtree\": true, \"childList\": true});\r\n    }\r\n}\r\n","import {Feature} from \"../../../Modules/Feature/Feature\";\r\nimport {HTML, Localization} from \"../../../../modulesCore\";\r\n\r\nexport default class FMyTradeOffersLink extends Feature {\r\n\r\n    checkPrerequisites() {\r\n        this._linksNode = document.querySelector(\".error_page_links\");\r\n        return this._linksNode !== null;\r\n    }\r\n\r\n    apply() {\r\n\r\n        HTML.beforeEnd(\r\n            this._linksNode,\r\n            `<div class=\"black_square_btn\" id=\"back_to_tradeoffers_btn\"> <a href=\"https://steamcommunity.com/my/tradeoffers\"><div class=\"cap left\"></div><div class=\"cap right\"></div>${Localization.str.tradeoffer.back}</a></div>`,\r\n        );\r\n    }\r\n}\r\n","import {Context} from \"../../../Modules/Context/Context\";\r\nimport ContextType from \"../../../Modules/Context/ContextType\";\r\n\r\nimport FCountTradeItems from \"./FCountTradeItems\";\r\nimport FMyTradeOffersLink from \"./FMyTradeOffersLink\";\r\n\r\nexport class CTradeOffer extends Context {\r\n\r\n    constructor() {\r\n        super(ContextType.TRADE_OFFER, [\r\n            FCountTradeItems,\r\n            FMyTradeOffersLink,\r\n        ]);\r\n    }\r\n}\r\n","import {FeatureManager} from \"../Feature/FeatureManager\";\r\n\r\nclass Context {\r\n\r\n    constructor(type, features) {\r\n        this._callbacks = [];\r\n        this.type = type;\r\n        this.features = features.map(Ref => new Ref(this));\r\n    }\r\n\r\n    applyFeatures() {\r\n        return FeatureManager.apply(this.features);\r\n    }\r\n\r\n    registerCallback(fn) {\r\n        this._callbacks.push(fn);\r\n    }\r\n\r\n    triggerCallbacks(...params) {\r\n        for (const callback of this._callbacks) {\r\n            callback(...params);\r\n        }\r\n    }\r\n}\r\n\r\nexport {Context};\r\n","import {CTradeOffer} from \"./CTradeOffer\";\r\n\r\nimport {Localization, SyncedStorage} from \"../../../../modulesCore\";\r\n\r\n(async function() {\r\n\r\n    try {\r\n        await SyncedStorage;\r\n        await Localization;\r\n    } catch (err) {\r\n        console.group(\"Augmented Steam initialization\");\r\n        console.error(\"Failed to initiliaze Augmented Steam\");\r\n        console.error(err);\r\n        console.groupEnd();\r\n\r\n        return;\r\n    }\r\n\r\n    new CTradeOffer().applyFeatures();\r\n})();\r\n"],"sourceRoot":""}